"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[36],{36:(ne,A,f)=>{f.r(A),f.d(A,{GroupServerPageModule:()=>ae});var w=f(177),D=f(4341),h=f(5374),E=f(9858),S=f(467),I=f(4237),F=f(92),L=f(8326),e=f(3953),M=f(9900),V=f(8065),U=f(755),X=f(4234),J=f(482),Y=f(3656);const z=["RegisterNewServer"],K=["ServerDisplayName"],H=()=>[0,.4,.6,1];function W(l,m){1&l&&(e.j41(0,"div",16),e.EFF(1,"A"),e.k0s())}function Z(l,m){if(1&l){const a=e.RV6();e.j41(0,"div",9)(1,"div",10),e.DNE(2,W,2,0,"div",11),e.j41(3,"ion-item",12),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.OpenNewServerForm())}),e.nrm(4,"ion-icon",13),e.j41(5,"ion-label"),e.EFF(6),e.k0s()()(),e.j41(7,"ion-item",14),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.toggle_online())}),e.j41(8,"ion-label",15),e.EFF(9),e.k0s()()()}if(2&l){const a=e.XpG();e.R7$(2),e.Y8G("ngIf",a.global.ShowHint),e.R7$(4),e.JRh(a.lang.text.GroupServer.JoinedServerList),e.R7$(3),e.JRh(a.lang.text.Profile.LogOut)}}function Q(l,m){1&l&&(e.j41(0,"div",16),e.EFF(1,"Ctrl + Enter"),e.k0s())}function q(l,m){if(1&l){const a=e.RV6();e.j41(0,"ion-item",14),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.add_dev_test_server())}),e.j41(1,"ion-label",26),e.EFF(2),e.k0s()()}if(2&l){const a=e.XpG(2);e.R7$(2),e.JRh(a.lang.text.GroupServer.UseDevTestServer)}}function ee(l,m){if(1&l){const a=e.RV6();e.j41(0,"ion-item",14),e.bIt("click",function(){const i=e.eBV(a).$implicit,s=e.XpG(2);return e.Njj(s.link_group(i.isOfficial,i.target))}),e.nrm(1,"div",27),e.j41(2,"ion-label",28)(3,"h2"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s()(),e.j41(7,"ion-button",29),e.bIt("click",function(){const i=e.eBV(a).$implicit,s=e.XpG(2);return e.Njj(s.edit_server_info(i.isOfficial,i.target))}),e.EFF(8),e.k0s(),e.j41(9,"ion-button",30),e.bIt("click",function(){const i=e.eBV(a).$implicit,s=e.XpG(2);return e.Njj(s.remove_server(i.isOfficial,i.target))}),e.EFF(10),e.k0s()()}if(2&l){const a=m.$implicit,t=e.XpG(2);e.R7$(),e.Aen("background-color: "+t.statusBar.colors[t.statusBar.groupServer[a.isOfficial][a.target]||"offline"]),e.R7$(3),e.JRh(a.name),e.R7$(2),e.JRh((a.useSSL?"https://":"http://")+a.address+":"+a.port),e.R7$(2),e.SpI(" ",t.lang.text.GroupServer.EditInfo," "),e.R7$(2),e.SpI(" ","online"==t.statusBar.groupServer[a.isOfficial][a.target]?t.lang.text.GroupServer.RemoveAccount:t.lang.text.GroupServer.RemoveUnofficial," ")}}function te(l,m){if(1&l){const a=e.RV6();e.j41(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-item",17)(5,"ion-input",18,1),e.mxI("ngModelChange",function(i){e.eBV(a);const s=e.XpG();return e.DH7(s.dedicated_info.name,i)||(s.dedicated_info.name=i),e.Njj(i)}),e.k0s()(),e.j41(7,"ion-item",17)(8,"ion-input",19),e.mxI("ngModelChange",function(i){e.eBV(a);const s=e.XpG();return e.DH7(s.dedicated_info.address,i)||(s.dedicated_info.address=i),e.Njj(i)}),e.k0s(),e.j41(9,"ion-icon",20),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.global.open_custom_site(i.dedicated_info.address))}),e.k0s()(),e.j41(10,"ion-item",17)(11,"ion-input",21),e.mxI("ngModelChange",function(i){e.eBV(a);const s=e.XpG();return e.DH7(s.dedicated_info.key,i)||(s.dedicated_info.key=i),e.Njj(i)}),e.k0s()(),e.j41(12,"div",10),e.DNE(13,Q,2,0,"div",11),e.j41(14,"ion-item",22),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.add_custom_dedicated())}),e.j41(15,"ion-label",23),e.EFF(16),e.k0s()()(),e.j41(17,"ion-item-divider")(18,"ion-label"),e.EFF(19),e.k0s()(),e.DNE(20,q,3,1,"ion-item",24)(21,ee,11,6,"ion-item",25),e.k0s()}if(2&l){const a=e.XpG();e.R7$(3),e.JRh(a.lang.text.GroupServer.RegisterServer),e.R7$(),e.Y8G("disabled",a.add_custom_tog),e.R7$(),e.Y8G("label",a.lang.text.GroupServer.DisplayName),e.R50("ngModel",a.dedicated_info.name),e.Y8G("placeholder",a.lang.text.GroupServer.DisplayName_placeholder),e.R7$(2),e.Y8G("disabled",a.add_custom_tog),e.R7$(),e.Y8G("label",a.lang.text.GroupServer.Address),e.R50("ngModel",a.dedicated_info.address),e.R7$(2),e.Y8G("disabled",a.add_custom_tog),e.R7$(),e.Y8G("label",a.lang.text.GroupServer.Key),e.R50("ngModel",a.dedicated_info.key),e.R7$(2),e.Y8G("ngIf",a.global.ShowHint),e.R7$(),e.Y8G("disabled",a.add_custom_tog),e.R7$(2),e.JRh(a.lang.text.GroupServer.submit),e.R7$(3),e.JRh(a.lang.text.GroupServer.JoinedServerList),e.R7$(),e.Y8G("ngIf",a.CanAddTestServer),e.R7$(),e.Y8G("ngForOf",a.servers)}}const ie=[{path:"",component:(()=>{var l;class m{constructor(t,i,s,n,r,o,c,g,P,G){this.nakama=t,this.p5toast=i,this.statusBar=s,this.indexed=n,this.lang=r,this.global=o,this.navCtrl=c,this.alertCtrl=g,this.route=P,this.router=G,this.session_uid="",this.isMobilePWA=!1,this.CanAddTestServer=!1,this.OnlineToggle=!1,this.ShowServerList=!1,this.isClickDisplayNameEdit=!1,this.dedicated_info={name:void 0,address:void 0,target:void 0,port:void 0,useSSL:void 0,isOfficial:void 0,key:void 0},this.add_custom_tog=!1,this.isOverrideButtonPressed=!1,this.announce_update_profile=!1,this.original_profile={},this.file_sel_id="",this.can_auto_modified=!1}ngOnInit(){this.servers=this.nakama.get_all_server_info(!0),this.file_sel_id=`self_profile_${(new Date).getTime()}`,this.original_profile=JSON.parse(JSON.stringify(this.nakama.users.self)),this.nakama.users.self.img||this.indexed.loadTextFromUserPath("servers/self/profile.img",(t,i)=>{t&&i&&(this.nakama.users.self.img=i.replace(/"|\\|=/g,""))}),this.nakama.socket_reactive.profile=t=>{this.p5canvas&&this.p5ChangeImageSmooth(t)},this.route.queryParams.subscribe(t=>{const i=this.router.getCurrentNavigation().extras.state;if(i){let s=i.isOfficial,n=i.target;try{this.session_uid=this.nakama.servers[s][n].session.user_id}catch{}}this.initialize()})}initialize(){var t=this;this.gsCanvasDiv=document.getElementById("GroupServerCanvasDiv"),this.OnlineToggle=this.nakama.users.self.online,this.p5canvas=new L(i=>{let n,r,o,c,g,G,u,v,y,P=1,R="0, 0, 0",C=0,O=!!this.session_uid,$=!1,p=i.createDiv();i.setup=()=>{if(O){let d=i.color(`#${(this.session_uid.replace(/[^5-79a-b]/g,"")+"abcdef").substring(0,6)}`);R=`${i.red(d)}, ${i.green(d)}, ${i.blue(d)}`,G=i.createDiv(),G.style("width","100%"),G.style("height","100%"),G.style("position","fixed"),G.style("background-image",`linear-gradient(to top, rgba(${R}, 0), rgba(${R}, 0))`),G.parent(this.gsCanvasDiv)}i.noCanvas(),i.pixelDensity(1),u=i.createDiv(),u.style("width","156px"),u.style("height","156px"),u.style("position","absolute"),u.style("top","120px"),u.style("left","50%"),u.style("transform","translateX(-50%)"),u.style("border-radius","156px"),u.style("background-image","url(assets/data/avatar.svg)"),u.style("background-position","center"),u.style("background-repeat","no-repeat"),u.style("background-size","cover"),u.style("cursor","pointer"),u.parent(this.gsCanvasDiv),u.elt.onclick=()=>{this.change_img_from_file()},u.elt.oncontextmenu=()=>(function(){var N=(0,S.A)(function*(){let j=yield t.global.GetValueFromClipboard();switch(j.type){case"text/plain":yield t.check_if_clipboard_available(j.value);break;case"image/png":return void t.inputImageSelected({target:{files:[j.value]}})}});return function(){return N.apply(this,arguments)}}()(),!1),v=i.createDiv();const T="36px";v.style("background-color",this.OnlineToggle?this.statusBar.colors.online:this.statusBar.colors.offline),v.style("width",T),v.style("height",T),v.style("position","absolute"),v.style("top","8px"),v.style("left","118px"),v.style("border-radius",T),v.style("cursor","pointer"),v.style("z-index","1"),v.parent(u),v.elt.onclick=()=>{this.toggle_online()},c=i.createImg(this.nakama.users.self.img,"profile_img"),c.style("width","156px"),c.style("height","156px"),c.style("border-radius","156px"),c.style("position","absolute"),c.style("object-fit","cover"),this.nakama.users.self.img||c.hide(),c.parent(u),g=i.createImg(void 0,"before_img"),g.style("width","156px"),g.style("height","156px"),g.style("border-radius","156px"),g.style("position","absolute"),g.style("object-fit","cover"),g.hide(),g.parent(u),this.p5ChangeImageSmooth=d=>{u.style("background-image","url(assets/data/avatar.svg)"),d?(g.elt.src=void 0,g.hide()):(g.elt.src=c.elt.src,g.show()),c.elt.src=d,P=1,i.loop(),this.nakama.users.self.img=d,this.sync_to_all_server(),document.getElementById(this.file_sel_id).value="",d?c.show():c.hide()};let x=i.createDiv();x.style("width","100%"),x.style("position","absolute"),x.style("top","330px"),x.style("display","flex"),x.style("flex-direction","column"),x.parent(this.gsCanvasDiv);const B="36px";if(n=i.createDiv(),n.style("font-size",B),n.style("font-weight","bold"),n.style("align-self","center"),n.style("width","80%"),n.style("text-align","center"),n.parent(x),r=i.createSpan(this.nakama.users.self.display_name||this.lang.text.Profile.noname_user),r.parent(n),i.createSpan('<ion-icon name="pencil-outline" style="width: 24px; height: 24px; margin-left: 8px"></ion-icon>').parent(n),n.elt.onclick=()=>{$=!0,o.value(this.nakama.users.self.display_name?r.html():""),o.show(),n.hide(),o.elt.focus(),this.isClickDisplayNameEdit=!0},o=i.createInput(),o.style("font-size",B),o.style("font-weight","bold"),o.style("align-self","center"),o.style("width","80%"),o.style("text-align","center"),o.attribute("placeholder",this.lang.text.Profile.name_placeholder),n.style("text-align","center"),o.parent(x),o.hide(),o.elt.addEventListener("input",()=>{this.nakama.users.self.display_name=o.value()}),o.elt.addEventListener("focusout",()=>{$=!1,this.nakama.users.self.display_name=o.value(),r.html(`${o.value()||this.lang.text.Profile.noname_user}`),o.hide(),n.show()}),this.session_uid){let d=i.createDiv(this.session_uid);d.style("margin-top","36px"),d.style("color","var(--ion-color-medium)"),d.style("width","80%"),d.style("text-align","center"),d.style("align-self","center"),d.style("cursor","copy"),d.parent(x),d.elt.onclick=()=>{this.copy_id()}}p.style("margin-top","60px"),p.style("width","80%"),p.style("align-self","center"),p.style("max-width","384px"),p.style("height","180px"),p.style("background-color","#8888"),p.style("text-align","center"),p.style("border-radius","24px"),p.style("display","flex"),p.style("flex-direction","column"),p.parent(x),this.OnlineToggle&&p.hide();let b=i.createInput(this.nakama.users.self.email);b.style("align-self","center"),b.style("margin-top","24px"),b.style("width","50%"),b.style("text-align","center"),b.attribute("placeholder","test@example.com"),b.parent(p),b.elt.onchange=()=>{this.nakama.users.self.email=b.value(),this.email_modified()},b.elt.onkeypress=d=>{"Enter"==d.key&&_.elt.focus()};let _=i.createInput();_.style("margin-top","10px"),_.style("align-self","center"),_.style("width","50%"),_.style("text-align","center"),_.attribute("type","password"),_.attribute("placeholder",this.lang.text.Profile.at_least),_.parent(p),_.elt.onchange=()=>{this.nakama.users.self.password=_.value()},_.elt.onkeypress=d=>{"Enter"==d.key&&(this.nakama.users.self.password=_.value(),y.elt.disabled=!0,this.toggle_online())},this.p5PasswordInput=_,setTimeout(()=>{this.nakama.users.self.email?this.nakama.users.self.password||_.elt.focus():b.elt.focus()},500),setTimeout(()=>{this.nakama.users.self.email?this.nakama.users.self.password||_.elt.focus():b.elt.focus()},150),y=i.createButton(this.OnlineToggle?this.lang.text.Profile.LogOut:this.lang.text.Profile.login_toggle),y.style("margin-top","17px"),y.style("align-self","center"),y.style("text-align","center"),y.style("font-size","24px"),y.style("border-radius","16px"),y.style("padding","12px 30px"),y.parent(p),y.elt.onclick=()=>{y.elt.disabled=!0,this.toggle_online()}},i.draw=()=>{P>0&&(P-=.025,g.style("opacity",`${P}`),c.style("opacity",""+(1-P))),this.nakama.users.self.online?this.lerpVal<1?this.lerpVal+=.025:this.lerpVal=1:this.lerpVal>0?this.lerpVal-=.025:this.lerpVal=0,O&&C<1&&(C+=.025),c.style("filter",`grayscale(${i.lerp(.9,0,this.lerpVal)}) contrast(${i.lerp(1.4,1,this.lerpVal)})`),g.style("filter",`grayscale(${i.lerp(.9,0,this.lerpVal)}) contrast(${i.lerp(1.4,1,this.lerpVal)})`),O&&G.style("background-image",`linear-gradient(to top, rgba(${R}, ${i.min(1,C)/2}), rgba(${R}, 0))`),P<=0&&(this.lerpVal>=1||this.lerpVal<=0)&&(!O||C>=1)&&(this.nakama.users.self.img&&u.style("background-image",""),this.OnlineToggle=this.lerpVal>=1,this.OnlineToggle?(p.hide(),y.html(this.lang.text.Profile.LogOut),v.style("background-color",this.statusBar.colors.online)):(p.show(),p.style("display","flex"),y.html(this.lang.text.Profile.login_toggle),v.style("background-color",this.statusBar.colors.offline)),this.nakama.users.self.display_name&&(r.html(this.nakama.users.self.display_name),o.value(this.nakama.users.self.display_name)),this.ShowServerList=this.OnlineToggle,this.p5PasswordInput.value(""),y.elt.disabled=!1,i.noLoop())},i.keyPressed=k=>{"Enter"==k.code&&$&&o.elt.blur()}}),this.ShowServerList=this.OnlineToggle,this.CanAddTestServer=0==Object.keys(this.nakama.servers.official).length,this.isMobilePWA="MobilePWA"==F.aH}add_dev_test_server(){var t=this;return(0,S.A)(function*(){t.CanAddTestServer=!(yield t.nakama.WatchAdsAndGetDevServerInfo()),t.servers=t.nakama.get_all_server_info(!0)})()}link_group(t,i){var s=this;return(0,S.A)(function*(){if(s.isOverrideButtonPressed)s.isOverrideButtonPressed=!1;else if("offline"==s.statusBar.groupServer[t][i])yield s.nakama.link_group(t,i),s.original_profile=JSON.parse(JSON.stringify(s.nakama.users.self));else try{s.nakama.servers[t][i].socket.disconnect(!0)}catch{s.nakama.OnSocketDisconnect(t,i)}})()}add_custom_dedicated(){if(this.add_custom_tog)return;if(!this.dedicated_info.name)return void this.p5toast.show({text:this.lang.text.GroupServer.NeedSetDIsplayName});this.add_custom_tog=!0;let t=(this.dedicated_info.address||"192.168.0.1").split("://"),i=t.pop().split(":"),s=t.pop();s?s+=":":s=this.global.checkProtocolFromAddress(i[0])?"https:":"http:",this.dedicated_info.address=i[0],this.dedicated_info.port=Number(i[1])||7350,this.dedicated_info.useSSL="https:"==window.location.protocol&&!F.Yl,this.dedicated_info.useSSL=this.dedicated_info.useSSL||"https:"==s,this.dedicated_info.key=this.dedicated_info.key||"defaultkey",this.nakama.add_group_server(this.dedicated_info,()=>{this.servers=this.nakama.get_all_server_info(!0),this.link_group(this.dedicated_info.isOfficial,this.dedicated_info.target),this.dedicated_info.name=void 0,this.dedicated_info.address=void 0,this.dedicated_info.target=void 0,this.dedicated_info.port=void 0,this.dedicated_info.key=void 0,this.dedicated_info.useSSL=void 0,this.dedicated_info.isOfficial=void 0}),this.RegisterNewServer.dismiss(),setTimeout(()=>{this.add_custom_tog=!1},1e3)}edit_server_info(t,i){this.RegisterNewServer.dismiss(),this.isOverrideButtonPressed=!0,this.navCtrl.navigateForward("server-detail",{state:{data:this.nakama.servers[t][i].info}})}remove_server(t,i){var s=this;return(0,S.A)(function*(){s.isOverrideButtonPressed=!0;let n=function(){var r=(0,S.A)(function*(){try{yield s.nakama.remove_server(t,i)}catch(o){console.log("\uc11c\ubc84 \uc0ad\uc81c \uc624\ub958: ",o)}s.servers=s.nakama.get_all_server_info(!0)});return function(){return r.apply(this,arguments)}}();"online"===s.statusBar.groupServer[t][i]?s.alertCtrl.create({header:s.lang.text.GroupServer.RemoveAccountReally,message:s.lang.text.ChatRoom.CannotUndone,buttons:[{text:s.lang.text.UserFsDir.OK,cssClass:"redfont",handler:n}]}).then(r=>r.present()):n()})()}ionViewWillLeave(){var t=this;return(0,S.A)(function*(){delete t.global.p5KeyShortCut.Escape,delete t.global.p5KeyShortCut.AddAct,delete t.global.p5KeyShortCut.EnterAct,t.nakama.on_socket_disconnected.group_unlink_by_user&&delete t.nakama.on_socket_disconnected.group_unlink_by_user,delete t.nakama.socket_reactive.profile;let i=Object.keys(t.nakama.users.self),s=!1;for(let n=0,r=i.length;n<r;n++)if("img"!=i[n]&&t.nakama.users.self[i[n]]!=t.original_profile[i[n]]){s=!0;break}if(t.nakama.users.self.img=t.tmp_img||t.nakama.users.self.img,s){let n=t.nakama.get_all_online_server();for(let r=0,o=n.length;r<o;r++){if(t.nakama.users.self.display_name!=t.original_profile.display_name)try{yield n[r].client.updateAccount(n[r].session,{display_name:t.nakama.users.self.display_name});try{yield n[r].socket.sendMatchState(t.nakama.self_match[n[r].info.isOfficial][n[r].info.target].match_id,I.I.EDIT_PROFILE,encodeURIComponent("info"))}catch{}}catch{}if(t.isClickDisplayNameEdit&&t.nakama.channels_orig[n[r].info.isOfficial][n[r].info.target]){let c=Object.keys(t.nakama.channels_orig[n[r].info.isOfficial][n[r].info.target]);c&&c.forEach(g=>{n[r].socket.writeChatMessage(g,{user_update:"modify_data",noti_form:t.original_profile.display_name==t.nakama.users.self.display_name?`: ${t.original_profile.display_name}`:`: ${t.original_profile.display_name} -> ${t.nakama.users.self.display_name}`})})}}t.nakama.save_self_profile()}})()}ngOnDestroy(){this.route.queryParams.unsubscribe(),this.p5canvas.remove()}sync_to_all_server(){var t=this;return(0,S.A)(function*(){let i=t.nakama.get_all_online_server();t.nakama.save_self_profile(),t.indexed.saveTextFileToUserPath(JSON.stringify(t.nakama.users.self.img),"servers/self/profile.img"),t.tmp_img="";for(let s=0,n=i.length;s<n;s++){if(t.nakama.users.self.img)try{yield i[s].client.writeStorageObjects(i[s].session,[{collection:"user_public",key:"profile_image",value:{img:t.nakama.users.self.img},permission_read:2,permission_write:1}]),yield i[s].socket.sendMatchState(t.nakama.self_match[i[s].info.isOfficial][i[s].info.target].match_id,I.I.EDIT_PROFILE,encodeURIComponent("image"))}catch(r){console.log("inputImageSelected_err: ",r)}else try{yield i[s].client.deleteStorageObjects(i[s].session,{object_ids:[{collection:"user_public",key:"profile_image"}]}),yield i[s].socket.sendMatchState(t.nakama.self_match[i[s].info.isOfficial][i[s].info.target].match_id,I.I.EDIT_PROFILE,encodeURIComponent("image"))}catch(r){console.error("inputImageSelected_err: ",r)}try{yield i[s].client.rpc(i[s].session,"send_noti_all_fn",{user_id:i[s].session.user_id,noti_id:I.I.USER_PROFILE_IMAGE_CHANGED,persistent:!1})}catch(r){console.log("\uc11c\ubc84\uc5d0 \uc54c\ub9ac\uae30 \uc2e4\ud328: ",r)}t.announce_update_profile=!1}})()}change_img_from_file(){var t=this;return(0,S.A)(function*(){t.announce_update_profile=!0,t.nakama.users.self.img?t.p5ChangeImageSmooth():document.getElementById(t.file_sel_id).click()})()}inputImageSelected(t){var i=this;return(0,S.A)(function*(){let s=setInterval(()=>{},110);setTimeout(()=>{clearInterval(s)},1500);let n=yield i.global.GetBase64ThroughFileReader(t.target.files[0]);i.nakama.limit_image_size(n,o=>{i.p5ChangeImageSmooth(o.canvas.toDataURL())}),document.getElementById(i.file_sel_id).value=""})()}ionViewDidEnter(){this.can_auto_modified=!0,this.global.p5KeyShortCut.AddAct=()=>{this.ShowServerList&&this.OpenNewServerForm()},this.global.p5KeyShortCut.Escape=()=>{this.navCtrl.pop()}}email_modified(){this.can_auto_modified&&(this.nakama.users.self.online&&this.toggle_online(),this.nakama.users.self.online=!1,delete this.nakama.users.self.password,this.p5PasswordInput.value(""))}toggle_online(){var t=this;return(0,S.A)(function*(){if(t.OnlineToggle=!t.OnlineToggle,t.nakama.users.self.online=t.OnlineToggle,t.OnlineToggle){t.announce_update_profile=!1;try{if(!t.nakama.users.self.email)throw t.p5toast.show({text:t.lang.text.Profile.need_email}),"\uc774\uba54\uc77c \uacf5\ubc31";if(!t.nakama.users.self.password)throw t.p5toast.show({text:t.lang.text.Profile.need_password}),"\ube44\ubc00\ubc88\ud638 \uacf5\ubc31";t.nakama.save_self_profile(),yield t.nakama.init_all_sessions(),t.original_profile=JSON.parse(JSON.stringify(t.nakama.users.self))}catch{t.nakama.users.self.online=!1,t.OnlineToggle=!1}}else t.nakama.logout_all_server(),delete t.nakama.users.self.password,t.nakama.groups.official={},t.nakama.groups.unofficial={},t.nakama.save_groups_with_less_info(),t.nakama.channels_orig.official={},t.nakama.channels_orig.unofficial={},t.nakama.rearrange_channels(),t.nakama.posts_orig.official={},t.nakama.posts_orig.unofficial={},t.nakama.rearrange_posts(),t.nakama.post_counter.official={},t.nakama.post_counter.unofficial={},t.nakama.save_post_counter(),(yield t.indexed.GetFileListFromDB("servers/official")).forEach(n=>t.indexed.removeFileFromUserPath(n)),(yield t.indexed.GetFileListFromDB("servers/unofficial")).forEach(n=>t.indexed.removeFileFromUserPath(n));t.p5canvas.loop()})()}check_if_clipboard_available(t){var i=this;return(0,S.A)(function*(){try{if(0!=t.indexOf("http"))throw"URL \uc8fc\uc18c\uac00 \uc544\ub2d8";yield new Promise((s,n)=>{let r=document.createElement("img");r.src=t,r.onload=()=>{i.p5ChangeImageSmooth(t),r.onload=null,r.onerror=null,r.remove(),s(void 0)},r.onerror=()=>{r.onload=null,r.onerror=null,r.remove(),n()}})}catch{try{if(0!=t.indexOf("data:image"))throw"DataURL \uc8fc\uc18c\uac00 \uc544\ub2d8";i.nakama.limit_image_size(t,n=>i.p5ChangeImageSmooth(n.canvas.toDataURL()))}catch{throw"\uc0ac\uc6a9\ubd88\uac00 \uc774\ubbf8\uc9c0"}}})()}OpenNewServerForm(){this.global.StoreShortCutAct("group-server"),this.RegisterNewServer.onDidDismiss().then(()=>{delete this.global.p5KeyShortCut.EnterAct,this.global.RestoreShortCutAct("group-server")}),this.global.p5KeyShortCut.EnterAct=t=>{t.ctrlKey&&this.add_custom_dedicated()},this.RegisterNewServer.present().then(()=>{"DesktopPWA"==F.aH&&!this.dedicated_info.name&&this.ServerDisplayName.setFocus()})}copy_id(){this.global.WriteValueToClipboard("text/plain",this.session_uid)}}return(l=m).\u0275fac=function(t){return new(t||l)(e.rXU(I.X),e.rXU(M.G),e.rXU(V.j),e.rXU(U.n),e.rXU(X.y),e.rXU(J.z3),e.rXU(Y.q9),e.rXU(h.hG),e.rXU(E.nX),e.rXU(E.Ix))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-group-server"]],viewQuery:function(t,i){if(1&t&&(e.GBs(z,5),e.GBs(K,5)),2&t){let s;e.mGM(s=e.lsd())&&(i.RegisterNewServer=s.first),e.mGM(s=e.lsd())&&(i.ServerDisplayName=s.first)}},decls:13,vars:5,consts:[["RegisterNewServer",""],["ServerDisplayName",""],[1,"ion-no-border"],["slot","start"],["defaultHref",""],["id","GroupServerCanvasDiv",2,"position","absolute","width","100%","height","100%","display","flex"],["style","position: absolute; bottom: 0; width: 100%;",4,"ngIf"],["hidden","","type","file","accept","image/*",3,"change","id"],["initialBreakpoint",".6",3,"breakpoints"],[2,"position","absolute","bottom","0","width","100%"],[2,"position","relative"],["class","shortcut_hint",4,"ngIf"],["button","","slot","header",3,"click"],["name","list-outline",1,"icon_margin"],["button","",3,"click"],["color","tertiary",1,"ion-text-center"],[1,"shortcut_hint"],["button","",3,"disabled"],[1,"ion-text-right",3,"ngModelChange","label","ngModel","placeholder"],["placeholder","(https://)192.168.0.1",1,"ion-text-right",3,"ngModelChange","label","ngModel"],["slot","end","name","open-outline",3,"click"],["placeholder","defaultkey",1,"ion-text-right",3,"ngModelChange","label","ngModel"],["button","",3,"click","disabled"],[1,"ion-text-center"],["button","",3,"click",4,"ngIf"],["button","",3,"click",4,"ngFor","ngForOf"],["color","secondary"],[1,"additional_form","status_bar_single"],[1,"form_margin"],[2,"padding-right","4px",3,"click"],[3,"click"]],template:function(t,i){if(1&t){const s=e.RV6();e.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",3),e.nrm(5,"ion-back-button",4),e.k0s()()(),e.j41(6,"ion-content"),e.nrm(7,"div",5),e.DNE(8,Z,10,3,"div",6),e.j41(9,"input",7),e.bIt("change",function(r){return e.eBV(s),e.Njj(i.inputImageSelected(r))}),e.k0s(),e.j41(10,"ion-modal",8,0),e.DNE(12,te,22,17,"ng-template"),e.k0s()()}2&t&&(e.R7$(3),e.JRh(i.lang.text.Settings.groupServer),e.R7$(5),e.Y8G("ngIf",i.ShowServerList),e.R7$(),e.Y8G("id",i.file_sel_id),e.R7$(),e.Y8G("breakpoints",e.lJ4(4,H)))},dependencies:[w.Sq,w.bT,D.BC,D.vS,h.Jm,h.QW,h.W9,h.eU,h.iq,h.$w,h.uz,h.Dg,h.he,h.BC,h.ai,h.Sb,h.Gw,h.el],styles:[".content_size[_ngcontent-%COMP%]{height:360px}"]}),m})()},{path:"server-detail",loadChildren:()=>f.e(3456).then(f.bind(f,3456)).then(l=>l.ServerDetailPageModule)}];let se=(()=>{var l;class m{}return(l=m).\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[E.iI.forChild(ie),E.iI]}),m})(),ae=(()=>{var l;class m{}return(l=m).\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[w.MD,D.YN,h.bv,se]}),m})()}}]);