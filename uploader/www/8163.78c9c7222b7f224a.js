"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8163,7476],{7476:(N,B,I)=>{I.d(B,{u:()=>j});var $=I(8326),b=I(3953);let j=(()=>{var v;class w{constructor(){this.Buttons={},this.ArrayKeys=[],this.RemoveLock=!1}CreateFloatButton(){this.p5canvas=new $(k=>{let x,T=[],t=R=>{T.push(R),D=0,k.loop()},F=R=>{x=R,R.style("transform-origin","50% 50%"),R.style("opacity","0"),R.style("transform","scale(0)"),D=0,k.loop()},G=()=>{this.LastRemoveQueue.style("transform-origin","50% 50%"),this.LastRemoveQueue.style("opacity","1"),this.LastRemoveQueue.style("transform","scale(1)"),D=0,k.loop()};k.setup=()=>{k.noCanvas(),this.AddAnimateActFunc=t,this.AddButtonQueue=F,this.RemoveButtonQueue=G,k.noLoop()};let D=0,L=R=>k.sin(R*k.PI/2);k.draw=()=>{D+=.07;let R=D>=1;R&&(D=1,x&&(x=null),this.LastRemoveQueue&&(this.LastRemoveQueue.remove(),this.LastRemoveQueue=null,this.LastRemoveKey=null,this.RemoveLock=!1,!this.ArrayKeys.length&&this.p5canvas&&this.p5canvas.remove()),k.noLoop()),x&&(x.style("opacity",`${D}`),x.style("transform",`scale(${L(D)})`)),this.LastRemoveQueue&&(this.LastRemoveQueue.style("opacity",""+(1-D)),this.LastRemoveQueue.style("transform",`scale(${L(1-D)})`));for(let S=T.length-1;S>=0;S--){let E=k.lerp(T[S].start,T[S].end,L(D));T[S].button.style(`right: ${E}px`)}R&&(T.length=0)}})}AddFloatButton(k,T){if(this.LastRemoveKey==k)return;this.p5canvas||this.CreateFloatButton();for(let x of this.ArrayKeys){let F=Number(this.Buttons[x].style("right").split("px").shift());this.AddAnimateActFunc({type:"add",button:this.Buttons[x],start:F,end:F+80})}let t=this.p5canvas.createDiv(`<ion-icon style="width: 36px; height: 36px" name="${T}"></ion-icon>`);return t.style("position: absolute; right: 0; bottom: 56px; z-index: 1"),t.style("width: 64px; height: 64px"),t.style("text-align: center; align-content: center"),t.style("cursor: pointer"),t.style("margin: 16px"),t.style("padding-top: 6px"),t.style("background-color: #8888"),t.style("border-radius: 24px"),this.AddButtonQueue(t),this.Buttons[k]=t,this.ArrayKeys.push(k),t}RemoveFloatButton(k){if(!this.Buttons[k]||this.RemoveLock)return;this.RemoveLock=!0,this.LastRemoveKey=k,this.LastRemoveQueue=this.Buttons[k],delete this.Buttons[k];let T=-1;for(let t=this.ArrayKeys.length-1;t>=0;t--){if(T>=0){let x=Number(this.Buttons[this.ArrayKeys[t]].style("right").split("px").shift());this.AddAnimateActFunc({type:"remove",button:this.Buttons[this.ArrayKeys[t]],start:x,end:x-80})}this.ArrayKeys[t]==k&&(this.RemoveButtonQueue(),this.ArrayKeys.splice(t,1),T=t)}}}return(v=w).\u0275fac=function(k){return new(k||v)},v.\u0275prov=b.jDH({token:v,factory:v.\u0275fac,providedIn:"root"}),w})()},8163:(N,B,I)=>{I.r(B),I.d(B,{AddTodoMenuPageModule:()=>ye});var $=I(177),P=I(4341),b=I(5374),j=I(9858),v=I(467),w=I(8326),O=I(4237),k=I(92),T=I(5402),t=I(3953),x=I(4234),F=I(9900),G=I(345),D=I(755),L=I(3656),R=I(5547),S=I(8065),E=I(482),U=I(7476),V=I(3307);const W=["StartCalendar"],X=["Calendar"],Y=["StoreAt"],J=["ImporantSel"];function z(d,f){if(1&d){const l=t.RV6();t.j41(0,"ion-grid",46)(1,"ion-row")(2,"ion-col",47)(3,"ion-item",48),t.bIt("click",function(){t.eBV(l);const i=t.XpG();return t.Njj(i.doneTodo())}),t.j41(4,"ion-label",49),t.EFF(5),t.k0s()()()()()}if(2&d){const l=t.XpG();t.R7$(3),t.Y8G("disabled",l.isButtonClicked),t.R7$(2),t.JRh(l.lang.text.TodoDetail.TodoComplete)}}function H(d,f){if(1&d&&(t.j41(0,"ion-select-option",54),t.EFF(1),t.k0s()),2&d){const l=f.$implicit;t.Y8G("value",l),t.R7$(),t.SpI("",l.name," ")}}function K(d,f){if(1&d){const l=t.RV6();t.j41(0,"ion-item",50),t.bIt("click",function(){t.eBV(l);const i=t.XpG();return t.Njj(i.StoreAtSelClicked())}),t.j41(1,"ion-select",51,3),t.bIt("ionChange",function(i){t.eBV(l);const o=t.XpG();return t.Njj(o.StoreAtSelChanged(i))}),t.j41(3,"ion-select-option",52),t.EFF(4),t.k0s(),t.DNE(5,H,2,2,"ion-select-option",53),t.k0s()()}if(2&d){const l=t.XpG();t.R7$(),t.Y8G("label",l.lang.text.TodoDetail.StoreAt),t.R7$(3),t.JRh(l.lang.text.TodoDetail.OnThisDevice),t.R7$(),t.Y8G("ngForOf",l.AvailableStorageList)}}function Q(d,f){if(1&d){const l=t.RV6();t.j41(0,"div")(1,"ion-item",50),t.bIt("click",function(){t.eBV(l);const i=t.XpG();return t.Njj(i.ChangeDisconnectStatus())}),t.j41(2,"ion-label",55),t.EFF(3),t.k0s(),t.j41(4,"ion-label",56),t.EFF(5),t.k0s()()()}if(2&d){const l=t.XpG();t.R7$(3),t.JRh(l.userInput.display_store||l.lang.text.TodoDetail.WIP),t.R7$(2),t.JRh(l.userInput.display_creator)}}function Z(d,f){if(1&d){const l=t.RV6();t.j41(0,"ion-item",60),t.bIt("click",function(){t.eBV(l);const i=t.XpG(3);return t.Njj(i.count_selected_worker())}),t.j41(1,"ion-checkbox",61),t.mxI("ngModelChange",function(i){const o=t.eBV(l).$implicit;return t.DH7(o.todo_checked,i)||(o.todo_checked=i),t.Njj(i)}),t.EFF(2),t.k0s()()}if(2&d){const l=f.$implicit;t.R7$(),t.R50("ngModel",l.todo_checked),t.R7$(),t.JRh(l.override_name||l.display_name)}}function q(d,f){if(1&d){const l=t.RV6();t.j41(0,"ion-accordion",54)(1,"ion-item",57)(2,"ion-label"),t.EFF(3),t.k0s()(),t.j41(4,"div",33)(5,"ion-item",58),t.bIt("click",function(){const i=t.eBV(l).$implicit,o=t.XpG(2);return t.Njj(o.toggle_all_user(i.id))}),t.j41(6,"ion-label"),t.EFF(7),t.k0s()(),t.DNE(8,Z,3,2,"ion-item",59),t.k0s()()}if(2&d){const l=f.$implicit,e=t.XpG(2);t.Y8G("value",l.id),t.R7$(3),t.JRh(l.name),t.R7$(4),t.JRh(e.lang.text.TodoDetail.ToggleWorkers),t.R7$(),t.Y8G("ngForOf",e.AvailableWorker[l.id])}}function ee(d,f){if(1&d&&(t.j41(0,"div")(1,"ion-accordion-group",null,4)(3,"ion-accordion")(4,"ion-item",29)(5,"ion-label"),t.EFF(6),t.k0s()(),t.j41(7,"div",33)(8,"ion-accordion-group",null,5),t.DNE(10,q,9,4,"ion-accordion",53),t.k0s()()()()()),2&d){const l=t.XpG();t.R7$(6),t.JRh(l.lang.text.TodoDetail.ManageWorker+" ("+l.SelectedWorkers+")"),t.R7$(4),t.Y8G("ngForOf",l.WorkerGroups)}}function te(d,f){if(1&d&&(t.j41(0,"div",69),t.EFF(1),t.k0s()),2&d){const l=t.XpG().$implicit;t.R7$(),t.SpI("",l.displayTime," ")}}function ie(d,f){1&d&&t.nrm(0,"ion-icon",70)}function ae(d,f){1&d&&t.nrm(0,"ion-icon",71)}function oe(d,f){1&d&&t.nrm(0,"ion-icon",72)}function ne(d,f){if(1&d&&(t.j41(0,"ion-item",64)(1,"ion-label"),t.EFF(2),t.k0s(),t.DNE(3,te,2,1,"div",65)(4,ie,1,0,"ion-icon",66)(5,ae,1,0,"ion-icon",67)(6,oe,1,0,"ion-icon",68),t.k0s()),2&d){const l=f.$implicit;t.R7$(2),t.JRh(l.name),t.R7$(),t.Y8G("ngIf",l.displayTime),t.R7$(),t.Y8G("ngIf",void 0===l.isDelete),t.R7$(),t.Y8G("ngIf",1==l.isDelete),t.R7$(),t.Y8G("ngIf",0==l.isDelete)}}function re(d,f){if(1&d&&(t.j41(0,"div")(1,"ion-accordion-group",null,4)(3,"ion-accordion")(4,"ion-item",29)(5,"ion-label",30),t.EFF(6),t.k0s(),t.j41(7,"ion-label",62),t.EFF(8),t.k0s()(),t.j41(9,"div",33),t.DNE(10,ne,7,5,"ion-item",63),t.k0s()()()()),2&d){const l=t.XpG();t.R7$(6),t.JRh(l.lang.text.TodoDetail.ManageWorker),t.R7$(2),t.JRh(l.worker_done+" / "+l.userInput.workers.length),t.R7$(2),t.Y8G("ngForOf",l.userInput.workers)}}function se(d,f){if(1&d){const l=t.RV6();t.j41(0,"ion-accordion",73)(1,"ion-item",29)(2,"ion-label",30),t.EFF(3),t.k0s(),t.j41(4,"ion-label",31),t.EFF(5),t.k0s(),t.nrm(6,"ion-icon",32),t.k0s(),t.j41(7,"div",33)(8,"ion-datetime",34,6),t.bIt("ionChange",function(i){t.eBV(l);const o=t.XpG();return t.Njj(o.start_change(i))}),t.k0s()()()}if(2&d){const l=t.XpG();t.R7$(3),t.JRh(l.lang.text.TodoDetail.startFrom),t.R7$(2),t.JRh(l.startDisplay||l.lang.text.TodoDetail.startImmediatly),t.R7$(3),t.Y8G("locale",l.lang.lang)}}function le(d,f){1&d&&(t.j41(0,"div",74),t.EFF(1,"Enter"),t.k0s())}function de(d,f){if(1&d){const l=t.RV6();t.j41(0,"ion-button",50),t.bIt("click",function(){t.eBV(l);const i=t.XpG().index,o=t.XpG();return t.Njj(o.remove_attach(i))}),t.EFF(1),t.k0s()}if(2&d){const l=t.XpG(2);t.R7$(),t.SpI(" ",l.lang.text.ChatRoom.Delete," ")}}function ue(d,f){if(1&d){const l=t.RV6();t.j41(0,"img",78),t.bIt("contextmenu",function(){t.eBV(l);const i=t.XpG(2),o=i.$implicit,p=i.index,r=t.XpG();return t.Njj(r.AttachmentContextMenu(o,p))}),t.k0s()}if(2&d){const l=t.XpG(2).$implicit;t.Y8G("src",l.thumbnail,t.B4B)("alt",l.filename)}}function ce(d,f){if(1&d&&(t.j41(0,"ion-item",79)(1,"ion-label",80),t.EFF(2),t.k0s()()),2&d){const l=t.XpG(3);t.R7$(2),t.JRh(l.lang.text.TodoDetail.open_content_viewer)}}function he(d,f){if(1&d){const l=t.RV6();t.j41(0,"div",50),t.bIt("click",function(){t.eBV(l);const i=t.XpG().index,o=t.XpG();return t.Njj(o.open_content_viewer(i))}),t.DNE(1,ue,1,2,"img",76)(2,ce,3,1,"ion-item",77),t.k0s()}if(2&d){const l=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",l.thumbnail),t.R7$(),t.Y8G("ngIf",!l.thumbnail)}}function pe(d,f){if(1&d&&(t.j41(0,"div")(1,"ion-item")(2,"ion-label",75),t.EFF(3),t.k0s(),t.DNE(4,de,2,1,"ion-button",17),t.k0s(),t.DNE(5,he,3,2,"div",17),t.k0s()),2&d){const l=f.$implicit,e=t.XpG();t.R7$(3),t.JRh(l.filename),t.R7$(),t.Y8G("ngIf",e.isModifiable),t.R7$(),t.Y8G("ngIf",l.viewer)}}function me(d,f){if(1&d&&t.nrm(0,"ion-icon",87),2&d){const l=t.XpG().$implicit;t.Y8G("name",l.icon||"close-circle")}}function ge(d,f){if(1&d&&t.nrm(0,"img",88),2&d){const l=t.XpG().$implicit;t.Y8G("src","assets/icon/"+l.icon_img,t.B4B)("alt",l.title)}}function _e(d,f){if(1&d){const l=t.RV6();t.j41(0,"div",83)(1,"div",84),t.bIt("click",function(){const i=t.eBV(l).$implicit;return t.Njj(i.act())})("contextmenu",function(){const i=t.eBV(l).$implicit;return t.Njj(i.context?i.context():null)}),t.DNE(2,me,1,1,"ion-icon",85)(3,ge,1,2,"img",86),t.j41(4,"div"),t.EFF(5),t.k0s()()()}if(2&d){const l=f.$implicit;t.R7$(),t.Aen("cursor: "+(l.cursor||"pointer")+";"),t.Y8G("hidden",l.isHide),t.R7$(),t.Y8G("ngIf",l.icon),t.R7$(),t.Y8G("ngIf",l.icon_img),t.R7$(2),t.JRh(l.name)}}function fe(d,f){if(1&d&&(t.j41(0,"div",81),t.DNE(1,_e,6,6,"div",82),t.k0s()),2&d){const l=t.XpG();t.R7$(),t.Y8G("ngForOf",l.extended_buttons)}}function Ie(d,f){1&d&&(t.j41(0,"div",89),t.EFF(1,"Ctrl + Enter"),t.k0s())}function be(d,f){if(1&d){const l=t.RV6();t.j41(0,"td")(1,"ion-button",90),t.bIt("click",function(){t.eBV(l);const i=t.XpG();return t.Njj(i.deleteData())}),t.EFF(2),t.k0s()()}if(2&d){const l=t.XpG();t.R7$(),t.Y8G("disabled",l.isButtonClicked),t.R7$(),t.SpI(" ",l.lang.text.TodoDetail.remove," ")}}const ve=[{path:"",component:(()=>{var d;class f{constructor(e,i,o,p,r,n,s,h,m,a,u,c,g,y){var A,_=this;this.route=e,this.router=i,this.lang=o,this.p5toast=p,this.sanitizer=r,this.indexed=n,this.nakama=s,this.alertCtrl=h,this.noti=m,this.statusBar=a,this.global=u,this.navCtrl=c,this.floatButton=g,this.p5loading=y,this.userInput={id:void 0,storeAt:"local",display_store:"",title:void 0,create_at:void 0,written:void 0,startFrom:void 0,limit:void 0,custom_color:void 0,workers:void 0,importance:"0",description:void 0,remote:void 0,display_creator:void 0,attach:[],done:void 0,noti_id:void 0,CDN:void 0},this.useVoiceRecording=!1,this.voidDrawContextId="todo_voiddraw_img",this.extended_buttons=[{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:()=>{this.isButtonClicked||this.new_attach({detail:{value:"load"}})},context:()=>{if(!this.isButtonClicked)return this.new_attach({detail:{value:"link"}}),!1}},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:()=>{this.isButtonClicked||this.new_attach({detail:{value:"image"}})},context:()=>(function(){var C=(0,v.A)(function*(){let M=yield _.global.GetValueFromClipboard("voiddraw");"image/png"===M.type?_.SelectVoidDrawBackgroundImage({target:{files:[M.value]}}):document.getElementById(_.voidDrawContextId).click()});return function(){return C.apply(this,arguments)}}()(),!1)},{icon:"reader-outline",name:this.lang.text.ChatRoom.newText,act:()=>{this.isButtonClicked||this.new_attach({detail:{value:"text"}})}},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:()=>{this.isButtonClicked||this.new_attach({detail:{value:"camera"}})}},{icon:"mic-circle-outline",name:this.lang.text.ChatRoom.Voice,act:(A=(0,v.A)(function*(){if(!_.isButtonClicked){if(_.global.useVoiceRecording&&"TodoRecording"!=_.global.useVoiceRecording)return void _.p5toast.show({text:_.lang.text.GlobalAct[_.global.useVoiceRecording]});_.useVoiceRecording=!_.useVoiceRecording,_.useVoiceRecording?(yield T.R.hasAudioRecordingPermission()).value?(_.global.useVoiceRecording="TodoRecording",_.extended_buttons[4].icon="stop-circle-outline",_.extended_buttons[4].name=_.lang.text.ChatRoom.VoiceStop,_.p5loading.toast(_.lang.text.ChatRoom.StartVRecord,"add_todo"),yield T.R.startRecording(),_.CreateFloatingVoiceTimeHistoryAddButton()):(_.useVoiceRecording=!1,_.extended_buttons[4].icon="mic-circle-outline",_.extended_buttons[4].name=_.lang.text.ChatRoom.Voice,yield T.R.requestAudioRecordingPermission()):yield _.StopAndSaveVoiceRecording()}}),function(){return A.apply(this,arguments)})},{icon:"cloud-done-outline",name:this.lang.text.ChatRoom.Detour,act:()=>{this.toggle_custom_attach()}}],this.BackButtonPressed=!1,this.AlreadyInited=!1,this.buttonDisplay={saveTodo:this.lang.text.TodoDetail.buttonDisplay_add},this.AmICreator=!0,this.isModify=!1,this.isModifiable=!1,this.isStoreAtChanged=!1,this.isStoreAtChangable=!0,this.CheckIfTitleFocus=!1,this.isLimitUsable=!1,this.normal_color="#8888",this.alert_color="#0bb8",this.AlertLerpStartFrom=.8,this.file_sel_id="",this.AvailableStorageList=[],this.isManager=!1,this.AvailableWorker={},this.WorkerGroups=[],this.toggle_logs={},this.SelectedWorkers=0,this.worker_done=0,this.WaitingLoaded=!1,this.lock_modal_open=!1,this.isCDNToggleClicked=!1,this.isButtonClicked=!1,this.WillLeavePage=!1,this.PageDestoryed=!1}CreateFloatingVoiceTimeHistoryAddButton(){this.floatButton.RemoveFloatButton("addtodo-record"),this.floatButton.AddFloatButton("addtodo-record","mic-outline").mouseClicked(()=>{this.p5toast.show({text:`${this.lang.text.GlobalAct.TodoRecording}`})})}SelectVoidDrawBackgroundImage(e){var i=this;return(0,v.A)(function*(){const o=e.target.files[0],p=`tmp_files/todo/${o.name}`;yield i.indexed.saveBlobToUserPath(o,p);let r=yield i.indexed.loadBlobFromUserPath(p,o.type);const n=URL.createObjectURL(r);new w(s=>{s.setup=()=>{document.getElementById(i.voidDrawContextId).value="",s.noCanvas(),s.loadImage(n,h=>{i.global.PageDismissAct["todo-voiddraw-quick"]=m=>{m.data&&i.voidDraw_fileAct_callback(m),delete i.global.PageDismissAct["todo-voiddraw-quick"]},i.global.ActLikeModal("portal/main/add-todo-menu/void-draw",{path:p,width:h.width,height:h.height,type:o.type,dismiss:"todo-voiddraw-quick"}),URL.revokeObjectURL(n),s.remove()},h=>{console.log("\ube60\ub978 \uadf8\ub9bc\ud310 \uc5f4\uae30 \uc2e4\ud328: ",h),URL.revokeObjectURL(n),s.remove()})}})})()}StopAndSaveVoiceRecording(){var e=this;return(0,v.A)(function*(){e.floatButton.RemoveFloatButton("addtodo-record");const i="add_todo";yield e.p5loading.update({id:i,message:e.lang.text.AddPost.SavingRecord});try{let o=yield e.global.StopAndSaveVoiceRecording();yield e.selected_blobFile_callback_act(o,!1)}catch{}e.p5loading.remove(i),e.extended_buttons[4].icon="mic-circle-outline",e.extended_buttons[4].name=e.lang.text.ChatRoom.Voice})()}ngOnInit(){var e=this;if(this.cont=new AbortController,this.voidDrawContextId=`todo_voiddraw_img_${Date.now()}`,this.MainDiv=document.getElementById("main_div"),this.nakama.socket_reactive.add_todo_menu=this,this.route.queryParams.subscribe(i=>{const o=this.router.getCurrentNavigation().extras.state;this.navParams=!!o,o&&(this.received_data=o.data),this.received_data&&!this.AlreadyInited&&(this.userInput={...this.userInput,...JSON.parse(this.received_data)}),this.toggle_custom_attach(this.userInput.CDN||0),this.AlreadyInited=!0}),this.nakama.AddTodoLinkAct=function(){var i=(0,v.A)(function*(o){e.p5timer&&e.p5timer.remove(),e.received_data=o,e.userInput=JSON.parse(e.received_data),yield e.ionViewWillEnter(),e.show_count_timer()});return function(o){return i.apply(this,arguments)}}(),this.nakama.AddTodoManageUpdateAct=(i,o,p,r)=>{if(this.userInput.id==i)for(let n=0,s=this.userInput.workers.length;n<s;n++)if((this.userInput.workers[n].user_id||this.userInput.workers[n].id)==o){this.userInput.workers[n].isDelete=p,this.userInput.workers[n].timestamp=r,this.userInput.workers[n].displayTime=new Date(r).toLocaleString(),this.worker_done++;break}},"DesktopPWA"==k.aH&&setTimeout(()=>{this.WillLeavePage||this.CreateDrop()},100),this.userInput.workers)for(let i=0,o=this.userInput.workers.length;i<o;i++)this.userInput.workers[i].timestamp&&(this.userInput.workers[i].displayTime=new Date(this.userInput.workers[i].timestamp).toLocaleString(),this.worker_done++);this.nakama.StatusBarChangedCallback=()=>{if(this.isModify){if(this.LoadStorageList(),this.userInput.remote)try{let i=!1;for(let o=0,p=this.AvailableStorageList.length;o<p;o++)if(this.AvailableStorageList[o].type==`${this.userInput.remote.isOfficial}/${this.userInput.remote.target}`){i=!0;break}this.isModifiable=i,this.userInput.display_creator=i?this.nakama.GetOverrideName(this.userInput.remote.creator_id,this.userInput.remote.isOfficial,this.userInput.remote.target)||this.nakama.load_other_user(this.userInput.remote.creator_id,this.userInput.remote.isOfficial,this.userInput.remote.target).display_name:this.lang.text.TodoDetail.Disconnected}catch{}}else this.LoadStorageList()}}ChangeDisconnectStatus(){var i,e=this;this.userInput.display_creator==this.lang.text.TodoDetail.Disconnected&&this.alertCtrl.create({header:this.lang.text.TodoDetail.MoveToLocal,message:this.lang.text.TodoDetail.RemoveFromRemote,buttons:[{text:this.lang.text.Nakama.LocalNotiOK,cssClass:"redfont",handler:(i=(0,v.A)(function*(){e.isButtonClicked=!0,yield e.nakama.deleteTodoFromStorage(!0,JSON.parse(JSON.stringify(e.userInput))),e.StoreAtSelChanged({detail:{value:"local"}}),e.isModify=!1,e.userInput.id=void 0,e.userInput.noti_id=void 0,e.userInput.create_at=void 0,delete e.userInput.modified,e.saveData()}),function(){return i.apply(this,arguments)})}]}).then(i=>i.present())}CreateDrop(){var e=this;let i=document.getElementById("p5Drop_todo");this.p5canvas=new w(o=>{o.setup=()=>{let p=o.createCanvas(i.clientWidth,i.clientHeight);p.parent(i),o.pixelDensity(.1),p.drop(function(){var r=(0,v.A)(function*(n){yield e.selected_blobFile_callback_act(n.file,!1)});return function(n){return r.apply(this,arguments)}}())},o.mouseMoved=p=>{p.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")}})}selected_blobFile_callback_act(e,i=!0){var o=this;return(0,v.A)(function*(){const p="add_todo";i&&(yield o.p5loading.update({id:p,message:`${o.lang.text.ContentViewer.OnLoadContent}: ${e.name}`,image:null}));let r=o.global.selected_blobFile_callback_act(e,"tmp_files/todo/",{display_name:o.nakama.users.self.display_name});yield o.checkHasSameFileAndRename(r);const n=URL.createObjectURL(e);"image"==r.viewer&&(r.thumbnail=o.sanitizer.bypassSecurityTrustUrl(n),o.p5loading.update({id:p,image:n}));try{yield o.indexed.saveBlobToUserPath(e,r.path),o.userInput.attach.push(r),setTimeout(()=>{URL.revokeObjectURL(n)},0)}catch(s){console.error("\ud30c\uc77c \uc62c\ub9ac\uae30 \uc2e4\ud328: ",s),o.p5toast.show({text:o.lang.text.TodoDetail.load_failed})}i&&o.p5loading.remove(p),o.auto_scroll_down()})()}checkHasSameFileAndRename(e){var i=this;return(0,v.A)(function*(){let o=!1;if(o=yield i.indexed.checkIfFileExist(e.path),i.userInput.id&&!o)try{o=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}_${i.userInput.remote.isOfficial}_${i.userInput.remote.target}/${e.filename}`)}catch{o=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}/${e.filename}`)}o&&(e.filename=`${e.filename.substring(0,e.filename.lastIndexOf("."))}_.${e.file_ext}`,e.path=`tmp_files/todo/${e.filename}`,yield i.checkHasSameFileAndRename(e))})()}AttachmentContextMenu(e,i){var o=this;return this.isStoreAtChangable&&function(){var r=(0,v.A)(function*(){const n=URL.createObjectURL(e.blob);yield o.p5loading.update({id:"voiddraw",image:n}),new w(s=>{s.setup=()=>{s.noCanvas(),s.loadImage(n,h=>{let m=[];if(e.content_related_creator&&(m=[...e.content_related_creator]),e.content_creator){let a=!1;for(let u=0,c=m.length;u<c;u++)if(void 0!==m[u].user_id&&void 0!==e.content_creator.user_id&&m[u].user_id==e.content_creator.user_id){a=!0;break}a||m.push(e.content_creator)}o.global.PageDismissAct["quick-modify-image"]=a=>{a.data&&o.voidDraw_fileAct_callback(a,m,i),delete o.global.PageDismissAct["quick-modify-image"]},o.global.ActLikeModal("portal/main/add-todo-menu/void-draw",{path:e.alt_path||e.path,width:h.width,height:h.height,type:e.type,dismiss:"quick-modify-image"}),URL.revokeObjectURL(n),s.remove()},h=>{console.log("\ube60\ub978 \ud3b8\uc9d1\uae30 \uc774\ub3d9 \uc2e4\ud328: ",h),URL.revokeObjectURL(n),s.remove()})}})});return function(){return r.apply(this,arguments)}}()(),!1}ionViewWillEnter(){var e=this;return(0,v.A)(function*(){if(e.global.portalHint=!1,e.global.StoreShortCutAct("add-todo"),e.WaitingLoaded=!0,e.lock_modal_open=!1,!e.navParams)return;let i;if(e.WillLeavePage=!1,e.LoadStorageList(),e.received_data){if(e.buttonDisplay.saveTodo=e.lang.text.TodoDetail.buttonDisplay_modify,i=JSON.parse(e.received_data),e.userInput={...e.userInput,...i},e.isModify=!0,e.isModify&&e.userInput.noti_id&&e.noti.ClearNoti(e.userInput.noti_id),"local"==e.userInput.storeAt)e.StoreAt.value="local";else for(let n=0,s=e.AvailableStorageList.length;n<s;n++)if(e.userInput.remote.isOfficial==e.AvailableStorageList[n].isOfficial&&e.userInput.remote.target==e.AvailableStorageList[n].target){e.StoreAt.value=e.AvailableStorageList[n];break}}else e.userInput.limit=(new Date).getTime(),e.limitTimeP5Display=e.userInput.limit,e.AvailableStorageList.length&&(e.StoreAt.value=e.AvailableStorageList[0].target,e.StoreAtSelChanged({detail:{value:e.AvailableStorageList[0]}}));let o=document.getElementById("titleInput");e.titleIonInput=o.children[0].children[1].children[0],e.titleIonInput.onblur||(e.titleIonInput.onblur=()=>{e.CheckIfTitleFocus=!1}),e.titleIonInput.onfocus||(e.titleIonInput.onfocus=()=>{e.CheckIfTitleFocus=!0}),setTimeout(()=>{"DesktopPWA"==k.aH&&!e.isModify&&!e.titleIonInput.value&&e.titleIonInput.focus()},200),e.ImporantSelChanged({detail:{value:e.userInput.importance}}),e.file_sel_id=`${e.userInput.id||"new_todo_id"}_${(new Date).getTime()}`;let p=!1;try{p=yield e.indexed.checkIfFileExist(`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`)}catch{p=yield e.indexed.checkIfFileExist(`todo/${e.userInput.id}/thumbnail.png`)}if(e.userInput.attach.length){const n="add_todo";yield e.p5loading.update({id:n,message:e.lang.text.AddPost.SyncAttaches,progress:0});for(let s=0,h=e.userInput.attach.length;s<h&&!e.PageDestoryed;s++){e.p5loading.update({id:n,message:`${e.lang.text.AddPost.SyncAttaches}: ${e.userInput.attach[s].filename}`,progress:s/h});try{if(e.userInput.remote){try{if(e.userInput.attach[s].alt_path=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/${e.userInput.attach[s].filename}`,e.userInput.attach[s].blob=(yield e.nakama.sync_load_file(e.userInput.attach[s],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach",e.userInput.remote.creator_id)).value,!e.userInput.attach[s].blob)throw"\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328\ud568"}catch{if(e.userInput.attach[s].url){if(!(yield e.indexed.checkIfFileExist(e.userInput.attach[s].alt_path||e.userInput.attach[s].path))){let c=yield fetch(e.userInput.attach[s].url);if(c.ok){let g=yield c.blob();yield e.indexed.saveBlobToUserPath(g,e.userInput.attach[s].alt_path||e.userInput.attach[s].path);let y=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[s].path,e.userInput.attach[s].type);e.userInput.attach[s].blob=y}else console.log("\uc989\uc2dc \ub2e4\uc6b4\ub85c\ub4dc \uc2e4\ud328: ",c),e.p5toast.show({text:`${e.lang.text.Nakama.FailedDownload}: ${c.statusText} (${c.status})`})}e.userInput.attach[s].thumbnail=e.userInput.attach[s].url}}if(!p){let a;if("image"==e.userInput.attach[s].viewer)a=URL.createObjectURL(e.userInput.attach[s].blob);else try{let u=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[s].path+"_thumbnail.png","");a=URL.createObjectURL(u)}catch{}a&&(yield new Promise(u=>{new w(c=>{c.setup=()=>{c.noCanvas(),c.loadImage(a,g=>{g.width>g.height?g.resize(g.width/g.height*128,128):g.resize(128,g.height/g.width*128);let _=c.createCanvas(128,128);_.hide(),c.smooth(),c.pixelDensity(1),c.image(g,-(g.width-128)/2,-(g.height-128)/2);let C,A=_.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{C=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{C=`todo/${e.userInput.id}/thumbnail.png`}e.indexed.saveBase64ToUserPath(A,C).then(M=>{e.global.p5todoAddtodo&&e.global.p5todoAddtodo(JSON.stringify(e.userInput)),u()}),e.userInput.attach[s].blob&&URL.revokeObjectURL(a),c.remove()},g=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",g),e.userInput.attach[s].blob&&URL.revokeObjectURL(a),c.remove(),u()})}})}))}}else{if("image"!=e.userInput.attach[s].viewer&&"text"!=e.userInput.attach[s].viewer)throw"\ubc88\uc678 \uc378\ub124\uc77c \ud544\uc694";e.userInput.attach[s].blob=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[s].path,e.userInput.attach[s].type)}if(!e.userInput.attach[s].blob)continue;let m=URL.createObjectURL(e.userInput.attach[s].blob);e.global.modulate_thumbnail(e.userInput.attach[s],m,e.cont)}catch{e.global.modulate_thumbnail(e.userInput.attach[s],"",e.cont)}e.userInput.attach[s].exist=!0}e.p5loading.remove(n)}try{if("local"==e.userInput.storeAt)e.isModify||(e.StoreAt.value=e.userInput.storeAt),e.userInput.display_store=e.lang.text.TodoDetail.OnThisDevice,e.userInput.display_creator=e.lang.text.TodoDetail.WrittenByMe,e.isModifiable=!0;else if(e.userInput.remote){if(e.isModify||(e.StoreAt.value=e.userInput.remote),e.userInput.display_store=e.userInput.remote.name,e.userInput.display_creator=e.lang.text.TodoDetail.Disconnected,!e.nakama.servers[e.userInput.remote.isOfficial]||!e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target])throw e.userInput.display_creator=e.lang.text.TodoDetail.DeletedServer,{text:"Server Deleted",isModifiable:!0};if(e.statusBar.groupServer[e.userInput.remote.isOfficial]&&"online"!=e.statusBar.groupServer[e.userInput.remote.isOfficial][e.userInput.remote.target])throw e.isStoreAtChangable=!1,{text:"Server disconnected",isModifiable:!1};"online"==e.statusBar.groupServer[e.userInput.remote.isOfficial][e.userInput.remote.target]&&(e.isModifiable=!0),e.userInput.remote.creator_id&&(e.AmICreator=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id==e.userInput.remote.creator_id),e.userInput.display_creator=e.AmICreator?e.lang.text.TodoDetail.WrittenByMe:e.nakama.GetOverrideName(e.userInput.remote.creator_id,e.userInput.remote.isOfficial,e.userInput.remote.target)||e.nakama.load_other_user(e.userInput.remote.creator_id,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name,e.userInput.remote.group_id&&(e.isModifiable="online"==e.nakama.groups[e.userInput.remote.isOfficial][e.userInput.remote.target][e.userInput.remote.group_id].status)}}catch(n){e.isModifiable=n.isModifiable,console.log("Server issue: ",n)}e.noti.Current=e.userInput.id;let r=new Date(e.userInput.limit);if(e.Calendar.value=new Date(r.getTime()-60*r.getTimezoneOffset()*1e3).toISOString(),i&&(e.limitTimeP5Display=new Date(i.limit).getTime()),e.userInput.startFrom){let n=new Date(e.userInput.startFrom);e.startDisplay=n.toLocaleString(e.lang.lang),e.startDisplay=e.startDisplay.substring(0,e.startDisplay.lastIndexOf(":"))}if(e.limit_change({detail:{value:e.userInput.limit}}),e.userInput.workers)for(let n=0,s=e.userInput.workers.length;n<s;n++){try{e.userInput.workers[n].name=e.nakama.GetOverrideName(e.userInput.workers[n].id,e.userInput.remote.isOfficial,e.userInput.remote.target)||e.nakama.load_other_user(e.userInput.workers[n].id,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}catch{}e.userInput.workers[n].timestamp&&(e.userInput.workers[n].displayTime=new Date(e.userInput.workers[n].timestamp).toLocaleString())}e.desc_input=document.getElementById("descInput"),e.desc_input&&!e.desc_input.onpaste&&(e.desc_input.onpaste=n=>{let s=[];for(const h of n.clipboardData.files)s.push({file:h});if(s.length){for(let h=0,m=s.length;h<m;h++)e.selected_blobFile_callback_act(s[h].file);return!1}})})()}LoadStorageList(){let e=[];Object.keys(this.nakama.servers).forEach(p=>{Object.keys(this.nakama.servers[p]).forEach(n=>{"online"==this.statusBar.groupServer[p][n]&&e.push({name:`${this.nakama.servers[p][n].info.name}`,isOfficial:p,target:n,type:`${p}/${n}`})})}),[...e].forEach(p=>{this.AvailableStorageList.push(p)})}ionViewDidEnter(){this.show_count_timer(),this.WillLeavePage=!1,this.AddShortCut()}AddShortCut(){setTimeout(()=>{this.WillLeavePage||(this.global.p5KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5KeyShortCut.EnterAct=e=>{document.activeElement==this.titleIonInput&&setTimeout(()=>{this.desc_input.focus()},0),e.ctrlKey&&this.saveData()},this.ScrollDiv||(this.ScrollDiv=document.getElementById("addtodo-scroll")),this.global.p5KeyShortCut.BottomTab=e=>{document.activeElement!=this.titleIonInput&&document.activeElement!=this.desc_input&&"W"===e&&this.ScrollDiv.scrollTo({top:this.ScrollDiv.scrollTop-this.ScrollDiv.clientHeight/2,behavior:"smooth"})},this.global.p5KeyShortCut.SKeyAct=()=>{document.activeElement!=this.titleIonInput&&document.activeElement!=this.desc_input&&this.ScrollDiv.scrollTo({top:this.ScrollDiv.scrollTop+this.ScrollDiv.clientHeight/2,behavior:"smooth"})})},0)}removeShortCut(){delete this.global.p5KeyShortCut.Escape,delete this.global.p5KeyShortCut.Escape}start_change(e){this.userInput.startFrom=e.detail.value,this.startDisplay=new Date(e.detail.value).toLocaleString(this.lang.lang),this.startDisplay=this.startDisplay.substring(0,this.startDisplay.lastIndexOf(":")),this.startTimeP5Display=new Date(this.userInput.startFrom).getTime()}limit_change(e){this.userInput.limit=e.detail.value;let i=new Date(e.detail.value);i.getTime()<=Date.now()?this.limitDisplay=this.lang.text.TodoDetail.NoDeadLine:(this.limitDisplay=i.toLocaleString(this.lang.lang),this.limitDisplay=this.limitDisplay.substring(0,this.limitDisplay.lastIndexOf(":"))),this.limitTimeP5Display=new Date(this.userInput.limit).getTime(),this.startTimeP5Display=Date.now(),this.isLimitUsable=this.limitTimeP5Display>this.startTimeP5Display}remove_attach(e){this.userInput.attach.splice(e,1)}show_count_timer(){this.p5timer=new w(e=>{let i=0;this.startTimeP5Display=this.userInput.startFrom||this.userInput.written?new Date(this.userInput.startFrom||this.userInput.written).getTime():(new Date).getTime(),this.startTimeP5Display=e.min(this.startTimeP5Display,this.limitTimeP5Display);let o,p=e.color(this.normal_color);e.setup=()=>{let m=document.getElementById("p5timer"),a=e.createCanvas(m.clientWidth,m.clientHeight);e.pixelDensity(1),a.id("timer"),a.style("position","inherit"),a.parent(m),e.noStroke()};let r=0,n=()=>{o=(new Date).getTime(),r=this.limitTimeP5Display<o?1:e.map(o,this.startTimeP5Display,this.limitTimeP5Display,0,1,!0),r<=this.AlertLerpStartFrom?p=e.color(this.userInput.custom_color?this.userInput.custom_color+"88":this.normal_color):r>this.AlertLerpStartFrom&&(p=this.userInput.custom_color?e.color(this.userInput.custom_color+"88"):e.lerpColor(e.color(this.normal_color),e.color(this.alert_color),e.map(r,this.AlertLerpStartFrom,1,0,1)*i))};e.draw=()=>{n(),e.clear(255,255,255,255),e.push(),e.fill(p),i<1?(i+=.04,i>=1&&(i=1),e.rect(0,0,e.lerp(0,e.width,r*s(i)),e.height)):e.rect(0,0,e.lerp(0,e.width,r),e.height),e.pop()},e.windowResized=()=>{setTimeout(()=>{let m=document.getElementById("p5timer");e.resizeCanvas(m.clientWidth,m.clientHeight)},50)};let s=m=>h(e.sq(h(m))),h=m=>1-m})}new_attach(e){var i=this;return(0,v.A)(function*(){switch(e.detail.value){case"camera":try{let r=yield i.global.from_camera("tmp_files/todo/",{display_name:i.nakama.users.self.display_name},"add_todo");r.thumbnail=i.sanitizer.bypassSecurityTrustUrl(r.base64),i.userInput.attach.push(r)}catch{}i.AddShortCut(),i.auto_scroll_down(100);break;case"text":let o=i.global.TextEditorNewFileName();i.global.PageDismissAct["todo-text-add"]=r=>{if(r.data){let n=i.global.TextEditorAfterAct(r.data,{display_name:i.nakama.users.self.display_name});i.userInput.attach.push(n),i.auto_scroll_down()}i.global.RestoreShortCutAct("add-todo-add-text"),delete i.global.PageDismissAct["todo-text-add"]},i.global.StoreShortCutAct("add-todo-add-text"),i.global.ActLikeModal("portal/main/add-todo-menu/ionic-viewer",{info:{content:{is_new:"text",type:"text/plain",viewer:"text",filename:o}},noEdit:!0,dismiss:"todo-text-add"});break;case"image":i.global.PageDismissAct["todo-image-add"]=r=>{r.data&&i.voidDraw_fileAct_callback(r),delete i.global.PageDismissAct["todo-image-add"]},i.global.ActLikeModal("portal/main/add-todo-menu/void-draw",{dismiss:"todo-image-add"});break;case"inapp":i.global.PageDismissAct["todo-userfs-add"]=r=>{r.data&&i.selected_blobFile_callback_act(r.data),delete i.global.PageDismissAct["todo-userfs-add"]},i.global.ActLikeModal("user-fs-dir",{selector:!0,dismiss:"todo-userfs-add"});break;case"load":i.select_attach(),i.AddShortCut();break;case"link":let p;try{try{let s=yield i.global.GetValueFromClipboard("add_todo");switch(s.type){case"text/plain":p=s.value;break;case"image/png":return void i.inputImageSelected({target:{files:[s.value]}});case"error":throw s.value}}catch(s){throw s}try{let s=i.global.Base64ToBlob(p),h=p.split(";")[0].split(":")[1],m=new File([s],`${i.lang.text.ChatRoom.FileLink}.${h.split("/").pop()}`,{type:h});throw yield i.selected_blobFile_callback_act(m),"done"}catch(s){if("done"===s)throw s}try{if(0!=p.indexOf("http:")&&0!=p.indexOf("https:"))throw"\uc62c\ubc14\ub978 \uc6f9 \uc8fc\uc18c\uac00 \uc544\ub2d8"}catch(s){throw s}let r={};r.url=p,r.content_related_creator=[],r.content_related_creator.push({user_id:"local"==i.userInput.storeAt?"local":i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"}),r.content_creator={user_id:"local"==i.userInput.storeAt?"local":i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"};let n=r.url.split(".");r.file_ext=n.pop().split("?").shift(),r.filename=decodeURIComponent(`${n.pop().split("/").pop()||i.lang.text.ChatRoom.ExternalLinkFile}.${r.file_ext}`).split("_").pop(),i.global.set_viewer_category_from_ext(r),r.type="",r.typeheader=r.viewer,i.global.modulate_thumbnail(r,r.url,i.cont),i.userInput.attach.push(r)}catch(r){throw"done"==r?r:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${r}`}}})()}select_attach(){document.getElementById(this.file_sel_id).click()}inputImageSelected(e){var i=this;return(0,v.A)(function*(){if(!e.target.files.length)return;const o="add_todo";yield i.p5loading.update({id:o,message:i.lang.text.ContentViewer.OnLoadContent});for(let r=0,n=e.target.files.length;r<n;r++){const s={id:o,message:`${i.lang.text.ContentViewer.OnLoadContent}: ${e.target.files[r].name}`};n>1&&(s.progress=r/n),i.p5loading.update(s),yield i.selected_blobFile_callback_act(e.target.files[r],!1)}i.p5loading.remove(o),document.getElementById(i.file_sel_id).value=""})()}StoreAtSelClicked(){this.StoreAt.open()}StoreAtSelChanged(e){this.isStoreAtChanged=!0;let i=e.detail.value;"local"==i?(this.userInput.storeAt="local",this.userInput.remote=void 0,this.isManager=!1,this.userInput.workers=void 0):(this.userInput.storeAt=i.type,this.userInput.remote=i,this.userInput.workers=[],this.nakama.servers[i.isOfficial][i.target].client.getAccount(this.nakama.servers[i.isOfficial][i.target].session).then(o=>{let p=JSON.parse(o.user.metadata);this.WorkerGroups.length=0,this.AvailableWorker={},p.is_admin?this.nakama.servers[i.isOfficial][i.target].client.rpc(this.nakama.servers[i.isOfficial][i.target].session,"query_all_groups",{}).then(r=>{let n=r.payload;for(let s=0,h=n.length;s<h;s++){this.AvailableWorker[n[s].id]||(this.AvailableWorker[n[s].id]=[]);for(let m=0,a=n[s].users.length;m<a;m++){let u=this.nakama.load_other_user(n[s].users[m].user.user_id,i.isOfficial,i.target,c=>{delete c.todo_checked,c.email||(c.override_name=this.nakama.GetOverrideName(c.id||c.user_id,this.userInput.remote.isOfficial,this.userInput.remote.target))});u.email||this.AvailableWorker[n[s].id].push(u)}this.AvailableWorker[n[s].id].length?this.WorkerGroups.push({id:n[s].id,name:n[s].name}):delete this.AvailableWorker[n[s].id]}this.isManager=!0}):this.UpdateWorkerList()})),setTimeout(()=>{"DesktopPWA"==k.aH&&!this.isModify&&this.titleIonInput&&!this.titleIonInput.value&&this.titleIonInput.focus()},200)}UpdateWorkerList(){if(!this.isStoreAtChanged)return;let e=0;this.WorkerGroups.length=0,this.userInput.workers=[];let i=Object.keys(this.nakama.PromotedGroup);for(let o of i){let p=Object.keys(this.nakama.PromotedGroup[o]);for(let r of p){let n=Object.keys(this.nakama.PromotedGroup[o][r]);for(let s of n){let h=this.nakama.groups[o][r][s];this.AvailableWorker[h.id]||(this.AvailableWorker[h.id]=[]),this.AvailableWorker[h.id].length=0;for(let m=0,a=h.users.length;m<a;m++){if(!h.users[m].user.user_id&&!h.users[m].user.id||(h.users[m].user.user_id||h.users[m].user.id)==this.nakama.servers[o][r].session.user_id)continue;let u=this.nakama.load_other_user(h.users[m].user.user_id||h.users[m].user.id,o,r,c=>{delete c.todo_checked,(c.id||c.user_id)!=this.nakama.servers[o][r].session.user_id&&c.display_name&&(c.override_name=this.nakama.GetOverrideName(c.id||c.user_id,this.userInput.remote.isOfficial,this.userInput.remote.target))});(u.id||u.user_id)!=this.nakama.servers[o][r].session.user_id&&u.display_name&&this.AvailableWorker[h.id].push(u)}this.AvailableWorker[h.id].length?this.WorkerGroups.push({id:h.id,name:h.name}):delete this.AvailableWorker[h.id],e++}}}this.isManager=0!=e}toggle_all_user(e){this.toggle_logs[e]=!this.toggle_logs[e];for(let i=0,o=this.AvailableWorker[e].length;i<o;i++)this.AvailableWorker[e][i].todo_checked=this.toggle_logs[e];this.count_selected_worker()}count_selected_worker(){let e=Object.keys(this.AvailableWorker),i=[];for(let o=0,p=e.length;o<p;o++)for(let r=0,n=this.AvailableWorker[e[o]].length;r<n;r++){let s=this.AvailableWorker[e[o]][r].id||this.AvailableWorker[e[o]][r].user_id;this.AvailableWorker[e[o]][r].todo_checked&&!i.includes(s)&&(this.userInput.workers.push({id:s,name:this.nakama.load_other_user(s,this.userInput.remote.isOfficial,this.userInput.remote.target).display_name}),i.push(s))}this.SelectedWorkers=i.length}ImporantSelClicked(){this.ImporantSel.open()}ImporantSelChanged(e){switch(this.userInput.importance=e.detail.value,this.userInput.importance){case"0":this.normal_color="#888b",this.alert_color="#58a19288",this.AlertLerpStartFrom=.8;break;case"1":this.normal_color="#888b",this.alert_color="#ddbb4188",this.AlertLerpStartFrom=.5;break;case"2":this.normal_color="#dddd0c88",this.alert_color="#b9543788",this.AlertLerpStartFrom=.4}}toggle_custom_color(){this.userInput.custom_color?this.userInput.custom_color=void 0:(document.getElementById("TodoCustomColorInput").click(),this.userInput.custom_color="#ff0000")}WaitingCurrent(){var e=this;return(0,v.A)(function*(){for(;!e.WaitingLoaded;)yield new Promise(i=>setTimeout(i,0));return!0})()}open_content_viewer(e){var i=this;if(this.lock_modal_open)return;this.lock_modal_open=!0;let p,r,n,o=[];for(let s=0,h=this.userInput.attach.length;s<h;s++)o.push({content:JSON.parse(JSON.stringify(this.userInput.attach[s]))});this.global.PageDismissAct["todo-ionicivewer"]=function(){var s=(0,v.A)(function*(h){if(yield i.WaitingCurrent(),i.lock_modal_open=!1,h.data)switch(h.data.type){case"image":let m=[];if(i.userInput.attach[h.data.index].content_related_creator&&(m=[...i.userInput.attach[h.data.index].content_related_creator]),i.userInput.attach[h.data.index].content_creator){let a=!1;for(let u=0,c=m.length;u<c;u++)if(void 0!==m[u].user_id&&void 0!==i.userInput.attach[h.data.index].content_creator.user_id&&m[u].user_id==i.userInput.attach[h.data.index].content_creator.user_id){a=!0;break}a||m.push(i.userInput.attach[h.data.index].content_creator)}delete i.userInput.attach[h.data.index].exist,i.global.PageDismissAct["todo-modify-image"]=a=>{a.data&&("image"===h.data.msg.content.viewer?i.voidDraw_fileAct_callback(a,m,h.data.index):i.voidDraw_fileAct_callback(a,m)),delete i.global.PageDismissAct["todo-modify-image"]},i.global.ActLikeModal("portal/main/add-todo-menu/void-draw",{path:h.data.path||i.userInput.attach[h.data.index].alt_path||i.userInput.attach[h.data.index].path,width:h.data.width,height:h.data.height,type:h.data.filetype,text:h.data.text,dismiss:"todo-modify-image"});break;case"text":i.userInput.attach[h.data.index].content_related_creator.push(i.userInput.attach[h.data.index].content_creator),i.userInput.attach[h.data.index].content_creator={timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"textedit"},i.userInput.attach[h.data.index].blob=h.data.blob,i.userInput.attach[h.data.index].path=h.data.path,i.userInput.attach[h.data.index].size=h.data.blob.size,i.userInput.attach[h.data.index].filename=h.data.blob.name||i.userInput.attach[h.data.index].filename,delete i.userInput.attach[h.data.index].exist}i.global.RestoreShortCutAct("add-todo-viewer"),delete i.global.PageDismissAct["todo-ionicivewer"]});return function(h){return s.apply(this,arguments)}}(),this.noti.Current="IonicViewerPage",this.global.StoreShortCutAct("add-todo-viewer");try{n=this.userInput.remote.creator_id,p=this.userInput.remote.isOfficial,r=this.userInput.remote.target}catch{p="local"}this.global.ActLikeModal("portal/main/add-todo-menu/ionic-viewer",{info:{content:this.userInput.attach[e],sender_id:n},isOfficial:p,target:r,path:this.userInput.attach[e].alt_path||this.userInput.attach[e].path,relevance:o,noEdit:!this.isModifiable,dismiss:"todo-ionicivewer"})}auto_scroll_down(e=0){setTimeout(()=>{this.MainDiv.scrollTo({top:this.MainDiv.scrollHeight,behavior:"smooth"})},e)}voidDraw_fileAct_callback(e,i,o){var p=this;return(0,v.A)(function*(){let r=yield p.global.voidDraw_fileAct_callback(e,"tmp_files/todo/",{display_name:p.nakama.users.self.display_name},i);try{if(void 0===o)throw"not overwrite";p.userInput.attach[o]=r}catch{p.userInput.attach.push(r)}p.auto_scroll_down(100)})()}doneTodo(){this.isButtonClicked=!0,this.nakama.doneTodo(this.userInput)}toggle_custom_attach(e){var i=this;return(0,v.A)(function*(){switch(i.isCDNToggleClicked=!0,i.userInput.CDN=(null!=e?e:i.userInput.CDN+1)%3,i.userInput.CDN){case 0:i.extended_buttons[5].icon="cloud-offline-outline",i.extended_buttons[5].name=i.lang.text.ChatRoom.Detour;break;case 1:i.extended_buttons[5].icon="cloud-done-outline",i.extended_buttons[5].name=i.lang.text.ChatRoom.useFSS;break;case 2:i.extended_buttons[5].icon="server-outline",i.extended_buttons[5].name=i.lang.text.ChatRoom.forceSQL}setTimeout(()=>{i.isCDNToggleClicked=!1},0)})()}saveData(){var e=this;return(0,v.A)(function*(){if(!e.userInput.title)return e.p5toast.show({text:e.lang.text.TodoDetail.needDisplayName}),void setTimeout(()=>{e.titleIonInput&&e.titleIonInput.focus()},0);e.isButtonClicked=!0,e.navCtrl.pop();const i="add_todo";yield e.p5loading.update({id:i,message:`${e.lang.text.TodoDetail.ApplyingTodo}: ${e.userInput.title}`}),e.useVoiceRecording&&(yield e.StopAndSaveVoiceRecording());let o=!!e.userInput.attach.length;delete e.userInput.display_store,delete e.userInput.display_creator;let p={};try{let a=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].info;p.apache_port=a.apache_port,p.cdn_port=a.cdn_port}catch{p={}}if(JSON.stringify(e.userInput)==e.received_data)return void e.navCtrl.pop();e.userInput.create_at||(e.userInput.create_at=(new Date).getTime());let n=e.received_data?JSON.parse(e.received_data):void 0;if((e.isStoreAtChanged||(null==n?void 0:n.CDN)!=e.userInput.CDN)&&e.isModify){for(let a=0,u=n.attach.length;a<u;a++){try{let c=n.attach[a].filename,g=yield e.indexed.loadBlobFromUserPath(n.attach[a].path,n.attach[a].type),y=`tmp_files/todo/${c}`;yield e.indexed.saveBlobToUserPath(g,y),e.userInput.attach[a].path=y,e.userInput.attach[a].blob=g}catch{if(n.attach[a].url){let g=n.attach[a].filename,_=yield(yield fetch(n.attach[a].url,{signal:e.cont.signal})).blob(),A=`tmp_files/todo/${g}`;yield e.indexed.saveBlobToUserPath(_,A),e.userInput.attach[a].path=A,e.userInput.attach[a].blob=_}}delete e.userInput.attach[a].thumbnail,delete e.userInput.attach[a].alt_path,yield e.global.remove_file_from_storage(e.userInput.attach[a].url,p),delete e.userInput.attach[a].url,delete e.userInput.attach[a].exist}yield e.nakama.deleteTodoFromStorage(!0,n),e.isModify=!1}if(!e.userInput.id||!e.isModify)if(e.userInput.remote)try{let a=yield e.nakama.getRemoteTodoCounter(e.userInput.remote.isOfficial,e.userInput.remote.target);e.userInput.id=`RemoteTodo_${a}`}catch{}else e.userInput.id=new Date(e.userInput.create_at).toISOString().replace(/[:|.|\/]/g,"_");e.userInput.noti_id&&(e.nakama.RemoveLocalPushSchedule(e.userInput),e.nakama.removeRegisteredId(e.userInput.noti_id),e.noti.ClearNoti(e.userInput.noti_id)),e.userInput.noti_id=e.nakama.get_noti_id();let m,h=!1;if(!e.isModify&&e.userInput.workers){e.userInput.workers.length=0;let a=Object.keys(e.AvailableWorker),u=[];for(let c=0,g=a.length;c<g;c++)for(let y=0,_=e.AvailableWorker[a[c]].length;y<_;y++){let A=e.AvailableWorker[a[c]][y].id||e.AvailableWorker[a[c]][y].user_id;e.AvailableWorker[a[c]][y].todo_checked&&!u.includes(A)&&(e.userInput.workers.push({id:A,name:e.nakama.load_other_user(A,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}),u.push(A))}e.userInput.workers.length||(e.userInput.workers=void 0)}try{n.attach.forEach(c=>{delete c.exist,delete c.thumbnail,delete c.base64,delete c.blob});let a=JSON.stringify(n.attach),u=JSON.parse(JSON.stringify(e.userInput.attach));u.forEach(c=>{delete c.exist,delete c.thumbnail,delete c.base64,delete c.blob}),u=JSON.stringify(u),h=a!=u}catch{h=!0}if(o&&h){if(n)try{for(let u=0,c=n.attach.length;u<c;u++){for(let g=0,y=e.userInput.attach.length;g<y;g++)if(e.userInput.attach[g].path==n.attach[u].path){n.attach[u].exist=!0,n.attach[u].index=g;break}(!n.attach[u].exist||n.attach[u].exist&&!e.userInput.attach[n.attach[u].index])&&(n.attach[u].url?""!==n.attach[u].type&&e.global.remove_file_from_storage(n.attach[u].url,p):yield e.indexed.removeFileFromUserPath(n.attach[u].path))}}catch{}let a;for(let u=0,c=e.userInput.attach.length;u<c;u++){let g,y=!1;try{if(a)throw"already exist";g=yield e.indexed.loadBlobFromUserPath(`${e.userInput.attach[u].path}_thumbnail.png`,"image/png"),y=!0}catch{}if(!e.userInput.attach[u].exist||!a&&"image"==e.userInput.attach[u].viewer){try{y||(g=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[u].path,e.userInput.attach[u].type))}catch{}try{if(1!=e.userInput.CDN)throw"FFS \uc0ac\uc6a9 \uc21c\uc704\uc5d0 \uc5c6\uc74c";let _;if(_=yield e.global.try_upload_to_user_custom_fs(e.userInput.attach[u],e.nakama.users.self.display_name,i),!_)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete e.userInput.attach[u].partsize,delete e.userInput.attach[u].size,e.userInput.attach[u].url=_}catch{try{e.userInput.attach[u].path=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/${e.userInput.attach[u].filename}`}catch{e.userInput.attach[u].path=`todo/${e.userInput.id}/${e.userInput.attach[u].filename}`}try{g||(g=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[u].path,e.userInput.attach[u].type)),yield e.indexed.saveBlobToUserPath(g,e.userInput.attach[u].path)}catch{}}}else delete e.userInput.attach[u].exist;if(!a&&("image"==e.userInput.attach[u].viewer||y))try{a=URL.createObjectURL(g)}catch{}}e.p5loading.update({id:i,image:a}),a&&(yield new Promise(u=>{new w(c=>{c.setup=()=>{c.noCanvas(),c.loadImage(a,g=>{g.width>g.height?g.resize(g.width/g.height*128,128):g.resize(128,g.height/g.width*128);let _=c.createCanvas(128,128);_.hide(),c.smooth(),c.pixelDensity(1),c.image(g,-(g.width-128)/2,-(g.height-128)/2);let C,A=_.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{C=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{C=`todo/${e.userInput.id}/thumbnail.png`}e.indexed.saveBase64ToUserPath(A,C).then(M=>{u()}),URL.revokeObjectURL(a),c.remove()},g=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",g),e.p5loading.update({id:i,image:null}),u(),URL.revokeObjectURL(a),c.remove()})}})}))}if(!o&&h&&n){let a;try{a=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{a=`todo/${e.userInput.id}/thumbnail.png`}if(yield e.indexed.removeFileFromUserPath(a),n.attach)for(let u=0,c=n.attach.length;u<c;u++)n.attach[u].url?""!==n.attach[u].type&&e.global.remove_file_from_storage(n.attach[u].url,p):yield e.indexed.removeFileFromUserPath(n.attach[u].path)}if(e.userInput.attach.forEach(a=>{URL.revokeObjectURL(a.thumbnail),delete a.thumbnail,delete a.exist,delete a.base64}),e.userInput.written=(new Date).getTime(),e.userInput.startFrom){let a=new Date(e.userInput.startFrom).getTime();(new Date).getTime()>a?delete e.userInput.startFrom:e.userInput.startFrom=a}if(e.userInput.limit=new Date(e.userInput.limit).getTime(),e.nakama.set_todo_notification(e.userInput),e.isModify||e.userInput.remote&&!e.userInput.remote.creator_id&&(e.userInput.remote.creator_id=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id),e.userInput.remote)try{if(e.userInput.attach.forEach(a=>{URL.revokeObjectURL(a.thumbnail),delete a.thumbnail,delete a.exist,delete a.base64}),o&&h&&n)for(let a=0,u=n.attach.length;a<u;a++){for(let c=0,g=e.userInput.attach.length;c<g;c++)if(e.userInput.attach[c].path==n.attach[a].path){n.attach[a].exist=!0,n.attach[a].index=c;break}if(!n.attach[a].exist||n.attach[a].exist&&!e.userInput.attach[n.attach[a].index])if(n.attach[a].url)""!==n.attach[a].type&&e.global.remove_file_from_storage(n.attach[a].url,p);else try{yield e.nakama.sync_remove_file(n.attach[a].path,e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach")}catch{}}for(let a=0,u=e.userInput.attach.length;a<u;a++)if(e.userInput.attach[a].url)delete e.userInput.attach[a].path,delete e.userInput.attach[a].size,delete e.userInput.attach[a].partsize;else try{if(2==e.userInput.CDN)throw"ForceSQL";!e.userInput.attach[a].blob.size&&e.userInput.attach[a].url&&(e.userInput.attach[a].blob=yield(yield fetch(e.userInput.attach[a].url,{signal:e.cont.signal})).blob());let c=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].info.address,g=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].info.useSSL?"https:":"http:",y=`${e.userInput.id}_${e.nakama.users.self.display_name}`;try{y=`${e.userInput.id}_${e.userInput.remote.creator_id}`}catch{}let _=yield e.global.upload_file_to_storage(e.userInput.attach[a],{user_id:y,apache_port:p.apache_port,cdn_port:p.cdn_port},g,c,1==e.userInput.CDN,i);if(!_)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete e.userInput.attach[a].size,delete e.userInput.attach[a].partsize,e.userInput.attach[a].url=_}catch(c){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",c),"ForceSQL"==c&&e.userInput.attach[a].url&&(e.userInput.attach[a].blob=yield(yield fetch(e.userInput.attach[a].url,{signal:e.cont.signal})).blob());try{yield e.nakama.sync_save_file(e.userInput.attach[a],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach")}catch{}}if(e.userInput.workers){if(!e.isModify){let a=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.rpc(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,"manage_todo_add_fn",e.userInput);e.userInput.id=`RemoteTodo_${a.payload.value}`,e.nakama.RemoteTodoCounter[e.userInput.remote.isOfficial][e.userInput.remote.target].push(a.payload.value),e.nakama.updateRemoteCounter(e.userInput.remote.isOfficial,e.userInput.remote.target)}for(let a=0,u=e.userInput.workers.length;a<u;a++)try{let c=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.readStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,{object_ids:[{collection:"self_share",key:"private_match",user_id:e.userInput.workers[a].id}]});c.objects.length&&(yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.joinMatch(c.objects[0].value.match_id),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(c.objects[0].value.match_id,O.I.MANAGE_TODO,encodeURIComponent(`add,server_todo,${e.userInput.id}`)),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.leaveMatch(c.objects[0].value.match_id))}catch(c){console.log(c)}}else{let a=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.writeStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,[{collection:"server_todo",key:e.userInput.id,permission_read:2,permission_write:1,value:e.userInput}]);e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].socket.sendMatchState(e.nakama.self_match[e.userInput.remote.isOfficial][e.userInput.remote.target].match_id,O.I.MANAGE_TODO,encodeURIComponent(`add,${a.acks[0].collection},${a.acks[0].key}`))}e.isModify||(yield e.nakama.updateRemoteCounter(e.userInput.remote.isOfficial,e.userInput.remote.target))}catch(a){if(console.error("\ud574\uc57c\ud560 \uc77c\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",a),e.isModify){let u;e.p5toast.show({text:e.lang.text.TodoDetail.SaveAfterConnectServer}),e.userInput.modified=!0,e.global.p5todoAddtodo&&e.global.p5todoAddtodo(JSON.stringify(e.userInput));try{u=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/info.todo`}catch{u=`todo/${e.userInput.id}/info.todo`}yield e.indexed.saveTextFileToUserPath(JSON.stringify(e.userInput),u),e.navCtrl.pop()}else e.p5toast.show({text:e.lang.text.TodoDetail.CanAddToServer});return e.isButtonClicked=!1,e.p5loading.update({id:i,message:`${e.lang.text.TodoDetail.ApplyingTodo}: ${e.userInput.title}`}),void e.p5loading.remove(i)}e.userInput.is_me=!0,e.global.p5todoAddtodo&&e.global.p5todoAddtodo(JSON.stringify(e.userInput));try{m=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/info.todo`}catch{m=`todo/${e.userInput.id}/info.todo`}yield e.indexed.saveTextFileToUserPath(JSON.stringify(e.userInput),m),e.p5loading.update({id:i,message:`${e.lang.text.TodoDetail.ApplyingTodo}: ${e.userInput.title}`}),e.p5loading.remove(i)})()}deleteData(){var i,e=this;this.alertCtrl.create({header:this.lang.text.TodoDetail.remove,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.TodoDetail.remove,handler:(i=(0,v.A)(function*(){e.isButtonClicked=!0,yield e.nakama.deleteTodoFromStorage(!0,e.userInput),e.navCtrl.pop()}),function(){return i.apply(this,arguments)}),cssClass:"redfont"}]}).then(i=>{this.global.p5KeyShortCut.Escape=()=>{i.dismiss()},i.onDidDismiss().then(()=>{this.global.p5KeyShortCut.Escape=()=>{this.navCtrl.pop()}}),i.present()})}ionViewWillLeave(){var e=this;return(0,v.A)(function*(){e.global.RestoreShortCutAct("add-todo"),e.WillLeavePage=!0,e.WaitingLoaded=!1,delete e.global.p5KeyShortCut.EnterAct,e.removeShortCut(),e.titleIonInput.onblur=null,e.titleIonInput.onfocus=null,e.noti.Current="",e.p5timer&&e.p5timer.remove()})()}ngOnDestroy(){this.PageDestoryed=!0,this.useVoiceRecording&&this.StopAndSaveVoiceRecording(),this.global.portalHint=!0,this.indexed.GetFileListFromDB("tmp_files/todo").then(e=>e.forEach(i=>this.indexed.removeFileFromUserPath(i))),delete this.nakama.socket_reactive.add_todo_menu,this.route.queryParams.unsubscribe(),this.desc_input&&(this.desc_input.onpaste=null),this.cont.abort("\ud560 \uc77c \ud398\uc774\uc9c0 \ubc97\uc5b4\ub0a8"),this.cont=null,this.nakama.AddTodoLinkAct=null,this.nakama.AddTodoManageUpdateAct=null,this.p5canvas&&this.p5canvas.remove(),delete this.nakama.StatusBarChangedCallback}}return(d=f).\u0275fac=function(e){return new(e||d)(t.rXU(j.nX),t.rXU(j.Ix),t.rXU(x.y),t.rXU(F.G),t.rXU(G.up),t.rXU(D.n),t.rXU(O.X),t.rXU(b.hG),t.rXU(R.r),t.rXU(S.j),t.rXU(E.z3),t.rXU(L.q9),t.rXU(U.u),t.rXU(V.f))},d.\u0275cmp=t.VBU({type:d,selectors:[["app-add-todo-menu"]],viewQuery:function(e,i){if(1&e&&(t.GBs(W,5),t.GBs(X,5),t.GBs(Y,5),t.GBs(J,5)),2&e){let o;t.mGM(o=t.lsd())&&(i.StartCalendar=o.first),t.mGM(o=t.lsd())&&(i.Calendar=o.first),t.mGM(o=t.lsd())&&(i.StoreAt=o.first),t.mGM(o=t.lsd())&&(i.ImporantSel=o.first)}},decls:66,vars:33,consts:[["ImporantSel",""],["DateTime",""],["Calendar",""],["StoreAt",""],["ManageWorker",""],["Groups",""],["StartCalendar",""],[1,"ion-no-border"],["slot","start"],["defaultHref","portal/main"],["id","p5Drop_todo",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none","z-index","500"],["id","addtodo-scroll",2,"height","100%","overflow-y","auto"],["id","p5timer",2,"position","fixed","width","100%","height","8px","z-index","500"],["id","main_table",2,"width","100%"],[2,"vertical-align","top"],["id","main_div",1,"main",2,"max-width","100vw"],["fixed","",4,"ngIf"],[3,"click",4,"ngIf"],[4,"ngIf"],["id","titleInput",1,"ion-text-right",3,"ngModelChange","label","ngModel","placeholder"],["button","",3,"click"],[2,"pointer-events","none",3,"ionChange","label","value"],["value","2"],["value","1"],["value","0"],[1,"additional_form","new_bg_form"],["id","TodoCustomColorInput","type","color",2,"width","0px","height","0px","opacity","0",3,"ngModelChange","ngModel"],["value","Start",4,"ngIf"],["value","Limit"],["button","","slot","header"],[2,"display","contents"],[1,"ion-text-right","uneditable_data"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],[2,"max-width","none",3,"ionChange","locale"],[2,"position","relative"],["class","shortcut_hint","style","z-index: 32;",4,"ngIf"],["id","descInput",1,"infobox",2,"height","240px",3,"ngModelChange","ngModel","placeholder"],[4,"ngFor","ngForOf"],["hidden","","type","file","accept","image/*",3,"change","id"],["style","width: 100%; text-align: center; padding-bottom: 16px;",4,"ngIf"],["hidden","","type","file","accept","*","multiple","",3,"change","id"],[2,"width","100%"],["id","bottom_buttons",2,"width","100%","background-color","black"],["class","shortcut_hint",4,"ngIf"],["expand","block",3,"click","disabled"],["fixed",""],["col-33",""],["button","","color","success",3,"click","disabled"],[1,"ion-text-center"],[3,"click"],[2,"pointer-events","none",3,"ionChange","label"],["value","local"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["color","medium",2,"display","contents"],["color","medium",1,"ion-text-right"],["button","","slot","header",1,"group_background"],["button","",1,"worker_background",3,"click"],["class","worker_background",3,"click",4,"ngFor","ngForOf"],[1,"worker_background",3,"click"],[3,"ngModelChange","ngModel"],[1,"ion-text-end"],["class","ignore_check",4,"ngFor","ngForOf"],[1,"ignore_check"],["style","color: var(--ion-color-medium);",4,"ngIf"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline",4,"ngIf"],["slot","end","color","danger","name","close-circle-outline",4,"ngIf"],["slot","end","color","success","name","checkmark-circle-outline",4,"ngIf"],[2,"color","var(--ion-color-medium)"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline"],["slot","end","color","danger","name","close-circle-outline"],["slot","end","color","success","name","checkmark-circle-outline"],["value","Start"],[1,"shortcut_hint",2,"z-index","32"],["text-wrap",""],["class","image_thumbnail",3,"src","alt","contextmenu",4,"ngIf"],["button","",4,"ngIf"],[1,"image_thumbnail",3,"contextmenu","src","alt"],["button",""],["color","medium"],[2,"width","100%","text-align","center","padding-bottom","16px"],["style","display: inline-block;",4,"ngFor","ngForOf"],[2,"display","inline-block"],[1,"ext_button","ext_button_override",3,"click","contextmenu","hidden"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"],[1,"shortcut_hint"],["color","danger","expand","block",3,"click","disabled"]],template:function(e,i){if(1&e){const o=t.RV6();t.j41(0,"ion-header",7)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",8),t.nrm(5,"ion-back-button",9),t.k0s()()(),t.j41(6,"ion-content"),t.nrm(7,"div",10),t.j41(8,"div",11),t.nrm(9,"div",12),t.j41(10,"div")(11,"table",13)(12,"tr")(13,"td",14)(14,"div",15),t.DNE(15,z,6,2,"ion-grid",16)(16,K,6,3,"ion-item",17)(17,Q,6,2,"div",18),t.j41(18,"ion-item")(19,"ion-input",19),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.userInput.title,r)||(i.userInput.title=r),t.Njj(r)}),t.k0s()(),t.DNE(20,ee,11,2,"div",18),t.j41(21,"ion-item",20),t.bIt("click",function(){return t.eBV(o),t.Njj(i.ImporantSelClicked())}),t.j41(22,"ion-select",21,0),t.bIt("ionChange",function(r){return t.eBV(o),t.Njj(i.ImporantSelChanged(r))}),t.j41(24,"ion-select-option",22),t.EFF(25),t.k0s(),t.j41(26,"ion-select-option",23),t.EFF(27),t.k0s(),t.j41(28,"ion-select-option",24),t.EFF(29),t.k0s()()(),t.DNE(30,re,11,3,"div",18),t.j41(31,"ion-item",20),t.bIt("click",function(){return t.eBV(o),t.Njj(i.toggle_custom_color())}),t.j41(32,"ion-label"),t.EFF(33),t.k0s(),t.j41(34,"div",25)(35,"input",26),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.userInput.custom_color,r)||(i.userInput.custom_color=r),t.Njj(r)}),t.k0s()()(),t.j41(36,"ion-accordion-group",null,1),t.DNE(38,se,10,3,"ion-accordion",27),t.j41(39,"ion-accordion",28)(40,"ion-item",29)(41,"ion-label",30),t.EFF(42),t.k0s(),t.j41(43,"ion-label",31),t.EFF(44),t.k0s(),t.nrm(45,"ion-icon",32),t.k0s(),t.j41(46,"div",33)(47,"ion-datetime",34,2),t.bIt("ionChange",function(r){return t.eBV(o),t.Njj(i.limit_change(r))}),t.k0s()()()(),t.j41(49,"div",35),t.DNE(50,le,2,0,"div",36),t.j41(51,"textarea",37),t.mxI("ngModelChange",function(r){return t.eBV(o),t.DH7(i.userInput.description,r)||(i.userInput.description=r),t.Njj(r)}),t.k0s()(),t.DNE(52,pe,6,3,"div",38),t.j41(53,"input",39),t.bIt("change",function(r){return t.eBV(o),t.Njj(i.SelectVoidDrawBackgroundImage(r))}),t.k0s(),t.DNE(54,fe,2,1,"div",40),t.j41(55,"input",41),t.bIt("change",function(r){return t.eBV(o),t.Njj(i.inputImageSelected(r))}),t.k0s()()()()(),t.j41(56,"div",42)(57,"table",43)(58,"tr")(59,"td")(60,"div")(61,"div",35),t.DNE(62,Ie,2,0,"div",44),t.j41(63,"ion-button",45),t.bIt("click",function(){return t.eBV(o),t.Njj(i.saveData())}),t.EFF(64),t.k0s()()()(),t.DNE(65,be,3,2,"td",18),t.k0s()()()()()()}2&e&&(t.R7$(3),t.JRh(i.lang.text.TodoDetail.Title),t.R7$(12),t.Y8G("ngIf",i.isModify),t.R7$(),t.Y8G("ngIf",i.isStoreAtChangable&&i.AmICreator),t.R7$(),t.Y8G("ngIf",!i.isStoreAtChangable||!i.AmICreator),t.R7$(2),t.Y8G("label",i.lang.text.TodoDetail.DisplayName),t.R50("ngModel",i.userInput.title),t.Y8G("placeholder",i.lang.text.TodoDetail.DisplayName_placeholder),t.R7$(),t.Y8G("ngIf","local"!=i.userInput.storeAt&&i.isManager&&i.WorkerGroups.length),t.R7$(2),t.Y8G("label",i.lang.text.TodoDetail.Importance)("value",i.userInput.importance),t.R7$(3),t.JRh(i.lang.text.TodoDetail.Importance_2),t.R7$(2),t.JRh(i.lang.text.TodoDetail.Importance_1),t.R7$(2),t.JRh(i.lang.text.TodoDetail.Importance_0),t.R7$(),t.Y8G("ngIf",!i.isStoreAtChanged&&i.userInput.workers),t.R7$(3),t.JRh(i.lang.text.TodoDetail.CustomColor),t.R7$(),t.Aen("background-image: linear-gradient(to right, #0000, "+(i.userInput.custom_color||i.alert_color)+")"),t.R7$(),t.R50("ngModel",i.userInput.custom_color),t.R7$(3),t.Y8G("ngIf",i.isLimitUsable),t.R7$(4),t.JRh(i.lang.text.TodoDetail.limit),t.R7$(2),t.JRh(i.limitDisplay),t.R7$(3),t.Y8G("locale",i.lang.lang),t.R7$(3),t.Y8G("ngIf",i.global.ShowHint&&i.CheckIfTitleFocus),t.R7$(),t.R50("ngModel",i.userInput.description),t.Y8G("placeholder",i.lang.text.TodoDetail.description),t.R7$(),t.Y8G("ngForOf",i.userInput.attach),t.R7$(),t.Y8G("id",i.voidDrawContextId),t.R7$(),t.Y8G("ngIf",i.isStoreAtChangable),t.R7$(),t.Y8G("id",i.file_sel_id),t.R7$(7),t.Y8G("ngIf",i.global.ShowHint),t.R7$(),t.Y8G("disabled",i.isButtonClicked),t.R7$(),t.SpI(" ",i.buttonDisplay.saveTodo," "),t.R7$(),t.Y8G("ngIf",i.isModify))},dependencies:[$.Sq,$.bT,P.me,P.BC,P.vS,b.xk,b.YH,b.Jm,b.QW,b.eY,b.hU,b.W9,b.A9,b.lO,b.eU,b.iq,b.$w,b.uz,b.he,b.ln,b.Nm,b.Ip,b.BC,b.ai,b.hB,b.Je,b.Gw,b.el],styles:[".uneditable_data[_ngcontent-%COMP%]{color:#888}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding-top:8px;scroll-behavior:smooth}.group_background[_ngcontent-%COMP%]{--background: var(--todo-worker-group-bg)}.worker_background[_ngcontent-%COMP%]{--background: var(--todo-worker-bg)}.logs[_ngcontent-%COMP%]{background:var(--voidDraw-menu-background);border-radius:8px;margin:8px;padding:4px 8px;text-align:center}.image_thumbnail[_ngcontent-%COMP%]{width:auto;height:auto;object-fit:contain;display:block;margin:auto;cursor:pointer}.ignore_check[_ngcontent-%COMP%]{pointer-events:none}"]}),f})()},{path:"void-draw",loadChildren:()=>Promise.all([I.e(4020),I.e(2655)]).then(I.bind(I,2655)).then(d=>d.VoidDrawPageModule)},{path:"ionic-viewer",loadChildren:()=>Promise.all([I.e(4803),I.e(222)]).then(I.bind(I,4803)).then(d=>d.IonicViewerPageModule)}];let ke=(()=>{var d;class f{}return(d=f).\u0275fac=function(e){return new(e||d)},d.\u0275mod=t.$C({type:d}),d.\u0275inj=t.G2t({imports:[j.iI.forChild(ve),j.iI]}),f})(),ye=(()=>{var d;class f{}return(d=f).\u0275fac=function(e){return new(e||d)},d.\u0275mod=t.$C({type:d}),d.\u0275inj=t.G2t({imports:[$.MD,P.YN,b.bv,ke]}),f})()}}]);