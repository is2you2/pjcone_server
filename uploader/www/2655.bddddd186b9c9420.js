"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2655],{2655:(dt,ye,x)=>{x.r(ye),x.d(ye,{VoidDrawPageModule:()=>Ke});var de=x(177),oe=x(4341),v=x(5374),ae=x(9858),E=x(467),Se=x(8326),Ie=x(92),i=x(3953),Ve=x(4234),We=x(3656),Me=x(482),je=x(755),Le=x(4237),Ee=x(9900),Be=x(4020);const He=["RemoteDraw"],Ne=["ChangeTransparent"],Ge=["ChangeResolution"],Xe=["AddrQRShare"];function $e(g,I){1&g&&(i.j41(0,"div",17),i.EFF(1,"Shift + S"),i.k0s())}function Oe(g,I){if(1&g&&(i.j41(0,"ion-select-option",18),i.EFF(1),i.k0s()),2&g){const l=I.$implicit;i.Y8G("value",l),i.R7$(),i.JRh(l.info.name)}}function Fe(g,I){if(1&g){const l=i.RV6();i.j41(0,"img",24),i.bIt("click",function(){i.eBV(l);const t=i.XpG(2);return i.Njj(t.copy_address(t.SelectedAddress))}),i.k0s()}if(2&g){const l=i.XpG(2);i.Y8G("src",l.QRCodeSRC,i.B4B)}}function Ye(g,I){if(1&g){const l=i.RV6();i.j41(0,"div",19)(1,"div",20),i.DNE(2,Fe,1,1,"img",21),i.j41(3,"ion-item",22),i.bIt("click",function(){i.eBV(l);const t=i.XpG();return i.Njj(t.copy_address(t.SelectedAddress))}),i.j41(4,"ion-label",23),i.EFF(5),i.k0s()()()()}if(2&g){const l=i.XpG();i.R7$(2),i.Y8G("ngIf",l.QRCodeSRC),i.R7$(3),i.JRh(l.SelectedAddress)}}function Ue(g,I){if(1&g){const l=i.RV6();i.j41(0,"div",25),i.bIt("click",function(t){i.eBV(l);const r=i.XpG();return i.Njj(r.CheckIfDismissAct(t))}),i.j41(1,"div",26)(2,"h4"),i.EFF(3),i.k0s(),i.j41(4,"ion-range",27),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.colorPickRed,t)||(r.colorPickRed=t),i.Njj(t)}),i.bIt("ionInput",function(){i.eBV(l);const t=i.XpG();return i.Njj(t.ColorSliderUpdate())}),i.j41(5,"div",28),i.EFF(6),i.k0s(),i.j41(7,"div",29)(8,"input",30),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.colorPickRed,t)||(r.colorPickRed=t),i.Njj(t)}),i.k0s()()(),i.j41(9,"ion-range",27),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.colorPickGreen,t)||(r.colorPickGreen=t),i.Njj(t)}),i.bIt("ionInput",function(){i.eBV(l);const t=i.XpG();return i.Njj(t.ColorSliderUpdate())}),i.j41(10,"div",28),i.EFF(11),i.k0s(),i.j41(12,"div",29)(13,"input",30),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.colorPickGreen,t)||(r.colorPickGreen=t),i.Njj(t)}),i.k0s()()(),i.j41(14,"ion-range",27),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.colorPickBlue,t)||(r.colorPickBlue=t),i.Njj(t)}),i.bIt("ionInput",function(){i.eBV(l);const t=i.XpG();return i.Njj(t.ColorSliderUpdate())}),i.j41(15,"div",28),i.EFF(16),i.k0s(),i.j41(17,"div",29)(18,"input",30),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.colorPickBlue,t)||(r.colorPickBlue=t),i.Njj(t)}),i.k0s()()(),i.j41(19,"ion-range",27),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.colorPickAlpha,t)||(r.colorPickAlpha=t),i.Njj(t)}),i.bIt("ionInput",function(){i.eBV(l);const t=i.XpG();return i.Njj(t.ColorSliderUpdate())}),i.j41(20,"div",28),i.EFF(21),i.k0s(),i.j41(22,"div",29)(23,"input",30),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.colorPickAlpha,t)||(r.colorPickAlpha=t),i.Njj(t)}),i.k0s()()()()()}if(2&g){const l=i.XpG();i.R7$(3),i.JRh(l.lang.text.voidDraw.ColorpickDetail),i.R7$(),i.R50("ngModel",l.colorPickRed),i.R7$(2),i.JRh(l.lang.text.voidDraw.ColorpickRed),i.R7$(2),i.R50("ngModel",l.colorPickRed),i.R7$(),i.R50("ngModel",l.colorPickGreen),i.R7$(2),i.JRh(l.lang.text.voidDraw.ColorpickGreen),i.R7$(2),i.R50("ngModel",l.colorPickGreen),i.R7$(),i.R50("ngModel",l.colorPickBlue),i.R7$(2),i.JRh(l.lang.text.voidDraw.ColorpickBlue),i.R7$(2),i.R50("ngModel",l.colorPickBlue),i.R7$(),i.R50("ngModel",l.colorPickAlpha),i.R7$(2),i.JRh(l.lang.text.voidDraw.ColorpickAlpha),i.R7$(2),i.R50("ngModel",l.colorPickAlpha)}}function Je(g,I){if(1&g){const l=i.RV6();i.j41(0,"div",31),i.bIt("click",function(t){i.eBV(l);const r=i.XpG();return i.Njj(r.CheckIfDismissAct(t))}),i.j41(1,"div",32)(2,"h4"),i.EFF(3),i.k0s(),i.j41(4,"ion-range",33),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.resolutionRatio,t)||(r.resolutionRatio=t),i.Njj(t)}),i.bIt("ionInput",function(){i.eBV(l);const t=i.XpG();return i.Njj(t.ResolutionSliderUpdate())}),i.j41(5,"div",28),i.EFF(6),i.k0s(),i.j41(7,"div",29)(8,"input",30),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.resolutionRatio,t)||(r.resolutionRatio=t),i.Njj(t)}),i.k0s()()(),i.j41(9,"ion-toggle",34),i.bIt("ionChange",function(){i.eBV(l);const t=i.XpG();return i.Njj(t.UserToggleAutoResolution())}),i.mxI("ngModelChange",function(t){i.eBV(l);const r=i.XpG();return i.DH7(r.ToggleAutoResolution,t)||(r.ToggleAutoResolution=t),i.Njj(t)}),i.EFF(10),i.k0s(),i.j41(11,"div"),i.EFF(12),i.k0s()()()}if(2&g){const l=i.XpG();i.R7$(3),i.JRh(l.lang.text.voidDraw.ResolutionDetail),i.R7$(),i.R50("ngModel",l.resolutionRatio),i.Y8G("disabled",l.ToggleAutoResolution),i.R7$(2),i.JRh(l.lang.text.voidDraw.ResolutionRatio),i.R7$(2),i.R50("ngModel",l.resolutionRatio),i.R7$(),i.R50("ngModel",l.ToggleAutoResolution),i.R7$(),i.JRh(l.lang.text.voidDraw.AutoResolution),i.R7$(2),i.Lme("",l.resolutionEffectedWidth," x ",l.resolutionEffectedHeight,"")}}const Qe=[{path:"",component:(()=>{var g;class I{constructor(o,t,r,e,s,_,d,m,y,B,S){this.lang=o,this.alertCtrl=t,this.loadingCtrl=r,this.global=e,this.indexed=s,this.nakama=_,this.p5toast=d,this.webrtc=m,this.router=y,this.route=B,this.navCtrl=S,this.voidDrawId="voidDraw",this.isMobile=!1,this.p5DrawingStack=[],this.colorPickRed=0,this.colorPickGreen=0,this.colorPickBlue=0,this.colorPickAlpha=255,this.isCropMode=!1,this.HasConnectedPeer=!1,this.ServerList=[],this.isDrawServerCreated=!1,this.ReadyToShareAct=!1,this.AlreadyExistServer=!1,this.resolutionRatio=100,this.resolutionEffectedWidth=0,this.resolutionEffectedHeight=0,this.ToggleAutoResolution=!1,this.WillLeaveHere=!1,this.WithoutSave=!0,this.QRNavParams={}}ngOnDestroy(){this.route.queryParams.unsubscribe(),this.global.PageDismissAct[this.navParams.dismiss]&&this.global.PageDismissAct[this.navParams.dismiss]({}),this.p5ActualCanvas&&(this.p5ActualCanvas.remove(),this.p5ActualCanvas=null),!this.AlreadyExistServer&&this.TargetRemoteAddress&&this.nakama.RemoveWebRTCServer(this.TargetRemoteAddress.split("://").pop()),this.p5ImageCanvas&&(this.p5ImageCanvas.remove(),this.p5ImageCanvas=null),this.p5voidDraw&&this.p5voidDraw.remove(),this.IceWebRTCWsClient&&this.IceWebRTCWsClient.close(1e3),this.CancelRemoteAct()}ngOnInit(){var o=this;this.route.queryParams.subscribe(function(){var t=(0,E.A)(function*(r){try{const e=o.router.getCurrentNavigation().extras.state;if(!e)throw"\ud398\uc774\uc9c0 \ubcf5\uadc0";o.navParams=e||{},o.voidDrawId=`voidDraw_${Date.now()}`,o.QueueAfterLoad=()=>{o.create_new_canvas({width:e.width,height:e.height,path:e.path,type:e.type}),e.remote&&setTimeout(()=>{o.Port=e.remote.port,o.username=e.remote.username,o.password=e.remote.password,o.CreateRemoteLocalClient(e.remote.address,e.remote.channel)},1e3)}}catch(e){console.log("\uadf8\ub9bc\ud310 \uc815\ubcf4 \ubc1b\uc9c0 \ubabb\ud568: ",e),o.p5SetDrawable(!0)}});return function(r){return t.apply(this,arguments)}}())}ionViewWillEnter(){this.QueueAfterLoad&&this.QueueAfterLoad(),this.QueueAfterLoad=null,this.p5SetDrawable(!0)}ionViewDidEnter(){var o=this;return(0,E.A)(function*(){o.global.StoreShortCutAct("void-draw"),o.AddShortCut(),o.mainLoading=yield o.loadingCtrl.create({message:o.lang.text.voidDraw.UseThisImage}),o.isMobile="DesktopPWA"!=Ie.aH})()}AddShortCut(){delete this.global.p5KeyShortCut.Digit,this.global.p5KeyShortCut.HistoryAct=o=>{switch(o.code.slice(-1)){case"Z":this.p5history_act(-1);break;case"X":this.p5history_act(1);break;case"C":this.isCropMode?this.p5apply_crop():o.shiftKey?this.p5change_color_contextmenu():this.p5change_color();break;case"V":o.shiftKey?this.p5set_line_weight_contextmenu():this.p5set_line_weight()}},this.global.p5KeyShortCut.AddAct=()=>{this.ClickRemoteAddButton()},this.global.p5KeyShortCut.SKeyAct=o=>{o.shiftKey?this.open_crop_tool_contextmenu():this.open_crop_tool()},this.global.p5KeyShortCut.DeleteAct=()=>{this.isCropMode?this.p5apply_crop():this.dismiss_draw()},this.global.p5KeyShortCut.FKeyAct=()=>{},this.global.p5KeyShortCut.Escape=()=>{this.isDrawServerCreated?this.CancelRemoteAct():this.navCtrl.pop()}}CancelRemoteAct(){this.ReadyToShareAct=!1,this.RemoteLoadingCtrl&&this.RemoteLoadingCtrl.dismiss(),this.isDrawServerCreated=!1,this.p5SetDrawable(!0),this.webrtc.close_webrtc(!1)}create_new_canvas(o){o.width=o.width||432,o.height=o.height||432,this.p5ActualCanvas&&(this.p5ActualCanvas.remove(),this.p5ActualCanvas=null),this.p5ImageCanvas&&(this.p5ImageCanvas.remove(),this.p5ImageCanvas=null),this.p5voidDraw&&this.p5voidDraw.remove(),this.create_p5voidDraw(o)}CheckIfDismissAct(o){"colordetailOuter"==o.target.id&&this.ChangeTransparent.dismiss(),"resolutiondetailOuter"==o.target.id&&this.ChangeResolution.dismiss()}create_p5voidDraw(o){var t=this;let r=document.getElementById(this.voidDrawId);this.isCropMode=!1,this.p5voidDraw=new Se(e=>{let s,_,d,m,y,B,S,f,$,ge,W=e.createColorPicker("#000"),he=Math.min(o.width,o.height)/100,re=Number(localStorage.getItem("voiddraw-lineweight"))||1;e.setup=(0,E.A)(function*(){W.style("position","absolute"),e.pixelDensity(1),e.noLoop(),e.noFill(),e.imageMode(e.CENTER),e.createCanvas(r.clientWidth,r.clientHeight).parent(r),M.x=e.width/2,M.y=e.height/2,t.p5set_line_weight=()=>{t.alertCtrl.create({header:t.lang.text.voidDraw.changeWeight,inputs:[{label:t.lang.text.voidDraw.weight,name:"weight",placeholder:`${re}`,type:"number"}],buttons:[{text:t.lang.text.voidDraw.apply,handler:w=>{w.weight&&(re=Number(w.weight))}}]}).then(w=>{k=!1,w.onWillDismiss().then(()=>{k=!0}),w.present()})},t.p5set_line_weight_contextmenu=()=>{const w=localStorage.getItem("voiddraw-lineweight")||1;t.alertCtrl.create({header:t.lang.text.voidDraw.changeDefaultWeight,inputs:[{label:t.lang.text.voidDraw.weight,name:"weight",placeholder:`${w}`,type:"number"}],buttons:[{text:t.lang.text.voidDraw.apply,handler:R=>{R.weight&&(localStorage.setItem("voiddraw-lineweight",R.weight),re=Number(R.weight))}}]}).then(R=>{k=!1,R.onWillDismiss().then(()=>{k=!0,V=!1}),R.present()})},t.p5change_color=()=>{W.elt.click()},t.p5change_color_contextmenu=()=>{t.ChangeTransparent.onDidDismiss().then(()=>{k=!0,V=!1,t.global.RestoreShortCutAct("draw-transparent")}),k=!1,t.global.StoreShortCutAct("draw-transparent"),t.ChangeTransparent.present()},t.p5save_image=(w=!1,R=!1)=>{new Se(p=>{p.setup=()=>{let ce=p.createCanvas(t.resolutionEffectedWidth,t.resolutionEffectedHeight);p.pixelDensity(1),d&&p.image(d,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),m&&p.image(m,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),s&&p.image(s,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight);let be=ce.elt.toDataURL("image/png").replace("image/png","image/octet-stream"),xe=`voidDraw_${p.year()}-${p.nf(p.month(),2)}-${p.nf(p.day(),2)}_${p.nf(p.hour(),2)}-${p.nf(p.minute(),2)}-${p.nf(p.second(),2)}.png`;if(R){let K=t.global.Base64ToBlob(be,"image/png");t.global.WriteValueToClipboard("image/png",K,"image.png")}else{if(w){t.p5toast.show({text:`${t.lang.text.ContentViewer.DownloadThisFile}: ${xe}`});let K=p.createA(be,null);K.elt.download=xe,K.hide(),K.parent(r),K.elt.click()}else t.navParams.dismiss&&t.global.PageDismissAct[t.navParams.dismiss]({data:{name:xe,img:be,loadingCtrl:t.mainLoading}}),t.navCtrl.pop();p.remove()}}})},t.p5history_act=(w,R=!1)=>{let p=L+w;if(!(p>t.p5DrawingStack.length)){switch(L=e.min(e.max(0,p),t.p5DrawingStack.length),w){case 1:t.p5DrawingStack.length&&(f.style.fill="var(--ion-color-dark)"),L==t.p5DrawingStack.length&&($.style.fill="var(--ion-color-medium)"),J(s,t.p5DrawingStack[L-1]);break;case-1:t.p5DrawingStack.length&&($.style.fill="var(--ion-color-dark)"),L<1?(f.style.fill="var(--ion-color-medium)",s.clear(255,255,255,255),e.redraw()):le()}!R&&t.ReadyToShareAct&&t.webrtc.dataChannel.send(JSON.stringify({type:"same",act:"history_act",data:w}))}},t.p5open_crop_tool=()=>{t.isCropMode?(t.isCropMode=!1,e.redraw()):(t.isCropMode=!0,k=!0,h.x=s.width,h.y=s.height,G.x=0,G.y=0,e.redraw()),ge(),V=!1},t.ToggleAutoResolution=!!localStorage.getItem("voidDraw-auto-adjust-res"),t.ToggleAutoResolution&&(t.resolutionRatio=e.min(100,100*C)),t.resolutionEffectedWidth=e.floor(o.width*t.resolutionRatio/100),t.resolutionEffectedHeight=e.floor(o.height*t.resolutionRatio/100),t.open_crop_tool_contextmenu=()=>{t.ChangeResolution.onDidDismiss().then(()=>{k=!0,V=!1,t.global.RestoreShortCutAct("resolution-detail")}),k=!1,t.global.StoreShortCutAct("resolution-detail"),t.ChangeResolution.present()},t.UserToggleAutoResolution=()=>{t.ToggleAutoResolution?(t.resolutionRatio=e.min(100,100*C),t.ResolutionSliderUpdate(),localStorage.setItem("voidDraw-auto-adjust-res","1")):localStorage.removeItem("voidDraw-auto-adjust-res")},t.ResolutionSliderUpdate=()=>{e.pixelDensity(e.min(1,1*t.resolutionRatio/100/C)),e.redraw(),t.resolutionEffectedWidth=e.floor(s.width*t.resolutionRatio/100),t.resolutionEffectedHeight=e.floor(s.height*t.resolutionRatio/100)},t.p5apply_crop=(w=!0)=>{w&&t.isMobile&&G.div(C),s.resizeCanvas(h.x,h.y),_=e.createVector(s.width/2,s.height/2),w&&D.sub(G),le(),d.resizeCanvas(h.x,h.y),d.push(),d.background(t.navParams.isDarkMode?26:255),d.translate(D),t.p5BaseImage&&d.image(t.p5BaseImage,0,0),d.pop(),d.redraw(),m.resizeCanvas(h.x,h.y),m.push(),y&&(m.translate(D),m.image(y,ne.x,ne.y)),m.pop(),m.redraw();let R=m.elt.toDataURL("image/png");if(e.loadImage(R,p=>{ne.x=-D.x,ne.y=-D.y,y=p,m.image(y,0,0),m.redraw()}),t.isCropMode=!1,ge(),t.ToggleAutoResolution&&(t.resolutionRatio=e.min(100,100*C)),t.resolutionEffectedWidth=e.floor(h.x*t.resolutionRatio/100),t.resolutionEffectedHeight=e.floor(h.y*t.resolutionRatio/100),t.p5SetCanvasViewportInit(),w&&t.ReadyToShareAct){let p=t.p5getCropPos(),ce=t.p5getCropSize();t.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"crop",cropPX:p.x,cropPY:p.y,cropSX:ce.x,cropSY:ce.y}))}},t.p5SetDrawable=st,B=e.createElement("table"),B.style("position: absolute; top: 0px;"),B.style(`width: 100%; height: ${j}px;`),B.style("background-color: var(--voidDraw-menu-background);"),B.parent(r);let n=B.elt.insertRow(0),c=n.insertCell(0);c.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">A</div><ion-icon style="width: 27px; height: 27px" name="wifi-outline"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="wifi-outline"></ion-icon>',c.style.textAlign="center",c.style.cursor="pointer",c.onclick=()=>{t.ClickRemoteAddButton()};let P=n.insertCell(1);P.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">S</div><ion-icon style="width: 27px; height: 27px" name="crop"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="crop"></ion-icon>',P.style.textAlign="center",P.style.cursor="pointer",P.onclick=()=>{t.open_crop_tool()},P.oncontextmenu=()=>{t.open_crop_tool_contextmenu()};let A=n.insertCell(2);A.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>',A.style.textAlign="center",A.style.cursor="pointer",A.onclick=()=>{t.dismiss_draw()},ge=()=>{A.innerHTML=t.isCropMode?t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="cut-sharp"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="cut-sharp"></ion-icon>':t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>'},S=e.createElement("table"),S.style("position: absolute; bottom: 0px;"),S.style(`width: 100%; height: ${j}px;`),S.style("background-color: var(--voidDraw-menu-background);"),S.parent(r);let O=S.elt.insertRow(0),te=O.insertCell(0);te.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">Z</div><ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon></div>':'<ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon>',f=document.getElementById("undoIcon"),f.style.fill="var(--ion-color-medium)",te.style.textAlign="center",te.style.cursor="pointer",te.onclick=()=>{t.p5history_act(-1)};let ie=O.insertCell(1);ie.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">X</div><ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon></div>':'<ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon>',$=document.getElementById("redoIcon"),$.style.fill="var(--ion-color-medium)",ie.style.textAlign="center",ie.style.cursor="pointer",ie.onclick=()=>{t.p5history_act(1)};let X=O.insertCell(2);X.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">C</div><ion-icon style="width: 27px; height: 27px" name="color-palette"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="color-palette"></ion-icon>',W.style("width: 0px; height: 0px; opacity: 0;"),W.parent(X),W.elt.oninput=()=>{let w=W.color().levels,R=`#${e.hex(w[0],2)}${e.hex(w[1],2)}${e.hex(w[2],2)}`;X.childNodes[0].style.color=R,t.colorPickRed=w[0],t.colorPickGreen=w[1],t.colorPickBlue=w[2],t.colorPickAlpha=w[3]},o.path&&(W.value("#ff0000"),W.elt.oninput()),X.style.textAlign="center",X.style.cursor="pointer",X.onclick=()=>{W.elt.click()},X.oncontextmenu=()=>(t.p5change_color_contextmenu(),!1),t.ColorSliderUpdate=()=>{let w=`#${e.hex(t.colorPickRed,2)}${e.hex(t.colorPickGreen,2)}${e.hex(t.colorPickBlue,2)}`;W.value(w);let R=`#${e.hex(t.colorPickRed,2)}${e.hex(t.colorPickGreen,2)}${e.hex(t.colorPickBlue,2)}${e.hex(t.colorPickAlpha,2)}`;X.childNodes[0].style.color=R};let z=O.insertCell(3);if(z.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">V</div><ion-icon style="width: 27px; height: 27px" name="pencil"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="pencil"></ion-icon>',z.style.textAlign="center",z.style.cursor="pointer",z.onclick=()=>{t.change_line_weight()},z.oncontextmenu=()=>{t.p5set_line_weight_contextmenu()},t.p5SetCanvasViewportInit=()=>{e.resizeCanvas(r.clientWidth,r.clientHeight),pe=M.copy(),me=C,we=Y.copy(),H=0,ue=!0,e.loop()},s=e.createGraphics(o.width,o.height),_=e.createVector(s.width/2,s.height/2),s.pixelDensity(1),s.noLoop(),s.noFill(),t.p5ActualCanvas=s,d=e.createGraphics(o.width,o.height),d.pixelDensity(1),d.noLoop(),d.noFill(),d.background(t.navParams.isDarkMode?26:255),t.p5ImageCanvas=d,m=e.createGraphics(o.width,o.height),m.pixelDensity(1),m.noLoop(),m.noFill(),m.clear(255,255,255,255),o.path){let w=yield t.indexed.loadBlobFromUserPath(o.path,o.type),R=URL.createObjectURL(w);e.loadImage(R,p=>{t.p5BaseImage=p,d.image(t.p5BaseImage,0,0),d.redraw(),URL.revokeObjectURL(R),setTimeout(()=>{t.p5SetCanvasViewportInit()},100)},p=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",p),d.redraw(),URL.revokeObjectURL(R),setTimeout(()=>{t.p5SetCanvasViewportInit()},100)})}else d.redraw(),setTimeout(()=>{t.p5SetCanvasViewportInit()},100);o.width<o.height&&(he/=C),t.p5getCropPos=qe,t.p5setCropPos=ke,t.p5getCropSize=et,t.p5setCropSize=tt,t.p5RemoteDrawStart=at,t.p5RemoteDrawing=rt,t.p5RemoteDrawingEnd=nt,t.p5updateRemoteCurve=ot,t.p5CancelCurrentDraw=()=>{b=null,e.redraw()},t.navParams.scrollHeight&&ke(0,-t.navParams.scrollHeight)});let M=e.createVector(),C=1,Y=e.createVector(0,0),D=e.createVector(),ne=e.createVector(),G=e.createVector(),h=e.createVector(),ue=!1,H=0,pe=e.createVector(0,0),me=0,we=e.createVector(0,0),qe=()=>D,et=()=>h,ke=(a,n)=>{D.x=a,D.y=n,d.translate(a,n),m.translate(a,n),e.redraw()},tt=(a,n)=>{h.x=a,h.y=n,d.translate(a,n),m.translate(a,n),e.redraw()},U=a=>e.sin(a*e.PI/2);e.draw=()=>{if(ue){H+=.07,H>=1&&(ue=!1,H=1,e.noLoop()),Y.x=e.lerp(we.x,e.width/2,U(H)),Y.y=e.lerp(we.y,e.height/2,U(H)),M.x=e.lerp(pe.x,0,U(H)),M.y=e.lerp(pe.y,0,U(H));let a=r.clientHeight-112;C=e.lerp(me,r.clientWidth/a<s.width/s.height?r.clientWidth/s.width:a/s.height,U(H)),this.ToggleAutoResolution&&(this.resolutionRatio=e.min(100,100*C),this.resolutionEffectedWidth=e.floor(s.width*this.resolutionRatio/100),this.resolutionEffectedHeight=e.floor(s.height*this.resolutionRatio/100)),e.pixelDensity(e.min(1,1*this.resolutionRatio/100/C))}if(e.clear(255,255,255,255),e.push(),e.translate(Y),e.scale(C),e.translate(M),e.image(d,0,0),e.image(m,0,0),s&&e.image(s,0,0),this.isCropMode)e.push(),e.translate(-s.width/2,-s.height/2),e.translate(G),e.noStroke(),e.fill(0,100),e.rect(0,0,h.x,h.y),e.stroke(255,0,0),e.strokeWeight(8),e.beginShape(e.LINES),e.vertex(0,0),e.vertex(h.x,0),e.vertex(h.x,0),e.vertex(h.x,.8*h.y),e.vertex(0,0),e.vertex(0,h.y),e.vertex(0,h.y),e.vertex(.8*h.x,h.y),e.stroke(255,255,0),e.vertex(.8*h.x,h.y),e.vertex(h.x,h.y),e.vertex(h.x,.8*h.y),e.vertex(h.x,h.y),e.endShape(),e.pop();else{if(u&&u.pos&&u.pos.length){e.push(),e.translate(D),e.stroke(u.color),e.strokeWeight(u.weight),e.beginShape();for(let a=0,n=u.pos.length;a<n;a++)e.curveVertex(u.pos[a].x-_.x,u.pos[a].y-_.y);e.endShape(),e.pop()}if(this.ReadyToShareAct&&b&&b.pos&&b.pos.length){e.push(),e.translate(D),e.stroke(b.color),e.strokeWeight(b.weight),e.beginShape();for(let a=0,n=b.pos.length;a<n;a++)e.curveVertex(b.pos[a].x-_.x,b.pos[a].y-_.y);e.endShape(),e.pop()}}e.pop()},this.p5DrawingStack=[],this.p5ClearCurrentDraw=()=>{u={},this.p5DrawingStack.length=0,L=0,le(),e.redraw()};let L=0,le=()=>{s.clear(255,255,255,255);for(let a=0;a<L;a++)J(s,this.p5DrawingStack[a])},J=(a,n=u)=>{if(n.color){a.push(),a.translate(D),a.stroke(n.color),a.strokeWeight(n.weight),a.beginShape();for(let c=0,P=n.pos.length;c<P;c++)a.curveVertex(n.pos[c].x,n.pos[c].y);a.endShape(),a.pop(),a.redraw(),e.redraw()}},ot=a=>{for(let n=0,c=a.length;n<c;n++)J(s,a[n]);L=this.p5DrawingStack.length};e.windowResized=()=>{setTimeout(()=>{this.p5SetCanvasViewportInit()},0)};let u={},b={},at=a=>{b=a,e.redraw()},rt=a=>{b&&b.pos&&b.pos.push(a),e.redraw()},nt=a=>{b.pos.push(a),b.pos.push(a),this.p5DrawingStack.length=L,b&&(this.p5DrawingStack.push(b),J(s,b)),L=this.p5DrawingStack.length,b=null,e.redraw()};const j=56;let Ce,Q,_e,fe,De,Z,Re,ve=0,se=!1,V=!1;e.mousePressed=a=>{if(k){if(e.mouseY<j||e.mouseY>e.height-j)return void(V=!0);switch(a.which){case 1:this.isCropMode?Te():Pe();break;case 3:Q=e.createVector(e.mouseX,e.mouseY),Z=M.copy(),Ce=e.createVector(e.mouseX,e.mouseY);break;case 2:this.p5SetCanvasViewportInit()}}};let Te=(a,n)=>{let c=F(a,n),P=G.copy().add(h).sub(e.createVector(s.width/2,s.height/2)),A=c.dist(P),O=.2*e.max(h.x,h.y);se=A<O,se?(fe=e.createVector(e.mouseX,e.mouseY),Re=h.copy()):_e=e.createVector(e.mouseX,e.mouseY).sub(G.mult(C))},Pe=(a,n)=>{f.style.fill="var(--ion-color-dark)",$.style.fill="var(--ion-color-medium)";let c=F(a,n);c.sub(D),c.add(_);let P={x:c.x,y:c.y},A=W.color().levels,O=`#${e.hex(A[0],2)}${e.hex(A[1],2)}${e.hex(A[2],2)}${e.hex(this.colorPickAlpha,2)}`;u={pos:[],color:O,weight:he*re},u.pos.push(P),u.pos.push(P),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"start",data:u})),e.redraw()};e.mouseDragged=a=>{if(k&&!V)switch(a.which){case 1:if(this.isCropMode){let n=e.createVector(e.mouseX,e.mouseY);se?h=Re.copy().add(fe.copy().sub(n).div(-C)):G=_e.copy().sub(n).div(-C),e.redraw()}else{let n=F();n.sub(D),n.add(_);let c={x:n.x,y:n.y};u&&u.pos&&u.pos.push(c),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"moved",data:c})),e.redraw()}break;case 3:Ce=e.createVector(e.mouseX,e.mouseY),M=Z.copy().add(Ce.sub(Q).div(C)),e.redraw()}},e.mouseWheel=a=>{k&&(e.mouseY<j||e.mouseY>e.height-j?V=!0:(lt(F()),C*=a.deltaY<0?1.1:.9,this.ToggleAutoResolution&&(this.resolutionRatio=e.min(100,100*C),this.resolutionEffectedWidth=e.floor(s.width*this.resolutionRatio/100),this.resolutionEffectedHeight=e.floor(s.height*this.resolutionRatio/100)),e.pixelDensity(e.min(1,1*this.resolutionRatio/100/C)),e.redraw()))},e.mouseReleased=a=>{if(k){if(1===a.which&&!this.isCropMode&&!V){let n=F();n.sub(D),n.add(_);let c={x:n.x,y:n.y};if(u)try{u.pos.push(c),u.pos.push(c),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"end",data:c}))}catch{}Ae()}V=!1}};let lt=a=>{Y=e.createVector(e.mouseX,e.mouseY),M=a.mult(-1)},F=(a,n)=>{let c=e.createVector(a||e.mouseX,n||e.mouseY);return c.sub(Y),c.div(C),c.sub(M),c},T=[],q=!1,k=!0,st=a=>{k=a};e.touchStarted=a=>{if(k){if(T=a.touches,a.changedTouches[0].clientY<j||a.changedTouches[0].clientY>e.height-j)return void(V=!0);switch(q=!0,T.length){case 1:this.isCropMode?Te(a.changedTouches[0].clientX,a.changedTouches[0].clientY-j):Pe(a.changedTouches[0].clientX,a.changedTouches[0].clientY-j);break;case 2:let n=e.createVector(T[0].clientX,T[0].clientY-56),c=e.createVector(T[1].clientX,T[1].clientY-56);ve=n.dist(c),Q=n.copy().add(c).div(2),Z=M.copy(),De=C,u=null,this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"cancel"}));break;default:q=!1,this.p5SetCanvasViewportInit()}}},e.touchMoved=a=>{if(k&&q){switch(T=a.touches,T.length){case 1:if(this.isCropMode&&!V){let n=e.createVector(a.changedTouches[0].clientX,a.changedTouches[0].clientY-j);se?h=Re.copy().add(fe.copy().sub(n).div(-C)):G=_e.copy().sub(n).div(-C),e.redraw()}else{let n=F(a.changedTouches[0].clientX,a.changedTouches[0].clientY-j);n.sub(D),n.add(_);let c={x:n.x,y:n.y};u&&u.pos&&u.pos.push(c),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"moved",data:c})),e.redraw()}break;case 2:{let n=e.createVector(T[0].clientX,T[0].clientY-56),c=e.createVector(T[1].clientX,T[1].clientY-56),P=n.copy().add(c).div(2);C=n.dist(c)/ve*De,M=Z.copy().add(P.sub(Q).div(C)),this.ToggleAutoResolution&&(this.resolutionRatio=e.min(100,100*C),this.resolutionEffectedWidth=e.floor(s.width*this.resolutionRatio/100),this.resolutionEffectedHeight=e.floor(s.height*this.resolutionRatio/100)),e.pixelDensity(e.min(1,1*this.resolutionRatio/100/C)),e.redraw()}}return!1}},e.touchEnded=a=>{if(k&&a.changedTouches){switch(T=a.touches,q=!1,T.length){case 0:if(!this.isCropMode&&!V&&u){let n=F(a.changedTouches[0].clientX,a.changedTouches[0].clientY-j);n.sub(D),n.add(_);let c={x:n.x,y:n.y};u.pos.push(c),u.pos.push(c),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"end",data:c})),Ae()}break;case 1:if(!q)return;ct(),ve=0,u=null}V=!1}};let ct=()=>{Q=e.createVector(T[0].clientX,T[0].clientY-56),Z=M.copy()},Ae=()=>{if(this.p5DrawingStack.length=L,u)if(this.p5DrawingStack.push(u),this.p5DrawingStack.length>20){let a=this.p5DrawingStack.shift();J(m,a);let n=m.elt.toDataURL("image/png");e.loadImage(n,c=>{y=c,m.redraw()}),le()}else J(s,u);L=this.p5DrawingStack.length,Q=null,V=!1,u=null,e.redraw()}})}ClickRemoteAddButton(){if(!this.isDrawServerCreated){if(this.IceWebRTCWsClient)return this.isDrawServerCreated=!0,this.global.StoreShortCutAct("voiddraw-remote"),this.p5SetDrawable(!1),this.AddrQRShare.onDidDismiss().then(()=>{this.p5SetDrawable(!0),this.isDrawServerCreated=!1,this.global.RestoreShortCutAct("voiddraw-remote"),this.HasConnectedPeer||this.p5SetDrawable(!0)}),void this.AddrQRShare.present();this.ServerList=this.nakama.get_all_online_server(),this.ServerList.length?(this.p5SetDrawable(!1),this.RemoteDraw.open()):(this.p5SetDrawable(!1),this.RemoteBridgeServerSelected({detail:{value:"local"}}))}}RemoteBridgeServerSelected(o){var t=this;return(0,E.A)(function*(){if(t.isDrawServerCreated)return;let r=o.detail.value;if("local"===r){let e;t.alertCtrl.create({header:t.lang.text.voidDraw.LocalAddrInput,inputs:[{type:"text",placeholder:"(wss://)0.0.0.0(:0)"},{type:"text",placeholder:"rtcport:username:password"}],buttons:[{text:t.lang.text.voidDraw.Confirm,handler:s=>{let _=s[1].split(":");t.Port=_[0],t.username=_[1],t.password=_[2],s[0]?(t.InputCustomAddress=s[0],t.p5SetDrawable(!1),e=!0,t.CreateOnMessageLink(),t.CreateRemoteLocalClient(s[0],s[1])):t.p5toast.show({text:t.lang.text.voidDraw.InputAddress})}}]}).then(s=>{s.onWillDismiss().then(()=>{t.p5SetDrawable(!0)}),s.onDidDismiss().then(()=>{!e&&!t.WillLeaveHere&&t.global.RestoreShortCutAct("voiddraw-remote-bridge")}),t.global.StoreShortCutAct("voiddraw-remote-bridge"),s.present()})}else t.InputCustomAddress=`${r.info.useSSL?"wss":"ws"}://${r.info.address}`,t.p5SetDrawable(!1),t.CreateOnMessageLink(),t.CreateRemoteLocalClient(t.InputCustomAddress,o[1],r.info)})()}CreateRemoteLocalClient(o,t,r){var e=this;return(0,E.A)(function*(){let s=o.split("://"),_=s.pop().split(":");e.TargetRemoteAddress=_[0];let m,d=s.pop();d?d+=":":d=e.global.checkProtocolFromAddress(_[0])?"wss:":"ws:",r?e.AlreadyExistServer=!0:yield e.nakama.SaveWebRTCServer({urls:[`stun:${_[0]}:${e.Port||("wss:"==d?5349:3478)}`,`turn:${_[0]}:${e.Port||("wss"==d?5349:3478)}`],username:e.username||"username",credential:e.password||"password"}).then(y=>e.AlreadyExistServer=y),e.IceWebRTCWsClient=new WebSocket(`${d}//${_[0]}:${_[1]||12013}/`),e.AddShortCut(),e.isDrawServerCreated=!0,e.IceWebRTCWsClient.onopen=(0,E.A)(function*(){e.p5toast.show({text:`${e.lang.text.voidDraw.Connected}: ${_[0]}`}),t?(e.IceWebRTCWsClient.send(JSON.stringify({type:"join",channel:t})),yield new Promise(y=>setTimeout(y,e.global.WebsocketRetryTerm)),e.IceWebRTCWsClient.send(JSON.stringify({type:"size_req",channel:t})),e.RemoteLoadingCtrl=yield e.loadingCtrl.create({message:e.lang.text.voidDraw.WaitingConnection}),e.RemoteLoadingCtrl.present()):e.IceWebRTCWsClient.send(JSON.stringify({type:"init",max:2}))}),e.IceWebRTCWsClient.onmessage=function(){var y=(0,E.A)(function*(B){let S;try{let f=JSON.parse(B.data);if(void 0===m)m=f.uid;else if(m==f.uid)return;switch(f.type){case"join":e.HasConnectedPeer=!0,e.p5SetDrawable(!1);break;case"block":console.error("\uc774\ubbf8 \uc5f0\uacb0\ub41c \uc0ac\uc6a9\uc790 \uc788\uc74c"),e.IceWebRTCWsClient.close(1e3,"block");break;case"leave":e.HasConnectedPeer=!1,e.p5SetDrawable(!0),e.RemoteLoadingCtrl.dismiss(),e.IceWebRTCWsClient.close(1e3,"leave_pair");break;case"init_id":e.QRNavParams={address:o,channel:f.id,user_id:f.uid},e.init_gen_qrcode(),e.AddrQRShare.onDidDismiss().then(()=>{e.isDrawServerCreated=!1,e.global.RestoreShortCutAct("voiddraw-remote"),e.HasConnectedPeer||e.p5SetDrawable(!0)}),e.global.StoreShortCutAct("voiddraw-remote"),e.p5SetDrawable(!1),e.AddrQRShare.present(),e.IceWebRTCWsClient.send(JSON.stringify({type:"join",channel:f.id})),S=f.id;break;case"init_req":e.RemoteLoadingCtrl.message=e.lang.text.voidDraw.WebRTC_Init,e.webrtc.initialize("data").then((0,E.A)(function*(){e.webrtc.HangUpCallBack=()=>{e.IceWebRTCWsClient.close(1e3,"hangup_webrtc")},e.CreateOnMessageLink(),e.CreateOnOpenAct(),e.webrtc.CreateOffer(),yield new Promise(W=>setTimeout(W,e.global.WebsocketRetryTerm)),e.IceWebRTCWsClient.send(JSON.stringify({type:"socket_react",channel:S,act:"WEBRTC_INIT_REQ_SIGNAL"}))}));break;case"size_req":e.AddrQRShare.dismiss(),e.RemoteLoadingCtrl=yield e.loadingCtrl.create({message:e.lang.text.voidDraw.WaitingConnection}),e.RemoteLoadingCtrl.present();let $=e.p5getCropPos();e.IceWebRTCWsClient.send(JSON.stringify({type:"size",width:e.p5ActualCanvas.width,height:e.p5ActualCanvas.height,cropX:$.x,cropY:$.y,channel:S}));break;case"socket_react":switch(f.act){case"WEBRTC_REPLY_INIT_SIGNAL":e.RemoteLoadingCtrl.message=e.lang.text.voidDraw.WebRTC_Reply,e.nakama.socket_reactive[f.act](f.data_str),"EOL"==f.data_str&&(e.RemoteLoadingCtrl.message=e.lang.text.voidDraw.WebRTC_Offer,e.webrtc.CreateAnswer({client:e.IceWebRTCWsClient,channel:S})),e.RemoteLoadingCtrl.message=e.lang.text.voidDraw.WebRTC_Ice;break;case"WEBRTC_ICE_CANDIDATES":e.nakama.socket_reactive[f.act](f.data_str,{client:e.IceWebRTCWsClient,channel:S}),e.RemoteLoadingCtrl.message=e.lang.text.voidDraw.WebRTC_datachannel,e.IceWebRTCWsClient.send(JSON.stringify({type:"init_end",channel:S}));break;case"WEBRTC_INIT_REQ_SIGNAL":e.nakama.socket_reactive[f.act]({client:e.IceWebRTCWsClient,channel:S});break;case"WEBRTC_RECEIVE_ANSWER":e.nakama.socket_reactive[f.act](f.data_str,{client:e.IceWebRTCWsClient,channel:S})}break;case"size":e.create_new_canvas({width:f.width,height:f.height}),e.p5SetDrawable(!1),e.p5setCropPos(f.cropX,f.cropY),e.p5voidDraw.redraw(),e.RemoteLoadingCtrl.message=e.lang.text.voidDraw.WebRTC_Init,e.webrtc.initialize("data").then(()=>{e.webrtc.HangUpCallBack=()=>{e.IceWebRTCWsClient&&e.IceWebRTCWsClient.close(1e3,"hangup_callback")},e.CreateOnOpenAct(),e.CreateOnMessageLink(),e.RemoteLoadingCtrl.message=e.lang.text.voidDraw.WebRTC_Offer,e.webrtc.CreateOffer(),e.IceWebRTCWsClient.send(JSON.stringify({type:"init_req"}))});break;case"init_end":e.RemoteLoadingCtrl.message=e.lang.text.voidDraw.WebRTC_datachannel}}catch{e.IceWebRTCWsClient.close(1e3)}});return function(B){return y.apply(this,arguments)}}(),e.IceWebRTCWsClient.onerror=y=>{console.log("\uadf8\ub9bc\ud310 \uae30\ub2a5 \uacf5\uc720 \uc5f0\uacb0 \uc624\ub958: ",y),e.IceWebRTCWsClient.close(1e3,"error")},e.IceWebRTCWsClient.onclose=y=>{console.log("\uc5f0\uacb0\uc774 \ub04a\uae30\ub294 \uc774\uc720: ",y),e.p5toast.show({text:e.lang.text.TodoDetail.Disconnected}),e.RemoteLoadingCtrl&&e.RemoteLoadingCtrl.dismiss(),e.AddrQRShare.dismiss(),e.isDrawServerCreated=!1,e.p5SetDrawable(!0),e.webrtc.close_webrtc(!1),e.IceWebRTCWsClient.onopen=null,e.IceWebRTCWsClient.onclose=null,e.IceWebRTCWsClient.onmessage=null,e.IceWebRTCWsClient.onerror=null,e.IceWebRTCWsClient=null}})()}CreateOnOpenAct(o=(0,E.A)(function*(){})){var t=this;this.webrtc.dataChannelOpenAct=(0,E.A)(function*(){if(t.ReadyToShareAct=!0,t.p5ClearCurrentDraw(),o&&(yield o()),t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_ShareBG,t.navParams.path)try{let r=t.navParams.path.split(".").pop(),e=yield t.indexed.loadBlobFromUserPath(t.navParams.path,""),s=t.InputCustomAddress.split("://"),_=s.pop(),d=s.shift();d=d?"wss"==d?"https:":"http:":t.global.checkProtocolFromAddress(t.InputCustomAddress)?"https":"http";let m=yield t.global.upload_file_to_storage({blob:e,size:e.size,file_ext:r,filename:`voidDrawRemoveImage.${r}`},{user_id:`tmp_${t.QRNavParams.channel}_${t.QRNavParams.user_id}`},d,_,!1,t.RemoteLoadingCtrl);t.webrtc.dataChannel.send(JSON.stringify({type:"background",data:m}))}catch(r){t.p5toast.show({text:`${t.lang.text.voidDraw.FailedGetBG}: ${r}`}),console.log("\ubc30\uacbd \uadf8\ub9bc \uacf5\uc720\ud558\uae30 \uc624\ub958: ",r)}t.RemoteLoadingCtrl.dismiss(),t.p5SetDrawable(!0)})}CreateOnMessageLink(){this.webrtc.dataChannelOnMsgAct=o=>{let t=JSON.parse(o);switch(t.type){case"drawline":this.p5DrawingStack=t.data,this.p5updateRemoteCurve(t.data),this.p5voidDraw.redraw();break;case"background":this.p5voidDraw.loadImage(t.data,r=>{this.p5BaseImage=r,this.p5ImageCanvas.image(this.p5BaseImage,0,0),this.p5ImageCanvas.redraw(),this.p5SetCanvasViewportInit()},r=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",r),this.p5ImageCanvas.redraw(),this.p5SetCanvasViewportInit()}),this.RemoteLoadingCtrl.dismiss();break;case"draw":switch(t.act){case"start":this.p5RemoteDrawStart(t.data);break;case"moved":this.p5RemoteDrawing(t.data);break;case"cancel":this.p5CancelCurrentDraw();break;case"crop":this.p5setCropPos(t.cropPX,t.cropPY),this.p5setCropSize(t.cropSX,t.cropSY),this.isCropMode=!0,this.p5apply_crop(!1);break;case"end":this.p5RemoteDrawingEnd(t.data)}break;case"same":"history_act"===t.act&&this.p5history_act(t.data,!0)}},this.webrtc.dataChannelOnCloseAct=()=>{this.CancelRemoteAct()}}change_line_weight(){this.p5set_line_weight()}open_crop_tool(){this.p5open_crop_tool()}dismiss_draw(){if(this.isCropMode)this.p5apply_crop();else{if("voiddraw-remote"==this.navParams.dismiss)return void this.navCtrl.pop();this.mainLoading.present(),this.WithoutSave=!1,this.p5save_image()}}ionSelectCancel(){this.p5voidDraw&&this.p5SetDrawable&&!this.isDrawServerCreated&&this.p5SetDrawable(!0)}RemoveShortCut(){this.p5voidDraw&&this.p5SetDrawable&&this.p5SetDrawable(!1),delete this.global.p5KeyShortCut.HistoryAct,delete this.global.p5KeyShortCut.AddAct,delete this.global.p5KeyShortCut.DeleteAct,delete this.global.p5KeyShortCut.SKeyAct,delete this.global.p5KeyShortCut.FKeyAct,delete this.global.p5KeyShortCut.Escape}ionViewWillLeave(){this.p5SetDrawable(!1),this.WillLeaveHere=!0,this.RemoveShortCut(),this.global.RestoreShortCutAct("void-draw")}ionViewDidLeave(){this.WithoutSave&&this.mainLoading.remove()}init_gen_qrcode(){var o=this;return(0,E.A)(function*(){let t=o.QRNavParams.address;o.SelectedAddress=`${yield o.global.GetHeaderAddress()}?voidDraw=${t},${o.QRNavParams.channel},${o.Port||""},${o.username||""},${o.password||""}`.replace(" ","%20"),o.QRCodeSRC=o.global.readasQRCodeFromString(o.SelectedAddress)})()}copy_address(o){this.global.WriteValueToClipboard("text/plain",o)}}return(g=I).\u0275fac=function(o){return new(o||g)(i.rXU(Ve.y),i.rXU(v.hG),i.rXU(v.Xi),i.rXU(Me.z3),i.rXU(je.n),i.rXU(Le.X),i.rXU(Ee.G),i.rXU(Be.j),i.rXU(ae.Ix),i.rXU(ae.nX),i.rXU(We.q9))},g.\u0275cmp=i.VBU({type:g,selectors:[["app-void-draw"]],viewQuery:function(o,t){if(1&o&&(i.GBs(He,5),i.GBs(Ne,5),i.GBs(Ge,5),i.GBs(Xe,5)),2&o){let r;i.mGM(r=i.lsd())&&(t.RemoteDraw=r.first),i.mGM(r=i.lsd())&&(t.ChangeTransparent=r.first),i.mGM(r=i.lsd())&&(t.ChangeResolution=r.first),i.mGM(r=i.lsd())&&(t.AddrQRShare=r.first)}},decls:26,vars:6,consts:[["RemoteDraw",""],["AddrQRShare",""],["ChangeTransparent",""],["ChangeResolution",""],[1,"ion-no-border"],["slot","start"],["defaultHref",""],["slot","end","name","clipboard-outline",1,"top_icon",2,"width","24px","height","24px",3,"click"],["class","shortcut_hint","style","left: auto; right: 4px; top: 0px; padding: 2px 8px; border-radius: 8px;",4,"ngIf"],["slot","end","name","save-outline",1,"top_icon",2,"width","24px","height","24px",3,"click"],["oncontextmenu","return false;"],["hidden",""],["value","local",3,"ionChange","ionCancel","label"],["value","local"],[3,"value",4,"ngFor","ngForOf"],[1,"full_screen",2,"display","flex","overflow","hidden","background-color","black",3,"id"],[1,"transparent-modal"],[1,"shortcut_hint",2,"left","auto","right","4px","top","0px","padding","2px 8px","border-radius","8px"],[3,"value"],[2,"display","flex","justify-content","center","align-items","center","height","100%"],[2,"width","400px","min-height","455px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["style","width: 100%; height: auto; cursor: copy; margin-bottom: 8px;","alt","QuickLink",3,"src","click",4,"ngIf"],["button","",3,"click"],[1,"ion-text-center"],["alt","QuickLink",2,"width","100%","height","auto","cursor","copy","margin-bottom","8px",3,"click","src"],["id","colordetailOuter",2,"display","flex","justify-content","center","align-items","center","height","100%",3,"click"],["id","colordetailInner",2,"width","400px","min-height","240px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["max","255",3,"ngModelChange","ionInput","ngModel"],["slot","label",1,"slider_title"],["slot","end",1,"slider_end"],["type","text",1,"slider_input",3,"ngModelChange","ngModel"],["id","resolutiondetailOuter",2,"display","flex","justify-content","center","align-items","center","height","100%",3,"click"],["id","resolutiondetailInner",2,"width","400px","min-height","160px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["min","1",3,"ngModelChange","ionInput","ngModel","disabled"],[3,"ionChange","ngModelChange","ngModel"]],template:function(o,t){if(1&o){const r=i.RV6();i.j41(0,"ion-header",4)(1,"ion-toolbar")(2,"ion-title"),i.EFF(3),i.k0s(),i.j41(4,"ion-buttons",5),i.nrm(5,"ion-back-button",6),i.k0s(),i.j41(6,"ion-icon",7),i.bIt("click",function(){return i.eBV(r),i.Njj(t.p5save_image(!0,!0))}),i.k0s(),i.DNE(7,$e,2,0,"div",8),i.j41(8,"ion-icon",9),i.bIt("click",function(){return i.eBV(r),i.Njj(t.p5save_image(!0))}),i.k0s()()(),i.j41(9,"ion-content",10)(10,"div",11)(11,"ion-select",12,0),i.bIt("ionChange",function(s){return i.eBV(r),i.Njj(t.RemoteBridgeServerSelected(s))})("ionCancel",function(){return i.eBV(r),i.Njj(t.ionSelectCancel())}),i.j41(13,"ion-select-option",13),i.EFF(14),i.k0s(),i.DNE(15,Oe,2,2,"ion-select-option",14),i.k0s()(),i.nrm(16,"div",15),i.j41(17,"ion-modal",16,1),i.DNE(19,Ye,6,2,"ng-template"),i.k0s(),i.j41(20,"ion-modal",16,2),i.DNE(22,Ue,24,13,"ng-template"),i.k0s(),i.j41(23,"ion-modal",16,3),i.DNE(25,Je,13,9,"ng-template"),i.k0s()()}2&o&&(i.R7$(3),i.JRh(t.lang.text.ChatRoom.voidDraw),i.R7$(4),i.Y8G("ngIf",t.global.ShowHint),i.R7$(4),i.Y8G("label",t.lang.text.voidDraw.ConnectToAddress),i.R7$(3),i.JRh(t.lang.text.voidDraw.InternalConn),i.R7$(),i.Y8G("ngForOf",t.ServerList),i.R7$(),i.Y8G("id",t.voidDrawId))},dependencies:[de.Sq,de.bT,oe.me,oe.BC,oe.vS,v.QW,v.W9,v.eU,v.iq,v.uz,v.he,v.Ob,v.Nm,v.Ip,v.BC,v.BY,v.ai,v.Sb,v.hB,v.su,v.Je,v.el],styles:[".slider_title[_ngcontent-%COMP%]{width:72px}.slider_end[_ngcontent-%COMP%]{width:40px;margin-left:24px}.slider_input[_ngcontent-%COMP%]{max-width:32px}"]}),I})()}];let ze=(()=>{var g;class I{}return(g=I).\u0275fac=function(o){return new(o||g)},g.\u0275mod=i.$C({type:g}),g.\u0275inj=i.G2t({imports:[ae.iI.forChild(Qe),ae.iI]}),I})(),Ke=(()=>{var g;class I{}return(g=I).\u0275fac=function(o){return new(o||g)},g.\u0275mod=i.$C({type:g}),g.\u0275inj=i.G2t({imports:[de.MD,oe.YN,v.bv,ze]}),I})()}}]);