"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8163],{8163:($e,B,v)=>{v.r(B),v.d(B,{AddTodoMenuPageModule:()=>Me});var O=v(177),$=v(4341),T=v(5374),P=v(9858),w=v(467),M=v(8326),F=v(4237),G=v(92),L=v(5402),t=v(3953),N=v(4234),E=v(9900),U=v(345),V=v(755),W=v(3656),Y=v(5547),X=v(8065),J=v(7100),z=v(7476),H=v(3307);const Q=["StartCalendar"],K=["Calendar"],Z=["StoreAt"],q=["ImporantSel"];function ee(l,_){if(1&l){const s=t.RV6();t.j41(0,"ion-icon",49),t.bIt("click",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.QuickBottomMenu())}),t.k0s()}}function te(l,_){if(1&l){const s=t.RV6();t.j41(0,"ion-grid",50)(1,"ion-row")(2,"ion-col",51)(3,"ion-item",52),t.bIt("click",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.doneTodo())}),t.j41(4,"ion-label",53),t.EFF(5),t.k0s()()()()()}if(2&l){const s=t.XpG();t.R7$(3),t.Y8G("disabled",s.isButtonClicked),t.R7$(2),t.JRh(s.lang.text.TodoDetail.TodoComplete)}}function ie(l,_){if(1&l&&(t.j41(0,"ion-select-option",58),t.EFF(1),t.k0s()),2&l){const s=_.$implicit;t.Y8G("value",s),t.R7$(),t.SpI("",s.name," ")}}function ae(l,_){if(1&l){const s=t.RV6();t.j41(0,"ion-item",54),t.bIt("click",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.StoreAtSelClicked())}),t.j41(1,"ion-select",55,3),t.bIt("ionChange",function(e){t.eBV(s);const a=t.XpG();return t.Njj(a.StoreAtSelChanged(e))}),t.j41(3,"ion-select-option",56),t.EFF(4),t.k0s(),t.DNE(5,ie,2,2,"ion-select-option",57),t.k0s()()}if(2&l){const s=t.XpG();t.R7$(),t.Y8G("label",s.lang.text.TodoDetail.StoreAt),t.R7$(3),t.JRh(s.lang.text.TodoDetail.OnThisDevice),t.R7$(),t.Y8G("ngForOf",s.AvailableStorageList)}}function oe(l,_){if(1&l){const s=t.RV6();t.j41(0,"div")(1,"ion-item",54),t.bIt("click",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.ChangeDisconnectStatus())}),t.j41(2,"ion-label",59),t.EFF(3),t.k0s(),t.j41(4,"ion-label",60),t.EFF(5),t.k0s()()()}if(2&l){const s=t.XpG();t.R7$(3),t.JRh(s.userInput.display_store||s.lang.text.TodoDetail.WIP),t.R7$(2),t.JRh(s.userInput.display_creator)}}function ne(l,_){if(1&l){const s=t.RV6();t.j41(0,"span",63),t.bIt("click",function(){const e=t.eBV(s).$implicit,a=t.XpG(2);return t.Njj(a.RemoveTag(e))}),t.EFF(1),t.k0s()}if(2&l){const s=_.$implicit;t.R7$(),t.JRh(s)}}function re(l,_){if(1&l&&(t.j41(0,"div",61),t.DNE(1,ne,2,1,"span",62),t.k0s()),2&l){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",s.userInput.tags)}}function se(l,_){if(1&l){const s=t.RV6();t.j41(0,"ion-item",67),t.bIt("click",function(){t.eBV(s);const e=t.XpG(3);return t.Njj(e.count_selected_worker())}),t.j41(1,"ion-checkbox",68),t.mxI("ngModelChange",function(e){const a=t.eBV(s).$implicit;return t.DH7(a.todo_checked,e)||(a.todo_checked=e),t.Njj(e)}),t.EFF(2),t.k0s()()}if(2&l){const s=_.$implicit;t.R7$(),t.R50("ngModel",s.todo_checked),t.R7$(),t.JRh(s.override_name||s.display_name)}}function le(l,_){if(1&l){const s=t.RV6();t.j41(0,"ion-accordion",58)(1,"ion-item",64)(2,"ion-label"),t.EFF(3),t.k0s()(),t.j41(4,"div",36)(5,"ion-item",65),t.bIt("click",function(){const e=t.eBV(s).$implicit,a=t.XpG(2);return t.Njj(a.toggle_all_user(e.id))}),t.j41(6,"ion-label"),t.EFF(7),t.k0s()(),t.DNE(8,se,3,2,"ion-item",66),t.k0s()()}if(2&l){const s=_.$implicit,i=t.XpG(2);t.Y8G("value",s.id),t.R7$(3),t.JRh(s.name),t.R7$(4),t.JRh(i.lang.text.TodoDetail.ToggleWorkers),t.R7$(),t.Y8G("ngForOf",i.AvailableWorker[s.id])}}function de(l,_){if(1&l&&(t.j41(0,"div")(1,"ion-accordion-group",null,4)(3,"ion-accordion")(4,"ion-item",32)(5,"ion-label"),t.EFF(6),t.k0s()(),t.j41(7,"div",36)(8,"ion-accordion-group",null,5),t.DNE(10,le,9,4,"ion-accordion",57),t.k0s()()()()()),2&l){const s=t.XpG();t.R7$(6),t.JRh(s.lang.text.TodoDetail.ManageWorker+" ("+s.SelectedWorkers+")"),t.R7$(4),t.Y8G("ngForOf",s.WorkerGroups)}}function ue(l,_){if(1&l&&(t.j41(0,"div",76),t.EFF(1),t.k0s()),2&l){const s=t.XpG().$implicit;t.R7$(),t.SpI("",s.displayTime," ")}}function ce(l,_){1&l&&t.nrm(0,"ion-icon",77)}function pe(l,_){1&l&&t.nrm(0,"ion-icon",78)}function he(l,_){1&l&&t.nrm(0,"ion-icon",79)}function me(l,_){if(1&l&&(t.j41(0,"ion-item",71)(1,"ion-label"),t.EFF(2),t.k0s(),t.DNE(3,ue,2,1,"div",72)(4,ce,1,0,"ion-icon",73)(5,pe,1,0,"ion-icon",74)(6,he,1,0,"ion-icon",75),t.k0s()),2&l){const s=_.$implicit;t.R7$(2),t.JRh(s.name),t.R7$(),t.Y8G("ngIf",s.displayTime),t.R7$(),t.Y8G("ngIf",void 0===s.isDelete),t.R7$(),t.Y8G("ngIf",1==s.isDelete),t.R7$(),t.Y8G("ngIf",0==s.isDelete)}}function ge(l,_){if(1&l&&(t.j41(0,"div")(1,"ion-accordion-group",null,4)(3,"ion-accordion")(4,"ion-item",32)(5,"ion-label",33),t.EFF(6),t.k0s(),t.j41(7,"ion-label",69),t.EFF(8),t.k0s()(),t.j41(9,"div",36),t.DNE(10,me,7,5,"ion-item",70),t.k0s()()()()),2&l){const s=t.XpG();t.R7$(6),t.JRh(s.lang.text.TodoDetail.ManageWorker),t.R7$(2),t.JRh(s.worker_done+" / "+s.userInput.workers.length),t.R7$(2),t.Y8G("ngForOf",s.userInput.workers)}}function _e(l,_){if(1&l){const s=t.RV6();t.j41(0,"ion-accordion",80)(1,"ion-item",32)(2,"ion-label",33),t.EFF(3),t.k0s(),t.j41(4,"ion-label",34),t.EFF(5),t.k0s(),t.nrm(6,"ion-icon",35),t.k0s(),t.j41(7,"div",36)(8,"ion-datetime",37,6),t.bIt("ionChange",function(e){t.eBV(s);const a=t.XpG();return t.Njj(a.start_change(e))}),t.k0s()()()}if(2&l){const s=t.XpG();t.R7$(3),t.JRh(s.lang.text.TodoDetail.startFrom),t.R7$(2),t.JRh(s.startDisplay||s.lang.text.TodoDetail.startImmediatly),t.R7$(3),t.Y8G("locale",s.lang.lang)}}function fe(l,_){1&l&&(t.j41(0,"div",81),t.EFF(1,"Enter "),t.k0s())}function Ie(l,_){if(1&l){const s=t.RV6();t.j41(0,"ion-icon",85),t.bIt("click",function(){t.eBV(s);const e=t.XpG().index,a=t.XpG();return t.Njj(a.remove_attach(e))}),t.k0s()}}function be(l,_){if(1&l){const s=t.RV6();t.j41(0,"img",88),t.bIt("contextmenu",function(){t.eBV(s);const e=t.XpG(2),a=e.$implicit,p=e.index,o=t.XpG();return t.Njj(o.AttachmentContextMenu(a,p))}),t.k0s()}if(2&l){const s=t.XpG(2).$implicit;t.Y8G("src",s.thumbnail,t.B4B)("alt",s.filename)}}function ve(l,_){if(1&l&&(t.j41(0,"ion-item",89)(1,"ion-label",90),t.EFF(2),t.k0s()()),2&l){const s=t.XpG(3);t.R7$(2),t.JRh(s.lang.text.TodoDetail.open_content_viewer)}}function ke(l,_){if(1&l){const s=t.RV6();t.j41(0,"div",54),t.bIt("click",function(){t.eBV(s);const e=t.XpG().index,a=t.XpG();return t.Njj(a.open_content_viewer(e))}),t.DNE(1,be,1,2,"img",86)(2,ve,3,1,"ion-item",87),t.k0s()}if(2&l){const s=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",s.thumbnail),t.R7$(),t.Y8G("ngIf",!s.thumbnail)}}function ye(l,_){if(1&l){const s=t.RV6();t.j41(0,"div")(1,"ion-item")(2,"ion-label",82),t.EFF(3),t.k0s(),t.j41(4,"ion-icon",83),t.bIt("click",function(){const e=t.eBV(s).index,a=t.XpG();return t.Njj(a.download_attach(e))}),t.k0s(),t.DNE(5,Ie,1,0,"ion-icon",84),t.k0s(),t.DNE(6,ke,3,2,"div",18),t.k0s()}if(2&l){const s=_.$implicit,i=t.XpG();t.R7$(3),t.JRh(s.filename),t.R7$(2),t.Y8G("ngIf",i.isModifiable),t.R7$(),t.Y8G("ngIf",s.viewer)}}function Te(l,_){if(1&l&&t.nrm(0,"ion-icon",97),2&l){const s=t.XpG().$implicit;t.Y8G("name",s.icon||"close-circle")}}function xe(l,_){if(1&l&&t.nrm(0,"img",98),2&l){const s=t.XpG().$implicit;t.Y8G("src","assets/icon/"+s.icon_img,t.B4B)("alt",s.title)}}function Ae(l,_){if(1&l){const s=t.RV6();t.j41(0,"div",93)(1,"div",94),t.bIt("click",function(){const e=t.eBV(s).$implicit;return t.Njj(e.act())})("contextmenu",function(){const e=t.eBV(s).$implicit;return t.Njj(e.context?e.context():null)}),t.DNE(2,Te,1,1,"ion-icon",95)(3,xe,1,2,"img",96),t.j41(4,"div"),t.EFF(5),t.k0s()()()}if(2&l){const s=_.$implicit;t.R7$(),t.Aen("cursor: "+(s.cursor||"pointer")+";"),t.Y8G("hidden",s.isHide),t.R7$(),t.Y8G("ngIf",s.icon),t.R7$(),t.Y8G("ngIf",s.icon_img),t.R7$(2),t.JRh(s.name)}}function we(l,_){if(1&l&&(t.j41(0,"div",91),t.DNE(1,Ae,6,6,"div",92),t.k0s()),2&l){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",s.extended_buttons)}}function De(l,_){1&l&&(t.j41(0,"div",99),t.EFF(1,"Ctrl + Enter"),t.k0s())}function Ce(l,_){if(1&l){const s=t.RV6();t.j41(0,"td")(1,"ion-button",100),t.bIt("click",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.deleteData())}),t.EFF(2),t.k0s()()}if(2&l){const s=t.XpG();t.R7$(),t.Y8G("disabled",s.isButtonClicked),t.R7$(),t.SpI(" ",s.lang.text.TodoDetail.remove," ")}}const Re=[{path:"",component:(()=>{var l;class _{constructor(i,e,a,p,o,u,r,h,d,I,k,f,A,j){var R,b=this;this.route=i,this.router=e,this.lang=a,this.p5toast=p,this.sanitizer=o,this.indexed=u,this.nakama=r,this.alertCtrl=h,this.noti=d,this.statusBar=I,this.global=k,this.navCtrl=f,this.floatButton=A,this.p5loading=j,this.userInput={id:void 0,storeAt:"local",display_store:"",title:void 0,tags:[],create_at:void 0,written:void 0,startFrom:void 0,limit:void 0,custom_color:void 0,workers:void 0,importance:"0",description:void 0,remote:void 0,display_creator:void 0,attach:[],done:void 0,noti_id:void 0,CDN:void 0},this.TagCache="",this.useVoiceRecording=!1,this.voidDrawContextId="todo_voiddraw_img",this.extended_buttons=[{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:()=>{this.isButtonClicked||this.new_attach({detail:{value:"load"}})},context:()=>{if(!this.isButtonClicked)return this.new_attach({detail:{value:"link"}}),!1}},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:()=>{this.isButtonClicked||this.new_attach({detail:{value:"image"}})},context:()=>(function(){var C=(0,w.A)(function*(){const n="voiddraw";let c=yield b.global.GetValueFromClipboard(n);switch(c.type){case"image/png":b.SelectVoidDrawBackgroundImage({target:{files:[c.value]}});break;case"text/plain":const g={file_ext:c.value.split(".").pop()};if(b.global.set_viewer_category_from_ext(g),"image"==g.viewer)try{b.p5loading.update({id:n,message:`${b.lang.text.Arcade.TryingDownload}: ${c.value.split("/").pop()}`,forceEnd:null});const y=yield fetch(c.value);if(!y.ok)throw`${y.statusText} (${y.status})`;const x=yield y.blob();b.p5loading.update({id:n,message:`${b.lang.text.Arcade.TryingDownload}: ${c.value.split("/").pop()}`,progress:1,forceEnd:350}),b.SelectVoidDrawBackgroundImage({target:{files:[x]}});break}catch(y){console.log("\uadf8\ub9bc\ud310 \ube60\ub978 \uc9c4\uc785 \uc624\ub958: ",y)}default:document.getElementById(b.voidDrawContextId).click()}});return function(){return C.apply(this,arguments)}}()(),!1)},{icon:"reader-outline",name:this.lang.text.ChatRoom.newText,act:()=>{this.isButtonClicked||this.new_attach({detail:{value:"text"}})}},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:()=>{this.isButtonClicked||this.new_attach({detail:{value:"camera"}})}},{icon:"mic-circle-outline",name:this.lang.text.ChatRoom.Voice,act:(R=(0,w.A)(function*(){if(!b.isButtonClicked){if(b.global.useVoiceRecording&&"TodoRecording"!=b.global.useVoiceRecording)return void b.p5toast.show({text:b.lang.text.GlobalAct[b.global.useVoiceRecording]});b.useVoiceRecording=!b.useVoiceRecording,b.useVoiceRecording?(yield L.R.hasAudioRecordingPermission()).value?(b.global.useVoiceRecording="TodoRecording",b.extended_buttons[4].icon="stop-circle-outline",b.extended_buttons[4].name=b.lang.text.ChatRoom.VoiceStop,b.p5loading.toast(b.lang.text.ChatRoom.StartVRecord,"add_todo"),yield L.R.startRecording(),b.CreateFloatingVoiceTimeHistoryAddButton()):(b.useVoiceRecording=!1,b.extended_buttons[4].icon="mic-circle-outline",b.extended_buttons[4].name=b.lang.text.ChatRoom.Voice,yield L.R.requestAudioRecordingPermission()):yield b.StopAndSaveVoiceRecording()}}),function(){return R.apply(this,arguments)})},{icon:"cloud-done-outline",name:this.lang.text.ChatRoom.Detour,act:()=>{this.toggle_custom_attach()}}],this.BackButtonPressed=!1,this.AlreadyInited=!1,this.buttonDisplay={saveTodo:this.lang.text.TodoDetail.buttonDisplay_add},this.AmICreator=!0,this.isModify=!1,this.isModifiable=!1,this.isStoreAtChanged=!1,this.isStoreAtChangable=!0,this.CheckIfTitleFocus=!1,this.isLimitUsable=!1,this.normal_color="#8888",this.alert_color="#0bb8",this.AlertLerpStartFrom=.8,this.file_sel_id="",this.AvailableStorageList=[],this.isManager=!1,this.AvailableWorker={},this.WorkerGroups=[],this.toggle_logs={},this.SelectedWorkers=0,this.worker_done=0,this.WaitingLoaded=!1,this.lock_modal_open=!1,this.isCDNToggleClicked=!1,this.isButtonClicked=!1,this.WillLeavePage=!1,this.PageDestoryed=!1}TagInputKey(i){var e;(null===(e=i.data)||void 0===e?void 0:e.indexOf(","))>=0&&(this.TagCache=this.TagCache.split(",")[0],this.AddCurrentTag())}AddCurrentTag(){this.TagCache&&!this.userInput.tags.includes(this.TagCache)&&this.userInput.tags.push(this.TagCache),this.TagCache=""}RemoveTag(i){for(let e=0,a=this.userInput.tags.length;e<a;e++)if(this.userInput.tags[e]==i){this.userInput.tags.splice(e,1);break}}CreateFloatingVoiceTimeHistoryAddButton(){this.floatButton.RemoveFloatButton("addtodo-record"),this.floatButton.AddFloatButton("addtodo-record","mic-outline").mouseClicked(()=>{this.p5toast.show({text:`${this.lang.text.GlobalAct.TodoRecording}`})})}SelectVoidDrawBackgroundImage(i){var e=this;return(0,w.A)(function*(){const a=i.target.files[0],p=`tmp_files/todo/${a.name}`;yield e.indexed.saveBlobToUserPath(a,p);const o=yield e.indexed.loadBlobFromUserPath(p,a.type),u=URL.createObjectURL(o);new M(r=>{r.setup=()=>{document.getElementById(e.voidDrawContextId).value="",r.noCanvas(),r.loadImage(u,h=>{e.global.PageDismissAct["todo-voiddraw-quick"]=d=>{d.data&&e.voidDraw_fileAct_callback(d),delete e.global.PageDismissAct["todo-voiddraw-quick"]},e.global.ActLikeModal("portal/main/add-todo-menu/void-draw",{path:p,width:h.width,height:h.height,type:a.type,dismiss:"todo-voiddraw-quick"}),URL.revokeObjectURL(u),r.remove()},h=>{console.log("\ube60\ub978 \uadf8\ub9bc\ud310 \uc5f4\uae30 \uc2e4\ud328: ",h),URL.revokeObjectURL(u),r.remove()})}})})()}StopAndSaveVoiceRecording(){var i=this;return(0,w.A)(function*(){i.floatButton.RemoveFloatButton("addtodo-record");const e="add_todo";yield i.p5loading.update({id:e,message:i.lang.text.AddPost.SavingRecord,forceEnd:null});try{let a=yield i.global.StopAndSaveVoiceRecording();yield i.selected_blobFile_callback_act(a,!1)}catch{}i.p5loading.remove(e),i.extended_buttons[4].icon="mic-circle-outline",i.extended_buttons[4].name=i.lang.text.ChatRoom.Voice})()}ngOnInit(){var i=this;if(this.cont=new AbortController,this.voidDrawContextId=`todo_voiddraw_img_${Date.now()}`,this.MainDiv=document.getElementById("main_div"),this.nakama.socket_reactive.add_todo_menu=this,this.route.queryParams.subscribe(e=>{const a=this.router.getCurrentNavigation().extras.state;this.navParams=!!a,a&&(this.received_data=a.data),this.received_data&&!this.AlreadyInited&&(this.userInput={...this.userInput,...JSON.parse(this.received_data)}),this.toggle_custom_attach(this.userInput.CDN||0),this.AlreadyInited=!0}),this.nakama.AddTodoLinkAct=function(){var e=(0,w.A)(function*(a){var p,o;i.p5timer&&i.p5timer.remove(),i.received_data=a,i.userInput=JSON.parse(i.received_data),null===(p=(o=i.global).SelectTodoTab)||void 0===p||p.call(o),i.show_count_timer()});return function(a){return e.apply(this,arguments)}}(),this.nakama.AddTodoManageUpdateAct=(e,a,p,o)=>{if(this.userInput.id==e)for(let u=0,r=this.userInput.workers.length;u<r;u++)if((this.userInput.workers[u].user_id||this.userInput.workers[u].id)==a){this.userInput.workers[u].isDelete=p,this.userInput.workers[u].timestamp=o,this.userInput.workers[u].displayTime=new Date(o).toLocaleString(),this.worker_done++;break}},"DesktopPWA"==G.aH&&setTimeout(()=>{this.WillLeavePage||this.CreateDrop()},100),this.userInput.workers)for(let e=0,a=this.userInput.workers.length;e<a;e++)this.userInput.workers[e].timestamp&&(this.userInput.workers[e].displayTime=new Date(this.userInput.workers[e].timestamp).toLocaleString(),this.worker_done++);this.nakama.StatusBarChangedCallback=()=>{if(this.isModify){if(this.LoadStorageList(),this.userInput.remote)try{let e=!1;for(let a=0,p=this.AvailableStorageList.length;a<p;a++)if(`${this.AvailableStorageList[a].isOfficial}/${this.AvailableStorageList[a].target}`==`${this.userInput.remote.isOfficial}/${this.userInput.remote.target}`){e=!0;break}this.isModifiable=e,this.userInput.display_creator=e?this.nakama.GetOverrideName(this.userInput.remote.creator_id,this.userInput.remote.isOfficial,this.userInput.remote.target)||this.nakama.load_other_user(this.userInput.remote.creator_id,this.userInput.remote.isOfficial,this.userInput.remote.target).display_name:this.lang.text.TodoDetail.Disconnected}catch{}}else this.LoadStorageList()}}ChangeDisconnectStatus(){var i=this;this.userInput.display_creator==this.lang.text.TodoDetail.Disconnected&&this.alertCtrl.create({header:this.lang.text.TodoDetail.MoveToLocal,message:this.lang.text.TodoDetail.RemoveFromRemote,buttons:[{text:this.lang.text.Nakama.LocalNotiOK,cssClass:"redfont",handler:()=>{!function(){var a=(0,w.A)(function*(){i.isButtonClicked=!0,yield i.nakama.deleteTodoFromStorage(!0,JSON.parse(JSON.stringify(i.userInput))),i.StoreAtSelChanged({detail:{value:"local"}}),i.isModify=!1,i.userInput.id=void 0,i.userInput.noti_id=void 0,i.userInput.create_at=void 0,delete i.userInput.modified,i.saveData()});return function(){return a.apply(this,arguments)}}()()}}]}).then(e=>e.present())}CreateDrop(){var i=this;let e=document.getElementById("p5Drop_todo");this.p5canvas=new M(a=>{a.setup=()=>{let p=a.createCanvas(e.clientWidth,e.clientHeight);p.parent(e),a.pixelDensity(.1),p.drop(function(){var o=(0,w.A)(function*(u){yield i.selected_blobFile_callback_act(u.file,!1)});return function(u){return o.apply(this,arguments)}}())},a.mouseMoved=p=>{p.dataTransfer?(e.style.pointerEvents="all",e.style.backgroundColor="#0008"):(e.style.pointerEvents="none",e.style.backgroundColor="transparent")}})}selected_blobFile_callback_act(i,e=!0){var a=this;return(0,w.A)(function*(){const p="add_todo";e&&(yield a.p5loading.update({id:p,message:`${a.lang.text.ContentViewer.OnLoadContent}: ${i.name}`,image:null,forceEnd:null}));let o=a.global.selected_blobFile_callback_act(i,"tmp_files/todo/",{display_name:a.nakama.users.self.display_name});yield a.checkHasSameFileAndRename(o);const u=URL.createObjectURL(i);"image"==o.viewer&&(o.thumbnail=a.sanitizer.bypassSecurityTrustUrl(u),e&&a.p5loading.update({id:p,image:u}));try{yield a.indexed.saveBlobToUserPath(i,o.path),a.userInput.attach.push(o),setTimeout(()=>{URL.revokeObjectURL(u)},0)}catch(r){console.error("\ud30c\uc77c \uc62c\ub9ac\uae30 \uc2e4\ud328: ",r),a.p5toast.show({text:a.lang.text.TodoDetail.load_failed})}e&&a.p5loading.remove(p),a.auto_scroll_down()})()}checkHasSameFileAndRename(i){var e=this;return(0,w.A)(function*(){let a=!1;if(a=yield e.indexed.checkIfFileExist(i.path),e.userInput.id&&!a)try{a=yield e.indexed.checkIfFileExist(`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/${i.filename}`)}catch{a=yield e.indexed.checkIfFileExist(`todo/${e.userInput.id}/${i.filename}`)}a&&(i.filename=`${i.filename.substring(0,i.filename.lastIndexOf("."))}_.${i.file_ext}`,i.path=`tmp_files/todo/${i.filename}`,yield e.checkHasSameFileAndRename(i))})()}AttachmentContextMenu(i,e){var a=this;return this.isStoreAtChangable&&function(){var o=(0,w.A)(function*(){const u=URL.createObjectURL(i.blob);yield a.p5loading.update({id:"voiddraw",image:u,forceEnd:null}),new M(r=>{r.setup=()=>{r.noCanvas(),r.loadImage(u,h=>{let d=[];if(i.content_related_creator&&(d=[...i.content_related_creator]),i.content_creator){let I=!1;for(let k=0,f=d.length;k<f;k++)if(void 0!==d[k].user_id&&void 0!==i.content_creator.user_id&&d[k].user_id==i.content_creator.user_id){I=!0;break}I||d.push(i.content_creator)}a.global.PageDismissAct["quick-modify-image"]=I=>{I.data&&a.voidDraw_fileAct_callback(I,d,e),delete a.global.PageDismissAct["quick-modify-image"]},a.global.ActLikeModal("portal/main/add-todo-menu/void-draw",{path:i.alt_path||i.path,width:h.width,height:h.height,type:i.type,dismiss:"quick-modify-image"}),URL.revokeObjectURL(u),r.remove()},h=>{console.log("\ube60\ub978 \ud3b8\uc9d1\uae30 \uc774\ub3d9 \uc2e4\ud328: ",h),a.p5loading.update({id:"voiddraw",message:a.lang.text.TodoDetail.load_failed,image:u,forceEnd:350}),URL.revokeObjectURL(u),r.remove()})}})});return function(){return o.apply(this,arguments)}}()(),!1}ionViewWillEnter(){var i=this;return(0,w.A)(function*(){if(i.global.portalHint=!1,i.global.StoreShortCutAct("add-todo"),i.WaitingLoaded=!0,i.lock_modal_open=!1,!i.navParams)return;let e;if(i.WillLeavePage=!1,i.LoadStorageList(),i.received_data){if(i.buttonDisplay.saveTodo=i.lang.text.TodoDetail.buttonDisplay_modify,e=JSON.parse(i.received_data),i.userInput={...i.userInput,...e},i.isModify=!0,i.isModify&&i.userInput.noti_id){i.noti.ClearNoti(i.userInput.noti_id);try{const u=i.nakama.GetNodejsServerAddress(i.userInput.remote.isOfficial,i.userInput.remote.target,"webpush_port");i.nakama.send_webpush(u,{id:i.userInput.noti_id,icon:"remove"},[i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id])}catch{}}if("local"==i.userInput.storeAt)i.StoreAt.value="local";else for(let u=0,r=i.AvailableStorageList.length;u<r;u++)if(i.userInput.remote.isOfficial==i.AvailableStorageList[u].isOfficial&&i.userInput.remote.target==i.AvailableStorageList[u].target){i.StoreAt.value=i.AvailableStorageList[u];break}}else i.userInput.limit=(new Date).getTime(),i.limitTimeP5Display=i.userInput.limit,i.AvailableStorageList.length&&(i.StoreAt.value=i.AvailableStorageList[0].target,i.StoreAtSelChanged({detail:{value:i.AvailableStorageList[0]}}));let a=document.getElementById("titleInput");i.titleIonInput=a.children[0].children[1].children[0],i.titleIonInput.onblur||(i.titleIonInput.onblur=()=>{i.CheckIfTitleFocus=!1}),i.titleIonInput.onfocus||(i.titleIonInput.onfocus=()=>{i.CheckIfTitleFocus=!0}),setTimeout(()=>{"DesktopPWA"==G.aH&&!i.isModify&&!i.titleIonInput.value&&i.titleIonInput.focus()},200),i.ImporantSelChanged({detail:{value:i.userInput.importance}}),i.file_sel_id=`${i.userInput.id||"new_todo_id"}_${(new Date).getTime()}`;let p=!1;try{p=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}_${i.userInput.remote.isOfficial}_${i.userInput.remote.target}/thumbnail.png`)}catch{p=yield i.indexed.checkIfFileExist(`todo/${i.userInput.id}/thumbnail.png`)}if(i.userInput.attach.length){const u="add_todo";yield i.p5loading.update({id:u,message:i.lang.text.AddPost.SyncAttaches,progress:0,forceEnd:null});for(let r=0,h=i.userInput.attach.length;r<h&&!i.PageDestoryed;r++){i.p5loading.update({id:u,message:`${i.lang.text.AddPost.SyncAttaches}: ${i.userInput.attach[r].filename}`,progress:r/h});try{if(i.userInput.remote){try{i.userInput.attach[r].alt_path=`todo/${i.userInput.id}_${i.userInput.remote.isOfficial}_${i.userInput.remote.target}/${i.userInput.attach[r].filename}`;const I=yield i.nakama.sync_load_file(i.userInput.attach[r],i.userInput.remote.isOfficial,i.userInput.remote.target,"todo_attach",i.userInput.remote.creator_id);if("failed"==I.from)throw"\ud30c\uc77c \uc694\uccad\ub2e8\uacc4\uc5d0\uc11c \uc2e4\ud328: nakama.sync_load_file: from failed";if(i.userInput.attach[r].blob=I.value,!i.userInput.attach[r].blob)throw"\ubd88\ub7ec\uc624\uae30 \uc2e4\ud328\ud568"}catch{if(i.userInput.attach[r].url){if(!(yield i.indexed.checkIfFileExist(i.userInput.attach[r].alt_path||i.userInput.attach[r].path)))try{const f=yield i.global.downloadWithProgressAsBlob(i.userInput.attach[r].url,i.cont,u);yield i.indexed.saveBlobToUserPath(f,i.userInput.attach[r].alt_path||i.userInput.attach[r].path);let A=yield i.indexed.loadBlobFromUserPath(i.userInput.attach[r].alt_path||i.userInput.attach[r].path,i.userInput.attach[r].type);i.userInput.attach[r].blob=A}catch(f){console.log("\uc989\uc2dc \ub2e4\uc6b4\ub85c\ub4dc \uc2e4\ud328: ",f),i.p5toast.show({text:`${i.userInput.attach[r].filename||i.userInput.attach[r].name} ${i.lang.text.Nakama.FailedDownload}: ${(f.statusText?`${f.statusText}(${f.status})`:f.status)||f}`,lateable:!0})}i.userInput.attach[r].thumbnail=i.userInput.attach[r].url}}if(!p){let I;if("image"==i.userInput.attach[r].viewer)I=URL.createObjectURL(i.userInput.attach[r].blob);else try{let k=yield i.indexed.loadBlobFromUserPath(i.userInput.attach[r].path+"_thumbnail.png","");I=URL.createObjectURL(k)}catch{}I&&(yield new Promise(k=>{new M(f=>{f.setup=()=>{f.noCanvas(),f.loadImage(I,A=>{A.width>A.height?A.resize(A.width/A.height*128,128):A.resize(128,A.height/A.width*128);let b=f.createCanvas(128,128);b.hide(),f.smooth(),f.pixelDensity(1),f.image(A,-(A.width-128)/2,-(A.height-128)/2);let C,R=b.elt.toDataURL("image/png").replace("image/png","image/octet-stream");try{C=`todo/${i.userInput.id}_${i.userInput.remote.isOfficial}_${i.userInput.remote.target}/thumbnail.png`}catch{C=`todo/${i.userInput.id}/thumbnail.png`}i.indexed.saveBase64ToUserPath(R,C).then(n=>{var c,m;null===(c=(m=i.global).p5todoAddtodo)||void 0===c||c.call(m,JSON.stringify(i.userInput)),k()}),i.userInput.attach[r].blob&&URL.revokeObjectURL(I),f.remove()},A=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",A),i.userInput.attach[r].blob&&URL.revokeObjectURL(I),f.remove(),k()})}})}))}}else{if("image"!=i.userInput.attach[r].viewer&&"text"!=i.userInput.attach[r].viewer)throw"\ubc88\uc678 \uc378\ub124\uc77c \ud544\uc694";i.userInput.attach[r].blob=yield i.indexed.loadBlobFromUserPath(i.userInput.attach[r].path,i.userInput.attach[r].type)}if(!i.userInput.attach[r].blob)continue;let d=URL.createObjectURL(i.userInput.attach[r].blob);i.global.modulate_thumbnail(i.userInput.attach[r],d,i.cont)}catch{i.global.modulate_thumbnail(i.userInput.attach[r],"",i.cont)}i.userInput.attach[r].exist=!0}i.p5loading.update({id:u,message:`${i.lang.text.AddPost.SyncAttaches}: ${i.lang.text.TodoDetail.TodoComplete}`,progress:1,forceEnd:1e3})}try{if("local"==i.userInput.storeAt)i.isModify||(i.StoreAt.value=i.userInput.storeAt),i.userInput.display_store=i.lang.text.TodoDetail.OnThisDevice,i.userInput.display_creator=i.lang.text.TodoDetail.WrittenByMe,i.isModifiable=!0;else if(i.userInput.remote){if(i.isModify||(i.StoreAt.value=i.userInput.remote),i.userInput.display_store=i.userInput.remote.name,i.userInput.display_creator=i.lang.text.TodoDetail.Disconnected,!i.nakama.servers[i.userInput.remote.isOfficial]||!i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target])throw i.userInput.display_creator=i.lang.text.TodoDetail.DeletedServer,{text:"Server Deleted",isModifiable:!0};if(i.statusBar.groupServer[i.userInput.remote.isOfficial]&&"online"!=i.statusBar.groupServer[i.userInput.remote.isOfficial][i.userInput.remote.target])throw i.isStoreAtChangable=!1,{text:"Server disconnected",isModifiable:!1};"online"==i.statusBar.groupServer[i.userInput.remote.isOfficial][i.userInput.remote.target]&&(i.isModifiable=!0),i.userInput.remote.creator_id&&(i.AmICreator=i.nakama.servers[i.userInput.remote.isOfficial][i.userInput.remote.target].session.user_id==i.userInput.remote.creator_id),i.userInput.display_creator=i.AmICreator?i.lang.text.TodoDetail.WrittenByMe:i.nakama.GetOverrideName(i.userInput.remote.creator_id,i.userInput.remote.isOfficial,i.userInput.remote.target)||i.nakama.load_other_user(i.userInput.remote.creator_id,i.userInput.remote.isOfficial,i.userInput.remote.target).display_name,i.userInput.remote.group_id&&(i.isModifiable="online"==i.nakama.groups[i.userInput.remote.isOfficial][i.userInput.remote.target][i.userInput.remote.group_id].status)}}catch(u){i.isModifiable=u.isModifiable,console.log("Server issue: ",u)}i.noti.Current=i.userInput.id;let o=new Date(i.userInput.limit);if(i.Calendar.value=new Date(o.getTime()-60*o.getTimezoneOffset()*1e3).toISOString(),e&&(i.limitTimeP5Display=new Date(e.limit).getTime()),i.userInput.startFrom){let u=new Date(i.userInput.startFrom);i.startDisplay=u.toLocaleString(i.lang.lang),i.startDisplay=i.startDisplay.substring(0,i.startDisplay.lastIndexOf(":"))}if(i.limit_change({detail:{value:i.userInput.limit}}),i.userInput.workers)for(let u=0,r=i.userInput.workers.length;u<r;u++){try{i.userInput.workers[u].name=i.nakama.GetOverrideName(i.userInput.workers[u].id,i.userInput.remote.isOfficial,i.userInput.remote.target)||i.nakama.load_other_user(i.userInput.workers[u].id,i.userInput.remote.isOfficial,i.userInput.remote.target).display_name}catch{}i.userInput.workers[u].timestamp&&(i.userInput.workers[u].displayTime=new Date(i.userInput.workers[u].timestamp).toLocaleString())}i.desc_input=document.getElementById("descInput")})()}descInputOnPasteAct(i){let e=[];for(const a of i.clipboardData.files)e.push({file:a});if(e.length){for(let a=0,p=e.length;a<p;a++)this.selected_blobFile_callback_act(e[a].file);return!1}}LoadStorageList(){let i=[];Object.keys(this.nakama.servers).forEach(p=>{Object.keys(this.nakama.servers[p]).forEach(u=>{"online"==this.statusBar.groupServer[p][u]&&i.push({name:`${this.nakama.servers[p][u].info.name}`,isOfficial:p,target:u})})}),[...i].forEach(p=>{this.AvailableStorageList.push(p)})}ionViewDidEnter(){this.show_count_timer(),this.WillLeavePage=!1,this.AddShortCut()}QuickChangeToDescFromTag(){this.AddCurrentTag(),setTimeout(()=>{var i;null===(i=this.desc_input)||void 0===i||i.focus()},0)}AddShortCut(){setTimeout(()=>{this.WillLeavePage||(this.global.p5KeyShortCut.EnterAct=i=>{document.activeElement==this.titleIonInput&&setTimeout(()=>{var e;null===(e=this.desc_input)||void 0===e||e.focus()},0),i.ctrlKey&&this.saveData()},this.ScrollDiv||(this.ScrollDiv=document.getElementById("addtodo-scroll")),this.global.p5KeyShortCut.BottomTab=i=>{document.activeElement!=this.titleIonInput&&document.activeElement!=this.desc_input&&"W"===i&&this.ScrollDiv.scrollTo({top:this.ScrollDiv.scrollTop-this.ScrollDiv.clientHeight/2,behavior:"smooth"})},this.global.p5KeyShortCut.SKeyAct=()=>{document.activeElement!=this.titleIonInput&&document.activeElement!=this.desc_input&&this.ScrollDiv.scrollTo({top:this.ScrollDiv.scrollTop+this.ScrollDiv.clientHeight/2,behavior:"smooth"})})},0)}start_change(i){this.userInput.startFrom=i.detail.value,this.startDisplay=new Date(i.detail.value).toLocaleString(this.lang.lang),this.startDisplay=this.startDisplay.substring(0,this.startDisplay.lastIndexOf(":")),this.startTimeP5Display=new Date(this.userInput.startFrom).getTime()}limit_change(i){this.userInput.limit=i.detail.value;let e=new Date(i.detail.value);e.getTime()<=Date.now()?this.limitDisplay=this.lang.text.TodoDetail.NoDeadLine:(this.limitDisplay=e.toLocaleString(this.lang.lang),this.limitDisplay=this.limitDisplay.substring(0,this.limitDisplay.lastIndexOf(":"))),this.limitTimeP5Display=new Date(this.userInput.limit).getTime(),this.startTimeP5Display=Date.now(),this.isLimitUsable=this.limitTimeP5Display>this.startTimeP5Display}download_attach(i){this.indexed.DownloadFileFromUserPath(this.userInput.attach[i].alt_path,this.userInput.attach[i].type,this.userInput.attach[i].filename)}remove_attach(i){this.userInput.attach.splice(i,1)}show_count_timer(){this.p5timer=new M(i=>{let e=0;this.startTimeP5Display=this.userInput.startFrom||this.userInput.written?new Date(this.userInput.startFrom||this.userInput.written).getTime():(new Date).getTime(),this.startTimeP5Display=i.min(this.startTimeP5Display,this.limitTimeP5Display);let a,p=i.color(this.normal_color);i.setup=()=>{let d=document.getElementById("p5timer"),I=i.createCanvas(d.clientWidth,d.clientHeight);i.pixelDensity(1),I.id("timer"),I.style("position","inherit"),I.parent(d),i.noStroke()};let o=0,u=()=>{a=(new Date).getTime(),o=this.limitTimeP5Display<a?1:i.map(a,this.startTimeP5Display,this.limitTimeP5Display,0,1,!0),o<=this.AlertLerpStartFrom?p=i.color(this.userInput.custom_color?this.userInput.custom_color+"88":this.normal_color):o>this.AlertLerpStartFrom&&(p=this.userInput.custom_color?i.color(this.userInput.custom_color+"88"):i.lerpColor(i.color(this.normal_color),i.color(this.alert_color),i.map(o,this.AlertLerpStartFrom,1,0,1)*e))};i.draw=()=>{u(),i.clear(255,255,255,255),i.push(),i.fill(p),e<1?(e+=.04,e>=1&&(e=1),i.rect(0,0,i.lerp(0,i.width,o*r(e)),i.height)):i.rect(0,0,i.lerp(0,i.width,o),i.height),i.pop()},i.windowResized=()=>{setTimeout(()=>{let d=document.getElementById("p5timer");i.resizeCanvas(d.clientWidth,d.clientHeight)},50)};let r=d=>h(i.sq(h(d))),h=d=>1-d})}new_attach(i){var e=this;return(0,w.A)(function*(){switch(i.detail.value){case"camera":try{let o=yield e.global.from_camera("tmp_files/todo/",{display_name:e.nakama.users.self.display_name},"add_todo");o.thumbnail=e.sanitizer.bypassSecurityTrustUrl(o.base64),e.userInput.attach.push(o)}catch{}e.AddShortCut(),e.auto_scroll_down(100);break;case"text":let a=e.global.TextEditorNewFileName();e.global.PageDismissAct["todo-text-add"]=o=>{if(o.data){let u=e.global.TextEditorAfterAct(o.data,{display_name:e.nakama.users.self.display_name});e.userInput.attach.push(u),e.auto_scroll_down()}e.global.RestoreShortCutAct("add-todo-add-text"),delete e.global.PageDismissAct["todo-text-add"]},e.global.StoreShortCutAct("add-todo-add-text"),e.global.ActLikeModal("portal/main/add-todo-menu/ionic-viewer",{info:{content:{is_new:"text",type:"text/plain",viewer:"text",filename:a}},noEdit:!0,dismiss:"todo-text-add"});break;case"image":e.global.PageDismissAct["todo-image-add"]=o=>{o.data&&e.voidDraw_fileAct_callback(o),delete e.global.PageDismissAct["todo-image-add"]},e.global.ActLikeModal("portal/main/add-todo-menu/void-draw",{dismiss:"todo-image-add"});break;case"inapp":e.global.PageDismissAct["todo-userfs-add"]=o=>{o.data&&e.selected_blobFile_callback_act(o.data),delete e.global.PageDismissAct["todo-userfs-add"]},e.global.ActLikeModal("user-fs-dir",{selector:!0,dismiss:"todo-userfs-add"});break;case"load":e.select_attach(),e.AddShortCut();break;case"link":let p;try{try{let r=yield e.global.GetValueFromClipboard("add_todo");switch(r.type){case"text/plain":p=r.value;break;case"image/png":return void e.inputImageSelected({target:{files:[r.value]}});case"error":throw r.value}}catch(r){throw r}try{let r=e.global.Base64ToBlob(p),h=p.split(";")[0].split(":")[1],d=new File([r],`${e.lang.text.ChatRoom.FileLink}.${h.split("/").pop()}`,{type:h});throw yield e.selected_blobFile_callback_act(d),"done"}catch(r){if("done"===r)throw r}try{if(0!=p.indexOf("http:")&&0!=p.indexOf("https:"))throw"\uc62c\ubc14\ub978 \uc6f9 \uc8fc\uc18c\uac00 \uc544\ub2d8"}catch(r){throw r}let o={};o.url=p,o.content_related_creator=[],o.content_related_creator.push({user_id:"local"==e.userInput.storeAt?"local":e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id,timestamp:(new Date).getTime(),display_name:e.nakama.users.self.display_name,various:"link"}),o.content_creator={user_id:"local"==e.userInput.storeAt?"local":e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id,timestamp:(new Date).getTime(),display_name:e.nakama.users.self.display_name,various:"link"};let u=o.url.split(".");o.file_ext=u.pop().split("?").shift(),o.filename=decodeURIComponent(o.url.split("/").pop()||`${e.lang.text.ChatRoom.ExternalLinkFile}.${o.file_ext}`),e.global.set_viewer_category_from_ext(o),o.type="",o.typeheader=o.viewer,e.global.modulate_thumbnail(o,o.url,e.cont),e.userInput.attach.push(o)}catch(o){throw"done"==o?o:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${(o.statusText?`${o.statusText}(${o.status})`:o.status)||o}`}}})()}select_attach(){document.getElementById(this.file_sel_id).click()}inputImageSelected(i){var e=this;return(0,w.A)(function*(){if(!i.target.files.length)return;const a="add_todo";yield e.p5loading.update({id:a,message:e.lang.text.ContentViewer.OnLoadContent,forceEnd:null});for(let o=0,u=i.target.files.length;o<u;o++){const r={id:a,message:`${e.lang.text.ContentViewer.OnLoadContent}: ${i.target.files[o].name}`};u>1&&(r.progress=o/u),e.p5loading.update(r),yield e.selected_blobFile_callback_act(i.target.files[o],!1)}e.p5loading.remove(a),document.getElementById(e.file_sel_id).value=""})()}StoreAtSelClicked(){this.StoreAt.open()}StoreAtSelChanged(i){this.isStoreAtChanged=!0;let e=i.detail.value;"local"==e?(this.userInput.storeAt="local",this.userInput.remote=void 0,this.isManager=!1,this.userInput.workers=void 0):(this.userInput.storeAt=e.type,this.userInput.remote=e,this.userInput.workers=[],this.nakama.servers[e.isOfficial][e.target].client.getAccount(this.nakama.servers[e.isOfficial][e.target].session).then(a=>{let p=JSON.parse(a.user.metadata);this.WorkerGroups.length=0,this.AvailableWorker={},p.is_admin?this.nakama.servers[e.isOfficial][e.target].client.rpc(this.nakama.servers[e.isOfficial][e.target].session,"query_all_groups",{}).then(o=>{let u=o.payload;for(let r=0,h=u.length;r<h;r++){this.AvailableWorker[u[r].id]||(this.AvailableWorker[u[r].id]=[]);for(let d=0,I=u[r].users.length;d<I;d++){let k=this.nakama.load_other_user(u[r].users[d].user.user_id,e.isOfficial,e.target,f=>{delete f.todo_checked,f.email||(f.override_name=this.nakama.GetOverrideName(f.id||f.user_id,this.userInput.remote.isOfficial,this.userInput.remote.target))});k.email||this.AvailableWorker[u[r].id].push(k)}this.AvailableWorker[u[r].id].length?this.WorkerGroups.push({id:u[r].id,name:u[r].name}):delete this.AvailableWorker[u[r].id]}this.isManager=!0}):this.UpdateWorkerList()})),setTimeout(()=>{"DesktopPWA"==G.aH&&!this.isModify&&this.titleIonInput&&!this.titleIonInput.value&&this.titleIonInput.focus()},200)}UpdateWorkerList(){if(!this.isStoreAtChanged)return;let i=0;this.WorkerGroups.length=0,this.userInput.workers=[];let e=Object.keys(this.nakama.PromotedGroup);for(let a of e){let p=Object.keys(this.nakama.PromotedGroup[a]);for(let o of p){let u=Object.keys(this.nakama.PromotedGroup[a][o]);for(let r of u){let h=this.nakama.groups[a][o][r];this.AvailableWorker[h.id]||(this.AvailableWorker[h.id]=[]),this.AvailableWorker[h.id].length=0;for(let d=0,I=h.users.length;d<I;d++){if(!h.users[d].user.user_id&&!h.users[d].user.id||(h.users[d].user.user_id||h.users[d].user.id)==this.nakama.servers[a][o].session.user_id)continue;let k=this.nakama.load_other_user(h.users[d].user.user_id||h.users[d].user.id,a,o,f=>{delete f.todo_checked,(f.id||f.user_id)!=this.nakama.servers[a][o].session.user_id&&f.display_name&&(f.override_name=this.nakama.GetOverrideName(f.id||f.user_id,this.userInput.remote.isOfficial,this.userInput.remote.target))});(k.id||k.user_id)!=this.nakama.servers[a][o].session.user_id&&k.display_name&&this.AvailableWorker[h.id].push(k)}this.AvailableWorker[h.id].length?this.WorkerGroups.push({id:h.id,name:h.name}):delete this.AvailableWorker[h.id],i++}}}this.isManager=0!=i}toggle_all_user(i){this.toggle_logs[i]=!this.toggle_logs[i];for(let e=0,a=this.AvailableWorker[i].length;e<a;e++)this.AvailableWorker[i][e].todo_checked=this.toggle_logs[i];this.count_selected_worker()}count_selected_worker(){let i=Object.keys(this.AvailableWorker),e=[];for(let a=0,p=i.length;a<p;a++)for(let o=0,u=this.AvailableWorker[i[a]].length;o<u;o++){let r=this.AvailableWorker[i[a]][o].id||this.AvailableWorker[i[a]][o].user_id;this.AvailableWorker[i[a]][o].todo_checked&&!e.includes(r)&&(this.userInput.workers.push({id:r,name:this.nakama.load_other_user(r,this.userInput.remote.isOfficial,this.userInput.remote.target).display_name}),e.push(r))}this.SelectedWorkers=e.length}ImporantSelClicked(){this.ImporantSel.open()}ImporantSelChanged(i){switch(this.userInput.importance=i.detail.value,this.userInput.importance){case"0":this.normal_color="#888b",this.alert_color="#58a19288",this.AlertLerpStartFrom=.8;break;case"1":this.normal_color="#888b",this.alert_color="#ddbb4188",this.AlertLerpStartFrom=.5;break;case"2":this.normal_color="#dddd0c88",this.alert_color="#b9543788",this.AlertLerpStartFrom=.4}}toggle_custom_color(){this.userInput.custom_color?this.userInput.custom_color=void 0:(document.getElementById("TodoCustomColorInput").click(),this.userInput.custom_color="#ff0000")}WaitingCurrent(){var i=this;return(0,w.A)(function*(){for(;!i.WaitingLoaded;)yield new Promise(e=>setTimeout(e,0));return!0})()}open_content_viewer(i){var e=this;if(this.lock_modal_open)return;this.lock_modal_open=!0;let p,o,u,a=[];for(let r=0,h=this.userInput.attach.length;r<h;r++)a.push({content:JSON.parse(JSON.stringify(this.userInput.attach[r]))});this.global.PageDismissAct["todo-ionicivewer"]=function(){var r=(0,w.A)(function*(h){if(yield e.WaitingCurrent(),e.lock_modal_open=!1,h.data)switch(h.data.type){case"gif-export":{let I=new File([h.data.blob],h.data.name);e.selected_blobFile_callback_act(I)}break;case"image":let d=[];if(e.userInput.attach[h.data.index].content_related_creator&&(d=[...e.userInput.attach[h.data.index].content_related_creator]),e.userInput.attach[h.data.index].content_creator){let I=!1;for(let k=0,f=d.length;k<f;k++)if(void 0!==d[k].user_id&&void 0!==e.userInput.attach[h.data.index].content_creator.user_id&&d[k].user_id==e.userInput.attach[h.data.index].content_creator.user_id){I=!0;break}I||d.push(e.userInput.attach[h.data.index].content_creator)}delete e.userInput.attach[h.data.index].exist,e.global.PageDismissAct["todo-modify-image"]=I=>{I.data&&("image"===h.data.msg.content.viewer?e.voidDraw_fileAct_callback(I,d,h.data.index):e.voidDraw_fileAct_callback(I,d)),delete e.global.PageDismissAct["todo-modify-image"]},e.global.ActLikeModal("portal/main/add-todo-menu/void-draw",{path:h.data.path||e.userInput.attach[h.data.index].alt_path||e.userInput.attach[h.data.index].path,width:h.data.width,height:h.data.height,type:h.data.filetype,text:h.data.text,dismiss:"todo-modify-image"});break;case"text":e.userInput.attach[h.data.index].content_related_creator.push(e.userInput.attach[h.data.index].content_creator),e.userInput.attach[h.data.index].content_creator={timestamp:(new Date).getTime(),display_name:e.nakama.users.self.display_name,various:"textedit"},e.userInput.attach[h.data.index].blob=h.data.blob,e.userInput.attach[h.data.index].path=h.data.path,e.userInput.attach[h.data.index].size=h.data.blob.size,e.userInput.attach[h.data.index].filename=h.data.blob.name||e.userInput.attach[h.data.index].filename,delete e.userInput.attach[h.data.index].exist}e.global.RestoreShortCutAct("add-todo-viewer"),delete e.global.PageDismissAct["todo-ionicivewer"]});return function(h){return r.apply(this,arguments)}}(),this.noti.Current="IonicViewerPage",this.global.StoreShortCutAct("add-todo-viewer");try{u=this.userInput.remote.creator_id,p=this.userInput.remote.isOfficial,o=this.userInput.remote.target}catch{p="local"}this.global.ActLikeModal("portal/main/add-todo-menu/ionic-viewer",{info:{content:this.userInput.attach[i],sender_id:u},isOfficial:p,target:o,path:this.userInput.attach[i].alt_path||this.userInput.attach[i].path,relevance:a,noEdit:!this.isModifiable,dismiss:"todo-ionicivewer"})}auto_scroll_down(i=0){setTimeout(()=>{this.MainDiv.scrollTo({top:this.MainDiv.scrollHeight,behavior:"smooth"})},i)}voidDraw_fileAct_callback(i,e,a){var p=this;return(0,w.A)(function*(){let o=yield p.global.voidDraw_fileAct_callback(i,"tmp_files/todo/",{display_name:p.nakama.users.self.display_name},e);try{if(void 0===a)throw"not overwrite";p.userInput.attach[a]=o}catch{p.userInput.attach.push(o)}p.auto_scroll_down(100)})()}doneTodo(){this.isButtonClicked=!0,this.navCtrl.pop(),this.nakama.doneTodo(this.userInput)}QuickBottomMenu(){this.alertCtrl.create({header:this.userInput.title,message:this.userInput.description,buttons:[{text:this.lang.text.TodoDetail.TodoComplete,handler:()=>this.doneTodo()},{text:this.lang.text.TodoDetail.remove,cssClass:"redfont",handler:()=>this.deleteData()}]}).then(i=>i.present())}toggle_custom_attach(i){var e=this;return(0,w.A)(function*(){switch(e.isCDNToggleClicked=!0,e.userInput.CDN=(null!=i?i:e.userInput.CDN+1)%3,e.userInput.CDN){case 0:e.extended_buttons[5].icon="cloud-offline-outline",e.extended_buttons[5].name=e.lang.text.ChatRoom.Detour;break;case 1:e.extended_buttons[5].icon="cloud-done-outline",e.extended_buttons[5].name=e.lang.text.ChatRoom.useFSS;break;case 2:e.extended_buttons[5].icon="server-outline",e.extended_buttons[5].name=e.lang.text.ChatRoom.forceSQL}setTimeout(()=>{e.isCDNToggleClicked=!1},0)})()}saveData(i=!0){var e=this;return(0,w.A)(function*(){var a,p;if(!e.userInput.title)return e.p5toast.show({text:e.lang.text.TodoDetail.needDisplayName}),void setTimeout(()=>{e.titleIonInput&&e.titleIonInput.focus()},0);e.isButtonClicked=!0,i&&e.navCtrl.pop();const o="add_todo";yield e.p5loading.update({id:o,message:`${e.lang.text.TodoDetail.ApplyingTodo}: ${e.userInput.title}`,forceEnd:null}),e.useVoiceRecording&&(yield e.StopAndSaveVoiceRecording());const u=!!e.userInput.attach.length;delete e.userInput.display_store,delete e.userInput.display_creator;let r={};try{const n=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].info;r.apache_port=n.apache_port,r.cdn_port=n.cdn_port,r.user_id=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id}catch{r={}}if(JSON.stringify(e.userInput)==e.received_data&&!e.TagCache)return void e.navCtrl.pop();e.userInput.create_at||(e.userInput.create_at=(new Date).getTime());let d=e.received_data?JSON.parse(e.received_data):void 0;if((e.isStoreAtChanged||(null==d?void 0:d.CDN)!=e.userInput.CDN)&&e.isModify){for(let n=0,c=d.attach.length;n<c;n++){try{const m=d.attach[n].filename,g=yield e.indexed.loadBlobFromUserPath(d.attach[n].path,d.attach[n].type),y=`tmp_files/todo/${m}`;yield e.indexed.saveBlobToUserPath(g,y),e.userInput.attach[n].path=y,e.userInput.attach[n].blob=g}catch{if(d.attach[n].url){const g=d.attach[n].filename,x=yield(yield fetch(d.attach[n].url,{signal:e.cont.signal})).blob(),D=`tmp_files/todo/${g}`;yield e.indexed.saveBlobToUserPath(x,D),e.userInput.attach[n].path=D,e.userInput.attach[n].blob=x,yield e.global.remove_file_from_storage(e.userInput.attach[n].url,r)}}delete e.userInput.attach[n].thumbnail,delete e.userInput.attach[n].alt_path,delete e.userInput.attach[n].url,delete e.userInput.attach[n].exist}yield e.nakama.deleteTodoFromStorage(!0,d,void 0,o),e.isModify=!1}if(!e.userInput.id||!e.isModify)if(e.userInput.remote)try{const n=yield e.nakama.getRemoteTodoCounter(e.userInput.remote.isOfficial,e.userInput.remote.target);e.userInput.id=`RemoteTodo_${n}`}catch{}else e.userInput.id=new Date(e.userInput.create_at).toISOString().replace(/[:|.|\/]/g,"_");e.userInput.noti_id&&(e.nakama.RemoveLocalPushSchedule(e.userInput),e.nakama.removeRegisteredId(e.userInput.noti_id),e.noti.ClearNoti(e.userInput.noti_id)),e.userInput.noti_id=e.nakama.get_noti_id();let j,b,k=!1;if(!e.isModify&&e.userInput.workers){e.userInput.workers.length=0;let n=Object.keys(e.AvailableWorker),c=[];for(let m=0,g=n.length;m<g;m++)for(let y=0,x=e.AvailableWorker[n[m]].length;y<x;y++){let D=e.AvailableWorker[n[m]][y].id||e.AvailableWorker[n[m]][y].user_id;e.AvailableWorker[n[m]][y].todo_checked&&!c.includes(D)&&(e.userInput.workers.push({id:D,name:e.nakama.load_other_user(D,e.userInput.remote.isOfficial,e.userInput.remote.target).display_name}),c.push(D))}e.userInput.workers.length||(e.userInput.workers=void 0)}try{d.attach.forEach(m=>{delete m.exist,delete m.thumbnail,delete m.base64,delete m.blob});let n=JSON.stringify(d.attach),c=JSON.parse(JSON.stringify(e.userInput.attach));c.forEach(m=>{delete m.exist,delete m.thumbnail,delete m.base64,delete m.blob}),c=JSON.stringify(c),k=n!=c}catch{k=!0}if(e.TagCache&&e.userInput.tags.push(e.TagCache),e.global.RemoveTodoTags(d),e.global.AddTodoTags(e.userInput),u&&k){if(d)try{for(let c=0,m=d.attach.length;c<m;c++){for(let g=0,y=e.userInput.attach.length;g<y;g++)if(e.userInput.attach[g].path==d.attach[c].path){d.attach[c].exist=!0,d.attach[c].index=g;break}(!d.attach[c].exist||d.attach[c].exist&&!e.userInput.attach[d.attach[c].index])&&(d.attach[c].url?""!==d.attach[c].type&&e.global.remove_file_from_storage(d.attach[c].url,r):yield e.indexed.removeFileFromUserPath(d.attach[c].path))}}catch{}let n;for(let c=0,m=e.userInput.attach.length;c<m;c++){let g,y=!1;try{if(n)throw"already exist";if("image"==e.userInput.attach[c].viewer)throw"\uc774\ubbf8\uc9c0 \uc911\ucca9 \ud589\ub3d9 \ubc29\uc9c0";g=yield e.indexed.loadBlobFromUserPath(`${e.userInput.attach[c].path}_thumbnail.png`,"image/png"),y=!0}catch{}if(!e.userInput.attach[c].exist||!n&&"image"==e.userInput.attach[c].viewer){try{y||(g=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[c].path,e.userInput.attach[c].type))}catch{}try{if(1!=e.userInput.CDN)throw"FFS \uc0ac\uc6a9 \uc21c\uc704\uc5d0 \uc5c6\uc74c";let x;if(x=yield e.global.try_upload_to_user_custom_fs(e.userInput.attach[c],e.nakama.users.self.display_name,o,e.userInput.title),!x)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete e.userInput.attach[c].partsize,delete e.userInput.attach[c].size,e.userInput.attach[c].url=x}catch{try{e.userInput.attach[c].path=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/${e.userInput.attach[c].filename}`}catch{e.userInput.attach[c].path=`todo/${e.userInput.id}/${e.userInput.attach[c].filename}`}try{g||(g=yield e.indexed.loadBlobFromUserPath(e.userInput.attach[c].path,e.userInput.attach[c].type)),yield e.indexed.saveBlobToUserPath(g,e.userInput.attach[c].path)}catch{}}}else delete e.userInput.attach[c].exist;if(!n&&("image"==e.userInput.attach[c].viewer||y))try{n=URL.createObjectURL(g)}catch{}}e.p5loading.update({id:o,image:n||null}),n&&(yield new Promise(c=>{new M(m=>{m.setup=()=>{m.noCanvas(),m.loadImage(n,g=>{g.width>g.height?g.resize(g.width/g.height*128,128):g.resize(128,g.height/g.width*128);let x=m.createCanvas(128,128);x.hide(),m.smooth(),m.pixelDensity(1),m.image(g,-(g.width-128)/2,-(g.height-128)/2);const D=x.elt.toDataURL("image/png").replace("image/png","image/octet-stream");let S;try{S=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{S=`todo/${e.userInput.id}/thumbnail.png`}URL.revokeObjectURL(n),m.remove(),e.indexed.saveBase64ToUserPath(D,S).then(je=>{c()})},g=>{console.error("Todo-\ub4f1\ub85d\ub41c \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",g),URL.revokeObjectURL(n),m.remove(),c()})}})}))}if(!u&&k&&d){let n;try{n=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/thumbnail.png`}catch{n=`todo/${e.userInput.id}/thumbnail.png`}if(yield e.indexed.removeFileFromUserPath(n),d.attach)for(let c=0,m=d.attach.length;c<m;c++)d.attach[c].url?""!==d.attach[c].type&&e.global.remove_file_from_storage(d.attach[c].url,r):yield e.indexed.removeFileFromUserPath(d.attach[c].path)}if(e.userInput.attach.forEach(n=>{URL.revokeObjectURL(n.thumbnail),delete n.thumbnail,delete n.exist,delete n.base64}),e.userInput.written=(new Date).getTime(),e.userInput.startFrom){const n=new Date(e.userInput.startFrom).getTime();(new Date).getTime()>n?delete e.userInput.startFrom:e.userInput.startFrom=n}if(e.userInput.limit=new Date(e.userInput.limit).getTime(),e.nakama.set_todo_notification(e.userInput),e.isModify||e.userInput.remote&&!e.userInput.remote.creator_id&&(e.userInput.remote.creator_id=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id),e.userInput.remote)try{if(e.userInput.attach.forEach(n=>{URL.revokeObjectURL(n.thumbnail),delete n.thumbnail,delete n.exist,delete n.base64}),u&&k&&d)for(let n=0,c=d.attach.length;n<c;n++){for(let m=0,g=e.userInput.attach.length;m<g;m++)if(e.userInput.attach[m].path==d.attach[n].path){d.attach[n].exist=!0,d.attach[n].index=m;break}if(!d.attach[n].exist||d.attach[n].exist&&!e.userInput.attach[d.attach[n].index])if(d.attach[n].url)""!==d.attach[n].type&&e.global.remove_file_from_storage(d.attach[n].url,r);else try{yield e.nakama.sync_remove_file(d.attach[n].path,e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach")}catch{}}for(let n=0,c=e.userInput.attach.length;n<c;n++){e.userInput.attach[n].url&&(delete e.userInput.attach[n].path,delete e.userInput.attach[n].size,delete e.userInput.attach[n].partsize);try{if(2==e.userInput.CDN)throw"ForceSQL";!e.userInput.attach[n].blob.size&&e.userInput.attach[n].url&&(e.userInput.attach[n].blob=yield(yield fetch(e.userInput.attach[n].url,{signal:e.cont.signal})).blob());const m=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].info.address,g=e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].info.useSSL?"https:":"http:";let y=`${e.nakama.users.self.display_name}/${e.userInput.id}`;try{y=`${e.userInput.remote.creator_id}/${e.userInput.id}`}catch{}const x=yield e.global.upload_file_to_storage(e.userInput.attach[n],{user_id:y,apache_port:r.apache_port,cdn_port:r.cdn_port},g,m,1==e.userInput.CDN,o,e.userInput.title);if(!x)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete e.userInput.attach[n].size,delete e.userInput.attach[n].partsize,e.userInput.attach[n].url=x}catch(m){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",m),"ForceSQL"==m&&e.userInput.attach[n].url&&(e.userInput.attach[n].blob=yield(yield fetch(e.userInput.attach[n].url,{signal:e.cont.signal})).blob());try{yield e.nakama.sync_save_file(e.userInput.attach[n],e.userInput.remote.isOfficial,e.userInput.remote.target,"todo_attach")}catch{}}}if(e.userInput.workers){if(!e.isModify){let n=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.rpc(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,"manage_todo_add_fn",e.userInput);e.userInput.id=`RemoteTodo_${n.payload.value}`,e.nakama.RemoteTodoCounter[e.userInput.remote.isOfficial][e.userInput.remote.target].push(n.payload.value),e.nakama.updateRemoteCounter(e.userInput.remote.isOfficial,e.userInput.remote.target)}try{let n=[];for(let c=0,m=e.userInput.workers.length;c<m;c++)n.push(e.userInput.workers[c].id);yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.rpc(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,"send_noti_fn",{receiver_id:n,title:"Manage_todo_add",content:{type:"add",collection:"server_todo",key:e.userInput.id},code:F.I.MANAGE_TODO,persistent:!1,sender_id:e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id})}catch(n){console.log(n)}}else{const n=yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.writeStorageObjects(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,[{collection:"server_todo",key:e.userInput.id,permission_read:2,permission_write:1,value:e.userInput}]);e.isModify||(yield e.nakama.updateRemoteCounter(e.userInput.remote.isOfficial,e.userInput.remote.target)),yield e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].client.rpc(e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session,"send_noti_fn",{receiver_id:[e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id],title:"Manage_todo_add",content:{type:"add",collection:n.acks[0].collection,key:n.acks[0].key},code:F.I.MANAGE_TODO,persistent:!1})}}catch(n){let c;console.error("\ud574\uc57c\ud560 \uc77c\uc774 \uc11c\ubc84\uc5d0 \uc804\uc1a1\ub418\uc9c0 \uc54a\uc74c: ",n);try{c=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/info.todo`}catch{c=`todo/${e.userInput.id}/info.todo`}return e.isModify?(e.p5toast.show({text:e.lang.text.TodoDetail.SaveAfterConnectServer}),e.userInput.modified=!0,null===(f=(A=e.global).p5todoAddtodo)||void 0===f||f.call(A,JSON.stringify(e.userInput)),yield e.indexed.saveTextFileToUserPath(JSON.stringify(e.userInput),c),e.isButtonClicked=!1,void e.p5loading.update({id:o,message:`${e.lang.text.TodoDetail.ApplyingTodo}: ${e.userInput.title}`,forceEnd:1e3})):(e.StoreAtSelChanged({detail:{value:"local"}}),e.saveData(!1),void e.p5toast.show({text:e.lang.text.TodoDetail.CanAddToServer}));var f,A}e.userInput.is_me=!0,null===(a=(p=e.global).p5todoAddtodo)||void 0===a||a.call(p,JSON.stringify(e.userInput));try{j=`todo/${e.userInput.id}_${e.userInput.remote.isOfficial}_${e.userInput.remote.target}/info.todo`}catch{j=`todo/${e.userInput.id}/info.todo`}yield e.indexed.saveTextFileToUserPath(JSON.stringify(e.userInput),j);for(let n=0,c=e.userInput.attach.length;n<c;n++)if("image"==e.userInput.attach[n].viewer&&e.userInput.attach[n].url){b=e.userInput.attach[n].url;break}try{var R;let n=localStorage.getItem("fallback_fs");if(!n)throw"\uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc11c\ubc84 \uc5c6\uc74c";let c=n.split("://"),m=c.pop().split(":"),g=c.pop();g?g+=":":g=e.global.checkProtocolFromAddress(m[0])?"https:":"http:";const y=null===(R=m[1])||void 0===R?void 0:R.split(","),x=`${g}//${m[0]}:${(null==y?void 0:y[2])||5e3}/`;let S=[localStorage.getItem("fallback_fs_push_tog")];yield e.nakama.remove_schedule_webpush(x,{todo_id:e.userInput.id},S),yield e.nakama.schedule_webpush(x,{id:e.userInput.noti_id,title:e.userInput.title,body:e.userInput.description,icon:"todo",image:b,todo_id:e.userInput.id,time:e.userInput.startFrom||e.userInput.limit,data:{url:`/?todo=${JSON.stringify(e.userInput)}&address=${e.nakama.GetNodejsServerAddress(e.userInput.remote.isOfficial,e.userInput.remote.target,"nakama_port")}`}},S)}catch(n){console.log("FFS \ud560 \uc77c \uc54c\ub9bc \ub4f1\ub85d \uc808\ucc28 \uc624\ub958: ",n)}if(e.userInput.remote)try{const n=e.nakama.GetNodejsServerAddress(e.userInput.remote.isOfficial,e.userInput.remote.target,"webpush_port");let c=[e.nakama.servers[e.userInput.remote.isOfficial][e.userInput.remote.target].session.user_id];for(let m=0,g=null===(C=e.userInput.workers)||void 0===C?void 0:C.length;m<g;m++){var C;c.push(e.userInput.workers[m].id)}yield e.nakama.remove_schedule_webpush(n,{todo_id:e.userInput.id},c),yield e.nakama.schedule_webpush(n,{id:e.userInput.noti_id,title:e.userInput.title,body:e.userInput.description,icon:"todo",image:b,todo_id:e.userInput.id,time:e.userInput.startFrom||e.userInput.limit,data:{url:`/?todo=${JSON.stringify(e.userInput)}&address=${e.nakama.GetNodejsServerAddress(e.userInput.remote.isOfficial,e.userInput.remote.target,"nakama_port")}`}},c)}catch(n){console.log("\uc6d0\uaca9 \ud560 \uc77c \uc54c\ub9bc \uc608\uc57d \uad6c\uc131 \uc2e4\ud328: ",n)}e.p5loading.update({id:o,message:`${e.lang.text.TodoDetail.ApplyingTodo}: ${e.userInput.title}`,progress:1,forceEnd:1e3})})()}deleteData(){this.alertCtrl.create({header:this.lang.text.TodoDetail.remove,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.TodoDetail.remove,handler:()=>{this.isButtonClicked=!0,this.navCtrl.pop(),this.nakama.deleteTodoFromStorage(!0,this.userInput)},cssClass:"redfont"}]}).then(i=>{i.present()})}ionViewWillLeave(){var i=this;return(0,w.A)(function*(){i.p5loading.remove("add_todo"),i.global.RestoreShortCutAct("add-todo"),i.WillLeavePage=!0,i.WaitingLoaded=!1,delete i.global.p5KeyShortCut.EnterAct,i.titleIonInput.onblur=null,i.titleIonInput.onfocus=null,i.noti.Current="",i.p5timer&&i.p5timer.remove()})()}ngOnDestroy(){this.PageDestoryed=!0,this.useVoiceRecording&&this.StopAndSaveVoiceRecording(),this.global.portalHint=!0,delete this.nakama.socket_reactive.add_todo_menu,this.route.queryParams.unsubscribe(),this.desc_input&&(this.desc_input.onpaste=null),this.cont.abort("\ud560 \uc77c \ud398\uc774\uc9c0 \ubc97\uc5b4\ub0a8"),this.cont=null,this.nakama.AddTodoLinkAct=null,this.nakama.AddTodoManageUpdateAct=null,this.p5canvas&&this.p5canvas.remove(),delete this.nakama.StatusBarChangedCallback}}return(l=_).\u0275fac=function(i){return new(i||l)(t.rXU(P.nX),t.rXU(P.Ix),t.rXU(N.y),t.rXU(E.G),t.rXU(U.up),t.rXU(V.n),t.rXU(F.X),t.rXU(T.hG),t.rXU(Y.r),t.rXU(X.j),t.rXU(J.z3),t.rXU(W.q9),t.rXU(z.u),t.rXU(H.f))},l.\u0275cmp=t.VBU({type:l,selectors:[["app-add-todo-menu"]],viewQuery:function(i,e){if(1&i&&(t.GBs(Q,5),t.GBs(K,5),t.GBs(Z,5),t.GBs(q,5)),2&i){let a;t.mGM(a=t.lsd())&&(e.StartCalendar=a.first),t.mGM(a=t.lsd())&&(e.Calendar=a.first),t.mGM(a=t.lsd())&&(e.StoreAt=a.first),t.mGM(a=t.lsd())&&(e.ImporantSel=a.first)}},decls:70,vars:38,consts:[["ImporantSel",""],["DateTime",""],["Calendar",""],["StoreAt",""],["ManageWorker",""],["Groups",""],["StartCalendar",""],[1,"ion-no-border"],["slot","start"],["defaultHref","portal/main"],["class","relevance_change","style","padding-right: 16px;","slot","end","name","menu-outline",3,"click",4,"ngIf"],["id","p5Drop_todo",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none","z-index","500"],["id","addtodo-scroll",2,"height","100%","overflow-y","auto"],["id","p5timer",2,"position","fixed","width","100%","height","8px","z-index","500"],["id","main_table",2,"width","100%"],[2,"vertical-align","top"],["id","main_div",1,"main",2,"max-width","100vw"],["fixed","",4,"ngIf"],[3,"click",4,"ngIf"],[4,"ngIf"],["id","titleInput",1,"ion-text-right",3,"ngModelChange","label","ngModel","placeholder"],["style","display: flex; flex-direction: row; flex-wrap: wrap; padding: 4px;",4,"ngIf"],["id","titleInput",1,"ion-text-right",3,"ngModelChange","input","keydown.enter","label","ngModel","placeholder"],["button","",3,"click"],[2,"pointer-events","none",3,"ionChange","label","value"],["value","2"],["value","1"],["value","0"],[1,"additional_form","new_bg_form"],["id","TodoCustomColorInput","type","color",2,"width","0px","height","0px","opacity","0",3,"ngModelChange","ngModel"],["value","Start",4,"ngIf"],["value","Limit"],["button","","slot","header"],[2,"display","contents"],[1,"ion-text-right","uneditable_data"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],[2,"max-width","none",3,"ionChange","locale"],[2,"position","relative"],["class","shortcut_hint","style","z-index: 32;",4,"ngIf"],["id","descInput",1,"infobox",2,"height","240px",3,"ngModelChange","paste","ngModel","placeholder"],[4,"ngFor","ngForOf"],["hidden","","type","file","accept","image/*",3,"change","id"],["style","width: 100%; text-align: center; padding-bottom: 16px;",4,"ngIf"],["hidden","","type","file","accept","*","multiple","",3,"change","id"],[2,"width","100%"],["id","bottom_buttons",2,"width","100%","background-color","black"],["class","shortcut_hint",4,"ngIf"],["expand","block",3,"click","disabled"],["slot","end","name","menu-outline",1,"relevance_change",2,"padding-right","16px",3,"click"],["fixed",""],["col-33",""],["button","","color","success",3,"click","disabled"],[1,"ion-text-center"],[3,"click"],[2,"pointer-events","none",3,"ionChange","label"],["value","local"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["color","medium",2,"display","contents"],["color","medium",1,"ion-text-right"],[2,"display","flex","flex-direction","row","flex-wrap","wrap","padding","4px"],["class","tags",3,"click",4,"ngFor","ngForOf"],[1,"tags",3,"click"],["button","","slot","header",1,"group_background"],["button","",1,"worker_background",3,"click"],["class","worker_background",3,"click",4,"ngFor","ngForOf"],[1,"worker_background",3,"click"],[3,"ngModelChange","ngModel"],[1,"ion-text-end"],["class","ignore_check",4,"ngFor","ngForOf"],[1,"ignore_check"],["style","color: var(--ion-color-medium);",4,"ngIf"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline",4,"ngIf"],["slot","end","color","danger","name","close-circle-outline",4,"ngIf"],["slot","end","color","success","name","checkmark-circle-outline",4,"ngIf"],[2,"color","var(--ion-color-medium)"],["slot","end","color","medium","name","ellipsis-horizontal-circle-outline"],["slot","end","color","danger","name","close-circle-outline"],["slot","end","color","success","name","checkmark-circle-outline"],["value","Start"],[1,"shortcut_hint",2,"z-index","32"],["text-wrap",""],["slot","end","name","download-outline",1,"remove_icon_size",3,"click"],["color","danger","slot","end","name","remove-circle-outline","class","remove_icon_size",3,"click",4,"ngIf"],["color","danger","slot","end","name","remove-circle-outline",1,"remove_icon_size",3,"click"],["class","image_thumbnail",3,"src","alt","contextmenu",4,"ngIf"],["button","",4,"ngIf"],[1,"image_thumbnail",3,"contextmenu","src","alt"],["button",""],["color","medium"],[2,"width","100%","text-align","center","padding-bottom","16px"],["style","display: inline-block;",4,"ngFor","ngForOf"],[2,"display","inline-block"],[1,"ext_button","ext_button_override",3,"click","contextmenu","hidden"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"],[1,"shortcut_hint"],["color","danger","expand","block",3,"click","disabled"]],template:function(i,e){if(1&i){const a=t.RV6();t.j41(0,"ion-header",7)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",8),t.nrm(5,"ion-back-button",9),t.k0s(),t.DNE(6,ee,1,0,"ion-icon",10),t.k0s()(),t.j41(7,"ion-content"),t.nrm(8,"div",11),t.j41(9,"div",12),t.nrm(10,"div",13),t.j41(11,"div")(12,"table",14)(13,"tr")(14,"td",15)(15,"div",16),t.DNE(16,te,6,2,"ion-grid",17)(17,ae,6,3,"ion-item",18)(18,oe,6,2,"div",19),t.j41(19,"ion-item")(20,"ion-input",20),t.mxI("ngModelChange",function(o){return t.eBV(a),t.DH7(e.userInput.title,o)||(e.userInput.title=o),t.Njj(o)}),t.k0s()(),t.DNE(21,re,2,1,"div",21),t.j41(22,"ion-item")(23,"ion-input",22),t.mxI("ngModelChange",function(o){return t.eBV(a),t.DH7(e.TagCache,o)||(e.TagCache=o),t.Njj(o)}),t.bIt("input",function(o){return t.eBV(a),t.Njj(e.TagInputKey(o))})("keydown.enter",function(){return t.eBV(a),t.Njj(e.QuickChangeToDescFromTag())}),t.k0s()(),t.DNE(24,de,11,2,"div",19),t.j41(25,"ion-item",23),t.bIt("click",function(){return t.eBV(a),t.Njj(e.ImporantSelClicked())}),t.j41(26,"ion-select",24,0),t.bIt("ionChange",function(o){return t.eBV(a),t.Njj(e.ImporantSelChanged(o))}),t.j41(28,"ion-select-option",25),t.EFF(29),t.k0s(),t.j41(30,"ion-select-option",26),t.EFF(31),t.k0s(),t.j41(32,"ion-select-option",27),t.EFF(33),t.k0s()()(),t.DNE(34,ge,11,3,"div",19),t.j41(35,"ion-item",23),t.bIt("click",function(){return t.eBV(a),t.Njj(e.toggle_custom_color())}),t.j41(36,"ion-label"),t.EFF(37),t.k0s(),t.j41(38,"div",28)(39,"input",29),t.mxI("ngModelChange",function(o){return t.eBV(a),t.DH7(e.userInput.custom_color,o)||(e.userInput.custom_color=o),t.Njj(o)}),t.k0s()()(),t.j41(40,"ion-accordion-group",null,1),t.DNE(42,_e,10,3,"ion-accordion",30),t.j41(43,"ion-accordion",31)(44,"ion-item",32)(45,"ion-label",33),t.EFF(46),t.k0s(),t.j41(47,"ion-label",34),t.EFF(48),t.k0s(),t.nrm(49,"ion-icon",35),t.k0s(),t.j41(50,"div",36)(51,"ion-datetime",37,2),t.bIt("ionChange",function(o){return t.eBV(a),t.Njj(e.limit_change(o))}),t.k0s()()()(),t.j41(53,"div",38),t.DNE(54,fe,2,0,"div",39),t.j41(55,"textarea",40),t.mxI("ngModelChange",function(o){return t.eBV(a),t.DH7(e.userInput.description,o)||(e.userInput.description=o),t.Njj(o)}),t.bIt("paste",function(o){return t.eBV(a),t.Njj(e.descInputOnPasteAct(o))}),t.k0s()(),t.DNE(56,ye,7,3,"div",41),t.j41(57,"input",42),t.bIt("change",function(o){return t.eBV(a),t.Njj(e.SelectVoidDrawBackgroundImage(o))}),t.k0s(),t.DNE(58,we,2,1,"div",43),t.j41(59,"input",44),t.bIt("change",function(o){return t.eBV(a),t.Njj(e.inputImageSelected(o))}),t.k0s()()()()(),t.j41(60,"div",45)(61,"table",46)(62,"tr")(63,"td")(64,"div")(65,"div",38),t.DNE(66,De,2,0,"div",47),t.j41(67,"ion-button",48),t.bIt("click",function(){return t.eBV(a),t.Njj(e.saveData())}),t.EFF(68),t.k0s()()()(),t.DNE(69,Ce,3,2,"td",19),t.k0s()()()()()()}2&i&&(t.R7$(3),t.JRh(e.lang.text.TodoDetail.Title),t.R7$(3),t.Y8G("ngIf",e.isModify),t.R7$(10),t.Y8G("ngIf",e.isModify),t.R7$(),t.Y8G("ngIf",e.isStoreAtChangable&&e.AmICreator),t.R7$(),t.Y8G("ngIf",!e.isStoreAtChangable||!e.AmICreator),t.R7$(2),t.Y8G("label",e.lang.text.TodoDetail.DisplayName),t.R50("ngModel",e.userInput.title),t.Y8G("placeholder",e.lang.text.TodoDetail.DisplayName_placeholder),t.R7$(),t.Y8G("ngIf",null==e.userInput.tags?null:e.userInput.tags.length),t.R7$(2),t.Y8G("label",e.lang.text.TodoDetail.Tag),t.R50("ngModel",e.TagCache),t.Y8G("placeholder",e.lang.text.TodoDetail.Tag_placeholder),t.R7$(),t.Y8G("ngIf","local"!=e.userInput.storeAt&&e.isManager&&e.WorkerGroups.length),t.R7$(2),t.Y8G("label",e.lang.text.TodoDetail.Importance)("value",e.userInput.importance),t.R7$(3),t.JRh(e.lang.text.TodoDetail.Importance_2),t.R7$(2),t.JRh(e.lang.text.TodoDetail.Importance_1),t.R7$(2),t.JRh(e.lang.text.TodoDetail.Importance_0),t.R7$(),t.Y8G("ngIf",!e.isStoreAtChanged&&e.userInput.workers),t.R7$(3),t.JRh(e.lang.text.TodoDetail.CustomColor),t.R7$(),t.Aen("background-image: linear-gradient(to right, #0000, "+(e.userInput.custom_color||e.alert_color)+")"),t.R7$(),t.R50("ngModel",e.userInput.custom_color),t.R7$(3),t.Y8G("ngIf",e.isLimitUsable),t.R7$(4),t.JRh(e.lang.text.TodoDetail.limit),t.R7$(2),t.JRh(e.limitDisplay),t.R7$(3),t.Y8G("locale",e.lang.lang),t.R7$(3),t.Y8G("ngIf",e.global.ShowHint&&e.CheckIfTitleFocus),t.R7$(),t.R50("ngModel",e.userInput.description),t.Y8G("placeholder",e.lang.text.TodoDetail.description),t.R7$(),t.Y8G("ngForOf",e.userInput.attach),t.R7$(),t.Y8G("id",e.voidDrawContextId),t.R7$(),t.Y8G("ngIf",e.isStoreAtChangable),t.R7$(),t.Y8G("id",e.file_sel_id),t.R7$(7),t.Y8G("ngIf",e.global.ShowHint),t.R7$(),t.Y8G("disabled",e.isButtonClicked),t.R7$(),t.SpI(" ",e.buttonDisplay.saveTodo," "),t.R7$(),t.Y8G("ngIf",e.isModify))},dependencies:[O.Sq,O.bT,$.me,$.BC,$.vS,T.xk,T.YH,T.Jm,T.QW,T.eY,T.hU,T.W9,T.A9,T.lO,T.eU,T.iq,T.$w,T.uz,T.he,T.ln,T.Nm,T.Ip,T.BC,T.ai,T.hB,T.Je,T.Gw,T.el],styles:[".uneditable_data[_ngcontent-%COMP%]{color:#888}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding-top:8px;scroll-behavior:smooth}.tags[_ngcontent-%COMP%]{border:1px solid var(--ion-color-primary);border-radius:16px;margin:4px;padding:4px 12px;cursor:pointer}.group_background[_ngcontent-%COMP%]{--background: var(--todo-worker-group-bg)}.worker_background[_ngcontent-%COMP%]{--background: var(--todo-worker-bg)}.logs[_ngcontent-%COMP%]{background:var(--voidDraw-menu-background);border-radius:8px;margin:8px;padding:4px 8px;text-align:center}.image_thumbnail[_ngcontent-%COMP%]{width:auto;height:auto;object-fit:contain;display:block;margin:auto;cursor:pointer}.ignore_check[_ngcontent-%COMP%]{pointer-events:none}.remove_icon_size[_ngcontent-%COMP%]{height:23px;cursor:pointer}ion-input[_ngcontent-%COMP%]{--highlight-color-valid: var(--ion-color-primary)}"]}),_})()},{path:"void-draw",loadChildren:()=>Promise.all([v.e(6042),v.e(4020),v.e(2655)]).then(v.bind(v,2655)).then(l=>l.VoidDrawPageModule)},{path:"ionic-viewer",loadChildren:()=>Promise.all([v.e(6042),v.e(4803),v.e(222)]).then(v.bind(v,4803)).then(l=>l.IonicViewerPageModule)}];let Se=(()=>{var l;class _{}return(l=_).\u0275fac=function(i){return new(i||l)},l.\u0275mod=t.$C({type:l}),l.\u0275inj=t.G2t({imports:[P.iI.forChild(Re),P.iI]}),_})(),Me=(()=>{var l;class _{}return(l=_).\u0275fac=function(i){return new(i||l)},l.\u0275mod=t.$C({type:l}),l.\u0275inj=t.G2t({imports:[O.MD,$.YN,T.bv,Se]}),_})()}}]);