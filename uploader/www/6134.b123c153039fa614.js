"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6134],{6134:(Dt,G,v)=>{v.r(G),v.d(G,{ChatRoomPageModule:()=>Et});var V=v(177),O=v(4341),I=v(5374),F=v(9858),g=v(467),D=v(617),j=v(8326),M=v(92),S=v(482);const E=(0,v(5083).F3)("TextToSpeech",{web:()=>v.e(640).then(v.bind(v,640)).then(o=>new o.TextToSpeechWeb)});"speechSynthesis"in window&&window;var T=v(5402),e=v(3953),B=v(3656),X=v(4237),N=v(5547),U=v(8065),H=v(755),Y=v(4234),q=v(345),z=v(4020),W=v(9900);function J(o,c){1&o&&e.nrm(0,"ion-icon",39)}function Q(o,c){1&o&&e.nrm(0,"ion-icon",40)}function K(o,c){if(1&o){const a=e.RV6();e.j41(0,"ion-icon",41),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.toggle_thumbnail())}),e.k0s()}}function Z(o,c){if(1&o){const a=e.RV6();e.j41(0,"ion-icon",42),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.toggle_thumbnail())}),e.k0s()}}function ee(o,c){1&o&&(e.j41(0,"div",43),e.EFF(1,"Backspace "),e.k0s())}function te(o,c){1&o&&(e.j41(0,"div",44),e.EFF(1,"`"),e.k0s())}function ie(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",59),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3);return e.Njj(t.SetOtherAct())}),e.j41(1,"span",60),e.EFF(2),e.k0s()()}if(2&o){const a=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",a.displayDate," ")}}function ne(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",61),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.user_detail(t))}),e.nrm(1,"img",62),e.k0s()}if(2&o){const a=e.XpG(2).$implicit,i=e.XpG();e.R7$(),e.Aen(i.nakama.users[i.isOfficial][i.target][a.sender_id].online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.Y8G("src",i.nakama.users[i.isOfficial][i.target][a.sender_id].img||"assets/data/avatar.svg",e.B4B)}}function ae(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",63)(1,"span",64),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.user_detail(t))}),e.j41(2,"b")(3,"span"),e.EFF(4),e.k0s()()(),e.j41(5,"span",65),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3);return e.Njj(t.SetOtherAct())}),e.EFF(6),e.k0s()()}if(2&o){const a=e.XpG(2).$implicit,i=e.XpG();e.R7$(3),e.Aen("color: #"+(i.nakama.users[i.isOfficial][i.target][a.sender_id].online?a.color:"888")),e.R7$(),e.SpI(" ",i.nakama.usernameOverride[i.isOfficial][i.target][a.sender_id]||a.user_display_name||i.lang.text.Profile.noname_user,""),e.R7$(2),e.JRh(a.msgTime)}}function oe(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",66),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.JoinWebRTCMatch(t))}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG(3);e.R7$(),e.SpI(" ",a.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function se(o,c){if(1&o&&(e.j41(0,"div",71),e.nrm(1,"img",72),e.k0s()),2&o){const a=e.XpG(3).$implicit,i=e.XpG();e.R7$(),e.Aen(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.qoute.url,e.B4B)}}function le(o,c){if(1&o&&(e.j41(0,"div",73),e.EFF(1),e.k0s()),2&o){const a=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",a.content.qoute.text,"")}}function re(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",67),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.FindQoute(t.content.qoute.id,t.content.qoute.timestamp))}),e.j41(1,"div",68),e.EFF(2),e.k0s(),e.DNE(3,se,2,3,"div",69)(4,le,2,1,"div",70),e.k0s()}if(2&o){const a=e.XpG(2).$implicit,i=e.XpG();e.R7$(2),e.JRh(i.lang.text.ChatRoom.qouteMsg+": "+(a.content.qoute.username||a.content.qoute.display_name)),e.R7$(),e.Y8G("ngIf",a.content.qoute.url),e.R7$(),e.Y8G("ngIf",a.content.qoute.text)}}function ce(o,c){1&o&&(e.j41(0,"div",44),e.EFF(1,"Q"),e.k0s())}function _e(o,c){1&o&&e.nrm(0,"div",82)}function de(o,c){if(1&o&&(e.j41(0,"span",83),e.EFF(1),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.SpI(" ",a," ")}}function ue(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",78),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3).$implicit,n=e.XpG();return e.Njj(n.file_detail(t))}),e.DNE(1,ce,2,0,"div",17),e.j41(2,"p",79),e.EFF(3),e.k0s(),e.DNE(4,_e,1,0,"div",80)(5,de,2,1,"span",81),e.k0s()}if(2&o){const a=e.XpG(3),i=a.$implicit,t=a.index,n=e.XpG();e.Aen(n.info.HideAutoThumbnail?"filter: blur(6px);":""),e.R7$(),e.Y8G("ngIf",n.global.ShowHint&&!n.CheckIfFocusOnInput&&t==n.ViewableMessage.length-1),e.R7$(2),e.SpI(" ",i.content.filename," "),e.R7$(),e.Y8G("ngIf",i.content.text),e.R7$(),e.Y8G("ngForOf",i.content.text)}}function he(o,c){1&o&&(e.j41(0,"div",44),e.EFF(1,"Q"),e.k0s())}function ge(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",84),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3).$implicit,n=e.XpG();return e.Njj(n.file_detail(t))}),e.DNE(1,he,2,0,"div",17),e.nrm(2,"img",85),e.k0s()}if(2&o){const a=e.XpG(3),i=a.$implicit,t=a.index,n=e.XpG();e.R7$(),e.Y8G("ngIf",n.global.ShowHint&&!n.CheckIfFocusOnInput&&t==n.ViewableMessage.length-1),e.R7$(),e.Aen(n.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",i.content.thumbnail,e.B4B)("alt",i.content.filename)}}function me(o,c){if(1&o&&(e.j41(0,"div",86),e.EFF(1),e.k0s()),2&o){const a=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",a.content.transfer_index.index,"")}}function fe(o,c){if(1&o&&(e.j41(0,"div",74),e.DNE(1,ue,6,6,"div",75)(2,ge,3,5,"div",76)(3,me,2,1,"div",77),e.k0s()),2&o){const a=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf",!a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.transfer_index)}}function pe(o,c){if(1&o){const a=e.RV6();e.j41(0,"span",95),e.bIt("click",function(){e.eBV(a);const t=e.XpG(6);return e.Njj(t.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG().$implicit;e.Aen("font-size: "+(a.size||16)+"px"),e.R7$(),e.SpI(" ",a.text," ")}}function ve(o,c){if(1&o){const a=e.RV6();e.j41(0,"a",96),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,n=e.XpG(5);return e.Njj(n.open_url_link(t.text))}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function xe(o,c){if(1&o&&(e.j41(0,"span"),e.DNE(1,pe,2,3,"span",93)(2,ve,2,2,"a",94),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function be(o,c){if(1&o&&(e.j41(0,"div",91)(1,"span"),e.DNE(2,xe,3,2,"span",92),e.k0s()()),2&o){const a=c.$implicit;e.R7$(2),e.Y8G("ngForOf",a)}}function Re(o,c){if(1&o&&(e.j41(0,"div",97),e.EFF(1),e.k0s()),2&o){const a=e.XpG(4);e.R7$(),e.SpI(" ","("+a.lang.text.ChatRoom.MsgEdited+")","")}}function ke(o,c){if(1&o&&(e.j41(0,"div",87)(1,"div",88),e.DNE(2,be,3,1,"div",89),e.k0s(),e.DNE(3,Re,2,1,"div",90),e.k0s()),2&o){const a=e.XpG(2).$implicit;e.R7$(),e.Aen(a.content.msg[0]&&a.content.msg[0][0].size?"padding: 0; margin: 0":"background-color: #"+a.color+"88"),e.R7$(),e.Y8G("ngForOf",a.content.msg),e.R7$(),e.Y8G("ngIf",a.content.edited)}}function Ce(o,c){if(1&o&&(e.j41(0,"div",98),e.EFF(1),e.k0s()),2&o){const a=e.XpG(3);e.R7$(),e.SpI(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function Ie(o,c){if(1&o&&(e.j41(0,"div"),e.DNE(1,ie,3,1,"div",49),e.j41(2,"table")(3,"tr")(4,"td",50),e.DNE(5,ne,2,3,"div",51),e.k0s(),e.j41(6,"td"),e.DNE(7,ae,7,4,"div",52)(8,oe,2,1,"div",53)(9,re,5,3,"div",54)(10,fe,4,3,"div",55)(11,ke,4,4,"div",56),e.k0s()()(),e.j41(12,"div",57),e.DNE(13,Ce,2,1,"div",58),e.k0s()()),2&o){const a=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",a.showInfo&&a.showInfo.date),e.R7$(4),e.Y8G("ngIf",a.showInfo&&a.showInfo.sender),e.R7$(2),e.Y8G("ngIf",a.showInfo&&a.showInfo.sender),e.R7$(),e.Y8G("ngIf",a.content.match),e.R7$(),e.Y8G("ngIf",a.content.qoute),e.R7$(),e.Y8G("ngIf",a.content.filename),e.R7$(),e.Y8G("ngIf",a.content.msg),e.R7$(2),e.Y8G("ngIf",a.isLastRead)}}function we(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",59),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3);return e.Njj(t.SetOtherAct())}),e.j41(1,"span",60),e.EFF(2),e.k0s()()}if(2&o){const a=e.XpG(2).$implicit;e.R7$(2),e.SpI(" ",a.displayDate," ")}}function ye(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",63)(1,"span",106),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3);return e.Njj(t.SetOtherAct())}),e.EFF(2),e.k0s(),e.j41(3,"span",64),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.user_detail(t))}),e.j41(4,"b")(5,"span"),e.EFF(6),e.k0s()()()()}if(2&o){const a=e.XpG(2).$implicit,i=e.XpG();e.R7$(2),e.JRh(a.msgTime),e.R7$(3),e.Aen("color: #"+(i.nakama.users.self.online?a.color:"888")),e.R7$(),e.SpI(" ",a.user_display_name||i.lang.text.Profile.noname_user,"")}}function Me(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",107),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.JoinWebRTCMatch(t))}),e.j41(1,"div",108),e.EFF(2),e.k0s()()}if(2&o){const a=e.XpG(3);e.R7$(2),e.SpI(" ",a.lang.text.ChatRoom.JoinWebRTCMatch," ")}}function $e(o,c){if(1&o&&(e.j41(0,"div",71),e.nrm(1,"img",72),e.k0s()),2&o){const a=e.XpG(3).$implicit,i=e.XpG();e.R7$(),e.Aen(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.qoute.url,e.B4B)}}function Te(o,c){if(1&o&&(e.j41(0,"div",73),e.EFF(1),e.k0s()),2&o){const a=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",a.content.qoute.text,"")}}function Oe(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",67),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.FindQoute(t.content.qoute.id,t.content.qoute.timestamp))}),e.j41(1,"div",68),e.EFF(2),e.k0s(),e.DNE(3,$e,2,3,"div",69)(4,Te,2,1,"div",70),e.k0s()}if(2&o){const a=e.XpG(2).$implicit,i=e.XpG();e.R7$(2),e.JRh(i.lang.text.ChatRoom.qouteMsg+": "+(a.content.qoute.username||a.content.qoute.display_name)),e.R7$(),e.Y8G("ngIf",a.content.qoute.url),e.R7$(),e.Y8G("ngIf",a.content.qoute.text)}}function Fe(o,c){1&o&&(e.j41(0,"div",44),e.EFF(1,"Q"),e.k0s())}function Pe(o,c){1&o&&e.nrm(0,"div",82)}function Ve(o,c){if(1&o&&(e.j41(0,"span",83),e.EFF(1),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.SpI(" ",a," ")}}function Ge(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",78),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3).$implicit,n=e.XpG();return e.Njj(n.file_detail(t))}),e.DNE(1,Fe,2,0,"div",17),e.j41(2,"p",79),e.EFF(3),e.k0s(),e.DNE(4,Pe,1,0,"div",80)(5,Ve,2,1,"span",81),e.k0s()}if(2&o){const a=e.XpG(3),i=a.$implicit,t=a.index,n=e.XpG();e.Aen(n.info.HideAutoThumbnail?"filter: blur(6px);":""),e.R7$(),e.Y8G("ngIf",n.global.ShowHint&&!n.CheckIfFocusOnInput&&t==n.ViewableMessage.length-1),e.R7$(2),e.SpI(" ",i.content.filename," "),e.R7$(),e.Y8G("ngIf",i.content.text),e.R7$(),e.Y8G("ngForOf",i.content.text)}}function je(o,c){1&o&&(e.j41(0,"div",44),e.EFF(1,"Q"),e.k0s())}function Se(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",84),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3).$implicit,n=e.XpG();return e.Njj(n.file_detail(t))}),e.DNE(1,je,2,0,"div",17),e.nrm(2,"img",85),e.k0s()}if(2&o){const a=e.XpG(3),i=a.$implicit,t=a.index,n=e.XpG();e.R7$(),e.Y8G("ngIf",n.global.ShowHint&&!n.CheckIfFocusOnInput&&t==n.ViewableMessage.length-1),e.R7$(),e.Aen(n.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",i.content.thumbnail,e.B4B)("alt",i.content.filename)}}function Ee(o,c){if(1&o&&(e.j41(0,"div",86),e.EFF(1),e.k0s()),2&o){const a=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",a.content.transfer_index.index,"")}}function Ae(o,c){if(1&o&&(e.j41(0,"div",109),e.DNE(1,Ge,6,6,"div",75)(2,Se,3,5,"div",76)(3,Ee,2,1,"div",77),e.k0s()),2&o){const a=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf",!a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.transfer_index)}}function De(o,c){if(1&o&&(e.j41(0,"div",97),e.EFF(1),e.k0s()),2&o){const a=e.XpG(4);e.R7$(),e.SpI(" ","("+a.lang.text.ChatRoom.MsgEdited+")","")}}function Le(o,c){if(1&o){const a=e.RV6();e.j41(0,"span",95),e.bIt("click",function(){e.eBV(a);const t=e.XpG(6);return e.Njj(t.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG().$implicit;e.Aen("font-size: "+(a.size||16)+"px"),e.R7$(),e.SpI(" ",a.text," ")}}function Be(o,c){if(1&o){const a=e.RV6();e.j41(0,"a",96),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,n=e.XpG(5);return e.Njj(n.open_url_link(t.text))}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function Xe(o,c){if(1&o&&(e.j41(0,"span"),e.DNE(1,Le,2,3,"span",93)(2,Be,2,2,"a",94),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function Ne(o,c){if(1&o&&(e.j41(0,"div",91)(1,"span"),e.DNE(2,Xe,3,2,"span",92),e.k0s()()),2&o){const a=c.$implicit;e.R7$(2),e.Y8G("ngForOf",a)}}function Ue(o,c){if(1&o&&(e.j41(0,"div",110),e.DNE(1,De,2,1,"div",90),e.j41(2,"div",88),e.DNE(3,Ne,3,1,"div",89),e.k0s()()),2&o){const a=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf",a.content.edited),e.R7$(),e.Aen(a.content.msg[0]&&a.content.msg[0][0].size?"padding: 0; margin: 0":"background-color: #"+a.color+"88"),e.R7$(),e.Y8G("ngForOf",a.content.msg)}}function He(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",61),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.user_detail(t))}),e.nrm(1,"img",111),e.k0s()}if(2&o){const a=e.XpG(3);e.R7$(),e.Aen(a.nakama.users.self.online?"filter: grayscale(0) contrast(1);":"filter: grayscale(.9) contrast(1.4);"),e.Y8G("src",a.nakama.users.self.img||"assets/data/avatar.svg",e.B4B)}}function Ye(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",112),e.bIt("click",function(){e.eBV(a);const t=e.XpG(3);return e.Njj(t.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG(3);e.R7$(),e.SpI(" ",a.lang.text.ChatRoom.YouReadHereLast,"")}}function qe(o,c){if(1&o&&(e.j41(0,"div",99),e.DNE(1,we,3,1,"div",49),e.j41(2,"table",100)(3,"tr")(4,"td"),e.DNE(5,ye,7,4,"div",52)(6,Me,3,1,"div",101)(7,Oe,5,3,"div",54)(8,Ae,4,3,"div",102)(9,Ue,4,4,"div",103),e.k0s(),e.j41(10,"td",104),e.DNE(11,He,2,3,"div",51),e.k0s()()(),e.j41(12,"div",57),e.DNE(13,Ye,2,1,"div",105),e.k0s()()),2&o){const a=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",a.showInfo&&a.showInfo.date),e.R7$(4),e.Y8G("ngIf",a.showInfo&&a.showInfo.sender),e.R7$(),e.Y8G("ngIf",a.content.match),e.R7$(),e.Y8G("ngIf",a.content.qoute),e.R7$(),e.Y8G("ngIf",a.content.filename),e.R7$(),e.Y8G("ngIf",a.content.msg),e.R7$(2),e.Y8G("ngIf",a.showInfo&&a.showInfo.sender),e.R7$(2),e.Y8G("ngIf",a.isLastRead)}}function ze(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",113),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.SetOtherAct())}),e.j41(1,"div",114),e.EFF(2),e.k0s()()}if(2&o){const a=e.XpG().$implicit;e.R7$(2),e.SpI(" ",a.content.noti," ")}}function We(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",45),e.bIt("contextmenu",function(){const t=e.eBV(a).$implicit,n=e.XpG();return e.Njj(n.ChatBalloonContextMenu(t))})("mousedown",function(t){const n=e.eBV(a).$implicit,s=e.XpG();return e.Njj(s.ChatBalloonMouseDown(t,n))})("touchstart",function(t){const n=e.eBV(a).$implicit,s=e.XpG();return e.Njj(s.ChatBalloonOnTouchStart(t,n))}),e.DNE(1,Ie,14,8,"div",46)(2,qe,14,8,"div",47)(3,ze,3,1,"div",48),e.k0s()}if(2&o){const a=c.$implicit;e.Y8G("id",a.message_id),e.R7$(),e.Y8G("ngIf",!a.is_me&&!a.content.noti),e.R7$(),e.Y8G("ngIf",a.is_me&&!a.content.noti),e.R7$(),e.Y8G("ngIf",a.content.noti)}}function Je(o,c){if(1&o&&(e.j41(0,"div",71),e.nrm(1,"img",72),e.k0s()),2&o){const a=e.XpG(2).$implicit,i=e.XpG();e.R7$(),e.Aen(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.qoute.url,e.B4B)}}function Qe(o,c){if(1&o&&(e.j41(0,"div",73),e.EFF(1),e.k0s()),2&o){const a=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",a.content.qoute.text,"")}}function Ke(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",67),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,n=e.XpG();return e.Njj(n.FindQoute(t.content.qoute.id,t.content.qoute.timestamp))}),e.j41(1,"div",68),e.EFF(2),e.k0s(),e.DNE(3,Je,2,3,"div",69)(4,Qe,2,1,"div",70),e.k0s()}if(2&o){const a=e.XpG().$implicit,i=e.XpG();e.R7$(2),e.JRh(i.lang.text.ChatRoom.qouteMsg+": "+(a.content.qoute.username||a.content.qoute.display_name)),e.R7$(),e.Y8G("ngIf",a.content.qoute.url),e.R7$(),e.Y8G("ngIf",a.content.qoute.text)}}function Ze(o,c){1&o&&e.nrm(0,"div",82)}function et(o,c){if(1&o&&(e.j41(0,"span",83),e.EFF(1),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.SpI(" ",a," ")}}function tt(o,c){if(1&o&&(e.j41(0,"div",118)(1,"p",79),e.EFF(2),e.k0s(),e.DNE(3,Ze,1,0,"div",80)(4,et,2,1,"span",81),e.k0s()),2&o){const a=e.XpG(2).$implicit,i=e.XpG();e.Aen(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.R7$(2),e.SpI(" ",a.content.filename," "),e.R7$(),e.Y8G("ngIf",a.content.text),e.R7$(),e.Y8G("ngForOf",a.content.text)}}function it(o,c){if(1&o&&(e.j41(0,"div",119),e.nrm(1,"img",85),e.k0s()),2&o){const a=e.XpG(2).$implicit,i=e.XpG();e.R7$(),e.Aen(i.info.HideAutoThumbnail?"filter: blur(6px);":""),e.Y8G("src",a.content.thumbnail,e.B4B)("alt",a.content.filename)}}function nt(o,c){if(1&o&&(e.j41(0,"div",109),e.DNE(1,tt,5,5,"div",116)(2,it,2,4,"div",117),e.k0s()),2&o){const a=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",!a.content.thumbnail),e.R7$(),e.Y8G("ngIf",a.content.thumbnail)}}function at(o,c){if(1&o){const a=e.RV6();e.j41(0,"span",122),e.bIt("click",function(){e.eBV(a);const t=e.XpG(5);return e.Njj(t.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG().$implicit;e.Aen("font-size: "+(a.size||16)+"px"),e.R7$(),e.SpI(" ",a.text," ")}}function ot(o,c){if(1&o){const a=e.RV6();e.j41(0,"a",123),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,n=e.XpG(4);return e.Njj(n.open_url_link(t.text))}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function st(o,c){if(1&o&&(e.j41(0,"span"),e.DNE(1,at,2,3,"span",120)(2,ot,2,2,"a",121),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function lt(o,c){if(1&o&&(e.j41(0,"div",91)(1,"span"),e.DNE(2,st,3,2,"span",92),e.k0s()()),2&o){const a=c.$implicit;e.R7$(2),e.Y8G("ngForOf",a)}}function rt(o,c){if(1&o&&(e.j41(0,"div",110)(1,"div",88),e.DNE(2,lt,3,1,"div",89),e.k0s()()),2&o){const a=e.XpG().$implicit;e.R7$(),e.Aen(a.content.msg[0]&&a.content.msg[0][0].size?"padding: 0; margin: 0":"background-color: #8888"),e.R7$(),e.Y8G("ngForOf",a.content.msg)}}function ct(o,c){if(1&o&&(e.j41(0,"div",115),e.DNE(1,Ke,5,3,"div",54)(2,nt,3,2,"div",102)(3,rt,3,3,"div",103),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",a.content.qoute),e.R7$(),e.Y8G("ngIf",a.content.filename),e.R7$(),e.Y8G("ngIf",a.content.msg)}}function _t(o,c){if(1&o&&(e.j41(0,"div",125),e.EFF(1),e.k0s()),2&o){const a=e.XpG(2);e.R7$(),e.JRh(a.userInput.qoute.text)}}function dt(o,c){if(1&o&&(e.j41(0,"div",128),e.nrm(1,"img",72),e.k0s()),2&o){const a=e.XpG(2);e.R7$(),e.Aen("max-height: 84px;"+(a.info.HideAutoThumbnail?"filter: blur(6px);":"")),e.Y8G("src",a.userInput.qoute.url,e.B4B)}}function ut(o,c){if(1&o){const a=e.RV6();e.j41(0,"tr",124),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.RemoveQoute())}),e.j41(1,"div",125),e.EFF(2),e.k0s(),e.DNE(3,_t,2,1,"div",126)(4,dt,2,3,"div",127),e.k0s()}if(2&o){const a=e.XpG();e.R7$(2),e.SpI("",a.lang.text.ChatRoom.qouteMsg+": "+(a.userInput.qoute.username||a.userInput.qoute.display_name)," "),e.R7$(),e.Y8G("ngIf",a.userInput.qoute.text),e.R7$(),e.Y8G("ngIf",a.userInput.qoute.url)}}function ht(o,c){if(1&o&&(e.j41(0,"div",128),e.nrm(1,"img",72),e.k0s()),2&o){const a=e.XpG(2);e.R7$(),e.Aen("max-height: 84px;"+(a.info.HideAutoThumbnail?"filter: blur(6px);":"")),e.Y8G("src",a.IsMsgEditMode.thumbnail,e.B4B)}}function gt(o,c){if(1&o){const a=e.RV6();e.j41(0,"tr",124),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.IsMsgEditMode=void 0)}),e.j41(1,"div",125),e.EFF(2),e.k0s(),e.DNE(3,ht,2,3,"div",127),e.k0s()}if(2&o){const a=e.XpG();e.R7$(2),e.SpI("",a.lang.text.ChatRoom.EditChat+": "+a.IsMsgEditMode.msg_string," "),e.R7$(),e.Y8G("ngIf",a.IsMsgEditMode.thumbnail)}}function mt(o,c){if(1&o&&e.nrm(0,"img",135),2&o){const a=e.XpG(4);e.Y8G("src",a.userInput.file.thumbnail,e.B4B)("alt",a.userInput.file.name)}}function ft(o,c){if(1&o&&(e.j41(0,"div"),e.DNE(1,mt,1,2,"img",134),e.k0s()),2&o){const a=e.XpG(3);e.R7$(),e.Y8G("ngIf","image"==a.userInput.file.viewer)}}function pt(o,c){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.SpI(" ",a," ")}}function vt(o,c){if(1&o&&(e.j41(0,"div",136),e.DNE(1,pt,2,1,"span",92),e.k0s()),2&o){const a=e.XpG(3);e.R7$(),e.Y8G("ngForOf",a.userInput.file.thumbnail)}}function xt(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",131),e.bIt("click",function(){e.eBV(a);const t=e.XpG(2);return e.Njj(t.removeAttach())}),e.j41(1,"div",132),e.EFF(2),e.k0s(),e.DNE(3,ft,2,1,"div",46)(4,vt,2,1,"div",133),e.k0s()}if(2&o){const a=e.XpG(2);e.R7$(2),e.SpI(" ",a.userInput.file.filename," "),e.R7$(),e.Y8G("ngIf",a.userInput.file.thumbnail),e.R7$(),e.Y8G("ngIf","code"==a.userInput.file.viewer||"text"==a.userInput.file.viewer)}}function bt(o,c){if(1&o&&(e.j41(0,"tr",129)(1,"td"),e.DNE(2,xt,5,3,"div",130),e.k0s()()),2&o){const a=e.XpG();e.R7$(2),e.Y8G("ngIf",a.userInput.file)}}function Rt(o,c){1&o&&(e.j41(0,"div",140),e.EFF(1," Enter"),e.k0s())}function kt(o,c){if(1&o){const a=e.RV6();e.j41(0,"tr",137),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.scroll_down_logs())}),e.j41(1,"td",138),e.DNE(2,Rt,2,0,"div",139),e.EFF(3),e.k0s()()}if(2&o){const a=e.XpG();e.R7$(2),e.Y8G("ngIf",a.global.ShowHint&&a.CheckIfFocusOnInput),e.R7$(),e.SpI(" ",a.lang.text.ChatRoom.GoToRecent," ")}}function Ct(o,c){if(1&o){const a=e.RV6();e.j41(0,"span",95),e.bIt("click",function(){e.eBV(a);const t=e.XpG(4);return e.Njj(t.SetOtherAct())}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG().$implicit;e.R7$(),e.SpI(" ",a.text," ")}}function It(o,c){if(1&o){const a=e.RV6();e.j41(0,"a",96),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,n=e.XpG(3);return e.Njj(n.open_url_link(t.text))}),e.EFF(1),e.k0s()}if(2&o){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function wt(o,c){if(1&o&&(e.j41(0,"span"),e.DNE(1,Ct,2,1,"span",142)(2,It,2,2,"a",94),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function yt(o,c){if(1&o&&(e.j41(0,"span"),e.DNE(1,wt,3,2,"span",92),e.k0s()),2&o){const a=c.$implicit;e.R7$(),e.Y8G("ngForOf",a)}}function Mt(o,c){if(1&o){const a=e.RV6();e.j41(0,"tr",137),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.scroll_down_logs())}),e.j41(1,"td",141)(2,"span")(3,"b"),e.EFF(4),e.k0s()(),e.DNE(5,yt,2,1,"span",92),e.k0s()()}if(2&o){const a=e.XpG();e.R7$(2),e.Aen("margin-right: 8px; color: #"+a.last_message_viewer.color),e.R7$(2),e.JRh((a.last_message_viewer.is_me?a.nakama.users.self.display_name:a.nakama.users[a.isOfficial][a.target][a.last_message_viewer.user_id].display_name)||a.lang.text.Profile.noname_user),e.R7$(),e.Y8G("ngForOf",a.last_message_viewer.message)}}function $t(o,c){1&o&&(e.j41(0,"div",143),e.EFF(1,"E"),e.k0s())}function Tt(o,c){1&o&&(e.j41(0,"div",143),e.EFF(1,"Enter "),e.k0s())}function Ot(o,c){1&o&&(e.j41(0,"div",143),e.EFF(1,"Backspace "),e.k0s())}function Ft(o,c){if(1&o&&(e.j41(0,"div",149),e.EFF(1),e.k0s()),2&o){const a=e.XpG().$implicit;e.R7$(),e.SpI(" ",a.index,"")}}function Pt(o,c){if(1&o&&e.nrm(0,"ion-icon",150),2&o){const a=e.XpG().$implicit;e.Y8G("name",a.icon||"close-circle")}}function Vt(o,c){if(1&o&&e.nrm(0,"img",151),2&o){const a=e.XpG().$implicit;e.Y8G("src","assets/icon/"+a.icon_img,e.B4B)("alt",a.title)}}function Gt(o,c){if(1&o){const a=e.RV6();e.j41(0,"div",144)(1,"div",145),e.bIt("click",function(){const t=e.eBV(a).$implicit;return e.Njj(t.act())})("contextmenu",function(){const t=e.eBV(a).$implicit;return e.Njj(t.context?t.context():null)}),e.DNE(2,Ft,2,1,"div",146)(3,Pt,1,1,"ion-icon",147)(4,Vt,1,2,"img",148),e.j41(5,"div"),e.EFF(6),e.k0s()()()}if(2&o){const a=c.$implicit,i=e.XpG();e.R7$(),e.Aen("cursor: "+(a.cursor||"pointer")+";"),e.Y8G("hidden",a.isHide),e.R7$(),e.Y8G("ngIf",i.global.ShowHint&&!i.CheckIfFocusOnInput),e.R7$(),e.Y8G("ngIf",a.icon),e.R7$(),e.Y8G("ngIf",a.icon_img),e.R7$(2),e.JRh(a.name)}}const jt=[{path:"",component:(()=>{var o;class c{constructor(i,t,n,s,r,_,d,h,p,y,C,R,m,x){var f,l=this;this.navCtrl=i,this.route=t,this.router=n,this.nakama=s,this.noti=r,this.statusBar=_,this.indexed=d,this.lang=h,this.sanitizer=p,this.global=y,this.loadingCtrl=C,this.webrtc=R,this.p5toast=m,this.alertCtrl=x,this.info={},this.foundLastRead=!1,this.messages=[],this.sending_msg=[],this.temporary_open_thumbnail={},this.extended_buttons=[{icon:"settings-outline",name:this.lang.text.ChatRoom.ExtSettings,act:()=>{if(3!=this.info.redirect.type)this.extended_buttons[0].isHide=!0;else try{this.nakama.open_group_detail({info:this.nakama.groups[this.isOfficial][this.target][this.info.group_id],server:{isOfficial:this.isOfficial,target:this.target}})}catch{this.p5toast.show({text:this.lang.text.ChatRoom.AlreadyRemoved})}}},{icon:"hammer-outline",name:this.lang.text.ChatRoom.ExtSoloImage,isHide:!0,act:(f=(0,g.A)(function*(){if(l.info.info.img)delete l.info.info.img,l.indexed.removeFileFromUserPath(`servers/${l.info.server.isOfficial}/${l.info.server.target}/groups/${l.info.id}.img`),l.p5toast.show({text:l.lang.text.ChatRoom.LocalImageRemoved});else try{let u=yield l.global.GetValueFromClipboard();switch(u.type){case"image/png":l.LocalChannelImageChanged({target:{files:[u.value]}});break;case"text/plain":yield l.check_if_clipboard_available(u.value)}}catch{document.getElementById("local_channel").click()}}),function(){return f.apply(this,arguments)}),context:()=>(document.getElementById("local_channel").click(),!1)},{icon:"image-outline",name:this.lang.text.ChatRoom.BackgroundImage,act:function(){var f=(0,g.A)(function*(){if(l.HasBackgroundImage)l.RemoveChannelBackgroundImage();else try{let u=yield l.global.GetValueFromClipboard();switch(u.type){case"image/png":l.ChangeBackgroundImage({target:{files:[u.value]}});break;case"text/plain":yield l.check_if_clipboard_available(u.value)}}catch{document.getElementById("backgroundImage_sel").click()}});return function(){return f.apply(this,arguments)}}(),context:()=>(document.getElementById("backgroundImage_sel").click(),!1)},{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:()=>{this.new_attach({detail:{value:"load"}})},context:()=>(this.new_attach({detail:{value:"link"}}),!1)},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:function(){var f=(0,g.A)(function*(){let k,u={};if(l.userInput.file)switch(l.userInput.file.typeheader){case"image":try{l.userInput.file.url&&(l.userInput.file.blob=yield fetch(l.userInput.file.url,{signal:l.cont.signal}).then($=>$.blob()));let b=`tmp_files/chatroom/attached.${l.userInput.file.file_ext}`;yield l.indexed.saveBlobToUserPath(l.userInput.file.blob,b);let w=document.getElementById("ChatroomSelectedImage");u.path=b,u.width=w.naturalWidth,u.height=w.naturalHeight,k=l.userInput.file.content_related_creator}catch(b){return void l.p5toast.show({text:`${l.lang.text.ContentViewer.CannotEditFile}: ${b}`})}break;case"text":u.text=l.userInput.file.thumbnail}l.global.PageDismissAct["chatroom-voiddraw"]=b=>{b.data&&l.voidDraw_fileAct_callback(b,k),delete l.global.PageDismissAct["chatroom-voiddraw"]},u.dismiss="chatroom-voiddraw",l.global.ActLikeModal("void-draw",u)});return function(){return f.apply(this,arguments)}}()},{icon:"reader-outline",name:this.lang.text.ChatRoom.newText,act:function(){var f=(0,g.A)(function*(){let u={info:{content:{is_new:void 0,type:"text/plain",viewer:"text",filename:void 0,path:void 0}},no_edit:void 0};if(l.userInput.file)switch(l.userInput.file.viewer){case"code":case"text":let k="tmp_files/chatroom/edit_text.txt";yield l.indexed.saveBlobToUserPath(l.userInput.file.blob,k),u.info.content.path=k,u.info.content.type=l.userInput.file.type,u.info.content.viewer=l.userInput.file.viewer,u.info.content.filename=l.userInput.file.filename||l.userInput.file.name}else u.info.content.is_new="text",u.info.content.filename=l.global.TextEditorNewFileName(),u.no_edit=!0;l.global.PageDismissAct["chatroom-ionicviewer"]=k=>{if(k.data){let b=l.global.TextEditorAfterAct(k.data,{display_name:l.nakama.users.self.display_name});l.userInput.file=b,l.CancelEditText(),l.create_thumbnail_imported(b)}delete l.global.PageDismissAct["chatroom-ionicviewer"]},u.dismiss="chatroom-ionicviewer",l.global.ActLikeModal("ionic-viewer",u)});return function(){return f.apply(this,arguments)}}()},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:function(){var f=(0,g.A)(function*(){let u=yield l.loadingCtrl.create({message:l.lang.text.TodoDetail.WIP});u.present();try{let k=yield l.global.from_camera("tmp_files/chatroom/",{user_id:l.info.local?"local":l.nakama.servers[l.isOfficial][l.target].session.user_id,display_name:l.nakama.users.self.display_name});l.userInput.file=k,l.CancelEditText()}catch{}u.dismiss()});return function(){return f.apply(this,arguments)}}()},{icon:"mic-circle-outline",name:this.lang.text.ChatRoom.Voice,act:function(){var f=(0,g.A)(function*(){if(l.useVoiceRecording=!l.useVoiceRecording,l.useVoiceRecording)(yield T.R.hasAudioRecordingPermission()).value?(l.extended_buttons[7].icon="stop-circle-outline",l.extended_buttons[7].name=l.lang.text.ChatRoom.VoiceStop,yield T.R.startRecording(),l.p5toast.show({text:l.lang.text.ChatRoom.StartVRecord})):yield T.R.requestAudioRecordingPermission();else{let u=yield T.R.stopRecording(),k=l.global.Base64ToBlob(`${u.value.mimeType},${u.value.recordDataBase64}`);k.name=`${l.lang.text.ChatRoom.VoiceRecord}.${u.value.mimeType.split("/").pop().split(";")[0]}`,k.type_override=u.value.mimeType,l.selected_blobFile_callback_act(k),l.extended_buttons[7].icon="mic-circle-outline",l.extended_buttons[7].name=l.lang.text.ChatRoom.Voice}});return function(){return f.apply(this,arguments)}}()},{icon:"cloud-done-outline",name:this.lang.text.ChatRoom.Detour,act:()=>{this.toggle_custom_attach(),this.nakama.save_channels_with_less_info()}},{icon:"call-outline",name:this.lang.text.ChatRoom.VoiceChat,act:function(){var f=(0,g.A)(function*(){try{yield l.webrtc.initialize("audio",void 0,{isOfficial:l.isOfficial,target:l.target,channel_id:l.info.id,user_id:l.info.info.id||l.info.info.user_id}),l.webrtc.CurrentMatch=yield l.nakama.servers[l.isOfficial][l.target].socket.createMatch(),yield l.nakama.servers[l.isOfficial][l.target].socket.writeChatMessage(l.info.id,{match:l.webrtc.CurrentMatch.match_id}),l.scroll_down_logs(),l.webrtc.CreateOffer()}catch(u){l.p5toast.show({text:`${l.lang.text.ChatRoom.JoinMatchFailed}: ${u}`})}});return function(){return f.apply(this,arguments)}}()},{icon:"volume-mute-outline",name:this.lang.text.ChatRoom.ReadText,act:function(){var f=(0,g.A)(function*(){l.toggle_speakermode()});return function(){return f.apply(this,arguments)}}()},{icon:"log-out-outline",name:this.lang.text.ChatRoom.LogOut,act:function(){var f=(0,g.A)(function*(){if(3!=l.info.redirect.type)try{yield l.nakama.servers[l.isOfficial][l.target].socket.leaveChat(l.info.id),l.nakama.channels_orig[l.isOfficial][l.target][l.info.id].status="missing",l.extended_buttons.forEach(u=>{u.isHide=!0}),l.extended_buttons[12].isHide=!1}catch(u){console.error("\ucc44\ub110\uc5d0\uc11c \ub098\uc624\uae30 \uc2e4\ud328: ",u)}else l.extended_buttons[11].isHide=!0});return function(){return f.apply(this,arguments)}}()},{isHide:!0,name:this.lang.text.ChatRoom.RemoveHistory,icon:"close-circle-outline",act:()=>{this.alertCtrl.create({header:this.lang.text.ChatRoom.RemoveChannel,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.ChatRoom.Delete,handler:function(){var f=(0,g.A)(function*(){let u=yield l.loadingCtrl.create({message:l.lang.text.TodoDetail.WIP});u.present(),delete l.nakama.channels_orig[l.isOfficial][l.target][l.info.id];try{switch(l.info.redirect.type){case 3:yield l.nakama.remove_group_list(l.nakama.groups[l.isOfficial][l.target][l.info.group_id]||l.info.info,l.isOfficial,l.target,!0);break;case 0:yield l.indexed.removeFileFromUserPath(`servers/${l.isOfficial}/${l.target}/groups/${l.info.id}.img`)}}catch(b){console.log("\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \uc0ad\uc81c \uc624\ub958: ",b)}try{delete l.nakama.groups[l.isOfficial][l.target][l.info.group_id]}catch(b){console.log("DeleteGroupFailed: ",b)}l.nakama.save_groups_with_less_info();try{let b=localStorage.getItem("fallback_fs");if(!b)throw"\uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc11c\ubc84 \uc5c6\uc74c";let w=b.split("://"),$=w.pop().split(":"),P=w.pop();P?P+=":":P=l.global.checkProtocolFromAddress($[0])?"https:":"http:";let At=`${P}//${$[0]}:${$[1]||9002}/`,A=`${l.info.id}_${l.nakama.users.self.display_name}`;try{A=`${l.info.info.id}_${l.nakama.servers[l.isOfficial][l.target].session.user_id}`}catch{}l.global.remove_files_from_storage_with_key(At,A)}catch{}try{l.global.remove_files_from_storage_with_key(`${[l.info.info.server.useSSL?"https:":"http:"]}//${l.info.info.server.address}:9002/`,`${l.info.info.id}_${l.nakama.servers[l.isOfficial][l.target].session.user_id}`)}catch{}let k=yield l.indexed.GetFileListFromDB(`servers/${l.isOfficial}/${l.target}/channels/${l.info.id}`);for(let b=0,w=k.length;b<w;b++)u.message=`${l.lang.text.UserFsDir.DeleteFile}: ${w-b}`,yield l.indexed.removeFileFromUserPath(k[b]);u.dismiss(),l.navCtrl.pop()});return function(){return f.apply(this,arguments)}}(),cssClass:"redfont"}]}).then(f=>{this.global.StoreShortCutAct("chatroom-alert"),this.global.p5KeyShortCut.Escape=()=>{f.dismiss()},f.onDidDismiss().then(()=>{this.global.RestoreShortCutAct("chatroom-alert")}),f.present()})}}],this.useVoiceRecording=!1,this.useFirstCustomCDN=0,this.HasBackgroundImage=!1,this.next_cursor="",this.prev_cursor="",this.file_sel_id="file_sel_id",this.ShowGoToBottom=!1,this.isMobile=!1,this.WillLeave=!1,this.InitWithFileImport=!1,this.InitWithRoomEnv=!1,this.BlockAutoScrollDown=!1,this.last_message_viewer={user_id:void 0,message:void 0,color:void 0,is_me:void 0},this.userInput={file:void 0,text:"",qoute:void 0},this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.pullable=!0,this.ViewableMessage=[],this.ViewMsgIndex=0,this.RefreshCount=15,this.ViewCount=45,this.ShowRecentMsg=!1,this.useSpeaker=!1,this.isSpeeching=!1,this.SpeechThese=[],this.isHistoryLoaded=!1,this.LocalHistoryList=[],this.isHidden=!0,this.CheckIfFocusOnInput=!1,this.ChannelUserInputId="ChannelUserInputId",this.block_send=!1,this.isOtherAct=!1,this.lock_modal_open=!1}WaitingCurrent(){var i=this;return(0,g.A)(function*(){for(;i.WillLeave;)yield new Promise(t=>setTimeout(t,0))})()}check_if_clipboard_available(i){var t=this;return(0,g.A)(function*(){try{if(0!=i.indexOf("http"))throw"URL \uc8fc\uc18c\uac00 \uc544\ub2d8";yield new Promise((n,s)=>{let r=document.createElement("img");r.src=i,r.onload=()=>{t.info.info.img=i,r.onload=null,r.onerror=null,r.remove(),n(void 0)},r.onerror=()=>{r.onload=null,r.onerror=null,r.remove(),s()}})}catch{try{if(0!=i.indexOf("data:image"))throw"DataURL \uc8fc\uc18c\uac00 \uc544\ub2d8";t.nakama.limit_image_size(i,s=>{t.info.info.img=s.canvas.toDataURL(),t.indexed.saveTextFileToUserPath(t.info.info.img,`servers/${t.info.server.isOfficial}/${t.info.server.target}/groups/${t.info.id}.img`),t.p5toast.show({text:t.lang.text.ChatRoom.LocalImageChanged})})}catch{throw"\uc0ac\uc6a9\ubd88\uac00 \uc774\ubbf8\uc9c0"}}})()}ionViewDidEnter(){T.R.getCurrentStatus().then(i=>{"RECORDING"==i.status&&(this.extended_buttons[7].isHide=!0)}),this.lock_modal_open=!1,this.init_noties(),this.AddShortCut()}new_attach(i,t=void 0){var n=this;return(0,g.A)(function*(){switch(void 0===t&&(t={}),i.detail.value){case"load":document.getElementById(n.file_sel_id).click();break;case"link":try{let s=t.url;if(!n.userInput.file&&void 0===s)try{let d=yield n.global.GetValueFromClipboard();switch(d.type){case"text/plain":s=d.value;break;case"image/png":return void n.inputFileSelected({target:{files:[d.value]}})}}catch(d){throw d}try{let d=n.global.Base64ToBlob(s),h=s.split(";")[0].split(":")[1],p=new File([d],`${n.lang.text.ChatRoom.FileLink}.${h.split("/").pop()}`,{type:h});throw yield n.selected_blobFile_callback_act(p),"done"}catch(d){if("done"===d)throw d}try{if(0!=s.indexOf("http:")&&0!=s.indexOf("https:"))throw"\uc62c\ubc14\ub978 \uc6f9 \uc8fc\uc18c\uac00 \uc544\ub2d8";if(n.userInput.file&&void 0===t.filename)throw"\uc774\ubbf8 \ud30c\uc77c\uc774 \ucca8\ubd80\ub428, \ud1a0\uae00\ub9cc \uc2dc\ub3c4"}catch(d){throw d}let r={};r.url=s,r.content_related_creator=[],t&&t.content_related_creator&&(r.content_related_creator=[...t.content_related_creator]),r.content_related_creator.push({user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:t.url?"shared":"link"}),r.content_creator={user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,timestamp:(new Date).getTime(),display_name:n.nakama.users.self.display_name,various:t.url?"shared":"link"};let _=r.url.split(".");r.file_ext=t.file_ext||_.pop().split("?").shift(),r.filename=t.filename||decodeURIComponent(`${_.pop().split("/").pop()||n.lang.text.ChatRoom.ExternalLinkFile}.${r.file_ext}`),r.filename=r.filename.split("_").pop(),n.global.set_viewer_category_from_ext(r),r.type=t.type||"",r.typeheader=t.typeheader||r.viewer,n.global.modulate_thumbnail(r,r.url,n.cont),n.NeedScrollDown()&&setTimeout(()=>{n.scroll_down_logs()},100),n.userInput.file=r,n.CancelEditText(),n.inputPlaceholder=`(${n.lang.text.ChatRoom.FileLink}: ${n.userInput.file.filename})`}catch(s){throw"done"==s?s:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${s}`}}})()}toggle_custom_attach(i){var t=this;return(0,g.A)(function*(){switch(t.useFirstCustomCDN=(null!=i?i:t.useFirstCustomCDN+1)%(0==t.info.redirect.type?2:3),"Android"==M.aH&&(t.useFirstCustomCDN=2,t.extended_buttons[8].isHide=!0),t.useFirstCustomCDN){case 0:t.extended_buttons[8].icon="cloud-offline-outline",t.extended_buttons[8].name=t.lang.text.ChatRoom.Detour;break;case 1:t.extended_buttons[8].icon="cloud-done-outline",t.extended_buttons[8].name=t.lang.text.ChatRoom.useFSS;break;case 2:t.extended_buttons[8].icon="server-outline",t.extended_buttons[8].name=t.lang.text.ChatRoom.forceSQL}t.info.CDN=t.useFirstCustomCDN})()}toggle_speakermode(i){var t=this;return(0,g.A)(function*(){if(t.useSpeaker=null!=i?i:!t.useSpeaker,t.extended_buttons[10].icon=t.useSpeaker?"volume-high-outline":"volume-mute-outline",t.useSpeaker?localStorage.setItem("useChannelSpeaker",`${t.useSpeaker}`):localStorage.removeItem("useChannelSpeaker"),!t.useSpeaker)try{yield E.stop()}catch{}})()}LoadChannelBackgroundImage(){var i=this;return(0,g.A)(function*(){try{let t=yield i.indexed.loadBlobFromUserPath(`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/backgroundImage.png`,"");i.ChangeBackgroundImage({target:{files:[t]}}),i.HasBackgroundImage=!0}catch{}})()}RemoveChannelBackgroundImage(){var i=this;return(0,g.A)(function*(){try{yield i.indexed.removeFileFromUserPath(`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/backgroundImage.png`),document.getElementById("main_table").style.backgroundImage='url("")'}catch{}i.HasBackgroundImage=!1})()}ChangeBackgroundImage(i){try{let t=document.getElementById("main_table"),n=i.target.files[0],s=URL.createObjectURL(n);t.style.backgroundImage=`url('${s}')`,this.indexed.saveBlobToUserPath(n,`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/backgroundImage.png`),this.HasBackgroundImage=!0,setTimeout(()=>{URL.revokeObjectURL(s)},100)}catch{}}inputFileSelected(i){var t=this;return(0,g.A)(function*(){if(i.target.files.length)if(1!=i.target.files.length){let s=yield t.alertCtrl.create({header:t.lang.text.ChatRoom.MultipleSend,message:`${t.lang.text.ChatRoom.CountFile}: ${i.target.files.length}`,buttons:[{text:t.lang.text.ChatRoom.Send,handler:(r=(0,g.A)(function*(){let _=yield t.loadingCtrl.create({message:t.lang.text.ChatRoom.MultipleSend});_.present();for(let d=0,h=i.target.files.length;d<h;d++)_.message=`${h-d}: ${i.target.files[d].name}`,yield t.selected_blobFile_callback_act(i.target.files[d]),yield t.send();t.noti.ClearNoti(7),_.dismiss()}),function(){return r.apply(this,arguments)})}]});t.global.StoreShortCutAct("chatroom-alert"),t.global.p5KeyShortCut.Escape=()=>{s.dismiss()},s.onDidDismiss().then(()=>{setTimeout(()=>{t.scroll_down_logs(),document.getElementById(t.file_sel_id).value=""},300),t.global.RestoreShortCutAct("chatroom-alert")}),s.present()}else{let s=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});s.present(),yield t.selected_blobFile_callback_act(i.target.files[0]),s.dismiss(),document.getElementById(t.file_sel_id).value=""}else delete t.userInput.file,t.inputPlaceholder=t.lang.text.ChatRoom.input_placeholder,document.getElementById(t.file_sel_id).value="";var r})()}LocalChannelImageChanged(i){var t=this;return(0,g.A)(function*(){let n=yield t.global.GetBase64ThroughFileReader(i.target.files[0]);t.nakama.limit_image_size(n,s=>{t.info.info.img=s.canvas.toDataURL(),t.indexed.saveTextFileToUserPath(t.info.info.img,`servers/${t.info.server.isOfficial}/${t.info.server.target}/groups/${t.info.id}.img`),t.p5toast.show({text:t.lang.text.ChatRoom.LocalImageChanged})})})()}ngOnInit(){var i=this;this.global.WindowOnBlurAct.chatroom=()=>{this.ChatManageMenu&&this.ChatManageMenu.dismiss()},this.useSpeaker=!!localStorage.getItem("useChannelSpeaker"),this.toggle_speakermode(this.useSpeaker);try{this.ChatLogs=document.getElementById("chatroom_div"),this.ChatLogs.onscroll=t=>{let n=this.ChatLogs.scrollHeight-(this.ChatLogs.scrollTop+this.ChatLogs.clientHeight)<this.ChatLogs.scrollHeight/4;n&&(this.ShowGoToBottom||this.ShowRecentMsg||this.init_last_message_viewer(),this.ShowRecentMsg&&!this.BlockAutoScrollDown&&this.pull_msg_history(!1)),this.ShowGoToBottom=!n||this.ShowRecentMsg}}catch(t){console.log("\ucc44\ud305 \ub85c\uadf8 \uac1c\uccb4 \ud589\ub3d9 \uc624\ub958: ",t)}this.nakama.ChatroomLinkAct=function(){var t=(0,g.A)(function*(n,s){try{delete i.nakama.channels_orig[i.isOfficial][i.target][i.info.id].update}catch{}i.info=n,i.InitWithFileImport=!!s,i.InitWithRoomEnv=!0,i.userInput.file=s,yield i.init_chatroom(),i.CancelEditText(),i.userInput.file&&i.create_thumbnail_imported(s)});return function(n,s){return t.apply(this,arguments)}}(),this.route.queryParams.subscribe(function(){var t=(0,g.A)(function*(n){try{const s=i.router.getCurrentNavigation().extras.state;s&&(i.info=s.info),yield new Promise(r=>setTimeout(r,100)),i.InitWithFileImport=!1,i.InitWithRoomEnv=!!s,i.userInput.file&&(i.userInput.file=s.file,i.CancelEditText(),i.create_thumbnail_imported(s.file)),yield i.init_chatroom()}catch{}});return function(n){return t.apply(this,arguments)}}()),setTimeout(()=>{this.WillLeave||this.CreateDrop()},100),this.isMobile="Android"==M.aH||"iOS"==M.aH,this.nakama.StatusBarChangedCallback=(0,g.A)(function*(){yield i.SetExtensionButtons()})}ionViewWillEnter(){this.WillLeave=!1,this.ChatContDiv=document.getElementById("chatroom_content_div"),this.userInputTextArea||(this.userInputTextArea=document.getElementById(this.ChannelUserInputId)),this.userInputTextArea.onblur||(this.userInputTextArea.onblur=()=>{this.CheckIfFocusOnInput=!1}),this.userInputTextArea.onfocus||(this.userInputTextArea.onfocus=()=>{this.CheckIfFocusOnInput=!0}),this.userInputTextArea.onpaste=i=>{let t=[];for(const n of i.clipboardData.files)t.push({file:n});if(t.length)return 1==t.length?this.selected_blobFile_callback_act(t[0].file):this.alertCtrl.create({header:this.lang.text.ChatRoom.MultipleSend,message:`${this.lang.text.ChatRoom.CountFile}: ${t.length}`,buttons:[{text:this.lang.text.ChatRoom.Send,handler:()=>{this.DropSendAct(t)}}]}).then(n=>{this.global.StoreShortCutAct("chatroom-alert"),n.onDidDismiss().then(()=>{this.global.RestoreShortCutAct("chatroom-alert")}),n.present()}),!1}}AddShortCut(){if(!this.global.p5KeyShortCut)return;this.global.p5KeyShortCut.Backspace=()=>{document.activeElement==document.getElementById(this.ChannelUserInputId)?this.userInput.text||this.userInputTextArea.blur():this.ChatLogs.scrollTo({top:0,behavior:"smooth"})},this.global.p5KeyShortCut.Backquote=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)&&(this.ChatLogs.scrollTo({top:0,behavior:"smooth"}),void 0===this.next_cursor&&!this.ViewMsgIndex||!this.pullable||this.pull_msg_history())},this.global.p5KeyShortCut.Escape=()=>{this.navCtrl.pop()},this.global.p5KeyShortCut.BottomTab=t=>{if(document.activeElement!=document.getElementById(this.ChannelUserInputId))switch(t){case"Q":this.open_last_file();break;case"E":this.open_ext_with_delay()}};let i=[];for(let t=0,n=this.extended_buttons.length;t<n;t++)this.extended_buttons[t].isHide||i.push(this.extended_buttons[t]);this.global.p5KeyShortCut.Digit=t=>{!this.isHidden&&document.activeElement!=document.getElementById(this.ChannelUserInputId)&&i.length>t&&i[t].act()},this.global.p5KeyShortCut.EnterAct=()=>{document.activeElement!=document.getElementById(this.ChannelUserInputId)?setTimeout(()=>{this.WillLeave||(this.make_ext_hidden(),this.userInputTextArea.focus())},0):this.userInput.text||this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}}open_last_file(){for(let i=this.ViewableMessage.length-1;i>=0;i--)if(this.ViewableMessage[i].content.filename){this.open_viewer(this.ViewableMessage[i],this.ViewableMessage[i].content.url||this.ViewableMessage[i].content.path);break}}init_noties(){this.noti.Current=this.info.cnoti_id,this.info.cnoti_id&&this.noti.ClearNoti(this.info.cnoti_id),this.isOtherAct=!1,this.useFirstCustomCDN=this.info.CDN||0,this.toggle_custom_attach(this.useFirstCustomCDN)}CreateDrop(){var i=this;let t=document.getElementById("p5Drop_chatroom");this.p5canvas=new j(n=>{n.setup=()=>{let m=n.createCanvas(t.clientWidth,t.clientHeight);m.parent(t),n.pixelDensity(.1),m.drop(x=>{let l=n.millis();_<l-400?(r=!1,d.length=0,d.push(x)):(r=!0,d.push(x)),_=l,clearTimeout(s),s=setTimeout((0,g.A)(function*(){if(!i.WillLeave)if(r)i.alertCtrl.create({header:i.lang.text.ChatRoom.MultipleSend,message:`${i.lang.text.ChatRoom.CountFile}: ${d.length}`,buttons:[{text:i.lang.text.ChatRoom.Send,handler:()=>{i.DropSendAct(d)}}]}).then(f=>{i.global.StoreShortCutAct("chatroom-alert"),i.global.p5KeyShortCut.Escape=()=>{f.dismiss()},f.onDidDismiss().then(()=>{i.global.RestoreShortCutAct("chatroom-alert")}),f.present()});else{let f=yield i.loadingCtrl.create({message:i.lang.text.TodoDetail.WIP});f.present(),i.selected_blobFile_callback_act(x.file),f.dismiss()}}),400)}),this.p5ChatMsgDragAct=y};let s,r=!1,_=0,d=[];n.mouseMoved=m=>{m.dataTransfer?(t.style.pointerEvents="all",t.style.backgroundColor="#0008"):(t.style.pointerEvents="none",t.style.backgroundColor="transparent")};let p=0;n.touchMoved=m=>{try{y(m.touches[0].clientX)}catch{}};let y=m=>{this.MsgClickedStartPos&&this.TargetMessageObject&&(p=this.MsgClickedStartPos-m,this.IsQouteMyMessage?p>0?this.TargetMessageObject.style.paddingRight=p/2+"px":this.TargetMessageObject.style.marginRight=p/2+"px":this.TargetMessageObject.style.marginLeft=-p/2+"px",this.TargetMessageObject.style.backgroundColor=80<p?"rgba(var(--ion-color-primary-rgb), .5)":-80>p?"rgba(var(--ion-color-tertiary-rgb), .5)":null)};n.mouseReleased=()=>{R()},n.touchEnded=()=>{R()};let R=function(){var m=(0,g.A)(function*(){if(i.MsgClickedStartPos&&i.TargetMessageObject){if(80<p)try{let x;for(let u=0,k=i.ViewableMessage.length;u<k;u++)if(i.TargetMessageObject.id==i.ViewableMessage[u].message_id){x=u;break}if(void 0===x)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";let l=i.ViewableMessage[x],f=i.deserialize_text(l);if(i.userInput.qoute={timestamp:l.create_time},f&&(i.userInput.qoute.text=((m,x)=>m.length>80?m.slice(0,79)+"\u2026":m)(f)),"image"==l.content.viewer)if(l.content.url)i.userInput.qoute.url=l.content.url,i.userInput.qoute.path=l.content.url;else if(l.content.path&&(i.userInput.qoute.path=l.content.path.split("/").pop(),!i.userInput.qoute.url)){let u=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/${i.userInput.qoute.path}`;i.indexed.checkIfFileExist(u,k=>{k&&i.indexed.loadBlobFromUserPath(u,"",b=>{let w=URL.createObjectURL(b);i.userInput.qoute.url=w,setTimeout(()=>{URL.revokeObjectURL(w)},100)})})}i.userInput.qoute.id=l.message_id,i.userInput.qoute.display_name=l.user_display_name,i.userInput.qoute.user_id=l.sender_id,i.CancelEditText(),setTimeout(()=>{i.WillLeave||(i.make_ext_hidden(),i.userInputTextArea.focus())},0)}catch(x){console.log("\uba54\uc2dc\uc9c0 \uc0c1\uc138\ubcf4\uae30 \uc2e4\ud328: ",x)}else if(-80>p)try{let x;for(let f=0,u=i.ViewableMessage.length;f<u;f++)if(i.TargetMessageObject.id==i.ViewableMessage[f].message_id){x=f;break}if(void 0===x)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";let l=i.ViewableMessage[x];yield i.CopyMessageText(l)}catch(x){console.log("\uba54\uc2dc\uc9c0 \ubcf5\uc0ac \uc2e4\ud328: ",x)}i.TargetMessageObject.style.backgroundColor=null,i.TargetMessageObject.style.paddingRight=null,i.TargetMessageObject.style.marginRight=null,i.TargetMessageObject.style.marginLeft=null,p=0}i.MsgClickedStartPos=null,i.TargetMessageObject=null,i.IsQouteMyMessage=null});return function(){return m.apply(this,arguments)}}()})}FindQoute(i,t){var n=this;return(0,g.A)(function*(){let s;for(let _=n.ViewableMessage.length-1;_>=0;_--)if(i==n.ViewableMessage[_].message_id){s=document.getElementById(i);break}n.BlockAutoScrollDown=!0;let r=yield n.loadingCtrl.create({message:n.lang.text.TodoDetail.WIP});if(r.present(),!s){let _=!1;for(;!s&&n.pullable&&!_;){yield n.pull_msg_history(),yield new Promise(d=>setTimeout(d,200));for(let d=n.ViewableMessage.length-1;d>=0;d--){if(new Date(n.ViewableMessage[d].create_time).getTime()<new Date(t).getTime()){_=!0;break}if(i==n.ViewableMessage[d].message_id){s=document.getElementById(i);break}}}}s?(s.scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{n.WillLeave||(s.style.backgroundColor="rgba(var(--ion-color-primary-rgb), .5)")},100),setTimeout(()=>{n.WillLeave||(s.style.backgroundColor=null,n.BlockAutoScrollDown=!1)},3500)):n.p5toast.show({text:n.lang.text.ChatRoom.LostOriginMsg}),r.dismiss()})()}RemoveQoute(){delete this.userInput.qoute}DropSendAct(i){var t=this;return(0,g.A)(function*(){let n=yield t.loadingCtrl.create({message:t.lang.text.TodoDetail.WIP});n.present();for(let s=0,r=i.length;s<r;s++)yield t.selected_blobFile_callback_act(i[s].file),yield t.send();n.dismiss(),setTimeout(()=>{t.scroll_down_logs()},300)})()}selected_blobFile_callback_act(i,t=[],n="loaded",s){var r=this;return(0,g.A)(function*(){r.userInput.file={},r.userInput.file.filename=i.name,r.userInput.file.file_ext=i.name.split(".").pop()||i.type||r.lang.text.ChatRoom.unknown_ext,r.userInput.file.size=i.size,r.userInput.file.type=i.type||i.type_override,s&&(r.userInput.file.path=s),r.userInput.file.content_related_creator=[...t];try{r.userInput.file.content_related_creator.push({user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:n})}catch{}r.userInput.file.content_creator={timestamp:(new Date).getTime()};try{r.userInput.file.content_creator={user_id:r.info.local?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,timestamp:(new Date).getTime(),display_name:r.nakama.users.self.display_name,various:n}}catch{}r.userInput.file.blob=i,r.create_selected_thumbnail(),r.inputPlaceholder=`(${r.lang.text.ChatRoom.attachments}: ${r.userInput.file.filename})`})()}create_thumbnail_imported(i){var t=this;return(0,g.A)(function*(){if(i.url)yield t.new_attach({detail:{value:"link"}},i);else{let n=yield t.indexed.loadBlobFromUserPath(i.path,i.type);n.name=i.filename||i.name,t.selected_blobFile_callback_act(n,i.content_related_creator,"shared",i.path)}})()}create_selected_thumbnail(){var i=this;return(0,g.A)(function*(){if(i.global.set_viewer_category_from_ext(i.userInput.file),i.userInput.file.url){try{(yield fetch(i.userInput.file.url,{signal:i.cont.signal})).ok&&(i.userInput.file.thumbnail=i.userInput.file.url)}catch{}return void(i.userInput.file.typeheader=i.userInput.file.viewer)}try{i.userInput.file.thumbnail=yield i.indexed.loadBlobFromUserPath(i.userInput.file.path,i.userInput.file.type)}catch{}let t=URL.createObjectURL(i.userInput.file.blob);switch(i.userInput.file.typeheader=i.userInput.file.blob.type.split("/")[0]||i.userInput.file.viewer,setTimeout(()=>{URL.revokeObjectURL(t)},0),i.userInput.file.thumbnail=void 0,i.userInput.file.viewer){case"image":i.userInput.file.thumbnail=i.sanitizer.bypassSecurityTrustUrl(t);break;case"code":case"text":new j(n=>{n.setup=()=>{n.noCanvas(),n.loadStrings(t,s=>{i.userInput.file.thumbnail=s,n.remove()},s=>{console.error("\ubb38\uc790\uc5f4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",s),n.remove()})}})}})()}init_chatroom(){var i=this;return(0,g.A)(function*(){i.cont&&i.cont.abort(),i.cont=new AbortController,i.InitWithFileImport||(i.userInput.text="",delete i.userInput.file,delete i.userInput.qoute),i.InitWithRoomEnv&&(i.BlockAutoScrollDown=!1,i.ResizeTextArea(),i.nakama.OnTransferMessage={},i.ViewableMessage.length=0,i.ViewMsgIndex=0,i.ShowGoToBottom=!1,i.ShowRecentMsg=!1,i.isHistoryLoaded=!1,i.LocalHistoryList.length=0,i.messages.length=0,i.prev_cursor="",i.next_cursor="",i.pullable=!0,i.init_last_message_viewer(),i.file_sel_id=`chatroom_${i.info.id}_${(new Date).getTime()}`,i.ChannelUserInputId=`chatroom_input_${i.info.id}_${(new Date).getTime()}`,window.onfocus=null,window.onfocus=()=>{i.info.cnoti_id&&i.noti.ClearNoti(i.info.cnoti_id)},i.isOfficial=i.info.server.isOfficial,i.target=i.info.server.target,i.info=i.nakama.channels_orig[i.isOfficial][i.target][i.info.id],i.LoadChannelBackgroundImage(),i.nakama.opened_page_info.channel={isOfficial:i.isOfficial,target:i.target,id:i.info.id},i.foundLastRead=i.info.last_read_id==i.info.last_comment_id,yield i.SetExtensionButtons()),i.nakama.channels_orig[i.isOfficial][i.target]&&i.nakama.channels_orig[i.isOfficial][i.target][i.info.id]&&"missing"!=i.info.status&&(i.nakama.channels_orig[i.isOfficial][i.target][i.info.id].update=t=>{if(1==t.code){for(let s=0,r=i.messages.length;s<r;s++)if(i.messages[s].message_id==t.message_id){i.messages[s].content=t.content,i.global.modulate_thumbnail(i.messages[s].content,i.messages[s].content.url,i.cont);break}return}let n="local"==t.sender_id;if(t.content.filename&&i.ModulateFileEmbedMessage(t),i.info.last_read_id=t.message_id,n||i.check_if_send_msg(t),1!=t.code&&2!=t.code)try{i.messages[i.messages.length-1].message_id!=t.message_id&&i.messages.push(t)}catch{i.messages.push(t)}if(2==t.code)for(let s=i.messages.length-1;s>=0;s--)if(i.messages[s].message_id==t.message_id){i.messages.splice(s,1);break}t.content.qoute&&i.OpenQouteThumbnail(t),i.ViewMsgIndex+i.ViewCount==i.messages.length-1&&i.ViewMsgIndex++,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount),i.pullable=(i.info.local?!!i.LocalHistoryList.length:void 0!==i.next_cursor)||i.ViewMsgIndex>0,i.modulate_chatmsg(0,i.ViewableMessage.length),i.modulate_chatmsg(i.ViewableMessage.length-1,i.ViewableMessage.length),i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.useSpeaker&&i.SpeechReceivedMessage(t),setTimeout(()=>{if(!i.WillLeave)if(i.info.is_new=!1,i.nakama.has_new_channel_msg=!1,i.NeedScrollDown()&&!i.ShowRecentMsg)i.init_last_message_viewer(),i.ChatLogs.scrollTo({top:i.ChatLogs.scrollHeight,behavior:"smooth"});else if(2!=t.code){i.last_message_viewer.is_me=!!i.info.local||t.sender_id==i.nakama.servers[i.isOfficial][i.target].session.user_id,i.last_message_viewer.user_id=t.sender_id;let s=JSON.parse(JSON.stringify(t.content.msg));t.content.filename&&(s.length?s[0][0].text=`(${i.lang.text.ChatRoom.attachments}) ${s[0][0].text}`:s=[[{text:`(${i.lang.text.ChatRoom.attachments})`}]]),i.last_message_viewer.message=s,i.last_message_viewer.color=t.color}},100),i.global.godot_window&&i.global.godot_window.received_msg&&i.global.godot_window.received_msg({sender_id:t.sender_id,user_display_name:t.user_display_name,content:t.content})}),(i.InitWithFileImport||i.InitWithRoomEnv)&&(yield i.pull_msg_history(),setTimeout(()=>{i.WillLeave||i.ChatLogs.scrollTo({top:i.ChatLogs.scrollHeight,behavior:"smooth"})},500))})()}OpenQouteThumbnail(i){let t=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/${i.content.qoute.path}`;this.indexed.checkIfFileExist(t,n=>{n?this.indexed.loadBlobFromUserPath(t,"",s=>{let r=URL.createObjectURL(s);i.content.qoute.url=r,setTimeout(()=>{URL.revokeObjectURL(r)},100)}):i.content.qoute.path&&0==i.content.qoute.path.indexOf("http")&&(i.content.qoute.url=i.content.qoute.path)})}SetExtensionButtons(){var i=this;return(0,g.A)(function*(){switch(i.extended_buttons.forEach(n=>{n.isHide=!1,n.index=void 0}),i.info.redirect.type){case 2:"missing"!=i.info.status&&(i.info.redirect?"online"==i.statusBar.groupServer[i.isOfficial][i.target]&&(i.info.status=i.nakama.load_other_user(i.info.redirect.id,i.isOfficial,i.target).online?"online":"pending"):i.info.status=i.info.info.online?"online":"pending",i.extended_buttons[0].isHide=!0,i.extended_buttons[1].isHide=!0,i.extended_buttons[9].isHide=!1,i.extended_buttons[12].isHide=!0);break;case 3:"missing"!=i.info.status&&(yield i.nakama.load_groups(i.isOfficial,i.target,i.info.group_id)),i.extended_buttons[1].isHide=!0,i.extended_buttons[11].isHide=!0,delete i.extended_buttons[0].isHide,i.extended_buttons[9].isHide=!0,i.extended_buttons[12].isHide=!0;break;case 0:i.extended_buttons[0].isHide=!0,i.extended_buttons[9].isHide=!0,i.extended_buttons[11].isHide=!0}void 0===i.info.status||"missing"==i.info.status?(i.extended_buttons.forEach(n=>{n.isHide=!0}),i.extended_buttons[12].isHide=!1,3==i.info.redirect.type&&(i.extended_buttons[0].isHide=!1)):i.extended_buttons[10].isHide=M.Yl||"missing"==i.info.status,i.extended_buttons[2].isHide=!1;let t=1;i.extended_buttons.forEach(n=>{!n.isHide&&t<11&&(n.index=t%10,t++)})})()}CopyMessageText(i){var t=this;return(0,g.A)(function*(){let n=t.deserialize_text(i);if(!n)try{let s=i.content.path;return n=yield t.indexed.loadBlobFromUserPath(s,i.content.type),void(yield t.global.WriteValueToClipboard(n.type,n,i.content.filename))}catch{try{n=i.content.url.replace(" ","%20")}catch{}}try{yield t.global.WriteValueToClipboard("text/plain",n)}catch(s){console.log("\ud074\ub9bd\ubcf4\ub4dc \ubcf5\uc0ac \uc2e4\ud328: ",s)}})()}init_last_message_viewer(){delete this.last_message_viewer.user_id,delete this.last_message_viewer.message,delete this.last_message_viewer.color,delete this.last_message_viewer.is_me}NeedScrollDown(){return this.ChatLogs.scrollHeight<this.ChatLogs.scrollTop+this.ChatLogs.clientHeight+200}scroll_down_logs(){this.ShowRecentMsg||this.init_last_message_viewer(),this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})}check_if_send_msg(i){for(let t=0,n=this.sending_msg.length;t<n;t++)if(i.sender_id==this.nakama.servers[this.isOfficial][this.target].session.user_id&&i.content.local_comp==this.sending_msg[t].content.local_comp){i.content.filename&&this.auto_open_thumbnail(i),this.sending_msg.splice(t,1);break}}auto_open_thumbnail(i){try{this.temporary_open_thumbnail[i.message_id]()}catch{this.temporary_open_thumbnail[i.message_id]=()=>{i.content.url?this.global.modulate_thumbnail(i.content,"",this.cont):(this.indexed.loadBlobFromUserPath(`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`,i.content.type,n=>{i.content.path=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;let s=URL.createObjectURL(n);this.global.modulate_thumbnail(i.content,s,this.cont),this.NeedScrollDown()&&setTimeout(()=>{this.scroll_down_logs()},100),this.nakama.WriteStorage_From_channel(i,i.content.path,this.isOfficial,this.target)}),delete this.temporary_open_thumbnail[i.message_id])}}}removeAttach(){delete this.userInput.file,this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder}pull_msg_history(i=!0){var t=this;return(0,g.A)(function*(){if(t.pullable||!i)if(t.pullable=!1,i){try{if(t.info.local)throw"Local channel";if(void 0===t.info.status||"missing"==t.info.status)throw"Channel missing";if(0!=t.ViewMsgIndex){let s=Math.min(t.ViewMsgIndex,t.RefreshCount);t.ViewMsgIndex-=s,t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let r=0;r<s;r++){let _;try{t.ViewableMessage[r].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[r].message_id}.${t.ViewableMessage[r].content.file_ext}`;let d=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[r].content.path,t.ViewableMessage[r].content.file_ext);_=URL.createObjectURL(d)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[r].content,_,t.cont),t.modulate_chatmsg(r,s+1),t.ViewableMessage[r].content.qoute&&t.ViewableMessage[r].content.qoute.path&&t.OpenQouteThumbnail(t.ViewableMessage[r])}return t.modulate_chatmsg(0,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,void(t.pullable=!0)}let n=yield t.nakama.servers[t.isOfficial][t.target].client.listChannelMessages(t.nakama.servers[t.isOfficial][t.target].session,t.info.id,t.RefreshCount,!1,t.next_cursor);t.info.is_new=!1,n.messages.forEach(s=>{if(s=t.nakama.modulation_channel_message(s,t.isOfficial,t.target),t.nakama.check_sender_and_show_name(s,t.isOfficial,t.target),t.info.last_comment||2!=s.code&&(t.info.last_comment=(s.content.filename?`(${t.lang.text.ChatRoom.attachments}) `:"")+(s.content.msg||s.content.noti||"")),!t.foundLastRead&&t.info.last_read_id?t.info.last_read_id==s.message_id&&(s.isLastRead=!0,t.foundLastRead=!0,t.info.last_read_id=t.info.last_comment_id,t.nakama.save_channels_with_less_info()):t.foundLastRead=!0,t.nakama.translate_updates(s),s.content.filename&&t.ModulateFileEmbedMessage(s),t.nakama.CatchQouteMsgUserName(s,t.isOfficial,t.target),t.nakama.ModulateTimeDate(s),t.nakama.content_to_hyperlink(s),2!=s.code){let r=!0;for(let _=t.messages.length-1;_>=t.messages.length-t.RefreshCount-1&&_>=0;_--)if(t.messages[_].message_id==s.message_id){r=!1;break}r&&t.messages.unshift(s)}}),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let s=0,r=t.ViewableMessage.length;s<r;s++){let _;try{if(!t.ViewableMessage[s].content.file_ext)throw"\ud30c\uc77c\uc774 \uc5c6\ub294 \uba54\uc2dc\uc9c0";if(t.ViewableMessage[s].content.url)throw"\ub9c1\ud06c\ub41c \ud30c\uc77c";t.ViewableMessage[s].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[s].message_id}.${t.ViewableMessage[s].content.file_ext}`,t.indexed.checkIfFileExist(t.ViewableMessage[s].content.path,d=>{d&&t.indexed.loadBlobFromUserPath(t.ViewableMessage[s].content.path,t.ViewableMessage[s].content.file_ext,h=>{_=URL.createObjectURL(h),t.global.modulate_thumbnail(t.ViewableMessage[s].content,_,t.cont)})})}catch{t.global.modulate_thumbnail(t.ViewableMessage[s].content,"")}t.modulate_chatmsg(s,r+1),t.ViewableMessage[s].content.qoute&&t.ViewableMessage[s].content.qoute.path&&t.OpenQouteThumbnail(t.ViewableMessage[s])}t.modulate_chatmsg(0,t.ViewableMessage.length),t.ShowRecentMsg=t.messages.length>t.ViewMsgIndex+t.ViewCount,t.next_cursor=n.next_cursor,t.prev_cursor=n.prev_cursor,t.pullable=!0,t.nakama.saveListedMessage(t.messages,t.info,t.isOfficial,t.target)}catch{yield t.LoadLocalChatHistory()}setTimeout(()=>{t.WillLeave||void 0!==t.next_cursor&&t.ChatContDiv&&t.ChatContDiv.clientHeight<t.ChatLogs.clientHeight&&t.pull_msg_history()},0)}else{let n=t.messages.length-t.ViewMsgIndex-t.ViewCount;t.ShowRecentMsg=0!=n,t.ViewMsgIndex+=Math.min(t.RefreshCount,n),t.ViewableMessage=t.messages.slice(t.ViewMsgIndex,t.ViewMsgIndex+t.ViewCount);for(let s=t.ViewableMessage.length-1;s>=0;s--){let r;try{t.ViewableMessage[s].content.path=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${t.ViewableMessage[s].message_id}.${t.ViewableMessage[s].content.file_ext}`;let _=yield t.indexed.loadBlobFromUserPath(t.ViewableMessage[s].content.path,t.ViewableMessage[s].content.file_ext);r=URL.createObjectURL(_)}catch{}t.global.modulate_thumbnail(t.ViewableMessage[s].content,r,t.cont),t.modulate_chatmsg(s,t.ViewableMessage.length),t.ViewableMessage[s].content.qoute&&t.ViewableMessage[s].content.qoute.path&&t.OpenQouteThumbnail(t.ViewableMessage[s])}t.pullable=!0}})()}SpeechReceivedMessage(i){try{if(0!=i.code)throw"\uc77c\ubc18 \uc218\uc2e0 \uba54\uc2dc\uc9c0\uac00 \uc544\ub2d8";let t=JSON.parse(JSON.stringify(i.content.msg)),n="";for(let s=0,r=t.length;s<r;s++)for(let _=0,d=t[s].length;_<d;_++)n+=t[s][_].text+" ";n&&n.trim()&&this.SpeechThese.push(n),this.isSpeeching||this.SpeechingTexts()}catch{}}SpeechingTexts(){var i=this;return(0,g.A)(function*(){let t=i.SpeechThese.shift();i.isSpeeching=!0,t&&t.trim()&&(yield E.speak({text:t,lang:i.lang.lang})),i.SpeechThese.length?i.SpeechingTexts():i.isSpeeching=!1})()}LoadLocalChatHistory(){var i=this;return(0,g.A)(function*(){if(i.ViewMsgIndex>0){let t=Math.min(i.ViewableMessage.length,Math.min(i.ViewMsgIndex,i.RefreshCount));i.ViewMsgIndex-=t,i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);for(let n=t-1;n>=0;n--){let s;try{i.ViewableMessage[n].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${i.ViewableMessage[n].message_id}.${i.ViewableMessage[n].content.file_ext}`;let r=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[n].content.path,i.ViewableMessage[n].content.file_ext);s=URL.createObjectURL(r)}catch{}i.global.modulate_thumbnail(i.ViewableMessage[n].content,s,i.cont),i.modulate_chatmsg(n,t+1),i.ViewableMessage[n].content.qoute&&i.ViewableMessage[n].content.qoute.path&&i.OpenQouteThumbnail(i.ViewableMessage[n])}return i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount,i.pullable=0!=i.ViewMsgIndex||!!i.LocalHistoryList.length,void(i.pullable&&i.ViewableMessage.length&&i.ViewableMessage.length<i.RefreshCount&&(yield i.LoadLocalChatHistory()))}if(i.isHistoryLoaded){try{let t=i.LocalHistoryList.pop();if(!t)throw"\uae30\ub85d \uc5c6\uc74c";let n=yield i.indexed.loadTextFromUserPath(t);if(n){let s=JSON.parse(n.trim()),r=0;for(let d=s.length-1;d>=0;d--)i.nakama.translate_updates(s[d]),s[d]=i.nakama.modulation_channel_message(s[d],i.isOfficial,i.target),i.nakama.CatchQouteMsgUserName(s[d],i.isOfficial,i.target),i.nakama.ModulateTimeDate(s[d]),s[d].content.path=`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/files/msg_${s[d].message_id}.${s[d].content.file_ext}`,2!=s[d].code&&(r++,i.messages.unshift(s[d]));i.ViewMsgIndex=Math.max(0,r-i.RefreshCount),i.ViewableMessage=i.messages.slice(i.ViewMsgIndex,i.ViewMsgIndex+i.ViewCount);let _=Math.min(Math.min(r,i.RefreshCount),i.ViewableMessage.length);for(let d=_-1;d>=0;d--){let h;try{let p=yield i.indexed.loadBlobFromUserPath(i.ViewableMessage[d].content.path,i.ViewableMessage[d].content.file_ext);h=URL.createObjectURL(p)}catch{}i.global.modulate_thumbnail(i.ViewableMessage[d].content,h,i.cont),i.modulate_chatmsg(d,_),i.ViewableMessage[d].content.qoute&&i.ViewableMessage[d].content.qoute.path&&i.OpenQouteThumbnail(i.ViewableMessage[d])}i.ShowRecentMsg=i.messages.length>i.ViewMsgIndex+i.ViewCount}else yield i.LoadLocalChatHistory()}catch{}i.pullable=0!=i.ViewMsgIndex||!!i.LocalHistoryList.length,i.pullable&&i.ViewableMessage.length<i.RefreshCount&&i.LoadLocalChatHistory()}else{let t=yield i.indexed.GetFileListFromDB(`servers/${i.isOfficial}/${i.target}/channels/${i.info.id}/chats/`);i.LocalHistoryList=t;for(let n=t.length-1;n>=0;n--){let s=t[n].split("/");"chats"!=s[s.length-4]&&t.splice(n,1)}if(i.isHistoryLoaded=!0,!i.LocalHistoryList.length)return;i.LoadLocalChatHistory()}})()}ChatBalloonMouseDown(i,t){2==i.which&&(this.IsQouteMyMessage=t.is_me,this.MsgClickedStartPos=i.clientX,this.TargetMessageObject=document.getElementById(t.message_id),this.MsgClickedStartPos=i.clientX+90,this.p5ChatMsgDragAct(i.clientX))}ChatBalloonOnTouchStart(i,t){try{this.IsQouteMyMessage=t.is_me,this.MsgClickedStartPos=i.touches[0].clientX,this.TargetMessageObject=document.getElementById(t.message_id)}catch{}}ChatBalloonContextMenu(i){try{let t;for(let n=0,s=this.ViewableMessage.length;n<s;n++)if(i.message_id==this.ViewableMessage[n].message_id){t=n;break}if(void 0===t)throw"\uba54\uc2dc\uc9c0\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc74c";"DesktopPWA"==M.aH&&this.CopyMessageText(this.ViewableMessage[t]),this.message_detail(i,t)}catch(t){console.log("\uba54\uc2dc\uc9c0 \uc0c1\uc138\ubcf4\uae30 \uc2e4\ud328: ",t)}return!1}open_ext_with_delay(){this.ScrollNearLogs(),this.isHidden=!this.isHidden}make_ext_hidden(){this.ScrollNearLogs(),"DesktopPWA"!=M.aH&&(this.isHidden=!0)}ScrollNearLogs(){this.NeedScrollDown()&&(this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"}),setTimeout(()=>{this.ChatLogs.scrollTo({top:this.ChatLogs.scrollHeight,behavior:"smooth"})},150))}ResizeTextArea(){this.userInputTextArea.style.height="36px"}check_key(i){"DesktopPWA"==M.aH?"Enter"!=i.key||i.shiftKey||"keydown"!=i.type?setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0):this.send(!0):setTimeout(()=>{this.ResizeTextArea(),this.userInputTextArea.style.height=this.userInputTextArea.scrollHeight+"px"},0)}send(i=!1){var t=this;return(0,g.A)(function*(){if(i&&("Android"==M.aH||"iOS"==M.aH))return;if(t.userInputTextArea.focus(),!(t.userInput.text.trim()||t.userInput.file||void 0!==t.IsMsgEditMode&&t.IsMsgEditMode.content.filename))return void setTimeout(()=>{t.userInput.text="",t.ResizeTextArea()},0);try{if(t.userInput.text.length>600)throw"\uba54\uc2dc\uc9c0\uac00 \ucda9\ubd84\ud788 \uae41\ub2c8\ub2e4";if(void 0!==t.IsMsgEditMode){let h=!1;if(t.IsMsgEditMode.content.msg=t.userInput.text,t.IsMsgEditMode.content.edited=!0,t.IsMsgEditMode.content.thumbnail&&(t.IsMsgEditMode.content.thumbnail=t.IsMsgEditMode.thumbnail),t.IsMsgEditMode.update_time=(new Date).toISOString(),delete t.IsMsgEditMode.msg_string,delete t.IsMsgEditMode.thumbnail,t.info.local)h=!0;else try{yield t.nakama.servers[t.isOfficial][t.target].socket.updateChatMessage(t.info.id,t.IsMsgEditMode.message_id,t.IsMsgEditMode.content),h=!0}catch(p){console.log("\uba54\uc2dc\uc9c0 \ud3b8\uc9d1 \uc694\uccad \uc624\ub958: ",p)}if(!h)return;return t.info.local&&(t.IsMsgEditMode.code=1,t.nakama.content_to_hyperlink(t.IsMsgEditMode),t.IsMsgEditMode.update_time=Date.now(),t.SendLocalMessage(t.IsMsgEditMode)),t.CancelEditText(),void setTimeout(()=>{t.userInput.text="",t.ResizeTextArea()},0)}}catch{t.CancelEditText()}if(t.block_send)return;t.block_send=!0,t.userInputTextArea.style.maxHeight=`${t.userInputTextArea.offsetHeight}px`,setTimeout(()=>{t.make_ext_hidden(),t.userInputTextArea.focus()},0),t.isHidden=!0;let n={};n.msg=t.userInput.text;let s=!1,r=!1,_="";if(t.userInput.qoute&&(delete t.userInput.qoute.url,n.qoute=t.userInput.qoute),t.userInput.file){n.filename=t.userInput.file.filename,n.file_ext=t.userInput.file.file_ext,n.type=t.userInput.file.type;try{n.filesize=t.userInput.file.size||t.userInput.file.blob.size,n.partsize=Math.ceil(n.filesize/S.xM)}catch{n.url=t.userInput.file.url,r=!0}if(n.msg.length>600?(_=n.msg,delete n.msg):n.msg=n.msg,n.content_creator=t.userInput.file.content_creator,n.content_related_creator=t.userInput.file.content_related_creator,!r&&!t.info.local&&2!=t.useFirstCustomCDN)try{let h=t.nakama.servers[t.isOfficial][t.target].info.address,p=t.nakama.servers[t.isOfficial][t.target].info.useSSL?"https:":"http:",y=`${t.info.group_id||(t.info.user_id_one==t.nakama.servers[t.isOfficial][t.target].session.user_id?t.info.user_id_two:t.info.user_id_one)}_${t.nakama.servers[t.isOfficial][t.target].session.user_id}`,C=yield t.global.upload_file_to_storage(t.userInput.file,y,p,h,1==t.useFirstCustomCDN);if(r=!!C,!r)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete n.partsize,n.url=C,t.noti.PushLocal({id:7,title:t.lang.text.ChatRoom.SendFile,body:t.userInput.file.filename||t.userInput.file.name,smallIcon_ln:"diychat"},t.noti.Current)}catch(h){console.log("cdn \uc5c5\ub85c\ub4dc \ucc98\ub9ac \uc2e4\ud328: ",h),t.noti.PushLocal({id:7,title:t.lang.text.Nakama.FailedUpload,body:`${t.userInput.file.filename||t.userInput.file.name}: ${h}`,smallIcon_ln:"diychat"},t.noti.Current)}s=!0;for(let h=0,p=n.content_related_creator.length;h<p;h++)delete n.content_related_creator[h].is_me,delete n.content_related_creator[h].timeDisplay,delete n.content_related_creator[h].various_display}else if(n.msg.length>600)return void t.LongTextMessageAsFile(n);n.local_comp=Math.random();let d={content:JSON.parse(JSON.stringify(n))};if(t.nakama.content_to_hyperlink(d),t.info.local){let h=(new Date).getTime().toString();if(s&&!r)try{let C;if(1==t.useFirstCustomCDN&&(C=yield t.global.try_upload_to_user_custom_fs(t.userInput.file,`${t.info.id}_${t.nakama.users.self.display_name}`)),!C)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete d.content.path,delete d.content.partsize,d.content.url=C,t.noti.PushLocal({id:7,title:t.lang.text.ChatRoom.SendFile,body:t.userInput.file.filename||t.userInput.file.name,smallIcon_ln:"diychat"},t.noti.Current)}catch(C){let R=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${h}.${t.userInput.file.file_ext}`;t.noti.PushLocal({id:7,title:t.lang.text.Nakama.FailedUpload,body:`${t.userInput.file.filename||t.userInput.file.name}: ${C}`,smallIcon_ln:"diychat"},t.noti.Current),yield t.indexed.saveBlobToUserPath(t.userInput.file.blob,R)}delete t.userInput.file,delete t.userInput.qoute,_&&(d.msg=_,t.LongTextMessageAsFile(d));let p=(new Date).toISOString(),y={channel_id:t.info.id,code:0,color:"888888",...d,create_time:p,update_time:p,sender_id:"local",message_id:h,user_display_name:t.nakama.users.self.display_name,is_me:!0};return t.SendLocalMessage(y),t.userInputTextArea.style.maxHeight=null,void(t.block_send=!1)}t.sending_msg.push(d),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},100);try{setTimeout(()=>{t.userInput.text="",t.ResizeTextArea()},0);let h=yield t.nakama.servers[t.isOfficial][t.target].socket.writeChatMessage(t.info.id,n);s&&(r?t.auto_open_thumbnail({content:n,message_id:h.message_id}):t.indexed.saveBlobToUserPath(t.userInput.file.blob,`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${h.message_id}.${t.userInput.file.file_ext}`,()=>{t.auto_open_thumbnail({content:n,message_id:h.message_id})})),delete t.userInput.file,delete t.userInput.qoute,t.inputPlaceholder=t.lang.text.ChatRoom.input_placeholder,_&&(n.msg=_,t.LongTextMessageAsFile(n))}catch(h){3===h.code?t.p5toast.show({text:t.lang.text.ChatRoom.FailedToJoinChannel}):(console.log("\uc624\ub958 \uac80\ud1a0 \ud544\uc694: ",h),t.p5toast.show({text:`${t.lang.text.ChatRoom.FailedToSend}: ${"string"==typeof h?h:h.message}`})),setTimeout(()=>{t.userInput.text="",t.ResizeTextArea()},0),setTimeout(()=>{for(let p=t.sending_msg.length-1;p>=0;p--)t.sending_msg[p].content.local_comp==n.local_comp&&t.sending_msg.splice(p,1)},1500)}t.userInputTextArea.style.maxHeight=null,t.block_send=!1})()}open_url_link(i){var t=this;return(0,g.A)(function*(){if(0==i.indexOf("https://is2you2.github.io/pjcone_pwa/?")){let n=t.global.CatchGETs(i)||{};try{yield t.nakama.AddressToQRCodeAct(n)}catch(s){t.p5toast.show({text:`${t.lang.text.ChatRoom.QRLinkFailed}: ${s}`})}}else t.global.open_link(i);t.make_ext_hidden(),t.userInputTextArea.focus(),t.SetOtherAct()})()}SendLocalMessage(i){let t=this.deserialize_text(i);this.nakama.CatchQouteMsgUserName(i,this.isOfficial,this.target),this.nakama.ModulateTimeDate(i),this.nakama.channels_orig[this.isOfficial][this.target][i.channel_id].last_comment_time=i.update_time,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment_id=i.message_id,this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update(i),this.nakama.saveListedMessage([i],this.info,this.isOfficial,this.target),2!=i.code&&(this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].last_comment=(i.content.filename?`(${this.lang.text.ChatRoom.attachments}) `:"")+(t||i.content.noti||(i.content.match?this.lang.text.ChatRoom.JoinWebRTCMatch:void 0)||"")),setTimeout(()=>{this.userInput.text="",this.ResizeTextArea(),this.inputPlaceholder=this.lang.text.ChatRoom.input_placeholder,this.NeedScrollDown()&&this.scroll_down_logs()},0)}LongTextMessageAsFile(i){var t=this;return(0,g.A)(function*(){let n=new Blob([i.msg]);yield t.indexed.saveBlobToUserPath(n,`tmp_files/chatroom/${t.lang.text.ChatRoom.LongText}_${i.msg.substring(0,10)}.txt`);let s={};s.blob=n,s.content_related_creator=[{user_id:t.info.local?"local":t.nakama.servers[t.isOfficial][t.target].session.user_id,timestamp:(new Date).getTime(),display_name:t.nakama.users.self.display_name,various:"long_text"}],s.content_creator={user_id:t.info.local?"local":t.nakama.servers[t.isOfficial][t.target].session.user_id,timestamp:(new Date).getTime(),display_name:t.nakama.users.self.display_name,various:"long_text"};let r=i.msg.substring(0,24);s.path=`tmp_files/chatroom/${t.lang.text.ChatRoom.LongText}_${r}~.txt`,s.file_ext="txt",s.filename=`[${t.lang.text.ChatRoom.LongText}] ${r}~.txt`,t.global.set_viewer_category_from_ext(s),s.type="text/plain",s.typeheader="text",delete i.msg,delete t.userInput.file,delete t.userInput.qoute,t.userInput.text="",t.ResizeTextArea(),t.inputPlaceholder=t.lang.text.ChatRoom.input_placeholder,t.userInput.file=s,t.CancelEditText(),t.inputPlaceholder=`(${t.lang.text.ChatRoom.attachments}: ${t.userInput.file.filename})`,t.create_selected_thumbnail(),t.p5toast.show({text:t.lang.text.ChatRoom.CreateAsTextFile}),t.block_send=!1})()}SetOtherAct(){this.isOtherAct=!0,setTimeout(()=>{this.isOtherAct=!1},0)}message_detail(i,t){var n=this;return(0,g.A)(function*(){if(n.isOtherAct||i.content.user_update||i.content.gupdate||!i.is_me)return;let s=n.deserialize_text(i),r=s,_=i.content.url;if(i.content.viewer){try{let R=yield n.indexed.loadBlobFromUserPath(`${i.content.path}_thumbnail.png`,i.content.type);_=URL.createObjectURL(R)}catch{try{let m=yield n.indexed.loadBlobFromUserPath(i.content.path,i.content.type);_=URL.createObjectURL(m)}catch{}}r=`(${n.lang.text.ChatRoom.attachments}) ${r}`}let d=n.global.HTMLEncode(r),h=_?`<div style="text-align: center;">${d}</div>`:`<div>${d}</div>`,C={header:n.lang.text.ChatRoom.ManageChat,message:new D.Vk(_?`<div style="width: 100%;"><img src="${_}" alt="${i.content.filename}" style="border-radius: 8px; max-height: 230px; position: relative; left: 50%; transform: translateX(-50%); ${n.info.HideAutoThumbnail?"filter: blur(6px);":""}"/></div>`+h:h),buttons:[{text:n.lang.text.ChatRoom.EditChat,handler:()=>{n.userInput.qoute=void 0;let R=JSON.parse(JSON.stringify(i));R.msg_string=r,n.IsMsgEditMode=R,R.content.path&&n.indexed.loadBlobFromUserPath(R.content.path,"",m=>{let x=URL.createObjectURL(m);R.thumbnail=x}),n.userInput.text=s,setTimeout(()=>{n.ResizeTextArea(),n.userInputTextArea.style.height=n.userInputTextArea.scrollHeight+"px"},0),n.make_ext_hidden(),n.userInputTextArea.focus()}},{text:n.lang.text.UserFsDir.Delete,cssClass:"redfont",handler:(R=(0,g.A)(function*(){if(n.CancelEditText(),n.info.local){if(_)if(i.content.url)n.global.remove_file_from_storage(i.content.url);else{let m=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;try{yield n.indexed.removeFileFromUserPath(m)}catch{}try{yield n.indexed.removeFileFromUserPath(`${m}_thumbnail.png`)}catch{}}}else try{if(yield n.nakama.servers[n.isOfficial][n.target].socket.removeChatMessage(n.info.id,i.message_id),_)if(i.content.url)n.global.remove_file_from_storage(i.content.url);else{let m=yield n.loadingCtrl.create({message:n.lang.text.UserFsDir.DeleteFile});m.present();for(let l=0;l<i.content.partsize;l++){try{yield n.nakama.servers[n.isOfficial][n.target].client.deleteStorageObjects(n.nakama.servers[n.isOfficial][n.target].session,{object_ids:[{collection:`file_${i.channel_id.replace(/[.]/g,"_")}`,key:`msg_${i.message_id}_${l}`}]})}catch{}m.message=`${n.lang.text.UserFsDir.DeleteFile}: ${i.content.filename}_${i.content.partsize-l}`}let x=`servers/${n.isOfficial}/${n.target}/channels/${n.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;yield n.indexed.removeFileFromUserPath(x),yield n.indexed.removeFileFromUserPath(`${x}_thumbnail.png`),m.dismiss()}}catch(m){console.error("\ucc44\ub110 \uba54\uc2dc\uc9c0 \uc0ad\uc81c \uc624\ub958: ",m)}n.ViewableMessage.splice(t,1);for(let m=0,x=n.messages.length;m<x;m++)if(n.messages[m].message_id==i.message_id){n.messages.splice(m,1);break}i.update_time=Date.now(),i.code=2,n.SendLocalMessage(i);for(let m=n.ViewableMessage.length-1;m>=0;m--)n.modulate_chatmsg(m,n.ViewableMessage.length);n.p5toast.show({text:n.lang.text.ChatRoom.MsgRemoved})}),function(){return R.apply(this,arguments)})}]};var R;("offline"==n.info.status||"missing"==n.info.status)&&delete C.buttons,n.alertCtrl.create(C).then(R=>{n.ChatManageMenu=R,n.global.StoreShortCutAct("chatroom-alert"),n.global.p5KeyShortCut.Escape=()=>{R.dismiss()},R.onDidDismiss().then(()=>{n.global.RestoreShortCutAct("chatroom-alert"),URL.revokeObjectURL(_),n.isOtherAct=!1}),R.present()})})()}CancelEditText(){try{let i=this.IsMsgEditMode.thumbnail;this.IsMsgEditMode=void 0,setTimeout(()=>{URL.revokeObjectURL(i)},100)}catch{}}deserialize_text(i){let t="";if(!i.content.msg)return t;for(let n=0,s=i.content.msg.length;n<s;n++){for(let r=0,_=i.content.msg[n].length;r<_;r++)t+=i.content.msg[n][r].text;n+1<s&&(t+="\n")}return t}file_detail(i){var t=this;return(0,g.A)(function*(){if(t.isOtherAct=!0,i.content.url)return t.open_viewer(i,i.content.url),void setTimeout(()=>{t.isOtherAct=!1},0);let n=`servers/${t.isOfficial}/${t.target}/channels/${t.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;try{if(!(yield t.indexed.checkIfFileExist(`${n}.history`)))throw"\uc378\ub124\uc77c \uc5f4\uae30";i.content.text=[t.lang.text.TodoDetail.WIP];let r=yield t.indexed.loadTextFromUserPath(`${n}.history`),_=JSON.parse(r);switch(delete i.content.text,_.type){case"upload":if(i.content.text=[t.lang.text.ChatRoom.uploading],t.nakama.WriteStorage_From_channel(i,n,t.isOfficial,t.target,_.index),i.content.transfer_index&&t.nakama.OnTransfer[t.isOfficial][t.target][i.channel_id][i.message_id].OnTransfer)throw"\uc804\uc1a1\uc791\uc5c5 \uc911, \uc378\ub124\uc77c \uc5f4\uae30";break;case"download":i.content.text=[t.lang.text.TodoDetail.WIP],yield t.nakama.ReadStorage_From_channel(i,n,t.isOfficial,t.target,_.index),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},100)}}catch{(yield t.indexed.checkIfFileExist(n))?(i.content.text||(i.content.text=[t.lang.text.ChatRoom.downloaded]),t.indexed.loadBlobFromUserPath(n,i.content.type,_=>{i.content.path=n;let d=URL.createObjectURL(_);i.content.thumbnail||t.global.modulate_thumbnail(i.content,d,t.cont),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},100)}),t.open_viewer(i,n)):t.isHistoryLoaded?t.p5toast.show({text:t.lang.text.ChatRoom.cannot_open_file}):(i.content.text=[t.lang.text.TodoDetail.WIP],yield t.nakama.ReadStorage_From_channel(i,n,t.isOfficial,t.target),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},400))}t.isOtherAct=!1})()}JoinWebRTCMatch(i){this.SetOtherAct(),this.nakama.JoinWebRTCMatch(i,this.isOfficial,this.target,this.info)}modulate_chatmsg(i,t){var n=this;return(0,g.A)(function*(){if(0!=t){if(n.ViewableMessage[i].showInfo||(n.ViewableMessage[i].showInfo={}),n.ViewableMessage[i].showInfo.date=!!n.ViewableMessage[i].msgDate,n.ViewableMessage[i].showInfo.sender=!n.ViewableMessage[i].content.noti,i-1>=0&&(n.ViewableMessage[i].showInfo.date=!!n.ViewableMessage[i].msgDate&&n.ViewableMessage[i].msgDate!=n.ViewableMessage[i-1].msgDate,n.ViewableMessage[i].showInfo.sender=!n.ViewableMessage[i].content.noti&&(n.ViewableMessage[i-1].isLastRead||n.ViewableMessage[i].sender_id!=n.ViewableMessage[i-1].sender_id||n.ViewableMessage[i-1].content.noti||n.ViewableMessage[i].msgDate!=n.ViewableMessage[i-1].msgDate||n.ViewableMessage[i].msgTime!=n.ViewableMessage[i-1].msgTime)),n.ViewableMessage[i].content.url)try{let s=yield n.indexed.loadBlobFromUserPath(`${n.ViewableMessage[i].content.path}_thumbnail.png`,"image/png"),r=URL.createObjectURL(s);return n.ViewableMessage[i].content.thumbnail=n.sanitizer.bypassSecurityTrustUrl(r),void setTimeout(()=>{URL.revokeObjectURL(r)},100)}catch{try{"image"==n.ViewableMessage[i].content.viewer&&n.ViewableMessage[i].content.url&&(n.ViewableMessage[i].content.thumbnail=n.ViewableMessage[i].content.url)}catch{}}try{i+1<t&&(n.ViewableMessage[i+1].showInfo.date=!!n.ViewableMessage[i].msgDate&&n.ViewableMessage[i].msgDate!=n.ViewableMessage[i+1].msgDate,n.ViewableMessage[i+1].showInfo.sender=!n.ViewableMessage[i+1].content.noti&&(n.ViewableMessage[i].isLastRead||n.ViewableMessage[i].sender_id!=n.ViewableMessage[i+1].sender_id||n.ViewableMessage[i].content.noti||n.ViewableMessage[i].msgDate!=n.ViewableMessage[i+1].msgDate||n.ViewableMessage[i].msgTime!=n.ViewableMessage[i+1].msgTime))}catch{}}})()}ModulateFileEmbedMessage(i){var t=this;i.content.url&&this.global.modulate_thumbnail(i.content,"",this.cont);let n=`servers/${this.isOfficial}/${this.target}/channels/${this.info.id}/files/msg_${i.message_id}.${i.content.file_ext}`;i.content.path=n;try{i.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id][i.message_id]}catch{}i.content.transfer_index||this.indexed.checkIfFileExist(`${n}.history`,s=>{s&&this.indexed.loadTextFromUserPath(`${n}.history`,(r,_)=>{if(r&&_){let d=JSON.parse(_);delete i.content.text,this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id]={}),this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id][i.message_id]||(this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id][i.message_id]={index:i.content.partsize-d.index}),i.content.transfer_index=this.nakama.OnTransfer[this.isOfficial][this.target][i.channel_id][i.message_id]}})}),this.global.set_viewer_category(i.content),this.indexed.checkIfFileExist(n,function(){var s=(0,g.A)(function*(r){if(r)i.content.text=[t.lang.text.ChatRoom.downloaded],t.indexed.loadBlobFromUserPath(n,i.content.type,_=>{i.content.path=n;let d=URL.createObjectURL(_);t.global.modulate_thumbnail(i.content,d,t.cont),t.NeedScrollDown()&&setTimeout(()=>{t.scroll_down_logs()},100)});else try{let _=yield t.indexed.loadBlobFromUserPath(`${i.content.path}_thumbnail.png`,"image/png"),d=URL.createObjectURL(_);t.global.modulate_thumbnail(i.content,d,t.cont)}catch{}});return function(r){return s.apply(this,arguments)}}())}toggle_thumbnail(){var i=this;return(0,g.A)(function*(){i.info.HideAutoThumbnail=!i.info.HideAutoThumbnail,i.nakama.save_channels_with_less_info()})()}open_viewer(i,t){var n=this;let s=[];for(let r=0,_=this.messages.length;r<_;r++)this.messages[r].content.filename&&s.push(JSON.parse(JSON.stringify(this.messages[r])));this.lock_modal_open||(this.lock_modal_open=!0,this.global.PageDismissAct["chatroom-ionicviewer"]=function(){var r=(0,g.A)(function*(_){if(n.lock_modal_open=!1,_.data)switch(_.data.type){case"image":let d=[];if(_.data.msg.content.content_related_creator&&(d=[..._.data.msg.content.content_related_creator]),_.data.msg.content.content_creator){let h=!1;for(let p=0,y=d.length;p<y;p++)if(d[p].user_id==_.data.msg.content.content_creator.user_id){h=!0;break}h||d.push(_.data.msg.content.content_creator)}return n.global.PageDismissAct["modify-image"]=h=>{h.data&&n.voidDraw_fileAct_callback(h,d),delete n.global.PageDismissAct["modify-image"]},yield n.WaitingCurrent(),void n.global.ActLikeModal("void-draw",{path:_.data.path||t,width:_.data.width,height:_.data.height,isDarkMode:_.data.isDarkMode,scrollHeight:_.data.scrollHeight,dismiss:"modify-image"});case"text":n.selected_blobFile_callback_act(_.data.blob,_.data.contentRelated,"textedit")}n.noti.Current=n.info.cnoti_id,n.info.cnoti_id&&n.noti.ClearNoti(n.info.cnoti_id),delete n.global.PageDismissAct["chatroom-ionicviewer"]});return function(_){return r.apply(this,arguments)}}(),this.noti.Current="IonicViewerPage",this.global.ActLikeModal("ionic-viewer",{info:i,path:t,alt_path:t,isOfficial:this.isOfficial,target:this.target,relevance:s,local:this.info.local,dismiss:"chatroom-ionicviewer"}))}voidDraw_fileAct_callback(i,t){var n=this;return(0,g.A)(function*(){n.userInput.file=yield n.global.voidDraw_fileAct_callback(i,"tmp_files/chatroom/",{user_id:n.info.local?"local":n.nakama.servers[n.isOfficial][n.target].session.user_id,display_name:n.nakama.users.self.display_name},t),n.CancelEditText(),n.userInput.file.thumbnail=n.sanitizer.bypassSecurityTrustUrl(i.data.img),n.inputPlaceholder=`(${n.lang.text.ChatRoom.attachments}: ${n.userInput.file.filename})`,i.data.loadingCtrl.dismiss()})()}user_detail(i){if(!this.lock_modal_open)if(this.isOtherAct=!0,this.lock_modal_open=!0,i.is_me)this.nakama.open_profile_page({isOfficial:this.info.server.isOfficial,target:this.info.server.target}),this.noti.Current="GroupServerPage",this.lock_modal_open=!1;else{let t=this.nakama.load_other_user(i.sender_id,this.isOfficial,this.target),n=JSON.parse(JSON.stringify(this.info));delete n.update,this.nakama.open_others_profile({info:{user:t},group:n,has_admin:!1}),this.lock_modal_open=!1,this.noti.Current="OthersProfilePage"}}ionViewWillLeave(){this.WillLeave=!0,this.noti.Current=void 0,this.removeShortCutKey(),window.onfocus=null,this.userInputTextArea.onpaste=null,this.userInputTextArea.onblur=null,this.userInputTextArea.onfocus=null}removeShortCutKey(){delete this.global.p5KeyShortCut.Escape,delete this.global.p5KeyShortCut.BottomTab,delete this.global.p5KeyShortCut.Backquote,delete this.global.p5KeyShortCut.Digit,delete this.global.p5KeyShortCut.EnterAct,delete this.global.p5KeyShortCut.Backspace}ngOnDestroy(){this.route.queryParams.unsubscribe();try{delete this.nakama.channels_orig[this.isOfficial][this.target][this.info.id].update}catch{}this.nakama.rearrange_channels(),this.ChatLogs.onscroll=null,this.cont.abort(),delete this.global.WindowOnBlurAct.chatroom,delete this.nakama.opened_page_info.channel,this.nakama.ChatroomLinkAct=null,this.p5canvas&&this.p5canvas.remove(),this.nakama.OnTransferMessage={};try{this.useVoiceRecording&&T.R.stopRecording()}catch{}delete this.nakama.StatusBarChangedCallback}}return(o=c).\u0275fac=function(i){return new(i||o)(e.rXU(B.q9),e.rXU(F.nX),e.rXU(F.Ix),e.rXU(X.X),e.rXU(N.r),e.rXU(U.j),e.rXU(H.n),e.rXU(Y.y),e.rXU(q.up),e.rXU(S.z3),e.rXU(I.Xi),e.rXU(z.j),e.rXU(W.G),e.rXU(I.hG))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-chat-room"]],decls:55,vars:28,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/subscribes"],["slot","start","name","file-tray-full-outline","class","top_icon title_override",4,"ngIf"],["slot","start","name","flame-outline","class","top_icon title_override",4,"ngIf"],["class","top_icon","style","padding-right: 68px;","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","style","padding-right: 68px;","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],[1,"header_online_circle"],["scrollY","false"],["id","p5Drop_chatroom",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none"],["class","shortcut_hint","style","left: auto; right: 0px; border-radius: 0px 0px 0px 4px;",4,"ngIf"],["id","main_table",1,"channel_bg",2,"width","100%","height","100%","background-color","var(--chatroom-background)"],[2,"height","100%"],[2,"vertical-align","top"],["id","chatroom_div",1,"main",2,"max-width","100vw"],["id","chatroom_content_div"],[2,"position","relative"],["class","shortcut_hint",4,"ngIf"],["button","",3,"click","disabled"],[3,"id","contextmenu","mousedown","touchstart",4,"ngFor","ngForOf"],["class","my_message_right my_sending_msg",4,"ngFor","ngForOf"],[1,"thumbnails","imageForm",2,"cursor","pointer"],["class","qoute_text",3,"click",4,"ngIf"],["class","thumbnail_parts","style","cursor: pointer;",4,"ngIf"],["class","thumbnail_parts",3,"click",4,"ngIf"],["id","input_table",2,"width","100%","background-color","var(--chatroom-input-background)"],["fill","clear","mode","md",1,"ion-text-center",3,"click"],["class","shortcut_hint shortcut_hint_menu",4,"ngIf"],["name","add"],[2,"width","100%","vertical-align","bottom","position","relative"],[1,"TextAreaInput","imageForm",3,"ngModelChange","keyup","keydown","click","id","ngModel","placeholder"],["fill","clear","mode","md","expand","block",3,"click","disabled"],["name","send"],["id","ext_menu",3,"hidden"],[2,"height","240px","overflow-x","hidden","overflow-y","auto","scroll-behavior","smooth","text-align","center","background-color","var(--chatroom-background)"],["hidden","","type","file","id","local_channel","accept","image/*",3,"change"],["hidden","","type","file","id","backgroundImage_sel","accept","image/png",3,"change"],["hidden","","type","file","accept","*","multiple","",3,"change","id"],["style","display: inline-block;",4,"ngFor","ngForOf"],["slot","start","name","file-tray-full-outline",1,"top_icon","title_override"],["slot","start","name","flame-outline",1,"top_icon","title_override"],["slot","end","name","eye-outline",1,"top_icon",2,"padding-right","68px",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",2,"padding-right","68px",3,"click"],[1,"shortcut_hint",2,"left","auto","right","0px","border-radius","0px 0px 0px 4px"],[1,"shortcut_hint"],[3,"contextmenu","mousedown","touchstart","id"],[4,"ngIf"],["class","my_message_right",4,"ngIf"],["class","notice_form",3,"click",4,"ngIf"],["style","text-align: center; font-size: 16px; padding-top: 8px;",3,"click",4,"ngIf"],[1,"avatar_form"],["class","avatar_image",3,"click",4,"ngIf"],["class","message_form",4,"ngIf"],["class","quickShare_form imageForm",3,"click",4,"ngIf"],["class","qoute_text qoute_background imageForm",3,"click",4,"ngIf"],["class","file_message_form",4,"ngIf"],["class","message_content_form",4,"ngIf"],[2,"width","100%","text-align","-webkit-center"],["class","read_last_here",4,"ngIf"],[2,"text-align","center","font-size","16px","padding-top","8px",3,"click"],[2,"color","#888"],[1,"avatar_image",3,"click"],["alt","img",1,"avatar_image",3,"src"],[1,"message_form"],[2,"cursor","pointer",3,"click"],[1,"time_form","message_span_form",3,"click"],[1,"quickShare_form","imageForm",3,"click"],[1,"qoute_text","qoute_background","imageForm",3,"click"],[1,"qouteDiv","qouteOnChatBalloon"],["class","imageForm borderRadiusDefault qouteImageHeight",4,"ngIf"],["class","qouteDiv qouteOnChatBalloon qouteBalloonBottom",4,"ngIf"],[1,"imageForm","borderRadiusDefault","qouteImageHeight"],["alt","",1,"qouteImage","qouteImageHeight",3,"src"],[1,"qouteDiv","qouteOnChatBalloon","qouteBalloonBottom"],[1,"file_message_form"],["class","file_button imageForm borderRadiusDefault",3,"style","click",4,"ngIf"],["class","file_name_form imageForm borderRadiusDefault",3,"click",4,"ngIf"],["class","transfer_count",4,"ngIf"],[1,"file_button","imageForm","borderRadiusDefault",3,"click"],[1,"file_info"],["class","text_seperator",4,"ngIf"],["class","file_info file_text_thumbnail",4,"ngFor","ngForOf"],[1,"text_seperator"],[1,"file_info","file_text_thumbnail"],[1,"file_name_form","imageForm","borderRadiusDefault",3,"click"],[1,"file_thumbnail","imageForm",3,"src","alt"],[1,"transfer_count"],[1,"message_content_form"],[1,"msg_balloon","qouteOnChatBalloon"],["class","msg_inside_balloon",4,"ngFor","ngForOf"],["class","edited_form",4,"ngIf"],[1,"msg_inside_balloon"],[4,"ngFor","ngForOf"],["class","text_span",3,"style","click",4,"ngIf"],["target","_system","onclick","return false;",3,"href","click",4,"ngIf"],[1,"text_span",3,"click"],["target","_system","onclick","return false;",3,"click","href"],[1,"edited_form"],[1,"read_last_here"],[1,"my_message_right"],[2,"display","inline-flex"],["class","my_file_message_form",3,"click",4,"ngIf"],["class","my_file_message_form",4,"ngIf"],["class","message_content_form my_file_message_form",4,"ngIf"],[1,"avatar_form","my_avatar_form"],["class","read_last_here",3,"click",4,"ngIf"],[1,"time_form","message_span_form_me",3,"click"],[1,"my_file_message_form",3,"click"],[1,"quickShare_form","imageForm"],[1,"my_file_message_form"],[1,"message_content_form","my_file_message_form"],["alt","my_img",1,"avatar_image",3,"src"],[1,"read_last_here",3,"click"],[1,"notice_form",3,"click"],[1,"notice","borderRadiusDefault"],[1,"my_message_right","my_sending_msg"],["class","file_button imageForm borderRadiusDefault",3,"style",4,"ngIf"],["class","file_name_form imageForm borderRadiusDefault",4,"ngIf"],[1,"file_button","imageForm","borderRadiusDefault"],[1,"file_name_form","imageForm","borderRadiusDefault"],["class","comp_local_content",3,"style","click",4,"ngIf"],["class","comp_local_content","onclick","return false;","target","_system",3,"href","click",4,"ngIf"],[1,"comp_local_content",3,"click"],["onclick","return false;","target","_system",1,"comp_local_content",3,"click","href"],[1,"qoute_text",3,"click"],[1,"qouteDiv"],["class","qouteDiv",4,"ngIf"],["class","imageForm borderRadiusDefault qouteImageHeight","style","max-height: 84px;",4,"ngIf"],[1,"imageForm","borderRadiusDefault","qouteImageHeight",2,"max-height","84px"],[1,"thumbnail_parts",2,"cursor","pointer"],[3,"click",4,"ngIf"],[3,"click"],[2,"text-align","center","margin","4px","max-width","95vw"],["style","display: grid;","class","thumbnail_parts",4,"ngIf"],["id","ChatroomSelectedImage","class","image_thumbnail",3,"src","alt",4,"ngIf"],["id","ChatroomSelectedImage",1,"image_thumbnail",3,"src","alt"],[1,"thumbnail_parts",2,"display","grid"],[1,"thumbnail_parts",3,"click"],[2,"text-align","center","padding","4px 0px","position","relative"],["class","shortcut_hint","style","border-radius: 4px;",4,"ngIf"],[1,"shortcut_hint",2,"border-radius","4px"],[1,"bottom_thumbnail","imageForm"],["class","text_span",3,"click",4,"ngIf"],[1,"shortcut_hint","shortcut_hint_menu"],[2,"display","inline-block"],[1,"ext_button",3,"click","contextmenu","hidden"],["class","shortcut_hint shortcut_hint_ext_menu",4,"ngIf"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],[1,"shortcut_hint","shortcut_hint_ext_menu"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"]],template:function(i,t){1&i&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",1),e.nrm(5,"ion-back-button",2),e.k0s(),e.DNE(6,J,1,0,"ion-icon",3)(7,Q,1,0,"ion-icon",4)(8,K,1,0,"ion-icon",5)(9,Z,1,0,"ion-icon",6),e.nrm(10,"div",7),e.k0s()(),e.j41(11,"ion-content",8),e.nrm(12,"div",9),e.DNE(13,ee,2,0,"div",10),e.j41(14,"table",11)(15,"tr",12)(16,"td",13)(17,"div",14)(18,"div",15)(19,"div",16),e.DNE(20,te,2,0,"div",17),e.j41(21,"ion-item",18),e.bIt("click",function(){return t.pull_msg_history()}),e.j41(22,"ion-label"),e.EFF(23),e.k0s()()(),e.DNE(24,We,4,4,"div",19)(25,ct,4,3,"div",20),e.k0s()(),e.j41(26,"table",21),e.DNE(27,ut,5,3,"tr",22)(28,gt,4,2,"tr",22)(29,bt,3,1,"tr",23)(30,kt,4,2,"tr",24)(31,Mt,6,4,"tr",24),e.k0s()()(),e.j41(32,"tr")(33,"td")(34,"div")(35,"table",25)(36,"tr")(37,"td")(38,"ion-button",26),e.bIt("click",function(){return t.open_ext_with_delay()}),e.DNE(39,$t,2,0,"div",27),e.nrm(40,"ion-icon",28),e.k0s()(),e.j41(41,"td",29),e.DNE(42,Tt,2,0,"div",27)(43,Ot,2,0,"div",27),e.j41(44,"textarea",30),e.mxI("ngModelChange",function(s){return e.DH7(t.userInput.text,s)||(t.userInput.text=s),s}),e.bIt("keyup",function(s){return t.check_key(s)})("keydown",function(s){return t.check_key(s)})("click",function(){return t.make_ext_hidden()}),e.k0s()(),e.j41(45,"td")(46,"ion-button",31),e.bIt("click",function(){return t.send(!1)}),e.nrm(47,"ion-icon",32),e.k0s()()()()()()(),e.j41(48,"tr",33)(49,"td")(50,"div",34)(51,"input",35),e.bIt("change",function(s){return t.LocalChannelImageChanged(s)}),e.k0s(),e.j41(52,"input",36),e.bIt("change",function(s){return t.ChangeBackgroundImage(s)}),e.k0s(),e.j41(53,"input",37),e.bIt("change",function(s){return t.inputFileSelected(s)}),e.k0s(),e.DNE(54,Gt,7,7,"div",38),e.k0s()()()()()),2&i&&(e.R7$(3),e.SpI(" ",t.info.info?t.info.info.name||t.nakama.usernameOverride[t.info.info.isOfficial][t.info.info.target][t.info.info.id]||t.info.info.display_name||t.lang.text.ChatRoom.noname_chatroom:t.info.title||t.lang.text.ChatRoom.noname_chatroom,""),e.R7$(3),e.Y8G("ngIf",t.info.local&&!t.info.volatile),e.R7$(),e.Y8G("ngIf",t.info.volatile),e.R7$(),e.Y8G("ngIf",!t.info.HideAutoThumbnail),e.R7$(),e.Y8G("ngIf",t.info.HideAutoThumbnail),e.R7$(),e.Aen("background-color: "+t.statusBar.colors[t.info.status||"offline"]),e.R7$(3),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput),e.R7$(7),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput),e.R7$(),e.Y8G("disabled",void 0===t.next_cursor&&!t.ViewMsgIndex||!t.pullable),e.R7$(2),e.JRh(t.lang.text.ChatRoom.fetch_previous_chat),e.R7$(),e.Y8G("ngForOf",t.ViewableMessage),e.R7$(),e.Y8G("ngForOf",t.sending_msg),e.R7$(2),e.Y8G("ngIf",t.userInput.qoute),e.R7$(),e.Y8G("ngIf",t.IsMsgEditMode),e.R7$(),e.Y8G("ngIf",t.userInput.file),e.R7$(),e.Y8G("ngIf",t.ShowGoToBottom&&!t.last_message_viewer.user_id),e.R7$(),e.Y8G("ngIf",t.last_message_viewer.user_id),e.R7$(8),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput),e.R7$(3),e.Y8G("ngIf",t.global.ShowHint&&!t.CheckIfFocusOnInput),e.R7$(),e.Y8G("ngIf",t.global.ShowHint&&t.CheckIfFocusOnInput),e.R7$(),e.Y8G("id",t.ChannelUserInputId),e.R50("ngModel",t.userInput.text),e.Y8G("placeholder",t.inputPlaceholder),e.R7$(2),e.Y8G("disabled",t.block_send||!t.info.status||"missing"==t.info.status||"offline"==t.info.status),e.R7$(2),e.Y8G("hidden",t.isHidden),e.R7$(5),e.Y8G("id",t.file_sel_id),e.R7$(),e.Y8G("ngForOf",t.extended_buttons))},dependencies:[V.Sq,V.bT,O.me,O.BC,O.vS,I.Jm,I.QW,I.W9,I.eU,I.iq,I.uz,I.he,I.BC,I.ai,I.el],styles:[".md[_ngcontent-%COMP%]   .title_override[_ngcontent-%COMP%]{cursor:initial;padding-right:initial;margin-right:-8px}.ios[_ngcontent-%COMP%]   .title_override[_ngcontent-%COMP%]{cursor:initial;padding-right:initial;padding-left:8px}.main[_ngcontent-%COMP%]{width:100%;height:100%;padding:8px;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth}.message_form[_ngcontent-%COMP%]{margin-top:8px;text-shadow:0px 0px 4px var(--chatroom-background),0px 0px 4px var(--chatroom-background),0px 0px 4px var(--chatroom-background)}.channel_bg[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat;background-size:cover}.message_span_form[_ngcontent-%COMP%]{margin-left:8px}.message_span_form_me[_ngcontent-%COMP%]{margin-right:4px}.my_message_right[_ngcontent-%COMP%]{text-align:end;margin-bottom:-4px}.my_sending_msg[_ngcontent-%COMP%]{margin-bottom:0;padding-right:56px}.msg_balloon[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;border:16px;border-radius:16px;padding:5px 12px 8px}.msg_inside_balloon[_ngcontent-%COMP%]{text-align:start}.time_form[_ngcontent-%COMP%]{font-size:12px;color:#888}.file_message_form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.my_file_message_form[_ngcontent-%COMP%]{text-align:right;text-align:-webkit-right}.file_name_form[_ngcontent-%COMP%]{margin-top:4px;max-width:192px;max-height:192px}.file_thumbnail[_ngcontent-%COMP%]{max-width:192px;max-height:192px;width:auto;height:auto;cursor:pointer;display:block}.file_info[_ngcontent-%COMP%]{margin:0 4px;text-align:start}.file_text_thumbnail[_ngcontent-%COMP%]{margin-top:2px;display:grid}.quickShare_form[_ngcontent-%COMP%]{border-radius:16px;max-width:156px;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;padding:8px 12px;margin:4px 0 0;text-align:center;vertical-align:middle;word-break:keep-all;background-color:var(--chatroom-you-read-here-backgruond)}.qoute_text[_ngcontent-%COMP%]{text-align:initial;margin:4px 0 0}.qoute_background[_ngcontent-%COMP%]{background-color:rgba(var(--ion-color-primary-rgb),.5);border-radius:16px}.qouteImage[_ngcontent-%COMP%]{width:100%;object-fit:cover;display:block}.qouteImageHeight[_ngcontent-%COMP%]{max-height:32px;display:block}.qouteDiv[_ngcontent-%COMP%]{padding:8px 12px;max-width:95vw;color:var(--chatroom-qouteDiv);font-size:14px}.qouteOnChatBalloon[_ngcontent-%COMP%]{max-width:65vw}.qouteBalloonBottom[_ngcontent-%COMP%]{padding-top:0}.message_content_form[_ngcontent-%COMP%]{display:inline-flex;margin:4px 0 0;place-self:flex-end}.edited_form[_ngcontent-%COMP%]{color:#888;font-size:12px;margin:0 8px;align-self:flex-end;padding-bottom:2px}.avatar_form[_ngcontent-%COMP%]{width:56px;vertical-align:top;padding:12px 8px 0 0;max-width:56px}.my_avatar_form[_ngcontent-%COMP%]{padding:12px 0 0 8px}.avatar_image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:64px;object-fit:cover;cursor:pointer}.comp_local_content[_ngcontent-%COMP%]{color:#888}.text_seperator[_ngcontent-%COMP%]{background-color:#fff;margin-top:2px;position:relative;width:100%;height:2px}.file_button[_ngcontent-%COMP%]{width:160px;height:112px;background-color:gray;margin-top:4px;cursor:pointer}.bottom_thumbnail[_ngcontent-%COMP%]{width:100%;max-width:100vw;max-height:96px;padding:8px}.image_thumbnail[_ngcontent-%COMP%]{width:auto;max-height:96px;height:auto;object-fit:contain;display:block;margin:auto;padding:8px}.thumbnails[_ngcontent-%COMP%]{width:-webkit-fill-available;height:-moz-fit-content;height:fit-content;position:relative;transform:translateY(-100%);background:var(--chatroom-last-msg-viewer-bg);padding:8px;border-radius:16px;margin:0 8px;bottom:4px}.thumbnail_parts[_ngcontent-%COMP%]{max-height:96px;overflow-y:scroll;max-width:100vw;padding:8px;word-break:break-all}.transfer_count[_ngcontent-%COMP%]{align-self:flex-end;margin-left:4px}.notice_form[_ngcontent-%COMP%]{text-align:center;margin:12px}.notice[_ngcontent-%COMP%]{font-size:12px;display:inline;background:#444;padding:4px 8px;color:#fff}.read_last_here[_ngcontent-%COMP%]{border-radius:16px;padding:4px 8px;width:-moz-fit-content;width:fit-content;text-align:center;font-size:12px;background:var(--chatroom-you-read-here-backgruond);margin:4px 0}.text_span[_ngcontent-%COMP%]{white-space:normal}.ext_icon_img[_ngcontent-%COMP%]{max-width:36px;max-height:36px}.md[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:36px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;background-color:var(--chatroom-input-background)}.ios[_ngcontent-%COMP%]   .TextAreaInput[_ngcontent-%COMP%]{width:100%;height:60px;max-height:156px;resize:none;padding:6px;margin-top:5px;border:0;background-color:var(--chatroom-input-background)}.imageForm[_ngcontent-%COMP%]{overflow:hidden;position:relative}.borderRadiusDefault[_ngcontent-%COMP%]{border-radius:8px}ion-button[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px}"]}),c})()},{path:"ionic-viewer",loadChildren:()=>v.e(5390).then(v.bind(v,5390)).then(o=>o.IonicViewerPageModule)},{path:"void-draw",loadChildren:()=>v.e(2655).then(v.bind(v,2655)).then(o=>o.VoidDrawPageModule)}];let St=(()=>{var o;class c{}return(o=c).\u0275fac=function(i){return new(i||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[F.iI.forChild(jt),F.iI]}),c})(),Et=(()=>{var o;class c{}return(o=c).\u0275fac=function(i){return new(i||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[V.MD,O.YN,I.bv,St]}),c})()}}]);