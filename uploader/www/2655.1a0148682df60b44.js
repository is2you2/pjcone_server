(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2655],{2655:(It,Ue,X)=>{"use strict";X.r(Ue),X.d(Ue,{VoidDrawPageModule:()=>Kt});var at=X(177),le=X(4341),D=X(5374),ve=X(9858),h=X(467),A=X(8326),te=X(7100),q=X(6042),e=X(3953),g=X(4234),b=X(3656),_=X(755),S=X(4237),F=X(9900),k=X(4020),l=X(3307),d=X(5547);const C=["RemoteDraw"],P=["ChangeTransparent"],V=["SetFrameRate"],ce=["ChangeResolution"],ne=["AddrQRShare"];function De(s,G){if(1&s){const a=e.RV6();e.j41(0,"ion-header",14)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",15),e.nrm(5,"ion-back-button",16),e.k0s(),e.j41(6,"ion-icon",17),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.p5SetCanvasViewportInit(!0))})("contextmenu",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ToggleFocusMode())}),e.k0s(),e.j41(7,"ion-icon",18),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.p5save_image(!0,!0))}),e.k0s()()()}if(2&s){const a=e.XpG();e.R7$(3),e.JRh(a.lang.text.ChatRoom.voidDraw)}}function rt(s,G){if(1&s&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&s){const a=G.$implicit;e.Y8G("value",a),e.R7$(),e.JRh(a.info.name)}}function ot(s,G){if(1&s&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&s){const a=e.XpG().$implicit;e.Aen("color: #"+a.color),e.R7$(),e.JRh(" "+a.text)}}function st(s,G){if(1&s&&(e.j41(0,"b"),e.EFF(1),e.k0s()),2&s){const a=e.XpG(2).$implicit;e.R7$(),e.SpI("",a.target,":")}}function We(s,G){if(1&s&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&s){const a=e.XpG().$implicit;e.R7$(),e.JRh(a.text)}}function lt(s,G){if(1&s){const a=e.RV6();e.j41(0,"a",33),e.bIt("click",function(i){e.eBV(a);const t=e.XpG().$implicit,w=e.XpG(5);return e.Njj(w.nakama.open_url_link(i,t.text))}),e.EFF(1),e.k0s()}if(2&s){const a=e.XpG().$implicit;e.Y8G("href",a.text,e.B4B),e.R7$(),e.JRh(a.text)}}function Qe(s,G){if(1&s&&(e.j41(0,"span"),e.DNE(1,We,2,1,"span",31)(2,lt,2,2,"a",32),e.k0s()),2&s){const a=G.$implicit;e.R7$(),e.Y8G("ngIf",!a.href),e.R7$(),e.Y8G("ngIf",a.href)}}function Je(s,G){if(1&s&&(e.j41(0,"span"),e.DNE(1,Qe,3,2,"span",23),e.k0s()),2&s){const a=e.XpG(2).$implicit;e.Aen(a.isSystem?"color: var(--arcade-fix-system-color)":""),e.R7$(),e.Y8G("ngForOf",a.text)}}function Ye(s,G){if(1&s&&(e.j41(0,"span",30)(1,"span"),e.DNE(2,st,2,1,"b",31),e.k0s(),e.DNE(3,Je,2,3,"span",12),e.k0s()),2&s){const a=e.XpG().$implicit;e.R7$(),e.Aen("color: #"+a.color),e.R7$(),e.Y8G("ngIf",a.target),e.R7$(),e.Y8G("ngIf",a.text)}}function Et(s,G){if(1&s&&(e.j41(0,"p"),e.DNE(1,ot,2,3,"span",12)(2,Ye,4,4,"span",29),e.k0s()),2&s){const a=G.$implicit;e.R7$(),e.Y8G("ngIf",!a.target),e.R7$(),e.Y8G("ngIf",a.target)}}function Wt(s,G){if(1&s){const a=e.RV6();e.j41(0,"div")(1,"div",20)(2,"div",21)(3,"div",22),e.DNE(4,Et,3,2,"p",23),e.k0s()(),e.j41(5,"table",24)(6,"tr")(7,"td",25)(8,"ion-input",26),e.bIt("ionFocus",function(){e.eBV(a);const i=e.XpG();return i.auto_scroll_down(120),e.Njj(i.global.toggleBlockMainShortcut(!0))})("ionBlur",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.global.toggleBlockMainShortcut(!1))})("keyup.enter",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.send())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.drawChat.text,i)||(t.drawChat.text=i),e.Njj(i)}),e.k0s()(),e.j41(9,"td")(10,"ion-button",27),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.send())}),e.nrm(11,"ion-icon",28),e.k0s()()()()()()}if(2&s){const a=e.XpG();e.Aen("display: flex; justify-content: center; align-items: center; width: 100%; position: absolute; bottom: "+a.BUTTON_HEIGHT+"px; color: var(--arcade-fix-color);"),e.R7$(2),e.Y8G("id",a.voidDrawId+"_log"),e.R7$(2),e.Y8G("ngForOf",a.drawChat.logs),e.R7$(4),e.Y8G("disabled",a.DisableChatInput)("placeholder",a.lang.text.ChatRoom.input_placeholder),e.R50("ngModel",a.drawChat.text),e.R7$(2),e.Y8G("disabled",a.DisableChatInput)}}function Nt(s,G){if(1&s){const a=e.RV6();e.j41(0,"img",39),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.copy_address(i.SelectedAddress))}),e.k0s()}if(2&s){const a=e.XpG(2);e.Y8G("src",a.QRCodeSRC,e.B4B)}}function Ft(s,G){if(1&s){const a=e.RV6();e.j41(0,"div",34),e.bIt("click",function(i){e.eBV(a);const t=e.XpG();return e.Njj(t.CheckIfDismissAct(i))}),e.j41(1,"div",35),e.DNE(2,Nt,1,1,"img",36),e.j41(3,"ion-item",37),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.copy_address(i.SelectedAddress))}),e.j41(4,"ion-label",38),e.EFF(5),e.k0s()()()()}if(2&s){const a=e.XpG();e.R7$(2),e.Y8G("ngIf",a.QRCodeSRC),e.R7$(3),e.JRh(a.SelectedAddress)}}function Xt(s,G){if(1&s){const a=e.RV6();e.j41(0,"div",40),e.bIt("click",function(i){e.eBV(a);const t=e.XpG();return e.Njj(t.CheckIfDismissAct(i))}),e.j41(1,"div",41)(2,"h4"),e.EFF(3),e.k0s(),e.j41(4,"ion-range",42),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.colorPickRed,i)||(t.colorPickRed=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.j41(5,"div",43),e.EFF(6),e.k0s(),e.j41(7,"div",44)(8,"input",45),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.colorPickRed,i)||(t.colorPickRed=i),e.Njj(i)}),e.k0s()()(),e.j41(9,"ion-range",42),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.colorPickGreen,i)||(t.colorPickGreen=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.j41(10,"div",43),e.EFF(11),e.k0s(),e.j41(12,"div",44)(13,"input",45),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.colorPickGreen,i)||(t.colorPickGreen=i),e.Njj(i)}),e.k0s()()(),e.j41(14,"ion-range",42),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.colorPickBlue,i)||(t.colorPickBlue=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.j41(15,"div",43),e.EFF(16),e.k0s(),e.j41(17,"div",44)(18,"input",45),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.colorPickBlue,i)||(t.colorPickBlue=i),e.Njj(i)}),e.k0s()()(),e.j41(19,"ion-range",42),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.LineDefaultTransparent,i)||(t.LineDefaultTransparent=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeDefaultLineTransparent())}),e.j41(20,"div",43),e.EFF(21),e.k0s(),e.j41(22,"div",44)(23,"input",46),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeDefaultLineTransparent())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.LineDefaultTransparent,i)||(t.LineDefaultTransparent=i),e.Njj(i)}),e.k0s()()(),e.j41(24,"ion-range",47),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.LineDefaultWeight,i)||(t.LineDefaultWeight=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeDefaultLineWeight())}),e.j41(25,"div",43),e.EFF(26),e.k0s(),e.j41(27,"div",44)(28,"input",48),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.LineDefaultWeight,i)||(t.LineDefaultWeight=i),e.Njj(i)}),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeDefaultLineWeight())}),e.k0s()()(),e.j41(29,"h4"),e.EFF(30),e.k0s(),e.j41(31,"ion-range",47),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.LineQuickWeight,i)||(t.LineQuickWeight=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeQuickLineColor())}),e.j41(32,"div",43),e.EFF(33),e.k0s(),e.j41(34,"div",44)(35,"input",48),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.LineQuickWeight,i)||(t.LineQuickWeight=i),e.Njj(i)}),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeQuickLineColor())}),e.k0s()()(),e.j41(36,"ion-range",49),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.LineQuickTransparent,i)||(t.LineQuickTransparent=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeQuickTransparent())}),e.j41(37,"div",43),e.EFF(38),e.k0s(),e.j41(39,"div",44)(40,"input",48),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.LineQuickTransparent,i)||(t.LineQuickTransparent=i),e.Njj(i)}),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeQuickTransparent())}),e.k0s()()()()()}if(2&s){const a=e.XpG();e.R7$(3),e.JRh(a.lang.text.voidDraw.ColorpickDetail),e.R7$(),e.R50("ngModel",a.colorPickRed),e.R7$(2),e.JRh(a.lang.text.voidDraw.ColorpickRed),e.R7$(2),e.R50("ngModel",a.colorPickRed),e.R7$(),e.R50("ngModel",a.colorPickGreen),e.R7$(2),e.JRh(a.lang.text.voidDraw.ColorpickGreen),e.R7$(2),e.R50("ngModel",a.colorPickGreen),e.R7$(),e.R50("ngModel",a.colorPickBlue),e.R7$(2),e.JRh(a.lang.text.voidDraw.ColorpickBlue),e.R7$(2),e.R50("ngModel",a.colorPickBlue),e.R7$(),e.R50("ngModel",a.LineDefaultTransparent),e.R7$(2),e.JRh(a.lang.text.voidDraw.ColorpickAlpha),e.R7$(2),e.R50("ngModel",a.LineDefaultTransparent),e.R7$(),e.R50("ngModel",a.LineDefaultWeight),e.R7$(2),e.JRh(a.lang.text.voidDraw.weight),e.R7$(2),e.R50("ngModel",a.LineDefaultWeight),e.R7$(2),e.JRh(a.lang.text.voidDraw.quickSetup),e.R7$(),e.R50("ngModel",a.LineQuickWeight),e.R7$(2),e.JRh(a.lang.text.voidDraw.weight),e.R7$(2),e.R50("ngModel",a.LineQuickWeight),e.R7$(),e.R50("ngModel",a.LineQuickTransparent),e.R7$(2),e.JRh(a.lang.text.voidDraw.quickTransparent),e.R7$(2),e.R50("ngModel",a.LineQuickTransparent)}}function Ht(s,G){if(1&s){const a=e.RV6();e.j41(0,"div",50),e.bIt("click",function(i){e.eBV(a);const t=e.XpG();return e.Njj(t.CheckIfDismissAct(i))}),e.j41(1,"div",51)(2,"h4"),e.EFF(3),e.k0s(),e.j41(4,"ion-range",52),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.resolutionRatio,i)||(t.resolutionRatio=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ResolutionSliderUpdate())}),e.j41(5,"div",43),e.EFF(6),e.k0s(),e.j41(7,"div",44)(8,"input",53),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ResolutionSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.resolutionRatio,i)||(t.resolutionRatio=i),e.Njj(i)}),e.k0s()()(),e.j41(9,"ion-toggle",54),e.bIt("ionChange",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.UserToggleAutoResolution())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.ToggleAutoResolution,i)||(t.ToggleAutoResolution=i),e.Njj(i)}),e.EFF(10),e.k0s(),e.j41(11,"div"),e.EFF(12),e.k0s()()()}if(2&s){const a=e.XpG();e.R7$(3),e.JRh(a.lang.text.voidDraw.ResolutionDetail),e.R7$(),e.R50("ngModel",a.resolutionRatio),e.Y8G("disabled",a.ToggleAutoResolution),e.R7$(2),e.JRh(a.lang.text.voidDraw.ResolutionRatio),e.R7$(2),e.R50("ngModel",a.resolutionRatio),e.R7$(),e.R50("ngModel",a.ToggleAutoResolution),e.R7$(),e.JRh(a.lang.text.voidDraw.AutoResolution),e.R7$(2),e.Lme("",a.resolutionEffectedWidth," x ",a.resolutionEffectedHeight,"")}}function $t(s,G){if(1&s){const a=e.RV6();e.j41(0,"div")(1,"ion-range",42),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.transparentBGRed,i)||(t.transparentBGRed=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.TransparentBGSliderUpdate())}),e.j41(2,"div",43),e.EFF(3),e.k0s(),e.j41(4,"div",44)(5,"input",45),e.bIt("input",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.TransparentBGSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.transparentBGRed,i)||(t.transparentBGRed=i),e.Njj(i)}),e.k0s()()(),e.j41(6,"ion-range",42),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.transparentBGGreen,i)||(t.transparentBGGreen=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.TransparentBGSliderUpdate())}),e.j41(7,"div",43),e.EFF(8),e.k0s(),e.j41(9,"div",44)(10,"input",45),e.bIt("input",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.TransparentBGSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.transparentBGGreen,i)||(t.transparentBGGreen=i),e.Njj(i)}),e.k0s()()(),e.j41(11,"ion-range",42),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.transparentBGBlue,i)||(t.transparentBGBlue=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.TransparentBGSliderUpdate())}),e.j41(12,"div",43),e.EFF(13),e.k0s(),e.j41(14,"div",44)(15,"input",45),e.bIt("input",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.TransparentBGSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.transparentBGBlue,i)||(t.transparentBGBlue=i),e.Njj(i)}),e.k0s()()(),e.j41(16,"div"),e.nrm(17,"div",61),e.EFF(18),e.k0s()()}if(2&s){const a=e.XpG(2);e.R7$(),e.R50("ngModel",a.transparentBGRed),e.R7$(2),e.JRh(a.lang.text.voidDraw.ColorpickRed),e.R7$(2),e.R50("ngModel",a.transparentBGRed),e.R7$(),e.R50("ngModel",a.transparentBGGreen),e.R7$(2),e.JRh(a.lang.text.voidDraw.ColorpickGreen),e.R7$(2),e.R50("ngModel",a.transparentBGGreen),e.R7$(),e.R50("ngModel",a.transparentBGBlue),e.R7$(2),e.JRh(a.lang.text.voidDraw.ColorpickBlue),e.R7$(2),e.R50("ngModel",a.transparentBGBlue),e.R7$(3),e.SpI(" ","0x"+a.transparentBGHex," ")}}function Ot(s,G){if(1&s){const a=e.RV6();e.j41(0,"div")(1,"ion-range",64),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(3);return e.DH7(t.AutoGen.trace_duration,i)||(t.AutoGen.trace_duration=i),e.Njj(i)}),e.j41(2,"div",43),e.EFF(3),e.k0s(),e.j41(4,"div",44)(5,"input",65),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(3);return e.DH7(t.AutoGen.trace_duration,i)||(t.AutoGen.trace_duration=i),e.Njj(i)}),e.k0s()()(),e.j41(6,"ion-range",66),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(3);return e.DH7(t.AutoGen.DrawAtOnce,i)||(t.AutoGen.DrawAtOnce=i),e.Njj(i)}),e.j41(7,"div",43),e.EFF(8),e.k0s(),e.j41(9,"div",44)(10,"input",67),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(3);return e.DH7(t.AutoGen.DrawAtOnce,i)||(t.AutoGen.DrawAtOnce=i),e.Njj(i)}),e.k0s()()()()}if(2&s){const a=e.XpG(3);e.R7$(),e.R50("ngModel",a.AutoGen.trace_duration),e.R7$(2),e.JRh(a.lang.text.voidDraw.TraceDuration),e.R7$(2),e.R50("ngModel",a.AutoGen.trace_duration),e.R7$(),e.R50("ngModel",a.AutoGen.DrawAtOnce),e.R7$(2),e.JRh(a.lang.text.voidDraw.DrawOver),e.R7$(2),e.R50("ngModel",a.AutoGen.DrawAtOnce)}}function Ut(s,G){if(1&s){const a=e.RV6();e.j41(0,"div")(1,"ion-range",68),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(3);return e.DH7(t.AutoGen.ScribbleExtent,i)||(t.AutoGen.ScribbleExtent=i),e.Njj(i)}),e.j41(2,"div",43),e.EFF(3),e.k0s(),e.j41(4,"div",44)(5,"input",65),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(3);return e.DH7(t.AutoGen.ScribbleExtent,i)||(t.AutoGen.ScribbleExtent=i),e.Njj(i)}),e.k0s()()()()}if(2&s){const a=e.XpG(3);e.R7$(),e.R50("ngModel",a.AutoGen.ScribbleExtent),e.R7$(2),e.JRh(a.lang.text.voidDraw.ScribbleExtent),e.R7$(2),e.R50("ngModel",a.AutoGen.ScribbleExtent)}}function Qt(s,G){if(1&s){const a=e.RV6();e.j41(0,"div")(1,"ion-checkbox",62),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.AutoGen.draw_trace,i)||(t.AutoGen.draw_trace=i),e.Njj(i)}),e.EFF(2),e.k0s(),e.DNE(3,Ot,11,6,"div",31),e.j41(4,"div",63)(5,"ion-checkbox",62),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.AutoGen.scribble,i)||(t.AutoGen.scribble=i),e.Njj(i)}),e.EFF(6),e.k0s(),e.DNE(7,Ut,6,3,"div",31),e.k0s(),e.j41(8,"ion-range",64),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.AutoGen.StopFrame,i)||(t.AutoGen.StopFrame=i),e.Njj(i)}),e.j41(9,"div",43),e.EFF(10),e.k0s(),e.j41(11,"div",44)(12,"input",65),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG(2);return e.DH7(t.AutoGen.StopFrame,i)||(t.AutoGen.StopFrame=i),e.Njj(i)}),e.k0s()()()()}if(2&s){const a=e.XpG(2);e.R7$(),e.R50("ngModel",a.AutoGen.draw_trace),e.R7$(),e.JRh(a.lang.text.voidDraw.DrawTrace),e.R7$(),e.Y8G("ngIf",a.AutoGen.draw_trace),e.R7$(2),e.R50("ngModel",a.AutoGen.scribble),e.R7$(),e.JRh(a.lang.text.voidDraw.Scribbles),e.R7$(),e.Y8G("ngIf",a.AutoGen.scribble),e.R7$(),e.R50("ngModel",a.AutoGen.StopFrame),e.R7$(2),e.JRh(a.lang.text.voidDraw.StopFrame),e.R7$(2),e.R50("ngModel",a.AutoGen.StopFrame)}}function Jt(s,G){if(1&s){const a=e.RV6();e.j41(0,"div",55),e.bIt("click",function(i){e.eBV(a);const t=e.XpG();return e.Njj(t.CheckIfDismissAct(i))}),e.j41(1,"div",56)(2,"h4"),e.EFF(3),e.k0s(),e.j41(4,"ion-range",52),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.resolutionRatio,i)||(t.resolutionRatio=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ResolutionSliderUpdate())}),e.j41(5,"div",43),e.EFF(6),e.k0s(),e.j41(7,"div",44)(8,"input",53),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ResolutionSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.resolutionRatio,i)||(t.resolutionRatio=i),e.Njj(i)}),e.k0s()()(),e.j41(9,"div"),e.EFF(10),e.k0s(),e.j41(11,"h4"),e.nrm(12,"div",57),e.EFF(13),e.k0s(),e.j41(14,"ion-range",58),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.TraceFrameRate,i)||(t.TraceFrameRate=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeTraceFrameRate())}),e.j41(15,"div",43),e.EFF(16),e.k0s(),e.j41(17,"div",44)(18,"input",59),e.bIt("input",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ChangeTraceFrameRate())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.TraceFrameRate,i)||(t.TraceFrameRate=i),e.Njj(i)}),e.k0s()()(),e.j41(19,"ion-toggle",54),e.bIt("ionChange",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ToggleTransparentBG())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.useTransparentBG,i)||(t.useTransparentBG=i),e.Njj(i)}),e.EFF(20),e.k0s(),e.DNE(21,$t,19,10,"div",31),e.j41(22,"div")(23,"ion-toggle",60),e.bIt("ionChange",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.ToggleTransparentBG())}),e.mxI("ngModelChange",function(i){e.eBV(a);const t=e.XpG();return e.DH7(t.useAutoGenerateGif,i)||(t.useAutoGenerateGif=i),e.Njj(i)}),e.EFF(24),e.k0s(),e.DNE(25,Qt,13,9,"div",31),e.k0s()()()}if(2&s){const a=e.XpG();e.R7$(3),e.JRh(a.lang.text.voidDraw.ResolutionDetail),e.R7$(),e.R50("ngModel",a.resolutionRatio),e.Y8G("disabled",a.ToggleAutoResolution),e.R7$(2),e.JRh(a.lang.text.voidDraw.ResolutionRatio),e.R7$(2),e.R50("ngModel",a.resolutionRatio),e.R7$(2),e.Lme("",a.resolutionEffectedWidth," x ",a.resolutionEffectedHeight,""),e.R7$(3),e.SpI(" ",a.lang.text.voidDraw.SetFrameRate," "),e.R7$(),e.R50("ngModel",a.TraceFrameRate),e.R7$(2),e.JRh(a.lang.text.voidDraw.Millis),e.R7$(2),e.R50("ngModel",a.TraceFrameRate),e.R7$(),e.R50("ngModel",a.useTransparentBG),e.R7$(),e.SpI(" ",a.lang.text.voidDraw.UseTransparentBG," "),e.R7$(),e.Y8G("ngIf",a.useTransparentBG),e.R7$(2),e.R50("ngModel",a.useAutoGenerateGif),e.R7$(),e.SpI(" ",a.lang.text.voidDraw.useAutoGenerateGif," "),e.R7$(),e.Y8G("ngIf",a.useAutoGenerateGif)}}const Yt=[{path:"",component:(()=>{var s;class G{constructor(r,i,t,w,n,u,M,p,T,R,H,W,Z){this.lang=r,this.alertCtrl=i,this.loadingCtrl=t,this.global=w,this.indexed=n,this.nakama=u,this.p5toast=M,this.webrtc=p,this.router=T,this.route=R,this.navCtrl=H,this.p5loading=W,this.noti=Z,this.PageId="voiddraw",this.voidDrawId="voidDraw",this.p5DrawingStack=[],this.p5BakedStack=[],this.colorPickRed=0,this.colorPickGreen=0,this.colorPickBlue=0,this.colorPickAlpha=255,this.isCropMode=!1,this.gif_frames=[],this.usePIPMode=!1,this.HasConnectedPeer=!1,this.RemoteDrawSelected="local",this.p5MenuTable=[],this.BUTTON_HEIGHT=56,this.ServerList=[],this.isDrawServerCreated=!1,this.ReadyToShareAct=!1,this.AlreadyExistServer=!1,this.drawChat={logs:[],text:""},this.ShowChatInterface=!1,this.DisableChatInput=!1,this.TraceFrameRate=350,this.ColorList=["primary","secondary","tertiary"],this.ColorListIndex=0,this.BlockResize=!1,this.resolutionRatio=100,this.resolutionEffectedWidth=0,this.resolutionEffectedHeight=0,this.ToggleAutoResolution=!0,this.useTransparentBG=!1,this.useAutoGenerateGif=!1,this.AutoGen={draw_trace:!1,trace_duration:1,DrawAtOnce:1,StopFrame:1,scribble:!1,ScribbleExtent:.1},this.transparentBGHex="FFFFFF",this.transparentBGRed=255,this.transparentBGGreen=255,this.transparentBGBlue=255,this.WillLeaveHere=!1,this.QRNavParams={}}ngOnDestroy(){var r,i,t,w,n,u,M,p,T,R,H;this.route.queryParams.unsubscribe(),null===(r=(i=this.global.PageDismissAct)[this.navParams.dismiss])||void 0===r||r.call(i,{}),null===(t=this.p5ActualCanvas)||void 0===t||t.remove(),this.p5ActualCanvas=null,!this.AlreadyExistServer&&this.TargetRemoteAddress&&this.nakama.RemoveWebRTCServer(this.TargetRemoteAddress.split("://").pop()),null===(w=this.p5ImageCanvas)||void 0===w||w.remove(),this.p5ImageCanvas=null,this.global.PIPableInfo.PIPableCanvas==this.p5voiddrawCanvas.elt&&this.global.RemoveAutoPIPMode(),null===(n=this.p5voiddrawCanvas)||void 0===n||n.remove(),this.p5voiddrawCanvas=null,null===(u=this.p5voidDraw)||void 0===u||u.remove(),this.p5voidDraw=null,null===(M=this.p5SaveCanvas)||void 0===M||M.remove(),this.p5SaveCanvas=null,this.IceWebRTCWsClient&&(this.IceWebRTCWsClient.close(1e3,"close "),this.CancelRemoteAct()),null===(p=this.AddrQRShare)||void 0===p||p.dismiss(),null===(T=this.ChangeTransparent)||void 0===T||T.dismiss(),null===(R=this.ChangeResolution)||void 0===R||R.dismiss(),null===(H=this.RemoteLoadingCtrl)||void 0===H||H.dismiss(),this.p5loading.remove("voiddraw"),this.p5loading.remove(this.PageId),this.ClearTraceCache(!0),this.FrameRateInterval&&clearInterval(this.FrameRateInterval)}ngOnInit(){var r=this;this.PageId=`voiddraw_${Date.now()}`,this.route.queryParams.subscribe(function(){var i=(0,h.A)(function*(t){try{const w=r.router.getCurrentNavigation().extras.state;if(!w)throw"\ud398\uc774\uc9c0 \ubcf5\uadc0";r.navParams=w||{},r.voidDrawId=`voidDraw_${Date.now()}`,r.QueueAfterLoad=()=>{r.create_new_canvas({width:w.width,height:w.height,path:w.path,type:w.type}),w.remote&&(r.global.ArcadeWithFullScreen=!0,r.Port=w.remote.port,r.username=w.remote.username,r.password=w.remote.password,r.CreateRemoteLocalClient(w.remote.address,w.remote.channel))}}catch(w){console.log("\uadf8\ub9bc\ud310 \uc815\ubcf4 \ubc1b\uc9c0 \ubabb\ud568: ",w),r.p5SetDrawable(!0)}});return function(t){return i.apply(this,arguments)}}()),this.ToggleAutoResolution=!!localStorage.getItem("voiddraw_autoRes")}ionViewWillEnter(){var r,i,t;this.noti.Current=this.voidDrawId,this.WillLeaveHere=!1,this.global.portalHint=!1,null===(r=this.QueueAfterLoad)||void 0===r||r.call(this),null===(i=this.p5SetCanvasViewportInit)||void 0===i||i.call(this),this.QueueAfterLoad=null,null===(t=this.p5SetDrawable)||void 0===t||t.call(this,!0)}ionViewDidEnter(){var r=this;return(0,h.A)(function*(){r.global.StoreShortCutAct("void-draw"),r.AddShortCut(),yield r.p5loading.update({id:"voiddraw",message:r.lang.text.voidDraw.UseThisImage,forceEnd:null},!0),r.p5loading.remove("voiddraw")})()}AddShortCut(){delete this.global.p5KeyShortCut.Digit,this.global.p5KeyShortCut.HistoryAct=r=>{switch(r.code.slice(-1)){case"Z":this.p5history_act(-1);break;case"X":this.p5history_act(1);break;case"C":r.shiftKey?this.p5change_color():this.p5change_color_detail()}},this.global.p5KeyShortCut.AddAct=()=>{this.ClickRemoteAddButton()},this.global.p5KeyShortCut.SKeyAct=r=>{r.shiftKey?this.open_crop_tool_contextmenu():this.p5open_crop_tool()},this.global.p5KeyShortCut.DeleteAct=r=>{this.isCropMode?this.p5apply_crop():r.shiftKey?this.saveContextmenu():this.dismiss_draw()},this.global.p5KeyShortCut.FKeyAct=()=>{this.ToggleFocusMode()},this.global.p5KeyShortCut.Escape=()=>{this.isDrawServerCreated?this.CancelRemoteAct():this.navCtrl.pop()}}CancelRemoteAct(){this.ReadyToShareAct&&(this.ReadyToShareAct=!1,this.RemoteLoadingCtrl&&this.RemoteLoadingCtrl.dismiss(),this.isDrawServerCreated=!1,this.p5SetDrawable(!0),this.webrtc.close_webrtc(this.PageId),this.dismiss_draw(!0))}create_new_canvas(r){r.width=r.width||432,r.height=r.height||432,this.p5ActualCanvas&&(this.p5ActualCanvas.remove(),this.p5ActualCanvas=null),this.p5ImageCanvas&&(this.p5ImageCanvas.remove(),this.p5ImageCanvas=null),this.p5voidDraw&&this.p5voidDraw.remove(),this.create_p5voidDraw(r)}CheckIfDismissAct(r){switch(r.target.id){case"RemoteDrawQR":this.AddrQRShare.dismiss();break;case"colordetailOuter":this.ChangeTransparent.dismiss();break;case"resolutiondetailOuter":this.ChangeResolution.dismiss();break;case"traceframerate":this.SetFrameRate.dismiss()}}saveContextmenu(){return this.p5save_image(!0),!1}create_p5voidDraw(r){var i,t=this;let w=document.getElementById(this.voidDrawId);this.isCropMode=!1,null===(i=this.p5voiddrawCanvas)||void 0===i||i.remove(),this.p5voiddrawCanvas=null,this.p5voidDraw=new A(n=>{let u,M,p,T,R,H,W,Z,ie,Q,B,de,ge,f=n.createColorPicker("#000"),Ce=Math.min(r.width,r.height)/100,ae=!0;const be=()=>{ae||(this.colorPickAlpha=this.LineQuickTransparent,B=Number(this.LineQuickWeight)||1)};n.setup=(0,h.A)(function*(){const o=localStorage.getItem("voiddraw-lineweight")||1;B=Number(o),t.LineDefaultWeight=Number(o),t.LineDefaultTransparent=Number(localStorage.getItem("voiddraw-transparent")||255),t.colorPickAlpha=t.LineDefaultTransparent,t.LineQuickWeight=Number(localStorage.getItem("voiddraw-quick-lineweight")||1),t.LineQuickTransparent=Number(localStorage.getItem("voiddraw-quick-transparent")||138),f.style("position","absolute"),n.pixelDensity(1),n.noLoop(),n.noFill(),n.imageMode(n.CENTER),t.p5voiddrawCanvas=n.createCanvas(w.clientWidth,w.clientHeight),t.p5voiddrawCanvas.parent(w),t.SetPIPableInfo=()=>{t.usePIPMode=!0,t.global.SetPIPableInfo(t.p5voiddrawCanvas.elt,n)},re.x=n.width/2,re.y=n.height/2,t.ChangeDefaultLineWeight=()=>{B=Number(t.LineDefaultWeight)||1,localStorage.setItem("voiddraw-lineweight",`${t.LineDefaultWeight||1}`)},t.ChangeDefaultLineTransparent=()=>{localStorage.setItem("voiddraw-transparent",`${t.LineDefaultTransparent||255}`),t.ColorSliderUpdate()},t.ChangeQuickLineColor=()=>{localStorage.setItem("voiddraw-quick-lineweight",`${t.LineQuickWeight||1}`),be()},t.ChangeQuickTransparent=()=>{t.colorPickAlpha=t.LineQuickTransparent,localStorage.setItem("voiddraw-quick-transparent",`${t.LineQuickTransparent||138}`),be()};let c=!0;t.p5change_color=()=>{ae=!1,c=!1,f.elt.click()},t.p5change_color_detail=()=>{c?(t.ChangeTransparent.onDidDismiss().then(()=>{fe=!0,he=!1,t.global.RestoreShortCutAct("draw-transparent")}),fe=!1,t.global.StoreShortCutAct("draw-transparent"),t.global.p5KeyShortCut.EnterAct=()=>{document.activeElement==document.getElementById("voiddraw_default_weight")&&t.ChangeTransparent.dismiss()},t.ChangeTransparent.present(),c=!0):c=!0},t.ClearTraceCache=(j=!1)=>{for(var $;t.gif_frames.length;){const z=t.gif_frames.shift();URL.revokeObjectURL(z)}URL.revokeObjectURL(t.downloadCache),null===($=T)||void 0===$||$.remove(),T=null,j||null==n||n.redraw()},t.p5save_image=(j=!1,$=!1,z=!1)=>{var He;null===(He=t.p5SaveCanvas)||void 0===He||He.remove(),t.p5SaveCanvas=null,t.p5SaveCanvas=new A(m=>{m.setup=()=>{let ht=m.createCanvas(t.resolutionEffectedWidth,t.resolutionEffectedHeight);m.pixelDensity(1),m.smooth(),m.noFill(),m.noLoop(),t.useTransparentBG&&p.background(`#${t.transparentBGHex}`),p&&p.elt&&m.image(p,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),R&&m.image(R,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),u&&u.elt&&m.image(u,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight);const ln=ht.elt.toDataURL("image/png").replace("image/png","image/octet-stream"),Vt=`voidDraw_${m.year()}-${m.nf(m.month(),2)}-${m.nf(m.day(),2)}_${m.nf(m.hour(),2)}-${m.nf(m.minute(),2)}-${m.nf(m.second(),2)}.png`,ut=t.global.Base64ToBlob(ln,"image/png"),tt=URL.createObjectURL(ut);if(t.useTransparentBG){const ue=n.color(`#${t.transparentBGHex}`),J=(n.hue(ue)+180)%360,se=n.saturation(ue),Ae=n.map(n.brightness(ue),0,100,80,0,!0);n.push(),n.colorMode(n.HSB);const Se=n.color(J,se,Ae);n.pop();const K=n.lerpColor(Se,n.color(255),.8);p.background(K)}!function(){var ue=(0,h.A)(function*(){yield t.p5loading.update({id:t.PageId,image:tt,forceEnd:1e3})});return function(){return ue.apply(this,arguments)}}()();const _t=`voidDraw_${m.year()}-${m.nf(m.month(),2)}-${m.nf(m.day(),2)}_${m.nf(m.hour(),2)}-${m.nf(m.minute(),2)}-${m.nf(m.second(),2)}.gif`,St=function(){var ue=(0,h.A)(function*(){return yield new Promise(function(){var J=(0,h.A)(function*(se){t.gif_frames.length||se(null);let Ae="assets/dist/gif.worker.js";try{if(!localStorage.getItem("useCache"))throw"\uc624\ud504\ub77c\uc778 \uce90\uc2dc \uc6b0\ud68c\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c";const we=yield(yield fetch("assets/dist/gif.worker.js")).blob();Ae=URL.createObjectURL(we)}catch(K){console.log("gif \uc624\ud504\ub77c\uc778 \uc6cc\ucee4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",K)}const Se=new q({width:t.resolutionEffectedWidth,height:t.resolutionEffectedHeight,workerScript:Ae,transparent:t.useTransparentBG?`0x${t.transparentBGHex}`:void 0});for(let K=0,Ie=t.gif_frames.length;K<Ie;K++)yield new Promise(we=>{const _e=new Image;_e.src=t.gif_frames[K],_e.onload=()=>{Se.addFrame(_e,{delay:t.TraceFrameRate}),K==Ie-1&&(Se.on("finished",Oe=>{se(Oe)}),Se.render()),we(),_e.remove()}})});return function(se){return J.apply(this,arguments)}}())});return function(){return ue.apply(this,arguments)}}();if($)return void St().then(ue=>{var J;ue?(null===(J=ge)||void 0===J||J.remove(),t.downloadCache=URL.createObjectURL(ue),ge=m.createA(t.downloadCache,null),ge.elt.download=_t,ge.hide(),ge.parent(w),ge.elt.click()):(t.global.WriteValueToClipboard("image/png",ut,"image.png",t.PageId).catch(se=>{}),setTimeout(()=>{URL.revokeObjectURL(tt)},1e3))});const Bt=function(){var ue=(0,h.A)(function*(){let J;const se=function(){var K=(0,h.A)(function*(){const Ie=yield t.loadingCtrl.create({message:t.lang.text.voidDraw.ProcessingAnim});Ie.present();try{let _e=[...t.p5BakedStack];for(let pe=0;pe<oe;pe++)_e.push(t.p5DrawingStack[pe]);let $e=m.ceil(1e3*t.AutoGen.StopFrame/t.TraceFrameRate);const Oe=()=>{let pe=JSON.parse(JSON.stringify(_e));for(let ye of pe)for(let xe of ye.pos)xe.x=xe.x+m.random(-t.AutoGen.ScribbleExtent*Ce,t.AutoGen.ScribbleExtent*Ce),xe.y=xe.y+m.random(-t.AutoGen.ScribbleExtent*Ce,t.AutoGen.ScribbleExtent*Ce);return pe};let U=m.createGraphics(p.width,p.height);if(U.smooth(),U.pixelDensity(1),U.noFill(),U.noLoop(),t.AutoGen.draw_trace){let pe=0,ye=[0],xe=0;for(let je of _e)pe=m.floor(pe+je.pos.length*t.AutoGen.DrawAtOnce),xe=m.max(xe,je.pos.length+ye[ye.length-1]),ye.push(pe);ye.pop();const pt=m.ceil(1e3*t.AutoGen.trace_duration/t.TraceFrameRate),nt=m.ceil(xe/pt);for(let je=0;je<pt;je++){let mt=_e;m.clear(255,255,255,255),U.clear(255,255,255,255),t.AutoGen.scribble&&(mt=Oe()),U.push(),U.translate(Y);for(let it=0;it<mt.length;it++){const Lt=nt*je-ye[it];if(Lt>0){const Ee=mt[it];if(null==Ee||!Ee.color)continue;U.stroke(Ee.color),U.strokeWeight(Ee.weight),U.beginShape();for(let ft=0;ft<m.min(mt[it].pos.length,Lt);ft++)U.curveVertex(Ee.pos[ft].x,Ee.pos[ft].y);U.endShape()}}U.pop(),U.redraw(),p&&p.elt&&m.image(p,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),m.image(U,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),m.redraw();const cn=ht.elt.toDataURL("image/png").replace("image/png","image/octet-stream"),dn=t.global.Base64ToBlob(cn,"image/png"),gn=URL.createObjectURL(dn);t.gif_frames.push(gn)}}for(;$e;){m.clear(255,255,255,255),U.clear(255,255,255,255);let pe=_e;t.AutoGen.scribble&&(pe=Oe());for(let nt=0,je=pe.length;nt<je;nt++)Ge(U,[pe[nt]]);p&&p.elt&&m.image(p,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),m.image(U,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),m.redraw();const ye=ht.elt.toDataURL("image/png").replace("image/png","image/octet-stream"),xe=t.global.Base64ToBlob(ye,"image/png"),pt=URL.createObjectURL(xe);t.gif_frames.push(pt),$e--}const Le=yield St();var we;if(t.navParams.dismiss&&t.global.PageDismissAct[t.navParams.dismiss])"arcade-voiddraw"==t.navParams.dismiss||"voiddraw-remote"==t.navParams.dismiss?(null===(we=ge)||void 0===we||we.remove(),t.downloadCache=URL.createObjectURL(Le),ge=m.createA(t.downloadCache,null),ge.elt.download=_t,ge.hide(),ge.parent(w),ge.elt.click()):t.global.PageDismissAct[t.navParams.dismiss]({data:{name:Le?_t:Vt,img:Le||ut,file_ext:Le?"gif":"png",type:Le?"image/gif":"image/png",loadingCtrl:t.PageId}}),t.navCtrl.pop()}catch(_e){t.p5toast.show({text:`${t.lang.text.voidDraw.PlayAnimErr}: ${_e}`})}Ie.dismiss()});return function(){return K.apply(this,arguments)}}();if(t.gif_frames.length||z)J=tt;else{if(yield new Promise(we=>{t.SetFrameRate.onDidDismiss().then(()=>{t.FrameRateInterval&&clearInterval(t.FrameRateInterval),t.useAutoGenerateGif=t.AutoGen.draw_trace||t.AutoGen.scribble,t.ReadyToShareAct&&!z&&t.webrtc.Peers[t.PageId].dataChannel.send(JSON.stringify({type:"framerate",value:t.TraceFrameRate,autoGen:t.useAutoGenerateGif,draw_trace:t.useAutoGenerateGif?t.AutoGen.draw_trace:void 0,StopFrame:t.useAutoGenerateGif?t.AutoGen.StopFrame:void 0,ScribbleExtent:t.useAutoGenerateGif?t.AutoGen.ScribbleExtent:void 0,DrawAtOnce:t.useAutoGenerateGif?t.AutoGen.DrawAtOnce:void 0})),we()}),t.ChangeTraceFrameRate(),t.ToggleAutoResolution=!1,t.SetFrameRate.present()}),URL.revokeObjectURL(tt),t.useTransparentBG&&p.background(`#${t.transparentBGHex}`),m.resizeCanvas(t.resolutionEffectedWidth,t.resolutionEffectedHeight),t.useAutoGenerateGif)return void se();p&&p.elt&&m.image(p,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),R&&m.image(R,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight),u&&u.elt&&m.image(u,0,0,t.resolutionEffectedWidth,t.resolutionEffectedHeight);const K=ht.elt.toDataURL("image/png").replace("image/png","image/octet-stream"),Ie=t.global.Base64ToBlob(K,"image/png");if(J=URL.createObjectURL(Ie),t.useTransparentBG){const we=n.color(`#${t.transparentBGHex}`),_e=(n.hue(we)+180)%360,$e=n.saturation(we),Oe=n.map(n.brightness(we),0,100,80,0,!0);n.push(),n.colorMode(n.HSB);const U=n.color(_e,$e,Oe);n.pop();const Le=n.lerpColor(U,n.color(255),.8);p.background(Le)}yield t.p5loading.update({id:t.PageId,image:J})}var Ae,Se;t.p5loading.toast(`${t.lang.text.ContentViewer.CacheFrame}: [${t.gif_frames.length}]`,t.PageId),t.gif_frames.push(J),T||(t.ToggleAutoResolution=!1,t.UserToggleAutoResolution(),T=n.createGraphics((null===(Ae=x)||void 0===Ae?void 0:Ae.x)||r.width,(null===(Se=x)||void 0===Se?void 0:Se.y)||r.height),T.pixelDensity(1),T.noLoop(),T.noFill(),T.clear(255,255,255,255));for(let K=0;K<oe;K++)Ge(T,[t.p5DrawingStack[K]]);T.tint(255,160),T.image(p,0,0),T.noTint(),ie.style.fill="var(--ion-color-medium)",R.clear(255,255,255,255),Pt()});return function(){return ue.apply(this,arguments)}}();j?(t.useTransparentBG&&(t.navParams.path=void 0),function(){var J=(0,h.A)(function*(){yield Bt(),t.ReadyToShareAct&&!z&&t.webrtc.Peers[t.PageId].dataChannel.send(JSON.stringify({type:"trace_save",bgColor:t.useTransparentBG?t.transparentBGHex:void 0}))});return function(){return J.apply(this,arguments)}}()()):function(){var J=(0,h.A)(function*(){t.gif_frames.length&&oe&&(yield Bt());const se=yield St();t.navParams.dismiss&&t.global.PageDismissAct[t.navParams.dismiss]&&t.global.PageDismissAct[t.navParams.dismiss]({data:{name:se?_t:Vt,img:se||ut,file_ext:se?"gif":"png",type:se?"image/gif":"image/png",loadingCtrl:t.PageId}}),setTimeout(()=>{URL.revokeObjectURL(tt)},1e3),t.navCtrl.pop()});return function(){return J.apply(this,arguments)}}()()}})},t.p5history_act=(j,$=!1)=>{-1==j&&gt();let z=oe+j;if(!(z>t.p5DrawingStack.length)){switch(oe=n.min(n.max(0,z),t.p5DrawingStack.length),j){case 1:t.p5DrawingStack.length&&(ie.style.fill="var(--ion-color-dark)"),oe==t.p5DrawingStack.length&&(Q.style.fill="var(--ion-color-medium)"),Ge(u,[t.p5DrawingStack[oe-1]]);break;case-1:t.p5DrawingStack.length&&(Q.style.fill="var(--ion-color-dark)"),oe<1?(ie.style.fill="var(--ion-color-medium)",u.clear(255,255,255,255),n.redraw()):Ke()}!$&&t.ReadyToShareAct&&t.webrtc.Peers[t.PageId].dataChannel.send(JSON.stringify({type:"same",act:"history_act",data:j}))}},t.p5open_crop_tool=()=>{t.isCropMode?(t.isCropMode=!1,n.redraw()):(t.isCropMode=!0,fe=!0,x.x=u.width,x.y=u.height,Pe.x=0,Pe.y=0,n.redraw()),de(),he=!1},t.ToggleAutoResolution&&(t.resolutionRatio=n.min(100,100*E)),t.resolutionEffectedWidth=n.floor(r.width*t.resolutionRatio/100),t.resolutionEffectedHeight=n.floor(r.height*t.resolutionRatio/100),t.open_crop_tool_contextmenu=()=>{t.ChangeResolution.onDidDismiss().then(()=>{t.BlockResize=!1,fe=!0,he=!1,t.global.RestoreShortCutAct("resolution-detail")}),fe=!1,t.global.StoreShortCutAct("resolution-detail"),t.global.p5KeyShortCut.EnterAct=()=>{document.activeElement==document.getElementById("voiddraw_resolution")&&t.ChangeResolution.dismiss()},t.BlockResize=!0,t.ChangeResolution.present()},t.UserToggleAutoResolution=(j=!0)=>{T&&j&&t.ClearTraceCache(),t.ToggleAutoResolution?(localStorage.setItem("voiddraw_autoRes","1"),t.p5SetCanvasViewportInit()):localStorage.removeItem("voiddraw_autoRes"),t.ReadyToShareAct&&j&&t.webrtc.Peers[t.PageId].dataChannel.send(JSON.stringify({type:"res_tog",data:t.ToggleAutoResolution}))},t.ResolutionSliderUpdate=(j=!0)=>{T&&t.ClearTraceCache(),t.resolutionRatio=n.min(100,n.max(t.resolutionRatio,1)),n.pixelDensity(n.min(1,1*(Number(t.resolutionRatio)||1)/100/E)),n.redraw(),t.resolutionEffectedWidth=n.floor(u.width*(Number(t.resolutionRatio)||1)/100),t.resolutionEffectedHeight=n.floor(u.height*(Number(t.resolutionRatio)||1)/100),t.ReadyToShareAct&&j&&t.webrtc.Peers[t.PageId].dataChannel.send(JSON.stringify({type:"res_slider",data:t.resolutionRatio}))},t.p5apply_crop=(0,h.A)(function*(j=!0){yield gt(),u.resizeCanvas(x.x,x.y),M=n.createVector(u.width/2,u.height/2),j&&Y.sub(Pe),Ke(),p.resizeCanvas(x.x,x.y),p.push(),p.background(t.navParams.isDarkMode?26:255),p.translate(Y),T&&t.ClearTraceCache(),t.p5BaseImage&&p.image(t.p5BaseImage,0,0),p.pop(),p.redraw(),R.resizeCanvas(x.x,x.y),R.push(),H&&(R.translate(Y),R.image(H,ct.x,ct.y)),R.pop(),R.redraw();let $=R.elt.toDataURL("image/png");if(n.loadImage($,z=>{ct.x=-Y.x,ct.y=-Y.y,H=z}),t.isCropMode=!1,de(),t.ToggleAutoResolution&&(t.resolutionRatio=n.min(100,100*E)),t.resolutionEffectedWidth=n.floor(x.x*t.resolutionRatio/100),t.resolutionEffectedHeight=n.floor(x.y*t.resolutionRatio/100),t.p5SetCanvasViewportInit(),j&&t.ReadyToShareAct){let z=t.p5getCropPos(),He=t.p5getCropSize();t.webrtc.Peers[t.PageId].dataChannel.send(JSON.stringify({type:"draw",act:"crop",cropPX:z.x,cropPY:z.y,cropSX:He.x,cropSY:He.y}))}}),t.p5SetDrawable=on,W=n.createElement("table"),W.style("position: absolute; top: 0px;"),W.style(`width: 100%; height: ${t.BUTTON_HEIGHT}px;`),W.style("background-color: var(--voidDraw-menu-background);"),W.parent(w),t.p5MenuTable.push(W);let v=W.elt.insertRow(0),I=v.insertCell(0);I.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">A</div><ion-icon style="width: 27px; height: 27px" name="wifi-outline"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="wifi-outline"></ion-icon>',I.style.textAlign="center",I.style.cursor="pointer",I.onclick=()=>{t.ClickRemoteAddButton()},I.oncontextmenu=()=>{t.ToggleFocusContextMenu()};let L=v.insertCell(1);L.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">S</div><ion-icon style="width: 27px; height: 27px" name="crop"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="crop"></ion-icon>',L.style.textAlign="center",L.style.cursor="pointer",L.onclick=()=>{t.p5open_crop_tool()},L.oncontextmenu=()=>{t.open_crop_tool_contextmenu()};let N=v.insertCell(2);N.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>',N.style.textAlign="center",N.style.cursor="pointer",N.onclick=()=>t.dismiss_draw(),N.oncontextmenu=()=>t.saveContextmenu(),de=()=>{N.innerHTML=t.isCropMode?t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="cut-sharp"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="cut-sharp"></ion-icon>':t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>'},Z=n.createElement("table"),Z.style("position: absolute; bottom: 0px;"),Z.style(`width: 100%; height: ${t.BUTTON_HEIGHT}px;`),Z.style("background-color: var(--voidDraw-menu-background);"),Z.parent(w),t.p5MenuTable.push(Z);let Ve=Z.elt.insertRow(0),Be=Ve.insertCell(0);Be.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">Z</div><ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon></div>':'<ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon>',ie=document.getElementById("undoIcon"),ie.style.fill="var(--ion-color-medium)",Be.style.textAlign="center",Be.style.cursor="pointer",Be.onclick=()=>{t.p5history_act(-1)};let et=Ve.insertCell(1);et.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">X</div><ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon></div>':'<ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon>',Q=document.getElementById("redoIcon"),Q.style.fill="var(--ion-color-medium)",et.style.textAlign="center",et.style.cursor="pointer",et.onclick=()=>{t.p5history_act(1)};let Te=Ve.insertCell(2);if(Te.innerHTML=t.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">C</div><ion-icon style="width: 27px; height: 27px" name="brush"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="brush"></ion-icon>',f.style("width: 0px; height: 0px; opacity: 0;"),f.hide(),f.parent(Te),f.elt.oninput=()=>{B=Number(t.LineQuickWeight)||Number(t.LineDefaultWeight)||1;let j=f.color().levels,$=`#${n.hex(j[0],2)}${n.hex(j[1],2)}${n.hex(j[2],2)}`;Te.childNodes[0].style.color=$,t.colorPickRed=j[0],t.colorPickGreen=j[1],t.colorPickBlue=j[2],t.colorPickAlpha=t.LineQuickTransparent},r.path&&(f.value("#ff0000"),f.elt.oninput()),Te.style.textAlign="center",Te.style.cursor="pointer",Te.onclick=()=>{t.p5change_color_detail()},Te.oncontextmenu=()=>(t.p5change_color(),be(),!1),t.ColorSliderUpdate=()=>{ae=!0,t.colorPickAlpha=t.LineDefaultTransparent,B=Number(t.LineDefaultWeight)||1;let j=`#${n.hex(Number(t.colorPickRed)||0,2)}${n.hex(Number(t.colorPickGreen)||0,2)}${n.hex(Number(t.colorPickBlue)||0,2)}`;f.value(j);let $=`#${n.hex(Number(t.colorPickRed)||0,2)}${n.hex(Number(t.colorPickGreen)||0,2)}${n.hex(Number(t.colorPickBlue)||0,2)}`;Te.childNodes[0].style.color=$},t.ColorSliderUpdate(),t.p5SetCanvasViewportInit=(j=!1)=>{var $;n.resizeCanvas(w.clientWidth,w.clientHeight),j&&(null===($=t.SetPIPableInfo)||void 0===$||$.call(t),t.global.CraeteAutoPIPMode()),vt=re.copy(),Ct=E,bt=Ne.copy(),Re=0,wt=!0,n.loop()},u=n.createGraphics(r.width,r.height),M=n.createVector(u.width/2,u.height/2),u.pixelDensity(1),u.noLoop(),u.noFill(),t.p5ActualCanvas=u,p=n.createGraphics(r.width,r.height),p.pixelDensity(1),p.noLoop(),p.noFill(),p.background(t.navParams.isDarkMode?26:255),t.p5ImageCanvas=p,R=n.createGraphics(r.width,r.height),R.pixelDensity(1),R.noLoop(),R.noFill(),R.clear(255,255,255,255),r.path){let j=yield t.indexed.loadBlobFromUserPath(r.path,r.type);const $=URL.createObjectURL(j);n.loadImage($,z=>{t.p5BaseImage=z,p.image(t.p5BaseImage,0,0),p.redraw(),URL.revokeObjectURL($),setTimeout(()=>{t.p5SetCanvasViewportInit()},100)},z=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",z),p.redraw(),URL.revokeObjectURL($),setTimeout(()=>{t.p5SetCanvasViewportInit()},100)})}else p.redraw(),setTimeout(()=>{t.p5SetCanvasViewportInit()},100);r.width<r.height&&(Ce/=E),t.p5getCropPos=qt,t.p5setCropPos=yt,t.p5getCropSize=Zt,t.p5setCropSize=en,t.p5RemoteDrawStart=tn,t.p5RemoteDrawing=nn,t.p5RemoteDrawingEnd=an,t.p5CancelCurrentDraw=()=>{O=null,n.redraw()},t.navParams.scrollHeight&&yt(0,-t.navParams.scrollHeight)});let re=n.createVector(),E=1,Ne=n.createVector(0,0),Y=n.createVector(),ct=n.createVector(),Pe=n.createVector(),x=n.createVector(),wt=!1,Re=0,vt=n.createVector(0,0),Ct=0,bt=n.createVector(0,0),qt=()=>Y,Zt=()=>x,yt=(o,c)=>{Y.x=o,Y.y=c,p.translate(o,c),R.translate(o,c),n.redraw()},en=(o,c)=>{x.x=o,x.y=c,p.translate(o,c),R.translate(o,c),n.redraw()},Fe=o=>n.sin(o*n.PI/2);n.draw=()=>{if(wt){Re+=.07,Re>=1&&(wt=!1,Re=1,n.noLoop()),Ne.x=n.lerp(bt.x,n.width/2,Fe(Re)),Ne.y=n.lerp(bt.y,n.height/2,Fe(Re)),re.x=n.lerp(vt.x,0,Fe(Re)),re.y=n.lerp(vt.y,0,Fe(Re));let o=w.clientHeight-2*this.BUTTON_HEIGHT;E=n.lerp(Ct,w.clientWidth/o<u.width/u.height?w.clientWidth/u.width:o/u.height,Fe(Re)),this.ToggleAutoResolution&&(this.resolutionRatio=n.min(100,100*E),this.resolutionEffectedWidth=n.floor(u.width*this.resolutionRatio/100),this.resolutionEffectedHeight=n.floor(u.height*this.resolutionRatio/100)),n.pixelDensity(n.min(1,1*this.resolutionRatio/100/E))}if(this.usePIPMode?n.background(0):n.clear(255,255,255,255),n.push(),n.translate(Ne),n.scale(E),n.translate(re),n.image(p,0,0),T&&n.image(T,0,0),n.image(R,0,0),u&&n.image(u,0,0),this.isCropMode)n.push(),n.translate(-u.width/2,-u.height/2),n.translate(Pe),n.noStroke(),n.fill(0,100),n.rect(0,0,x.x,x.y),n.stroke(255,0,0),n.strokeWeight(8),n.beginShape(n.LINES),n.vertex(0,0),n.vertex(x.x,0),n.vertex(x.x,0),n.vertex(x.x,.8*x.y),n.vertex(0,0),n.vertex(0,x.y),n.vertex(0,x.y),n.vertex(.8*x.x,x.y),n.stroke(255,255,0),n.vertex(.8*x.x,x.y),n.vertex(x.x,x.y),n.vertex(x.x,.8*x.y),n.vertex(x.x,x.y),n.endShape(),n.pop();else{if(y&&y.pos&&y.pos.length){n.push(),n.translate(Y),n.stroke(y.color),n.strokeWeight(y.weight),n.beginShape();for(let o=0,c=y.pos.length;o<c;o++)n.curveVertex(y.pos[o].x-M.x,y.pos[o].y-M.y);n.endShape(),n.pop()}if(this.ReadyToShareAct&&O&&O.pos&&O.pos.length){n.push(),n.translate(Y),n.stroke(O.color),n.strokeWeight(O.weight),n.beginShape();for(let o=0,c=O.pos.length;o<c;o++)n.curveVertex(O.pos[o].x-M.x,O.pos[o].y-M.y);n.endShape(),n.pop()}}n.pop()},this.p5DrawingStack=[];let Pt=()=>{y={},this.p5DrawingStack.length=0,this.p5BakedStack.length=0,oe=0,Ke(),n.redraw()};this.p5ClearCurrentDraw=Pt;let oe=0,Ke=()=>{u.clear(255,255,255,255);for(let o=0;o<oe;o++)Ge(u,[this.p5DrawingStack[o]])};const Ge=(o,c=[y])=>{for(o.push(),o.translate(Y);c.length;){const v=c.shift();if(null!=v&&v.color){o.stroke(v.color),o.strokeWeight(v.weight),o.beginShape();for(let I=0,L=v.pos.length;I<L;I++)o.curveVertex(v.pos[I].x,v.pos[I].y);o.endShape()}}o.pop(),o.redraw(),n.redraw()};n.windowResized=()=>{this.BlockResize||setTimeout(()=>{this.p5SetCanvasViewportInit()},0)};let Rt,Xe,xt,Dt,Gt,qe,Tt,y={},O={},tn=o=>{O=o,n.redraw()},nn=o=>{O&&O.pos&&O.pos.push(o),n.redraw()},an=o=>{O.pos.push(o),O.pos.push(o),this.p5DrawingStack.length=oe,O&&(this.p5DrawingStack.push(O),this.p5DrawingStack.length>180&&(gt(),this.p5BakedStack.push(O)),Ge(u,[O])),oe=this.p5DrawingStack.length,O=null,n.redraw()},kt=0,dt=!1,he=!1;n.mousePressed=o=>{if(fe){if(o.target!=this.p5voiddrawCanvas.elt)return void(he=!0);switch(o.which){case 1:this.isCropMode?At():jt();break;case 3:Xe=n.createVector(n.mouseX,n.mouseY),qe=re.copy(),Rt=n.createVector(n.mouseX,n.mouseY);break;case 2:this.p5SetCanvasViewportInit()}}};let At=(o,c)=>{const v=Me(o,c),I=Pe.copy().add(x).sub(n.createVector(u.width/2,u.height/2)),L=v.dist(I),N=.2*n.max(x.x,x.y);dt=L<N,dt?(Dt=n.createVector(n.mouseX,n.mouseY),Tt=x.copy()):xt=n.createVector(n.mouseX,n.mouseY).sub(Pe.mult(E))};const jt=(o,c)=>{var v,I;ie.style.fill="var(--ion-color-dark)",Q.style.fill="var(--ion-color-medium)";let L=Me(o,c);L.sub(Y),L.add(M);let N={x:L.x,y:L.y},Ve=f.color().levels,Be=`#${n.hex(Ve[0],2)}${n.hex(Ve[1],2)}${n.hex(Ve[2],2)}${n.hex(this.colorPickAlpha,2)}`;y={pos:[],color:Be,weight:Ce*B},null===(v=y.pos)||void 0===v||v.push(N),null===(I=y.pos)||void 0===I||I.push(N),this.ReadyToShareAct&&this.webrtc.Peers[this.PageId].dataChannel.send(JSON.stringify({type:"draw",act:"start",data:y})),n.redraw()};n.mouseDragged=o=>{if(fe&&!he)switch(o.which){case 1:if(this.isCropMode){let c=n.createVector(n.mouseX,n.mouseY);dt?x=Tt.copy().add(Dt.copy().sub(c).div(-E)):Pe=xt.copy().sub(c).div(-E),n.redraw()}else{let c=Me();c.sub(Y),c.add(M);let v={x:c.x,y:c.y};y&&y.pos&&y.pos.push(v),this.ReadyToShareAct&&this.webrtc.Peers[this.PageId].dataChannel.send(JSON.stringify({type:"draw",act:"moved",data:v})),n.redraw()}break;case 3:Rt=n.createVector(n.mouseX,n.mouseY),re=qe.copy().add(Rt.sub(Xe).div(E)),n.redraw()}},n.mouseWheel=o=>{fe&&(o.target==this.p5voiddrawCanvas.elt?(rn(Me()),E*=o.deltaY<0?1.1:.9,n.pixelDensity(n.min(1,1*this.resolutionRatio/100/E)),n.redraw()):he=!0)},n.mouseReleased=o=>{if(fe){if(1===o.which&&!this.isCropMode&&!he){let I=Me();I.sub(Y),I.add(M);let L={x:I.x,y:I.y};if(y)try{var c,v;null===(c=y.pos)||void 0===c||c.push(L),null===(v=y.pos)||void 0===v||v.push(L),this.ReadyToShareAct&&this.webrtc.Peers[this.PageId].dataChannel.send(JSON.stringify({type:"draw",act:"end",data:L}))}catch{}Mt()}he=!1}};const rn=o=>{Ne=n.createVector(n.mouseX,n.mouseY),re=o.mult(-1)},Me=(o,c)=>{const v=n.createVector(o||n.mouseX,c||n.mouseY);return v.sub(Ne),v.div(E),v.sub(re),v};let ee=[],Ze=!1,fe=!0,on=o=>{fe=o};n.touchStarted=o=>{if(fe){if(he=!1,ee=o.touches,o.target!=this.p5voiddrawCanvas.elt)return void(he=!0);switch(Ze=!0,ee.length){case 1:this.isCropMode?At(o.changedTouches[0].clientX,o.changedTouches[0].clientY-(this.global.ArcadeWithFullScreen?0:56)):jt(o.changedTouches[0].clientX,o.changedTouches[0].clientY-(this.global.ArcadeWithFullScreen?0:56));break;case 2:let c=n.createVector(ee[0].clientX,ee[0].clientY-(this.global.ArcadeWithFullScreen?0:56)),v=n.createVector(ee[1].clientX,ee[1].clientY-(this.global.ArcadeWithFullScreen?0:56));kt=c.dist(v),Xe=c.copy().add(v).div(2),qe=re.copy(),Gt=E,y=null,this.ReadyToShareAct&&this.webrtc.Peers[this.PageId].dataChannel.send(JSON.stringify({type:"draw",act:"cancel"}));break;default:Ze=!1,this.p5SetCanvasViewportInit()}}},n.touchMoved=o=>{if(fe&&Ze){switch(ee=o.touches,ee.length){case 1:if(this.isCropMode&&!he){let c=n.createVector(o.changedTouches[0].clientX,o.changedTouches[0].clientY-(this.global.ArcadeWithFullScreen?0:56));dt?x=Tt.copy().add(Dt.copy().sub(c).div(-E)):Pe=xt.copy().sub(c).div(-E),n.redraw()}else{let c=Me(o.changedTouches[0].clientX,o.changedTouches[0].clientY-(this.global.ArcadeWithFullScreen?0:56));c.sub(Y),c.add(M);let v={x:c.x,y:c.y};y&&y.pos&&y.pos.push(v),this.ReadyToShareAct&&this.webrtc.Peers[this.PageId].dataChannel.send(JSON.stringify({type:"draw",act:"moved",data:v})),n.redraw()}break;case 2:{let c=n.createVector(ee[0].clientX,ee[0].clientY-(this.global.ArcadeWithFullScreen?0:56)),v=n.createVector(ee[1].clientX,ee[1].clientY-(this.global.ArcadeWithFullScreen?0:56)),I=c.copy().add(v).div(2);E=c.dist(v)/kt*Gt,re=qe.copy().add(I.sub(Xe).div(E)),n.pixelDensity(n.min(1,1*this.resolutionRatio/100/E)),n.redraw()}}return!1}},n.touchEnded=o=>{if(fe&&o.changedTouches){switch(ee=o.touches,Ze=!1,ee.length){case 0:if(!this.isCropMode&&!he&&y){var c,v;let I=Me(o.changedTouches[0].clientX,o.changedTouches[0].clientY-(this.global.ArcadeWithFullScreen?0:56));I.sub(Y),I.add(M);const L={x:I.x,y:I.y};null===(c=y.pos)||void 0===c||c.push(L),null===(v=y.pos)||void 0===v||v.push(L),this.ReadyToShareAct&&this.webrtc.Peers[this.PageId].dataChannel.send(JSON.stringify({type:"draw",act:"end",data:L})),Mt()}break;case 1:if(!Ze)return;sn(),kt=0,y=null}he=!1}};const sn=()=>{Xe=n.createVector(ee[0].clientX,ee[0].clientY-(this.global.ArcadeWithFullScreen?0:56)),qe=re.copy()},Mt=()=>{if(this.p5DrawingStack.length=oe,y)if(this.p5DrawingStack.push(y),this.p5DrawingStack.length>180){gt();const o=this.p5DrawingStack.shift();this.p5BakedStack.push(o),Ge(R,[o]);const c=R.elt.toDataURL("image/png");n.loadImage(c,v=>{H=v,R.redraw()}),Ke()}else Ge(u,[y]);oe=this.p5DrawingStack.length,Xe=null,he=!1,y=null,n.redraw()},gt=function(){var o=(0,h.A)(function*(){t.p5DrawingStack.length>20&&(yield new Promise(c=>{const v=t.p5DrawingStack.length-20;let I=[];for(let N=0;N<v;N++)I.push(t.p5DrawingStack.shift());t.p5BakedStack=[...t.p5BakedStack,...I],Ge(R,I);const L=R.elt.toDataURL("image/png");n.loadImage(L,N=>{H=N,R.redraw(),c(void 0)},N=>{c(N)}),Ke(),oe=t.p5DrawingStack.length}))});return function(){return o.apply(this,arguments)}}()})}ClickRemoteAddButton(){if(!this.isDrawServerCreated){if(this.IceWebRTCWsClient)return this.isDrawServerCreated=!0,this.global.StoreShortCutAct("voiddraw-remote"),this.p5SetDrawable(!1),this.AddrQRShare.onDidDismiss().then(()=>{this.p5SetDrawable(!0),this.isDrawServerCreated=!1,this.global.RestoreShortCutAct("voiddraw-remote"),this.HasConnectedPeer||this.p5SetDrawable(!0)}),void this.AddrQRShare.present();this.ServerList=this.nakama.get_all_online_server(),this.ServerList.length?(this.RemoteDrawSelected=this.ServerList[0],this.p5SetDrawable(!1),this.RemoteDraw.open()):(this.p5SetDrawable(!1),this.RemoteBridgeServerSelected({detail:{value:"local"}}))}}ToggleFocusMode(){var r;return this.global.ToggleFullScreen(),null===(r=this.p5voidDraw)||void 0===r||r.windowResized(),!1}ToggleFocusContextMenu(){this.BUTTON_HEIGHT=0,this.ToggleFocusMode();for(let r of this.p5MenuTable)r.remove();return this.p5MenuTable.length=0,!1}RemoteBridgeServerSelected(r){var i=this;return(0,h.A)(function*(){if(i.isDrawServerCreated)return;let t=r.detail.value;if("local"===t){let w;i.alertCtrl.create({header:i.lang.text.voidDraw.LocalAddrInput,inputs:[{type:"text",placeholder:"(wss://)0.0.0.0(:0)"},{type:"text",placeholder:"rtcport:username:password"}],buttons:[{text:i.lang.text.voidDraw.Confirm,handler:n=>{let u=n[1].split(":");i.Port=u[0],i.username=u[1],i.password=u[2],n[0]?(i.InputCustomAddress=n[0],i.p5SetDrawable(!1),w=!0,i.CreateOnMessageLink(),i.CreateRemoteLocalClient(n[0],n[1],void 0,!0)):i.p5toast.show({text:i.lang.text.voidDraw.InputAddress})}}]}).then(n=>{n.onWillDismiss().then(()=>{i.p5SetDrawable(!0)}),n.onDidDismiss().then(()=>{!w&&!i.WillLeaveHere&&i.global.RestoreShortCutAct("voiddraw-remote-bridge")}),i.global.StoreShortCutAct("voiddraw-remote-bridge"),n.present()})}else i.InputCustomAddress=`${t.info.useSSL?"wss":"ws"}://${t.info.address}`,i.p5SetDrawable(!1),i.CreateOnMessageLink(),i.CreateRemoteLocalClient(i.InputCustomAddress,r[1],t.info)})()}CreateRemoteLocalClient(r,i,t,w){var n=this;return(0,h.A)(function*(){const u=`voiddraw_CreateRemoteLocalClient_${Date.now()}`;let p=r.split("://"),T=p.pop().split(":");n.TargetRemoteAddress=T[0],yield n.p5loading.update({id:u,message:`${n.lang.text.InstantCall.Connecting}: ${T[0]}`,forceEnd:null});let H,R=p.pop();R?R+=":":R=n.global.checkProtocolFromAddress(T[0])?"wss:":"ws:",t?(n.QRNavParams.cdn_port=t.cdn_port,n.QRNavParams.apache_port=t.apache_port,n.QRNavParams.square_port=t.square_port,n.AlreadyExistServer=!0):yield n.nakama.SaveWebRTCServer({urls:[`stun:${T[0]}:${n.Port||3478}`,`turn:${T[0]}:${n.Port||3478}`],username:n.username||"username",credential:n.password||"password"}).then(W=>n.AlreadyExistServer=W),n.IceWebRTCWsClient=new WebSocket(`${R}//${T[0]}:${T[1]||12013}/`),n.AddShortCut(),n.isDrawServerCreated=!0,n.IceWebRTCWsClient.onopen=(0,h.A)(function*(){n.p5loading.update({id:u,message:`${n.lang.text.voidDraw.Connected}: ${T[0]}`,progress:1,forceEnd:1e3}),i?(n.IceWebRTCWsClient.send(JSON.stringify({type:"join",channel:i,quick:n.navParams.quick})),yield new Promise(W=>setTimeout(W,n.global.WebsocketRetryTerm)),n.RemoteLoadingCtrl=yield n.loadingCtrl.create({message:n.lang.text.voidDraw.WaitingConnection}),n.RemoteLoadingCtrl.present(),n.IceWebRTCWsClient.send(JSON.stringify({type:"size_req",channel:i}))):n.IceWebRTCWsClient.send(JSON.stringify({type:"initInfo",act:"voiddraw",max:2}))}),n.IceWebRTCWsClient.onmessage=function(){var W=(0,h.A)(function*(Z){var ie;let Q;try{let f=JSON.parse(Z.data);if(void 0===H)H=f.uid;else if(H==f.uid&&"text"!=f.type)return;switch(f.type){case"text":{let B=f.msg.split(" "),de=[],ae="";const ke=H==f.uid,ze=ke?f.name||n.lang.text.MinimalChat.name_me:f.name||n.lang.text.MinimalChat.name_stranger_group,me=f.uid?(f.uid.replace(/[^5-79a-b]/g,"")+"abcdef").substring(0,6):te.ud?"888888":"444444";for(let be=0,re=B.length;be<re;be++)0==B[be].indexOf("http://")||0==B[be].indexOf("https://")?(de.push({text:" "+ae+" "}),ae="",de.push({href:!0,text:B[be]})):ae+=" "+B[be];ae&&de.push({text:" "+ae}),n.drawChat.logs.push({color:me,text:de,target:ze,isMe:ke}),n.noti.PushLocal({id:14,title:ze,body:f.msg,smallIcon_ln:"voidDraw",bgcolor:me},n.voidDrawId,()=>{window.focus(),n.p5loading.update({id:"14",clickable:null,forceEnd:100})}),n.auto_scroll_down()}break;case"socket_react":switch(f.act){case"WEBRTC_REPLY_INIT_SIGNAL_PART":n.webrtc.WEBRTC_REPLY_INIT_SIGNAL_PART({client:n.IceWebRTCWsClient,channel:Q},n.PageId,"data");break;case"WEBRTC_RECEIVE_ANSWER_PART":n.webrtc.WEBRTC_RECEIVE_ANSWER_PART({client:n.IceWebRTCWsClient,channel:Q},n.PageId);break;case"WEBRTC_REPLY_INIT_SIGNAL":n.RemoteLoadingCtrl.message=n.lang.text.voidDraw.WebRTC_Reply,n.webrtc.WEBRTC_REPLY_INIT_SIGNAL(f.data_str,{client:n.IceWebRTCWsClient,channel:Q},n.PageId),"EOL"==f.data_str&&(n.RemoteLoadingCtrl.message=n.lang.text.voidDraw.WebRTC_Offer,n.webrtc.CreateAnswer({client:n.IceWebRTCWsClient,channel:Q},n.PageId)),n.RemoteLoadingCtrl.message=n.lang.text.voidDraw.WebRTC_Ice;break;case"WEBRTC_ICE_CANDIDATES":n.webrtc.WEBRTC_ICE_CANDIDATES(f.data_str,{client:n.IceWebRTCWsClient,channel:Q},n.PageId),n.RemoteLoadingCtrl.message=n.lang.text.voidDraw.WebRTC_datachannel,n.IceWebRTCWsClient.send(JSON.stringify({type:"init_end",channel:Q}));break;case"WEBRTC_INIT_REQ_SIGNAL":n.webrtc.WEBRTC_INIT_REQ_SIGNAL({client:n.IceWebRTCWsClient,channel:Q},n.PageId,"data");break;case"WEBRTC_RECEIVE_ANSWER":n.webrtc.WEBRTC_RECEIVE_ANSWER(f.data_str,{client:n.IceWebRTCWsClient,channel:Q},n.PageId)}break;case"init_id":n.QRNavParams={address:r,channel:f.id,user_id:f.uid},n.init_gen_qrcode(f.socketId).then(()=>{n.IceWebRTCWsClient.send(JSON.stringify({type:"update_reqInfo",socketId:f.socketId,keys:["address","username","credential","port"],username:n.username||"username",credential:n.password||"password",port:n.Port}))}),n.AddrQRShare.onDidDismiss().then(()=>{n.isDrawServerCreated=!1,n.global.RestoreShortCutAct("voiddraw-remote"),n.HasConnectedPeer||n.p5SetDrawable(!0)}),n.global.StoreShortCutAct("voiddraw-remote"),n.p5SetDrawable(!1),n.AddrQRShare.present(),n.IceWebRTCWsClient.send(JSON.stringify({type:"join",channel:f.id,customInput:w,server_uid:null===(ie=n.nakama.servers[null==t?void 0:t.isOfficial])||void 0===ie||null===(ie=ie[null==t?void 0:t.target])||void 0===ie?void 0:ie.session.user_id})),Q=f.id;break;case"init_req":n.RemoteLoadingCtrl.message=n.lang.text.voidDraw.WebRTC_Init,n.webrtc.initialize("data",n.PageId).then((0,h.A)(function*(){n.webrtc.Peers[n.PageId].HangUpCallBack=()=>{var B;null===(B=n.IceWebRTCWsClient)||void 0===B||B.close(1e3,"hangup_webrtc")},n.webrtc.Peers[n.PageId].signalingChannel=n.IceWebRTCWsClient,n.webrtc.Peers[n.PageId].signalChannelId=Q,n.CreateOnMessageLink(),n.CreateOnOpenAct(),n.webrtc.CreateOffer(n.PageId),yield new Promise(B=>setTimeout(B,n.global.WebsocketRetryTerm)),n.IceWebRTCWsClient.send(JSON.stringify({type:"socket_react",channel:Q,act:"WEBRTC_INIT_REQ_SIGNAL"}))}));break;case"size_req":n.AddrQRShare.dismiss(),n.RemoteLoadingCtrl=yield n.loadingCtrl.create({message:n.lang.text.voidDraw.WaitingConnection}),n.RemoteLoadingCtrl.present();let Ce=n.p5getCropPos();n.IceWebRTCWsClient.send(JSON.stringify({type:"size",width:n.p5ActualCanvas.width,height:n.p5ActualCanvas.height,cropX:Ce.x,cropY:Ce.y,channel:Q}));break;case"join":n.ShowChatInterface=!0,n.DisableChatInput=!1,setTimeout(()=>{n.DrawChatLog=document.getElementById(n.voidDrawId+"_log");const de=H==f.uid?f.name||n.lang.text.MinimalChat.name_me:f.name||n.lang.text.MinimalChat.name_stranger_group,ae=f.uid?(f.uid.replace(/[^5-79a-b]/g,"")+"abcdef").substring(0,6):te.ud?"888888":"444444";n.drawChat.logs.push({color:ae,text:[{text:" "+n.lang.text.MinimalChat.user_join}],target:de,isSystem:!0}),n.noti.PushLocal({id:14,title:n.lang.text.MinimalChat.user_join,body:de+` | ${n.lang.text.MinimalChat.user_join_comment}`,smallIcon_ln:"voidDraw",bgcolor:ae},n.voidDrawId,()=>{window.focus(),n.p5loading.update({id:"14",clickable:null,forceEnd:100})}),n.auto_scroll_down()},100),n.p5DrawingStack.length=0,n.HasConnectedPeer=!0,n.p5SetDrawable(!1);break;case"leave":{const de=H==f.uid?f.name||n.lang.text.MinimalChat.name_me:f.name||n.lang.text.MinimalChat.name_stranger_group,ae=f.uid?(f.uid.replace(/[^5-79a-b]/g,"")+"abcdef").substring(0,6):te.ud?"888888":"444444";n.drawChat.logs.push({color:ae,text:[{text:" "+n.lang.text.MinimalChat.user_out}],target:de,isSystem:!0}),n.noti.PushLocal({id:14,title:n.lang.text.MinimalChat.user_out,body:de+` | ${n.lang.text.MinimalChat.user_out_comment}`,smallIcon_ln:"voidDraw",bgcolor:ae},n.voidDrawId,()=>{window.focus(),n.p5loading.update({id:"14",clickable:null,forceEnd:100})}),n.auto_scroll_down(),n.HasConnectedPeer=!1,n.p5SetDrawable(!0),n.RemoteLoadingCtrl.dismiss(),n.IceWebRTCWsClient.close(1e3,"leave_pair")}break;case"size":n.create_new_canvas({width:f.width,height:f.height}),n.p5SetDrawable(!1),n.p5setCropPos(f.cropX,f.cropY),n.p5voidDraw.redraw(),n.RemoteLoadingCtrl.message=n.lang.text.voidDraw.WebRTC_Init,n.webrtc.initialize("data",n.PageId).then(()=>{n.webrtc.Peers[n.PageId].HangUpCallBack=()=>{var B;null===(B=n.IceWebRTCWsClient)||void 0===B||B.close(1e3,"hangup_callback")},n.webrtc.Peers[n.PageId].signalingChannel=n.IceWebRTCWsClient,n.webrtc.Peers[n.PageId].signalChannelId=Q,n.CreateOnOpenAct(),n.CreateOnMessageLink(),n.RemoteLoadingCtrl.message=n.lang.text.voidDraw.WebRTC_Offer,n.webrtc.CreateOffer(n.PageId),n.IceWebRTCWsClient.send(JSON.stringify({type:"init_req"}))});break;case"init_end":n.RemoteLoadingCtrl.message=n.lang.text.voidDraw.WebRTC_datachannel}}catch(f){console.log("\uc6d0\uaca9 \uadf8\ub9bc\ud310 WebRTC \uad6c\uc131\uc2dc \uc624\ub958: ",f),n.IceWebRTCWsClient.close(1e3,"onmessage_error")}});return function(Z){return W.apply(this,arguments)}}(),n.IceWebRTCWsClient.onerror=W=>{console.log("\uadf8\ub9bc\ud310 \uae30\ub2a5 \uacf5\uc720 \uc5f0\uacb0 \uc624\ub958: ",W),n.IceWebRTCWsClient.close(1e3,"onerror"),n.p5loading.remove(u),n.p5loading.remove("14")},n.IceWebRTCWsClient.onclose=W=>{var Z;console.log("\uc5f0\uacb0\uc774 \ub04a\uae30\ub294 \uc774\uc720: ",W),n.p5toast.show({text:`${n.lang.text.TodoDetail.Disconnected}: ${W.reason}`}),n.drawChat.logs.push({color:"faa",text:`${n.lang.text.TodoDetail.Disconnected}: ${W.reason}`,isSystem:!0}),n.auto_scroll_down(),n.RemoteLoadingCtrl&&n.RemoteLoadingCtrl.dismiss(),n.AddrQRShare.dismiss(),n.DisableChatInput=!0,n.isDrawServerCreated=!1,n.p5SetDrawable(!0),n.p5loading.remove(u),n.p5loading.remove("14"),n.ReadyToShareAct=!1,n.webrtc.close_webrtc(n.PageId),n.IceWebRTCWsClient.onopen=null,n.IceWebRTCWsClient.onclose=null,n.IceWebRTCWsClient.onmessage=null,n.IceWebRTCWsClient.onerror=null,n.IceWebRTCWsClient=null,n.global.PIPableInfo.PIPableCanvas==(null===(Z=n.p5voiddrawCanvas)||void 0===Z?void 0:Z.elt)&&n.global.RemoveAutoPIPMode()}})()}auto_scroll_down(r){this.DrawChatLog&&setTimeout(()=>{const i=this.DrawChatLog.scrollHeight;i<this.DrawChatLog.scrollTop+this.DrawChatLog.clientHeight+120&&this.DrawChatLog.scrollTo({top:i,behavior:"smooth"})},r||0)}send(){var r;let i={type:"text",msg:this.drawChat.text};i.msg.trim()&&(i.name=this.nakama.users.self.display_name,null===(r=this.IceWebRTCWsClient)||void 0===r||r.send(JSON.stringify(i)),this.drawChat.text="",this.auto_scroll_down())}CreateOnOpenAct(r=(0,h.A)(function*(){})){var i=this;this.webrtc.Peers[this.PageId].dataChannelOpenAct=(0,h.A)(function*(){var t;if(i.ReadyToShareAct=!0,i.p5ClearCurrentDraw(),null===(t=i.ClearTraceCache)||void 0===t||t.call(i),r&&(yield r()),i.RemoteLoadingCtrl.message=i.lang.text.voidDraw.WebRTC_ShareBG,i.navParams.path)try{const w=i.navParams.path.split(".").pop(),n=yield i.indexed.loadBlobFromUserPath(i.navParams.path,"");let u=i.InputCustomAddress.split("://");const M=u.pop();let p=u.shift();p=p?"wss"==p?"https:":"http:":i.global.checkProtocolFromAddress(i.InputCustomAddress)?"https:":"http:";const T=(new Date).getTime(),R=`voidDrawRemoveImage.${w}`.replace(/[\/\\:*?"<>|#&?%+\s]/g,"_"),H=`tmp_${i.QRNavParams.channel}_${i.QRNavParams.user_id.replace(/\//g,"_")}_${T}_${R}`,W=yield i.global.upload_file_to_storage({blob:n,size:n.size,file_ext:w,filename:`voidDrawRemoveImage.${w}`,override_name:H,override_path:"",override_filename:H},{user_id:`tmp_${i.QRNavParams.channel}_${i.QRNavParams.user_id}`},p,M,!1,i.PageId,i.lang.text.ChatRoom.voidDraw);i.p5loading.remove(i.PageId),i.webrtc.Peers[i.PageId].dataChannel.send(JSON.stringify({type:"background",data:W}))}catch(w){i.p5toast.show({text:`${i.lang.text.voidDraw.FailedGetBG}: ${w}`}),console.log("\ubc30\uacbd \uadf8\ub9bc \uacf5\uc720\ud558\uae30 \uc624\ub958: ",w)}i.RemoteLoadingCtrl.dismiss(),i.p5SetDrawable(!0)})}CreateOnMessageLink(){this.webrtc.Peers[this.PageId]||(this.webrtc.Peers[this.PageId]={},this.webrtc.Peers[this.PageId].TypeIn="data"),this.webrtc.Peers[this.PageId].dataChannelOnMsgAct=r=>{let i=JSON.parse(r);switch(i.type){case"background":this.p5voidDraw.loadImage(i.data,t=>{this.p5BaseImage=t,this.p5ImageCanvas.image(this.p5BaseImage,0,0),this.p5ImageCanvas.redraw(),this.p5SetCanvasViewportInit()},t=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",t),this.p5ImageCanvas.redraw(),this.p5SetCanvasViewportInit()}),this.RemoteLoadingCtrl.dismiss();break;case"draw":switch(i.act){case"start":this.p5RemoteDrawStart(i.data);break;case"moved":this.p5RemoteDrawing(i.data);break;case"cancel":this.p5CancelCurrentDraw();break;case"crop":this.p5setCropPos(i.cropPX,i.cropPY),this.p5setCropSize(i.cropSX,i.cropSY),this.isCropMode=!0,this.p5apply_crop(!1);break;case"end":this.p5RemoteDrawingEnd(i.data)}break;case"trace_save":i.bgColor&&(this.useTransparentBG=!0,this.transparentBGHex=i.bgColor),this.p5save_image(!0,!1,!0);break;case"framerate":this.TraceFrameRate=i.value,i.autoGen&&(this.useAutoGenerateGif=i.autoGen),i.draw_trace&&(this.AutoGen.draw_trace=i.draw_trace),i.StopFrame&&(this.AutoGen.StopFrame=i.StopFrame),i.ScribbleExtent&&(this.AutoGen.ScribbleExtent=i.ScribbleExtent),i.DrawAtOnce&&(this.AutoGen.DrawAtOnce=i.DrawAtOnce);break;case"res_tog":this.ToggleAutoResolution=i.data,this.UserToggleAutoResolution(!1);break;case"res_slider":this.resolutionRatio=i.data,this.ResolutionSliderUpdate(!1);break;case"same":"history_act"===i.act&&this.p5history_act(i.data,!0)}},this.webrtc.Peers[this.PageId].dataChannelOnCloseAct=()=>{this.CancelRemoteAct()}}ChangeTraceFrameRate(){this.FrameRateInterval&&clearInterval(this.FrameRateInterval),this.FrameRateInterval=setInterval(()=>{this.ColorListIndex=(this.ColorListIndex+1)%this.ColorList.length,document.getElementById("frame_lamp").style.backgroundColor=`var(--ion-color-${this.ColorList[this.ColorListIndex]})`},this.TraceFrameRate)}ToggleTransparentBG(r=!1){r||(this.transparentBGRed=255,this.transparentBGGreen=255,this.transparentBGBlue=255);const i=document.getElementById("transparentbgsample");i&&(i.style.backgroundColor=`#${this.transparentBGHex}`)}TransparentBGSliderUpdate(){this.transparentBGHex=`${this.p5voidDraw.hex(Number(this.transparentBGRed)||0,2)}${this.p5voidDraw.hex(Number(this.transparentBGGreen)||0,2)}${this.p5voidDraw.hex(Number(this.transparentBGBlue)||0,2)}`.toUpperCase(),this.ToggleTransparentBG(!0)}dismiss_draw(r=!1){if(!this.WillLeaveHere)if(this.isCropMode&&!r)this.p5apply_crop();else{if(this.navParams.saveClipboard)return this.p5save_image(!0,!0),void this.navCtrl.pop();this.p5loading.update({id:"voiddraw"}),this.p5save_image()}}ionSelectCancel(){this.p5voidDraw&&this.p5SetDrawable&&!this.isDrawServerCreated&&this.p5SetDrawable(!0)}RemoveShortCut(){this.p5voidDraw&&this.p5SetDrawable&&this.p5SetDrawable(!1),delete this.global.p5KeyShortCut.HistoryAct,delete this.global.p5KeyShortCut.AddAct,delete this.global.p5KeyShortCut.DeleteAct,delete this.global.p5KeyShortCut.SKeyAct,delete this.global.p5KeyShortCut.FKeyAct,delete this.global.p5KeyShortCut.Escape}ionViewWillLeave(){this.noti.Current="",this.p5loading.update({id:"voiddraw",forceEnd:0},!0),this.global.ToggleFullScreen(!1),this.global.portalHint=!0,this.p5SetDrawable&&this.p5SetDrawable(!1),this.WillLeaveHere=!0,this.RemoveShortCut(),this.global.RestoreShortCutAct("void-draw")}init_gen_qrcode(r){var i=this;return(0,h.A)(function*(){const t=i.QRNavParams.address;i.SelectedAddress=`${yield i.global.GetHeaderAddress()}?token=${t},${12013==i.QRNavParams.square_port?"":i.QRNavParams.square_port||""},${r}`,i.QRCodeSRC=i.global.readasQRCodeFromString(i.SelectedAddress)})()}copy_address(r){this.global.WriteValueToClipboard("text/plain",r)}}return(s=G).\u0275fac=function(r){return new(r||s)(e.rXU(g.y),e.rXU(D.hG),e.rXU(D.Xi),e.rXU(te.z3),e.rXU(_.n),e.rXU(S.X),e.rXU(F.G),e.rXU(k.j),e.rXU(ve.Ix),e.rXU(ve.nX),e.rXU(b.q9),e.rXU(l.f),e.rXU(d.r))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-void-draw"]],viewQuery:function(r,i){if(1&r&&(e.GBs(C,5),e.GBs(P,5),e.GBs(V,5),e.GBs(ce,5),e.GBs(ne,5)),2&r){let t;e.mGM(t=e.lsd())&&(i.RemoteDraw=t.first),e.mGM(t=e.lsd())&&(i.ChangeTransparent=t.first),e.mGM(t=e.lsd())&&(i.SetFrameRate=t.first),e.mGM(t=e.lsd())&&(i.ChangeResolution=t.first),e.mGM(t=e.lsd())&&(i.AddrQRShare=t.first)}},decls:22,vars:7,consts:[["RemoteDraw",""],["AddrQRShare",""],["ChangeTransparent",""],["ChangeResolution",""],["SetFrameRate",""],["class","ion-no-border",4,"ngIf"],["oncontextmenu","return false;"],["hidden",""],[3,"ionChange","ionCancel","label","value"],["value","local"],[3,"value",4,"ngFor","ngForOf"],[1,"full_screen",2,"display","block","overflow","hidden","background-color","black",3,"id"],[3,"style",4,"ngIf"],[1,"transparent-modal"],[1,"ion-no-border"],["slot","start"],["defaultHref",""],["slot","end","name","expand-outline",1,"top_icon",3,"click","contextmenu"],["slot","end","name","save-outline",1,"top_icon",2,"width","24px","height","24px",3,"click"],[3,"value"],[2,"width","100%","max-width","650px","overflow-y","hidden"],[2,"width","100%","height","fit-content","max-height","84px","overflow-y","scroll","padding","8px","background","linear-gradient(to top, var(--voidDraw-chat-bg-transparent), transparent)",3,"id"],[2,"pointer-events","none","user-select","none"],[4,"ngFor","ngForOf"],[2,"width","100%","background-color","var(--voidDraw-chat-bg-transparent)"],[2,"width","100%"],["type","text",2,"margin-left","16px",3,"ionFocus","ionBlur","keyup.enter","ngModelChange","disabled","placeholder","ngModel"],["expand","block","fill","clear",3,"click","disabled"],["name","send"],["class","default_text",4,"ngIf"],[1,"default_text"],[4,"ngIf"],["target","_system","onclick","return false;",3,"href","click",4,"ngIf"],["target","_system","onclick","return false;",3,"click","href"],["id","RemoteDrawQR",1,"OutterModal",3,"click"],[2,"width","400px","min-height","455px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["style","width: 100%; height: auto; cursor: copy; margin-bottom: 8px;","alt","QuickLink",3,"src","click",4,"ngIf"],["button","",3,"click"],[1,"ion-text-center"],["alt","QuickLink",2,"width","100%","height","auto","cursor","copy","margin-bottom","8px",3,"click","src"],["id","colordetailOuter",1,"OutterModal",3,"click"],[2,"width","400px","min-height","240px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["max","255",3,"ngModelChange","ionInput","ngModel"],["slot","label",1,"slider_title"],["slot","end",1,"slider_end"],["type","number",1,"slider_input",3,"input","ngModelChange","ngModel"],["id","voiddraw_color_detail","type","number",1,"slider_input",3,"input","ngModelChange","ngModel"],["min","1","max","10",3,"ngModelChange","ionInput","ngModel"],["id","voiddraw_default_weight","type","number",1,"slider_input",3,"ngModelChange","input","ngModel"],["min","1","max","255",3,"ngModelChange","ionInput","ngModel"],["id","resolutiondetailOuter",1,"OutterModal",3,"click"],[2,"width","400px","min-height","160px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["min","1",3,"ngModelChange","ionInput","ngModel","disabled"],["id","voiddraw_resolution","type","number","min","1","max","100",1,"slider_input",3,"input","ngModelChange","ngModel"],[3,"ionChange","ngModelChange","ngModel"],["id","traceframerate",1,"OutterModal",3,"click"],[2,"width","400px","min-height","280px","max-height","480px","overflow-y","scroll","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["id","frame_lamp",2,"display","inline-block","width","16px","height","16px","background-color","aqua","border-radius","16px","margin-right","4px"],["min","1","max","1000",3,"ngModelChange","ionInput","ngModel"],["id","voiddraw_resolution","type","number","min","1",1,"slider_input",3,"input","ngModelChange","ngModel"],[2,"margin-top","8px",3,"ionChange","ngModelChange","ngModel"],["id","transparentbgsample",2,"display","inline-block","width","16px","height","16px","background-color","white","border-radius","16px","margin-right","4px"],[3,"ngModelChange","ngModel"],[2,"margin-top","4px"],["step",".1","max","5",3,"ngModelChange","ngModel"],["type","number","step",".1","min","0",1,"slider_input",3,"ngModelChange","ngModel"],["step",".1","max","1",3,"ngModelChange","ngModel"],["type","number","step",".1","min","0","max","1",1,"slider_input",3,"ngModelChange","ngModel"],["step",".01","max","1",3,"ngModelChange","ngModel"]],template:function(r,i){if(1&r){const t=e.RV6();e.DNE(0,De,8,1,"ion-header",5),e.j41(1,"ion-content",6)(2,"div",7)(3,"ion-select",8,0),e.bIt("ionChange",function(n){return e.eBV(t),e.Njj(i.RemoteBridgeServerSelected(n))})("ionCancel",function(){return e.eBV(t),e.Njj(i.ionSelectCancel())}),e.j41(5,"ion-select-option",9),e.EFF(6),e.k0s(),e.DNE(7,rt,2,2,"ion-select-option",10),e.k0s()(),e.j41(8,"div",11),e.DNE(9,Wt,12,8,"div",12),e.k0s(),e.j41(10,"ion-modal",13,1),e.DNE(12,Ft,6,2,"ng-template"),e.k0s(),e.j41(13,"ion-modal",13,2),e.DNE(15,Xt,41,23,"ng-template"),e.k0s(),e.j41(16,"ion-modal",13,3),e.DNE(18,Ht,13,9,"ng-template"),e.k0s(),e.j41(19,"ion-modal",13,4),e.DNE(21,Jt,26,17,"ng-template"),e.k0s()()}2&r&&(e.Y8G("ngIf",!i.global.ArcadeWithFullScreen),e.R7$(3),e.Y8G("label",i.lang.text.voidDraw.ConnectToAddress)("value",i.RemoteDrawSelected),e.R7$(3),e.JRh(i.lang.text.voidDraw.InternalConn),e.R7$(),e.Y8G("ngForOf",i.ServerList),e.R7$(),e.Y8G("id",i.voidDrawId),e.R7$(),e.Y8G("ngIf",i.ShowChatInterface))},dependencies:[at.Sq,at.bT,le.me,le.Q0,le.BC,le.VZ,le.zX,le.vS,D.Jm,D.QW,D.eY,D.W9,D.eU,D.iq,D.$w,D.uz,D.he,D.Ob,D.Nm,D.Ip,D.BC,D.BY,D.ai,D.Sb,D.hB,D.su,D.Je,D.Gw,D.el],styles:[".slider_title[_ngcontent-%COMP%]{width:96px}.slider_end[_ngcontent-%COMP%]{width:72px;margin-left:24px}.slider_input[_ngcontent-%COMP%]{max-width:48px}p[_ngcontent-%COMP%]{margin:8px 0 0}"]}),G})()}];let zt=(()=>{var s;class G{}return(s=G).\u0275fac=function(r){return new(r||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[ve.iI.forChild(Yt),ve.iI]}),G})(),Kt=(()=>{var s;class G{}return(s=G).\u0275fac=function(r){return new(r||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[at.MD,le.YN,D.bv,zt]}),G})()},6042:It=>{It.exports=function le(D,ve,h){function A(e,g){if(!ve[e]){if(!D[e]){if(te)return te(e,!0);var _=new Error("Cannot find module '"+e+"'");throw _.code="MODULE_NOT_FOUND",_}var S=ve[e]={exports:{}};D[e][0].call(S.exports,function(F){return A(D[e][1][F]||F)},S,S.exports,le,D,ve,h)}return ve[e].exports}for(var te=void 0,q=0;q<h.length;q++)A(h[q]);return A}({1:[function(le,D,ve){function h(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function A(g){return"function"==typeof g}function q(g){return"object"==typeof g&&null!==g}function e(g){return void 0===g}D.exports=h,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._maxListeners=void 0,h.defaultMaxListeners=10,h.prototype.setMaxListeners=function(g){if(!function te(g){return"number"==typeof g}(g)||g<0||isNaN(g))throw TypeError("n must be a positive number");return this._maxListeners=g,this},h.prototype.emit=function(g){var b,_,S,F,k,l;if(this._events||(this._events={}),"error"===g&&(!this._events.error||q(this._events.error)&&!this._events.error.length)){if((b=arguments[1])instanceof Error)throw b;var d=new Error('Uncaught, unspecified "error" event. ('+b+")");throw d.context=b,d}if(e(_=this._events[g]))return!1;if(A(_))switch(arguments.length){case 1:_.call(this);break;case 2:_.call(this,arguments[1]);break;case 3:_.call(this,arguments[1],arguments[2]);break;default:F=Array.prototype.slice.call(arguments,1),_.apply(this,F)}else if(q(_))for(F=Array.prototype.slice.call(arguments,1),S=(l=_.slice()).length,k=0;k<S;k++)l[k].apply(this,F);return!0},h.prototype.on=h.prototype.addListener=function(g,b){var _;if(!A(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",g,A(b.listener)?b.listener:b),this._events[g]?q(this._events[g])?this._events[g].push(b):this._events[g]=[this._events[g],b]:this._events[g]=b,q(this._events[g])&&!this._events[g].warned&&(_=e(this._maxListeners)?h.defaultMaxListeners:this._maxListeners)&&_>0&&this._events[g].length>_&&(this._events[g].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[g].length),"function"==typeof console.trace&&console.trace()),this},h.prototype.once=function(g,b){if(!A(b))throw TypeError("listener must be a function");var _=!1;function S(){this.removeListener(g,S),_||(_=!0,b.apply(this,arguments))}return S.listener=b,this.on(g,S),this},h.prototype.removeListener=function(g,b){var _,S,F,k;if(!A(b))throw TypeError("listener must be a function");if(!this._events||!this._events[g])return this;if(F=(_=this._events[g]).length,S=-1,_===b||A(_.listener)&&_.listener===b)delete this._events[g],this._events.removeListener&&this.emit("removeListener",g,b);else if(q(_)){for(k=F;k-- >0;)if(_[k]===b||_[k].listener&&_[k].listener===b){S=k;break}if(S<0)return this;1===_.length?(_.length=0,delete this._events[g]):_.splice(S,1),this._events.removeListener&&this.emit("removeListener",g,b)}return this},h.prototype.removeAllListeners=function(g){var b,_;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[g]&&delete this._events[g],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(A(_=this._events[g]))this.removeListener(g,_);else if(_)for(;_.length;)this.removeListener(g,_[_.length-1]);return delete this._events[g],this},h.prototype.listeners=function(g){return this._events&&this._events[g]?A(this._events[g])?[this._events[g]]:this._events[g].slice():[]},h.prototype.listenerCount=function(g){if(this._events){var b=this._events[g];if(A(b))return 1;if(b)return b.length}return 0},h.listenerCount=function(g,b){return g.listenerCount(b)}},{}],2:[function(le,D,ve){var h,A,te,q,e;e=navigator.userAgent.toLowerCase(),q=navigator.platform.toLowerCase(),te="ie"===(h=e.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(A={name:"version"===h[1]?h[3]:h[1],version:te||parseFloat("opera"===h[1]&&h[4]?h[4]:h[2]),platform:{name:e.match(/ip(?:ad|od|hone)/)?"ios":(e.match(/(?:webos|android)/)||q.match(/mac|win|linux/)||["other"])[0]}})[A.name]=!0,A[A.name+parseInt(A.version,10)]=!0,A.platform[A.platform.name]=!0,D.exports=A},{}],3:[function(le,D,ve){var h,A,te,e={}.hasOwnProperty,g=[].indexOf||function(_){for(var S=0,F=this.length;S<F;S++)if(S in this&&this[S]===_)return S;return-1},b=[].slice;h=le("events").EventEmitter,te=le("./browser.coffee"),A=function(_){var S,F;function k(l){var d,C;for(C in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(l),S)null==(d=this.options)[C]&&(d[C]=S[C])}return function(_,S){for(var F in S)e.call(S,F)&&(_[F]=S[F]);function k(){this.constructor=_}k.prototype=S.prototype,_.prototype=new k,_.__super__=S.prototype}(k,_),S={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},F={delay:500,copy:!1},k.prototype.setOption=function(l,d){if(this.options[l]=d,null!=this._canvas&&("width"===l||"height"===l))return this._canvas[l]=d},k.prototype.setOptions=function(l){var d,C;for(d in C=[],l)e.call(l,d)&&C.push(this.setOption(d,l[d]));return C},k.prototype.addFrame=function(l,d){var C,P;for(P in null==d&&(d={}),(C={}).transparent=this.options.transparent,F)C[P]=d[P]||F[P];if(null==this.options.width&&this.setOption("width",l.width),null==this.options.height&&this.setOption("height",l.height),typeof ImageData<"u"&&null!==ImageData&&l instanceof ImageData)C.data=l.data;else if(typeof CanvasRenderingContext2D<"u"&&null!==CanvasRenderingContext2D&&l instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&null!==WebGLRenderingContext&&l instanceof WebGLRenderingContext)d.copy?C.data=this.getContextData(l):C.context=l;else{if(null==l.childNodes)throw new Error("Invalid image");d.copy?C.data=this.getImageData(l):C.image=l}return this.frames.push(C)},k.prototype.render=function(){var d,C,P;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var V,ce,ne;for(ne=[],V=0,ce=this.frames.length;0<=ce?V<ce:V>ce;0<=ce?++V:--V)ne.push(null);return ne}.call(this),C=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(d=0,P=C;0<=P?d<P:d>P;0<=P?++d:--d)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},k.prototype.abort=function(){for(var l;null!=(l=this.activeWorkers.shift());)this.log("killing active worker"),l.terminate();return this.running=!1,this.emit("abort")},k.prototype.spawnWorkers=function(){var d,C,P;return d=Math.min(this.options.workers,this.frames.length),function(){P=[];for(var V=C=this.freeWorkers.length;C<=d?V<d:V>d;C<=d?V++:V--)P.push(V);return P}.apply(this).forEach(function(V){return function(ce){var ne;return V.log("spawning worker "+ce),(ne=new Worker(V.options.workerScript)).onmessage=function(De){return V.activeWorkers.splice(V.activeWorkers.indexOf(ne),1),V.freeWorkers.push(ne),V.frameFinished(De.data)},V.freeWorkers.push(ne)}}(this)),d},k.prototype.frameFinished=function(l){var C,P;if(this.log("frame "+l.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[l.index]=l,!0===this.options.globalPalette&&(this.options.globalPalette=l.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(C=1,P=this.freeWorkers.length;1<=P?C<P:C>P;1<=P?++C:--C)this.renderNextFrame();return g.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},k.prototype.finishRendering=function(){var l,d,C,P,V,ce,ne,De,rt,ot,st,We,Qe,Je,Ye;for(De=0,V=0,rt=(Qe=this.imageParts).length;V<rt;V++)De+=((d=Qe[V]).data.length-1)*d.pageSize+d.cursor;for(De+=d.pageSize-d.cursor,this.log("rendering finished - filesize "+Math.round(De/1e3)+"kb"),l=new Uint8Array(De),We=0,ce=0,ot=(Je=this.imageParts).length;ce<ot;ce++)for(C=ne=0,st=(Ye=(d=Je[ce]).data).length;ne<st;C=++ne)l.set(Ye[C],We),We+=C===d.data.length-1?d.cursor:d.pageSize;return P=new Blob([l],{type:"image/gif"}),this.emit("finished",P,l)},k.prototype.renderNextFrame=function(){var l,d,C;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return l=this.frames[this.nextFrame++],C=this.freeWorkers.shift(),d=this.getTask(l),this.log("starting frame "+(d.index+1)+" of "+this.frames.length),this.activeWorkers.push(C),C.postMessage(d)},k.prototype.getContextData=function(l){return l.getImageData(0,0,this.options.width,this.options.height).data},k.prototype.getImageData=function(l){var d;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(d=this._canvas.getContext("2d")).setFill=this.options.background,d.fillRect(0,0,this.options.width,this.options.height),d.drawImage(l,0,0),this.getContextData(d)},k.prototype.getTask=function(l){var d,C;if(C={index:d=this.frames.indexOf(l),last:d===this.frames.length-1,delay:l.delay,transparent:l.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===te.name},null!=l.data)C.data=l.data;else if(null!=l.context)C.data=this.getContextData(l.context);else{if(null==l.image)throw new Error("Invalid frame");C.data=this.getImageData(l.image)}return C},k.prototype.log=function(){var l;if(l=1<=arguments.length?b.call(arguments,0):[],this.options.debug)return console.log.apply(console,l)},k}(h),D.exports=A},{"./browser.coffee":2,events:1}]},{},[3])(3)}}]);