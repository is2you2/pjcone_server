"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6556],{6556:(le,x,u)=>{u.r(x),u.d(x,{UserFsDirPageModule:()=>se});var v=u(177),b=u(4341),f=u(5374),D=u(9858),p=u(467),y=u(92),U=u(8326),h=u(9969),e=u(3953),I=u(755),P=u(4234),k=u(7100),R=u(9900),j=u(3656),G=u(345),S=u(5547),T=u(4237),$=u(3307);const C=["FileSel"];function N(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-icon",17),e.bIt("click",function(){e.eBV(s);const t=e.XpG();return e.Njj(t.toggle_thumbnail())}),e.k0s()}}function L(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-icon",18),e.bIt("click",function(){e.eBV(s);const t=e.XpG();return e.Njj(t.toggle_thumbnail())}),e.k0s()}}function w(r,d){if(1&r){const s=e.RV6();e.j41(0,"div")(1,"ion-item",19),e.bIt("click",function(){e.eBV(s);const t=e.XpG();return e.Njj(t.SelectImportFolder())}),e.nrm(2,"ion-icon",20),e.j41(3,"ion-label"),e.EFF(4),e.k0s()(),e.j41(5,"input",21),e.bIt("change",function(t){e.eBV(s);const n=e.XpG();return e.Njj(n.inputImageSelected(t))}),e.k0s()()}if(2&r){const s=e.XpG();e.Y8G("@toggle_item",void 0),e.R7$(4),e.SpI(" ",s.lang.text.UserFsDir.ImportFolder," ")}}function X(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-icon",22),e.bIt("click",function(){e.eBV(s);const t=e.XpG();return e.Njj(t.CreateNewFolder())}),e.k0s()}}function A(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-item",19),e.bIt("click",function(){e.eBV(s);const t=e.XpG();return e.Njj(t.MoveToUpDir())}),e.nrm(1,"ion-icon",10),e.j41(2,"ion-label"),e.EFF(3,".."),e.k0s()()}2&r&&e.Y8G("@toggle_item",void 0)}function B(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-item",19),e.bIt("click",function(){e.eBV(s);const t=e.XpG().$implicit,n=e.XpG();return e.Njj(n.SelectFolder(t))}),e.nrm(1,"ion-icon",10),e.j41(2,"ion-label"),e.EFF(3),e.k0s()()}if(2&r){const s=e.XpG().$implicit;e.Y8G("@toggle_item",void 0),e.R7$(3),e.JRh(s.name)}}function E(r,d){if(1&r){const s=e.RV6();e.j41(0,"div",23),e.bIt("contextmenu",function(){const t=e.eBV(s).$implicit,n=e.XpG();return e.Njj(n.DeleteShortcut(t))}),e.DNE(1,B,4,2,"ion-item",14),e.k0s()}if(2&r){const s=d.$implicit,i=e.XpG();e.R7$(),e.Y8G("ngIf",i.CurrentDir==s.dir)}}function M(r,d){1&r&&e.nrm(0,"ion-icon",41)}function V(r,d){1&r&&e.nrm(0,"ion-icon",42)}function O(r,d){1&r&&e.nrm(0,"ion-icon",43)}function Y(r,d){1&r&&e.nrm(0,"ion-icon",44)}function H(r,d){1&r&&e.nrm(0,"ion-icon",45)}function z(r,d){1&r&&e.nrm(0,"ion-icon",46)}function J(r,d){1&r&&e.nrm(0,"ion-icon",47)}function W(r,d){1&r&&e.nrm(0,"ion-icon",48)}function Q(r,d){if(1&r&&(e.j41(0,"ion-label",49),e.EFF(1),e.k0s()),2&r){const s=e.XpG(2).$implicit;e.R7$(),e.JRh(s.name)}}function K(r,d){if(1&r&&(e.j41(0,"ion-label"),e.EFF(1),e.k0s()),2&r){const s=e.XpG(2).$implicit;e.R7$(),e.JRh(s.name)}}function Z(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-button",50),e.bIt("click",function(){e.eBV(s);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.OpenFile(t))}),e.EFF(1),e.k0s()}if(2&r){const s=e.XpG(3);e.R7$(),e.SpI(" ",s.lang.text.UserFsDir.Open," ")}}function q(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-button",50),e.bIt("click",function(){e.eBV(s);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.dismiss_page(t))}),e.EFF(1),e.k0s()}if(2&r){const s=e.XpG(3);e.R7$(),e.SpI(" ",s.lang.text.UserFsDir.Select," ")}}function ee(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-button",50),e.bIt("click",function(){e.eBV(s);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.DownloadFile(t))}),e.EFF(1),e.k0s()}if(2&r){const s=e.XpG(3);e.R7$(),e.SpI(" ",s.lang.text.UserFsDir.Download," ")}}function te(r,d){if(1&r){const s=e.RV6();e.j41(0,"div",51),e.bIt("click",function(){e.eBV(s);const t=e.XpG(2).$implicit,n=e.XpG();return e.Njj(n.OpenFile(t))}),e.nrm(1,"img",52),e.k0s()}if(2&r){const s=e.XpG(2).$implicit,i=e.XpG();e.R7$(),e.Aen(i.HideThumbnail?"filter: blur(6px);":""),e.Y8G("src",s.thumbnail,e.B4B)("alt",s.name)}}function ie(r,d){if(1&r){const s=e.RV6();e.j41(0,"ion-accordion",25)(1,"ion-item",26),e.bIt("contextmenu",function(){e.eBV(s);const t=e.XpG(),n=t.$implicit,o=t.index,a=e.XpG();return e.Njj(a.DeleteShortcut(n,o))}),e.DNE(2,M,1,0,"ion-icon",27)(3,V,1,0,"ion-icon",28)(4,O,1,0,"ion-icon",29)(5,Y,1,0,"ion-icon",30)(6,H,1,0,"ion-icon",31)(7,z,1,0,"ion-icon",32)(8,J,1,0,"ion-icon",33)(9,W,1,0,"ion-icon",34)(10,Q,2,1,"ion-label",35)(11,K,2,1,"ion-label",8),e.nrm(12,"ion-icon",36),e.k0s(),e.j41(13,"div",37)(14,"ion-item",9)(15,"ion-label"),e.EFF(16),e.k0s(),e.DNE(17,Z,2,1,"ion-button",38)(18,q,2,1,"ion-button",38)(19,ee,2,1,"ion-button",38),e.j41(20,"ion-button",39),e.bIt("click",function(){e.eBV(s);const t=e.XpG(),n=t.$implicit,o=t.index,a=e.XpG();return e.Njj(a.RemoveFile(n,o))}),e.EFF(21),e.k0s()(),e.DNE(22,te,2,4,"div",40),e.k0s()()}if(2&r){const s=e.XpG().$implicit,i=e.XpG(),t=e.sdS(23);e.Y8G("@toggle_item",void 0)("value",s.path),e.R7$(2),e.Y8G("ngIf","image"==s.viewer),e.R7$(),e.Y8G("ngIf","audio"==s.viewer),e.R7$(),e.Y8G("ngIf","video"==s.viewer),e.R7$(),e.Y8G("ngIf","text"==s.viewer),e.R7$(),e.Y8G("ngIf","godot"==s.viewer),e.R7$(),e.Y8G("ngIf","model"==s.viewer),e.R7$(),e.Y8G("ngIf","code"==s.viewer),e.R7$(),e.Y8G("ngIf","disabled"==s.viewer),e.R7$(),e.Y8G("ngIf",t.value==s.path),e.R7$(),e.Y8G("ngIf",t.value!=s.path),e.R7$(5),e.JRh(i.lang.text.UserFsDir.Action),e.R7$(),e.Y8G("ngIf","image"!=s.viewer),e.R7$(),e.Y8G("ngIf",i.navParams.selector),e.R7$(),e.Y8G("ngIf",!i.navParams.selector),e.R7$(2),e.SpI(" ",i.lang.text.UserFsDir.Delete," "),e.R7$(),e.Y8G("ngIf","image"==s.viewer)}}function ne(r,d){if(1&r&&(e.j41(0,"div"),e.DNE(1,ie,23,18,"ion-accordion",24),e.k0s()),2&r){const s=d.$implicit,i=e.XpG();e.R7$(),e.Y8G("ngIf",i.CurrentDir==s.dir||i.navParams.selector)}}const re=[{path:"",component:(()=>{var r;class d{constructor(i,t,n,o,a,c,l,m,_,g,F,ae){this.indexed=i,this.lang=t,this.global=n,this.p5toast=o,this.alertCtrl=a,this.sanitizer=c,this.navCtrl=l,this.noti=m,this.nakama=_,this.router=g,this.route=F,this.p5loading=ae,this.DirList=[],this.FileList=[],this.is_ready=!1,this.HideThumbnail=!1,this.CanImportFolder=!0,this.InitIndexingId="userfs_init",this.StopIndexing=!1,this.lock_modal_open=!1}ngOnDestroy(){var i,t;this.route.queryParams.unsubscribe(),this.StopIndexing=!0,this.FileList.forEach(n=>{URL.revokeObjectURL(n.thumbnail)}),setTimeout(()=>{this.noti.ClearNoti(4),this.noti.ClearNoti(5)},1e3),null===(i=(t=this.global.PageDismissAct)[this.navParams.dismiss])||void 0===i||i.call(t,{})}toggle_thumbnail(){this.HideThumbnail=!this.HideThumbnail,localStorage.setItem("user-fs-thumbnail",this.HideThumbnail?"1":"0")}ngOnInit(){"DesktopPWA"==y.aH&&setTimeout(()=>{this.CreateDrop()},100),this.CanImportFolder="DesktopPWA"==y.aH,this.route.queryParams.subscribe(i=>{const t=this.router.getCurrentNavigation().extras.state;this.navParams=t||{}})}CreateDrop(){var i=this;let t=document.getElementById("p5Drop_userfs");this.p5canvas=new U(n=>{n.setup=()=>{let m=n.createCanvas(t.clientWidth,t.clientHeight);m.parent(t),n.pixelDensity(.1),m.drop(_=>{let g=n.millis();c<g-400?(a=!1,l.length=0,l.push(_)):(a=!0,l.push(_)),c=g,clearTimeout(o),o=setTimeout((0,p.A)(function*(){if(a)i.MultipleDrops(l);else{const F=`userfs_multi_drop_${Date.now()}`;i.p5loading.update({id:F}),yield i.importSelected(_.file),i.p5loading.remove(F)}}),400)})};let o,a=!1,c=0,l=[];n.mouseMoved=m=>{m.dataTransfer?(t.style.pointerEvents="all",t.style.backgroundColor="#0008"):(t.style.pointerEvents="none",t.style.backgroundColor="transparent")}})}CreateNewFolder(){var i=this;this.alertCtrl.create({header:this.lang.text.UserFsDir.CreateFolder,inputs:[{type:"text",placeholder:this.lang.text.UserFsDir.FolderName}],buttons:[{text:this.lang.text.UserFsDir.Create,handler:t=>{!function(){var o=(0,p.A)(function*(){if(t[0])try{let a=`${i.CurrentDir?i.CurrentDir+"/":""}${t[0]}`;yield i.indexed.createDirectory(a);let c=yield i.indexed.GetFileInfoFromDB(a),l={path:a,mode:c.mode,timestamp:c.timestamp,db:i.indexed.ionicDB};l.name=t[0],l.dir=i.CurrentDir,i.DirList.push(l)}catch(a){console.error("\ud3f4\ub354 \uc0dd\uc131 \uc2e4\ud328: ",a),i.p5toast.show({text:`${i.lang.text.UserFsDir.FailedToCreateFolder}: ${(a.statusText?`${a.statusText}(${a.status})`:a.status)||a}`})}else i.p5toast.show({text:i.lang.text.UserFsDir.NeedFolderName})});return function(){return o.apply(this,arguments)}}()()}}]}).then(t=>t.present())}SelectFiles(){document.getElementById("import_file").click()}MultipleDrops(i){var t=this;return(0,p.A)(function*(){const n=`userfs_MultipleDrops_${Date.now()}`;t.p5loading.update({id:n,message:t.lang.text.UserFsDir.MultipleSave});for(let o=0,a=i.length;o<a;o++)t.p5loading.update({id:n,message:`${t.lang.text.UserFsDir.MultipleSave}: ${i[o].file.name}`,progress:o/a}),yield t.importSelected(i[o].file);t.p5loading.remove(n)})()}PasteFile(){var i=this;return function(){var n=(0,p.A)(function*(){const o=`get_image_${Date.now()}`,a=yield i.global.GetValueFromClipboard(o);"image/png"===a.type&&(console.log(a.value),i.MultipleDrops([{file:a.value}]))});return function(){return n.apply(this,arguments)}}()(),!1}inputFileSelected(i){var t=this;return(0,p.A)(function*(){if(i.target.files.length){const n=`userfs_inputFileSelected_${Date.now()}`;if(1!=i.target.files.length){yield t.p5loading.update({id:n,message:t.lang.text.UserFsDir.MultipleSave,forceEnd:null});for(let a=0,c=i.target.files.length;a<c&&!t.StopIndexing;a++)t.p5loading.update({id:n,message:`${t.lang.text.UserFsDir.MultipleSave}: ${i.target.files[a].name}`,progress:a/c}),yield t.importSelected(i.target.files[a]);t.noti.ClearNoti(4),t.p5loading.remove(n)}else yield t.p5loading.update({id:n,forceEnd:null}),yield t.importSelected(i.target.files[0]),t.p5loading.remove(n)}})()}importSelected(i){var t=this;return(0,p.A)(function*(){try{let n=`${t.CurrentDir?t.CurrentDir+"/":""}${i.name}`;yield t.indexed.saveBlobToUserPath(i,n);let o=yield t.indexed.GetFileInfoFromDB(n),a={path:n,mode:o.mode,timestamp:o.timestamp,db:t.indexed.ionicDB};a.name=i.name,a.dir=t.CurrentDir,a.file_ext=a.name.split(".").pop(),t.global.set_viewer_category_from_ext(a),"image"==a.viewer&&t.indexed.loadBlobFromUserPath(a.path,"").then(c=>{let l=URL.createObjectURL(c);a.thumbnail=t.sanitizer.bypassSecurityTrustUrl(l)});try{let c=a.path.split("/");if(5!=c.length||"groups"!=c[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";t.SetDisplayGroupImageName(a,c)}catch{}for(let c=0,l=t.FileList.length;c<l;c++)if(t.FileList[c].path==n){t.FileList.splice(c,1);break}t.FileList.push(a)}catch(n){console.log("importSelected error: ",n)}})()}ionViewWillEnter(){this.lock_modal_open?this.lock_modal_open=!1:(this.HideThumbnail="1"==localStorage.getItem("user-fs-thumbnail"),this.CurrentDir="",this.LoadAllIndexedFiles())}dismiss_page(i){var t=this;return(0,p.A)(function*(){if(t.navParams.selector){var n,o;let a;i&&(a=yield t.indexed.loadBlobFromUserPath(i.path,""),a.name=i.name,a.file_ext=i.file_ext),null===(n=(o=t.global.PageDismissAct)[t.navParams.dismiss])||void 0===n||n.call(o),t.navCtrl.pop()}})()}LoadAllIndexedFiles(){var i=this;return(0,p.A)(function*(){if(yield i.p5loading.update({id:i.InitIndexingId,message:i.lang.text.UserFsDir.LoadingExplorer,forceEnd:null}),i.DirList.length=0,i.FileList.length=0,i.navParams.selector)if(i.navParams.path){let t=yield i.indexed.GetFileListFromDB(i.navParams.path);yield i.ModulateIndexedFile(t)}else{let t=yield i.indexed.GetFileListFromDB("/files/");yield i.ModulateIndexedFile(t)}else{let t=yield i.indexed.GetFileListFromDB("/");yield i.ModulateIndexedFile(t)}i.navParams.selector?i.FileList.sort((t,n)=>t.timestamp<n.timestamp?1:t.timestamp>n.timestamp?-1:0):(i.FileList.sort((t,n)=>t.path>n.path?1:t.path<n.path?-1:0),i.DirList.sort((t,n)=>t.path>n.path?1:t.path<n.path?-1:0)),i.noti.ClearNoti(5),i.p5loading.remove(i.InitIndexingId),i.is_ready=!0})()}ModulateIndexedFile(i){var t=this;return(0,p.A)(function*(){for(let n=0,o=i.length;n<o;n++){if(t.StopIndexing)return;let a=`${t.lang.text.UserFsDir.LoadingExplorer}: ${i[n].split("/").pop()}`;t.p5loading.update({id:t.InitIndexingId,message:a,progress:n/i.length}),yield t.indexed.GetFileInfoFromDB(i[n]).then(c=>{if(!c)return void t.indexed.removeFileFromUserPath(i[n]);let l={path:i[n],mode:c.mode,timestamp:c.timestamp};switch(l.name=l.path.substring(l.path.lastIndexOf("/")+1),l.dir=i[n].substring(0,i[n].lastIndexOf("/")),l.mode){case 33206:l.file_ext=l.name.split(".").pop(),t.global.set_viewer_category_from_ext(l),"image"==l.viewer&&t.indexed.loadBlobFromUserPath(l.path,"").then(g=>{let F=URL.createObjectURL(g);l.thumbnail=t.sanitizer.bypassSecurityTrustUrl(F)});try{let g=l.path.split("/");if(5!=g.length||"groups"!=g[3])throw"\uadf8\ub8f9 \uc774\ubbf8\uc9c0 \ud30c\uc77c\uc774 \uc544\ub2d8";t.SetDisplayGroupImageName(l,g)}catch{}t.FileList.push(l);break;case 16893:0==l.path.indexOf("todo/")&&t.SetDisplayTodoName(l);let m=!1,_=l.path.split("/");try{if(5!=_.length||"channels"!=_[3])throw"\ucc44\ub110 \ud3f4\ub354\uac00 \uc544\ub2d8";t.SetDisplayChannelName(l,_),m=!0}catch{}try{if(m||5!=_.length||"users"!=_[3])throw"\uc0ac\uc6a9\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";t.SetDisplayUserName(l,_),m=!0}catch{}try{if(m||5!=_.length||"posts"!=_[3])throw"\uac8c\uc2dc\ubb3c \uc791\uc131\uc790 \ud3f4\ub354\uac00 \uc544\ub2d8";t.SetDisplayPostWriterName(l,_),m=!0}catch{}try{if(m||6!=_.length||"posts"!=_[3])throw"\uac8c\uc2dc\ubb3c \ud3f4\ub354\uac00 \uc544\ub2d8";t.SetDisplayPostName(l,_),m=!0}catch{}t.DirList.push(l);break;default:console.log("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \ud30c\uc77c \ubaa8\ub4dc: ",l)}})}t.noti.ClearNoti(5)})()}SetDisplayTodoName(i){var t=this;return(0,p.A)(function*(){try{let n=yield t.indexed.loadTextFromUserPath(`${i.path}/info.todo`),o=JSON.parse(n);i.name=o.title}catch(n){console.log("SetDisplayTodoName error: ",n)}})()}SetDisplayUserName(i,t){try{i.name=this.nakama.users[t[1]][t[2]][t[4]].display_name}catch{}i.name=i.name||this.lang.text.Profile.noname_user}SetDisplayChannelName(i,t){try{i.name=this.nakama.channels_orig[t[1]][t[2]][i.name].title}catch{}i.name=i.name||this.lang.text.ChatRoom.noname_chatroom}SetDisplayGroupImageName(i,t){try{i.name=`${this.nakama.groups[t[1]][t[2]][t[4].split(".").shift()].name}.img`}catch{}i.name=i.name||this.lang.text.ChatRoom.noname_chatroom}SetDisplayPostWriterName(i,t){try{i.name=this.nakama.users[t[1]][t[2]][t[4]].display_name}catch{this.nakama.servers[t[1]][t[2]].session.user_id==i.name&&(i.name=this.nakama.users.self.display_name)}i.name=i.name||this.lang.text.Profile.noname_user}SetDisplayPostName(i,t){var n=this;return(0,p.A)(function*(){try{let o=yield n.indexed.loadTextFromUserPath(`${i.path}/info.json`),a=JSON.parse(o);i.name=a.title}catch(o){console.log("SetDisplayPostName error: ",o)}})()}MoveToUpDir(){this.CurrentDir=this.CurrentDir.substring(0,this.CurrentDir.lastIndexOf("/")),this.FileSel.value=void 0}SelectFolder(i){this.CurrentDir=i.path,this.FileSel.value=void 0}OpenFile(i){var t=this;return(0,p.A)(function*(){if(t.lock_modal_open)return;t.lock_modal_open=!0;let n=[];if(t.navParams.selector){if(t.navParams.path)for(let o=0,a=t.FileList.length;o<a;o++)n.push({content:JSON.parse(JSON.stringify(t.FileList[o]))})}else for(let o=0,a=t.FileList.length;o<a;o++)t.FileList[o].dir==t.CurrentDir&&n.push({content:JSON.parse(JSON.stringify(t.FileList[o]))});{let o=yield t.indexed.loadBlobFromUserPath(i.path,"");i.size=o.size}t.global.PageDismissAct["userfs-viewer"]=o=>{if(o.data)switch(o.data.type){case"gif-export":{let a=new File([o.data.blob],o.data.name);t.importSelected(a)}break;case"image":return t.global.PageDismissAct["userfs-modify-image"]=function(){var a=(0,p.A)(function*(c){if(c.data){let l=t.global.Base64ToBlob(c.data.img,"image/png");l.name=c.data.name,yield t.importSelected(l),t.p5loading.remove(c.data.loadingCtrl)}delete t.global.PageDismissAct["userfs-modify-image"]});return function(c){return a.apply(this,arguments)}}(),void t.global.ActLikeModal("void-draw",{path:o.data.path,width:o.data.width,height:o.data.height,text:o.data.text,isDarkMode:o.data.isDarkMode,scrollHeight:o.data.scrollHeight,dismiss:"userfs-modify-image"});case"text":t.importSelected(o.data.blob)}delete t.global.PageDismissAct["userfs-viewer"]},t.global.ActLikeModal("ionic-viewer",{info:{content:i},path:i.path,relevance:n,dismiss:"userfs-viewer"})})()}DownloadFile(i){this.indexed.DownloadFileFromUserPath(i.path,"",i.name)}SelectImportFolder(){document.getElementById("folder_sel_id").click()}inputImageSelected(i){var t=this;return(0,p.A)(function*(){const n=`userfs_inputImageSelected_${Date.now()}`;yield t.p5loading.update({id:n,message:t.lang.text.UserFsDir.LoadingExplorer,forceEnd:null});for(let o=0,a=i.target.files.length;o<a;o++){if(t.StopIndexing)return void t.p5loading.remove(n);yield t.indexed.saveBlobToUserPath(i.target.files[o],i.target.files[o].webkitRelativePath)}t.LoadAllIndexedFiles(),t.p5loading.remove(n),t.p5toast.show({text:t.lang.text.UserFsDir.NeedResetToApply})})()}DeleteShortcut(i,t){switch(i.mode){case 16893:this.RemoveDirectoryRecursive(i.path);break;case 33206:this.RemoveFile(i,t);break;default:console.log("\uc624\ub958 \uac80\ud1a0\uc6a9: ",i)}return!1}RemoveDirectoryRecursive(i=this.CurrentDir){var t=this;const n=i.substring(i.lastIndexOf("/")+1);this.alertCtrl.create({header:n||this.lang.text.UserFsDir.ResetDB,message:this.lang.text.UserFsDir.RemoveThisFolder,buttons:[{text:this.lang.text.UserFsDir.Delete,handler:()=>{!function(){var a=(0,p.A)(function*(){const c=`userfs_RemoveDirectoryRecursive_${Date.now()}`;yield t.p5loading.update({id:c,message:t.lang.text.UserFsDir.DeleteFile,forceEnd:null}),yield t.nakama.RemoveNotiPubKey();let l=yield t.indexed.GetFileListFromDB(i);for(let m=0,_=l.length;m<_;m++){if(t.StopIndexing)return void t.p5loading.remove(c);t.p5loading.update({id:c,message:`${t.lang.text.UserFsDir.DeleteFile}: ${l[m].split("/").pop()}`,progress:m/_}),yield t.indexed.removeFileFromUserPath(l[m])}for(let m=t.DirList.length-1;m>=0;m--)0==t.DirList[m].path.indexOf(i)&&t.DirList.splice(m,1);for(let m=t.FileList.length-1;m>=0;m--)0==t.FileList[m].path.indexOf(i)&&t.FileList.splice(m,1);if(i===t.CurrentDir&&t.MoveToUpDir(),t.p5loading.remove(c),t.noti.ClearNoti(4),!n){const m=t.global.GetConnectedAddress();window.location.href=m}});return function(){return a.apply(this,arguments)}}()()},cssClass:"redfont"}]}).then(o=>o.present())}RemoveFile(i,t){this.alertCtrl.create({header:i.name,message:this.lang.text.ChatRoom.CannotUndone,buttons:[{text:this.lang.text.UserFsDir.Delete,handler:()=>{this.indexed.removeFileFromUserPath(i.path).then(()=>{this.FileList.splice(t,1)})},cssClass:"redfont"}]}).then(n=>n.present())}}return(r=d).\u0275fac=function(i){return new(i||r)(e.rXU(I.n),e.rXU(P.y),e.rXU(k.z3),e.rXU(R.G),e.rXU(f.hG),e.rXU(G.up),e.rXU(j.q9),e.rXU(S.r),e.rXU(T.X),e.rXU(D.Ix),e.rXU(D.nX),e.rXU($.f))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-user-fs-dir"]],viewQuery:function(i,t){if(1&i&&e.GBs(C,5),2&i){let n;e.mGM(n=e.lsd())&&(t.FileSel=n.first)}},decls:25,vars:8,consts:[["FileSel",""],[1,"ion-no-border"],["slot","start"],["defaultHref",""],["class","top_icon","slot","end","name","eye-outline",3,"click",4,"ngIf"],["class","top_icon","slot","end","name","eye-off-outline",3,"click",4,"ngIf"],["id","p5Drop_userfs",2,"position","absolute","width","100%","height","100%","display","flex","pointer-events","none","z-index","500"],["hidden","","type","file","id","import_file","accept","*","multiple","",3,"change"],[4,"ngIf"],["button",""],["slot","start","name","folder"],["color","primary","slot","end","name","folder-open-outline",3,"click",4,"ngIf"],["color","primary","slot","end","name","document-outline",3,"click","contextmenu"],["color","danger","slot","end","name","close-circle-outline",3,"click"],["button","",3,"click",4,"ngIf"],[3,"contextmenu",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["slot","end","name","eye-outline",1,"top_icon",3,"click"],["slot","end","name","eye-off-outline",1,"top_icon",3,"click"],["button","",3,"click"],["slot","start","name","arrow-down-circle"],["hidden","","type","file","id","folder_sel_id","webkitdirectory","",3,"change"],["color","primary","slot","end","name","folder-open-outline",3,"click"],[3,"contextmenu"],[3,"value",4,"ngIf"],[3,"value"],["slot","header",3,"contextmenu"],["slot","start","name","image",4,"ngIf"],["slot","start","name","musical-notes",4,"ngIf"],["slot","start","name","play-circle",4,"ngIf"],["slot","start","name","reader",4,"ngIf"],["slot","start","name","extension-puzzle",4,"ngIf"],["slot","start","name","cube-outline",4,"ngIf"],["slot","start","name","code-slash-outline",4,"ngIf"],["slot","start","name","document",4,"ngIf"],["text-wrap","",4,"ngIf"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["class","ion-text-right button_dist",3,"click",4,"ngIf"],[1,"ion-text-end","button_dist",3,"click"],["class","image_front_form",3,"click",4,"ngIf"],["slot","start","name","image"],["slot","start","name","musical-notes"],["slot","start","name","play-circle"],["slot","start","name","reader"],["slot","start","name","extension-puzzle"],["slot","start","name","cube-outline"],["slot","start","name","code-slash-outline"],["slot","start","name","document"],["text-wrap",""],[1,"ion-text-right","button_dist",3,"click"],[1,"image_front_form",3,"click"],["loading","lazy",1,"image_front_view",3,"src","alt"]],template:function(i,t){if(1&i){const n=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",2),e.nrm(5,"ion-back-button",3),e.k0s(),e.DNE(6,N,1,0,"ion-icon",4)(7,L,1,0,"ion-icon",5),e.k0s()(),e.j41(8,"ion-content")(9,"div",6)(10,"input",7),e.bIt("change",function(a){return e.eBV(n),e.Njj(t.inputFileSelected(a))}),e.k0s()(),e.DNE(11,w,6,2,"div",8),e.j41(12,"div")(13,"ion-item",9),e.nrm(14,"ion-icon",10),e.j41(15,"ion-label"),e.EFF(16,"."),e.k0s(),e.DNE(17,X,1,0,"ion-icon",11),e.j41(18,"ion-icon",12),e.bIt("click",function(){return e.eBV(n),e.Njj(t.SelectFiles())})("contextmenu",function(){return e.eBV(n),e.Njj(t.PasteFile())}),e.k0s(),e.j41(19,"ion-icon",13),e.bIt("click",function(){return e.eBV(n),e.Njj(t.RemoveDirectoryRecursive())}),e.k0s()(),e.DNE(20,A,4,1,"ion-item",14),e.k0s(),e.DNE(21,E,2,1,"div",15),e.j41(22,"ion-accordion-group",null,0),e.DNE(24,ne,2,1,"div",16),e.k0s()()}2&i&&(e.R7$(3),e.JRh(t.lang.text.Settings.InAppExplorer),e.R7$(3),e.Y8G("ngIf",!t.HideThumbnail),e.R7$(),e.Y8G("ngIf",t.HideThumbnail),e.R7$(4),e.Y8G("ngIf",""==t.CurrentDir&&!t.navParams.selector&&t.CanImportFolder),e.R7$(6),e.Y8G("ngIf",""!=t.CurrentDir),e.R7$(3),e.Y8G("ngIf",""!=t.CurrentDir),e.R7$(),e.Y8G("ngForOf",t.DirList),e.R7$(3),e.Y8G("ngForOf",t.FileList))},dependencies:[v.Sq,v.bT,f.xk,f.YH,f.Jm,f.QW,f.W9,f.eU,f.iq,f.uz,f.he,f.BC,f.ai,f.el],styles:[".item.sc-ion-label-md-h[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]   .sc-ion-label-md-h[_ngcontent-%COMP%]{overflow:unset}.image_front_form[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.image_front_view[_ngcontent-%COMP%]{max-height:233px}.button_dist[_ngcontent-%COMP%]{padding-left:2px}"],data:{animation:[(0,h.hZ)("toggle_item",[(0,h.kY)(":enter",[(0,h.iF)({height:"0px",opacity:0}),(0,h.i0)(".5s ease-out",(0,h.iF)({height:"{{ offset }}px",opacity:1}))],{params:{offset:"48"}}),(0,h.kY)(":leave",[(0,h.i0)(".5s ease-in",(0,h.iF)({height:"0px",opacity:0}))])])]}}),d})()}];let oe=(()=>{var r;class d{}return(r=d).\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[D.iI.forChild(re),D.iI]}),d})(),se=(()=>{var r;class d{}return(r=d).\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[v.MD,b.YN,f.bv,oe]}),d})()}}]);