"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8989],{8989:(z,A,u)=>{u.r(A),u.d(A,{AdminToolsPageModule:()=>Y});var v=u(177),f=u(4341),c=u(5374),R=u(9858),g=u(467),e=u(3953),T=u(4234),j=u(4237),$=u(9900),b=u(8065),x=u(755),F=u(7100),G=u(3307);const y=["UserSel"],E=["GroupSel"];function I(r,_){if(1&r){const n=e.RV6();e.j41(0,"ion-item",34),e.bIt("click",function(){const t=e.eBV(n).index,s=e.XpG(2);return e.Njj(s.select_server(t))}),e.j41(1,"ion-label"),e.EFF(2),e.k0s()()}if(2&r){const n=_.$implicit;e.R7$(2),e.JRh(n.name)}}function P(r,_){if(1&r){const n=e.RV6();e.j41(0,"ion-accordion-group",26,2),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.isExpanded=!0)}),e.j41(2,"ion-accordion",27)(3,"ion-item",28)(4,"ion-label",29),e.EFF(5),e.k0s(),e.j41(6,"ion-label",30),e.EFF(7),e.k0s(),e.nrm(8,"ion-icon",31),e.k0s(),e.j41(9,"div",32),e.DNE(10,I,3,1,"ion-item",33),e.k0s()()()}if(2&r){const n=e.XpG();e.Y8G("value",n.isExpanded),e.R7$(5),e.JRh(n.lang.text.AddGroup.SelectServer),e.R7$(2),e.JRh(n.servers[n.index].name),e.R7$(3),e.Y8G("ngForOf",n.servers)}}function S(r,_){if(1&r){const n=e.RV6();e.j41(0,"ion-item")(1,"ion-label"),e.EFF(2),e.k0s(),e.j41(3,"ion-button",21),e.bIt("click",function(){const t=e.eBV(n),s=t.$implicit,o=t.index,a=e.XpG(2);return e.Njj(a.ApprovalUser(s,o))}),e.EFF(4),e.k0s(),e.j41(5,"ion-button",35),e.bIt("click",function(){const t=e.eBV(n),s=t.$implicit,o=t.index,a=e.XpG(2);return e.Njj(a.ApprovalUser(s,o,!1))}),e.EFF(6),e.k0s()()}if(2&r){const n=_.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(n.email),e.R7$(2),e.SpI(" ",i.lang.text.Nakama.ReqContAccept," "),e.R7$(2),e.SpI(" ",i.lang.text.Nakama.ReqContReject," ")}}function L(r,_){if(1&r&&(e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.DNE(4,S,7,3,"ion-item",25),e.k0s()),2&r){const n=e.XpG();e.R7$(3),e.JRh(n.lang.text.AdminTools.WaitingReg),e.R7$(),e.Y8G("ngForOf",n.WaitingApproval)}}function O(r,_){if(1&r&&(e.j41(0,"div",36)(1,"div",37),e.nrm(2,"ion-icon",38),e.j41(3,"div")(4,"ion-label",39),e.EFF(5),e.k0s()()()()),2&r){const n=e.XpG();e.R7$(5),e.JRh(n.lang.text.AdminTools.Requesting)}}function C(r,_){if(1&r&&e.nrm(0,"img",52),2&r){const n=e.XpG().$implicit,i=e.XpG();e.Y8G("src",i.all_users[n].img,e.B4B)}}function N(r,_){if(1&r&&(e.j41(0,"span",53),e.EFF(1),e.k0s()),2&r){const n=e.XpG(2);e.R7$(),e.JRh("("+n.lang.text.MinimalChat.name_me+")")}}function U(r,_){if(1&r){const n=e.RV6();e.j41(0,"div")(1,"ion-accordion",40)(2,"ion-item",41)(3,"div",42),e.DNE(4,C,1,1,"img",43),e.k0s(),e.nrm(5,"div",44),e.j41(6,"ion-label",45),e.EFF(7),e.DNE(8,N,2,1,"span",46),e.k0s(),e.nrm(9,"ion-icon",31),e.k0s(),e.j41(10,"div",32)(11,"ion-item",47),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG();return e.Njj(s.copy_id(s.all_users[t].id||s.all_users[t].user_id))}),e.j41(12,"ion-label",48),e.EFF(13),e.k0s()(),e.j41(14,"ion-item",49)(15,"ion-label",29),e.EFF(16),e.k0s(),e.j41(17,"ion-label",50),e.EFF(18),e.k0s()(),e.j41(19,"ion-item",49)(20,"ion-label",29),e.EFF(21),e.k0s(),e.j41(22,"ion-label",50),e.EFF(23),e.k0s()(),e.j41(24,"ion-item",34),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG();return e.Njj(s.start_private_chat(s.all_users[t]))}),e.j41(25,"ion-label"),e.EFF(26),e.k0s()(),e.j41(27,"ion-item",34),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG();return e.Njj(s.remove_user(s.all_users[t]))}),e.j41(28,"ion-label",51),e.EFF(29),e.k0s()()()()()}if(2&r){const n=_.$implicit,i=e.XpG();e.R7$(),e.Y8G("value",i.all_users[n].id||i.all_users[n].user_id),e.R7$(3),e.Y8G("ngIf",i.all_users[n].img),e.R7$(),e.Aen("background-color: "+i.statusBar.colors[i.all_users[n].online?"online":"offline"]),e.R7$(2),e.SpI("",i.nakama.usernameOverride[i.isOfficial][i.target][i.all_users[n].id]||i.all_users[n].display_name||i.lang.text.Profile.noname_user," "),e.R7$(),e.Y8G("ngIf",i.all_users[n].is_me),e.R7$(5),e.JRh(i.all_users[n].id||i.all_users[n].user_id),e.R7$(3),e.JRh(i.lang.text.AdminTools.UserCreate),e.R7$(2),e.JRh(i.all_users[n].display_created),e.R7$(3),e.JRh(i.lang.text.AddGroup.LanguageTag),e.R7$(2),e.JRh(i.all_users[n].lang_tag),e.R7$(3),e.JRh(i.lang.text.OtherProfile.privacy_chat),e.R7$(3),e.JRh(i.lang.text.AdminTools.ForceLeave)}}function M(r,_){if(1&r&&(e.j41(0,"div",36)(1,"div",37),e.nrm(2,"ion-icon",54),e.j41(3,"div")(4,"ion-label",39),e.EFF(5),e.k0s()()()()),2&r){const n=e.XpG();e.R7$(5),e.JRh(n.lang.text.AdminTools.Requesting)}}function B(r,_){if(1&r&&e.nrm(0,"img",52),2&r){const n=e.XpG().$implicit,i=e.XpG();e.Y8G("src",i.all_groups[n].img,e.B4B)}}function J(r,_){if(1&r&&e.nrm(0,"img",60),2&r){const n=e.XpG().$implicit,i=e.XpG(2);e.Y8G("src",n.is_me?i.nakama.users.self.img:i.nakama.users[i.isOfficial][i.target][n.user.id].img,e.B4B)}}function w(r,_){if(1&r){const n=e.RV6();e.j41(0,"div")(1,"ion-item",58),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG(2);return s.copy_id(t.user.id),e.Njj(s.find_current_user_id(t.user.id))}),e.j41(2,"div",42),e.DNE(3,J,1,1,"img",59),e.k0s(),e.j41(4,"ion-label"),e.EFF(5),e.k0s()()()}if(2&r){const n=_.$implicit,i=e.XpG(2);e.R7$(3),e.Y8G("ngIf",n.is_me?i.nakama.users.self.img:i.nakama.users[i.isOfficial][i.target][n.user.id].img),e.R7$(2),e.JRh((n.is_me?i.nakama.users.self.display_name:i.nakama.usernameOverride[i.isOfficial][i.target][n.user.id]||n.user.display_name)||i.lang.text.Profile.noname_user)}}function V(r,_){if(1&r){const n=e.RV6();e.j41(0,"div")(1,"ion-accordion",40)(2,"ion-item",41)(3,"div",42),e.DNE(4,B,1,1,"img",43),e.k0s(),e.nrm(5,"div",44),e.j41(6,"ion-label",45),e.EFF(7),e.k0s(),e.nrm(8,"ion-icon",31),e.k0s(),e.j41(9,"div",32)(10,"ion-item",47),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG();return e.Njj(s.copy_id(s.all_groups[t].id))}),e.j41(11,"ion-label",48),e.EFF(12),e.k0s()(),e.j41(13,"ion-item",49)(14,"ion-label",29),e.EFF(15),e.k0s(),e.j41(16,"ion-label",50),e.EFF(17),e.k0s()(),e.j41(18,"ion-item",47),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG();return s.copy_id(s.all_groups[t].creator_id),e.Njj(s.find_current_user_id(s.all_groups[t].creator_id))}),e.j41(19,"ion-label",55),e.EFF(20),e.k0s(),e.j41(21,"ion-label",56),e.EFF(22),e.k0s()(),e.j41(23,"ion-accordion-group",null,3)(25,"ion-accordion",40)(26,"ion-item",41)(27,"ion-label",29),e.EFF(28),e.k0s(),e.j41(29,"ion-label",50),e.EFF(30),e.k0s()(),e.j41(31,"div",32),e.DNE(32,w,6,2,"div",25),e.k0s()()(),e.j41(33,"ion-item-divider")(34,"ion-label"),e.EFF(35),e.k0s()(),e.j41(36,"textarea",57),e.mxI("ngModelChange",function(t){const s=e.eBV(n).$implicit,o=e.XpG();return e.DH7(o.all_groups[s].description,t)||(o.all_groups[s].description=t),e.Njj(t)}),e.k0s(),e.j41(37,"ion-item",34),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG();return e.Njj(s.force_breakup_group(s.all_groups[t]))}),e.j41(38,"ion-label",51),e.EFF(39),e.k0s()()()()()}if(2&r){const n=_.$implicit,i=e.XpG();e.R7$(),e.Y8G("value",i.all_groups[n].name),e.R7$(3),e.Y8G("ngIf",i.all_groups[n].img),e.R7$(),e.Aen("background-color: "+i.statusBar.colors[i.all_groups[n].open?"online":"pending"]),e.R7$(2),e.JRh(i.all_groups[n].name),e.R7$(5),e.JRh(i.all_groups[n].id),e.R7$(3),e.JRh(i.lang.text.AddGroup.LanguageTag),e.R7$(2),e.JRh(i.all_groups[n].lang_tag),e.R7$(3),e.JRh(i.lang.text.AdminTools.GroupCreator),e.R7$(2),e.SpI(" ",(i.nakama.users[i.isOfficial][i.target][i.all_groups[n].creator_id]?i.nakama.usernameOverride[i.isOfficial][i.target][i.all_groups[n].creator_id]||i.nakama.users[i.isOfficial][i.target][i.all_groups[n].creator_id].display_name:i.nakama.users.self.display_name)||i.lang.text.Profile.noname_user," "),e.R7$(3),e.Y8G("value",i.all_groups[n].name+"_user"),e.R7$(3),e.JRh(i.lang.text.AdminTools.GroupUserCounter),e.R7$(2),e.JRh(i.all_groups[n].edge_count+" / "+i.all_groups[n].max_count),e.R7$(2),e.Y8G("ngForOf",i.all_groups[n].users),e.R7$(3),e.JRh(i.lang.text.AddGroup.GroupDetail_placeholder),e.R7$(),e.R50("ngModel",i.all_groups[n].description),e.R7$(3),e.JRh(i.lang.text.AdminTools.ForceBreakUp)}}const X=[{path:"",component:(()=>{var r;class _{constructor(i,t,s,o,a,l,d,p){this.lang=i,this.nakama=t,this.p5toast=s,this.alertCtrl=o,this.statusBar=a,this.indexed=l,this.global=d,this.p5loading=p,this.servers=[],this.index=0,this.isExpanded=!0,this.notification={uri:"",msg:"",noti_id:1,persistent:!1},this.ArcadeListURL="",this.RegLimitApplying=!1,this.WaitingApproval=[],this.is_sending=!1,this.all_users=[],this.CurrentOnlineUser=0,this.AllUserCount=0,this.current_user_page=1,this.all_user_page=1,this.current_user_size=[],this.all_groups=[],this.AllGroupCount=0,this.current_group_page=1,this.all_group_page=1,this.current_group_size=[],this.LIST_PAGE_SIZE=5}select_server(i){this.index=i,this.isOfficial=this.servers[i].isOfficial,this.target=this.servers[i].target,this.isExpanded=!1,this.GetRegisteredArcadeURL(),this.refresh_all_user(),this.refresh_all_groups(),this.GetRegLimitInfo(),this.GetApprovalList()}ngOnInit(){this.servers=this.nakama.get_all_server_info(!0,!0);for(let i=this.servers.length-1;i>=0;i--)this.servers[i].is_admin||this.servers.splice(i,1);this.select_server(0)}GetRegisteredArcadeURL(){this.nakama.servers[this.isOfficial][this.target].client.readStorageObjects(this.nakama.servers[this.isOfficial][this.target].session,{object_ids:[{collection:"arcade",key:"url"}]}).then(i=>{this.ArcadeListURL=i.objects.length?i.objects[0].value.data:""})}GetRegLimitInfo(){var i=this;return(0,g.A)(function*(){try{const t=i.nakama.GetNodejsServerAddress(i.isOfficial,i.target,"webpush_port"),s=yield fetch(`${t}GetRegLimitInfo`,{method:"POST"});if(!s.ok)throw`${s.statusText} (${s.status})`;const o=yield s.text(),a=JSON.parse(o);i.RegCountLimit=a.count,i.RegWithApproval=a.useApproval}catch(t){console.log("GetRegLimitInfo: ",t),i.p5toast.show({text:`${t}`,lateable:!0})}})()}ApplyRegLimit(){var i=this;return(0,g.A)(function*(){i.RegLimitApplying=!0;try{const t=i.nakama.GetNodejsServerAddress(i.isOfficial,i.target,"webpush_port"),s={count:i.RegCountLimit||0,useApproval:i.RegWithApproval||!1},o=yield fetch(`${t}ApplyRegLimit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw`${o.statusText} (${o.status})`;i.p5loading.toast(i.lang.text.AdminTools.ApplyRegLimit,"updateRegLimit")}catch(t){console.log("ApplyRegLimit: ",t),i.p5toast.show({text:`${i.lang.text.AdminTools.ApplyRegCountLimitErr}: ${t}`})}i.RegLimitApplying=!1})()}GetApprovalList(){var i=this;return(0,g.A)(function*(){i.WaitingApproval.length=0;try{const t=i.nakama.GetNodejsServerAddress(i.isOfficial,i.target,"webpush_port"),s=yield fetch(`${t}GetNeedApprovalList`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:i.nakama.servers[i.isOfficial][i.target].session.user_id})});if(!s.ok)throw`${s.statusText} (${s.status})`;const o=yield s.text(),a=JSON.parse(o);let l=Object.keys(a);for(let d of l)i.WaitingApproval.push({email:d,pw:a[d]})}catch(t){console.log("GetApprovalList: ",t),i.p5toast.show({text:`${t}`,lateable:!0})}})()}ApprovalUser(i,t,s=!0){var o=this;return(0,g.A)(function*(){try{const a=o.nakama.GetNodejsServerAddress(o.isOfficial,o.target,"webpush_port"),l=yield fetch(`${a}ApprovalUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw`${l.statusText} (${l.status})`;o.WaitingApproval.splice(t,1),s?(yield o.nakama.servers[o.isOfficial][o.target].client.authenticateEmail(i.email,i.pw,!0),o.refresh_all_user(),o.p5toast.show({text:`${o.lang.text.Nakama.RegisterUserSucc}: ${i.email}`,lateable:!0})):o.p5toast.show({text:`${o.lang.text.Nakama.ReqContReject}: ${i.email}`,lateable:!0})}catch(a){console.log("ApprovalUser: ",a),o.p5toast.show({text:`${o.lang.text.AdminTools.ApprovalErr}: ${a}`})}})()}SetArcadeURL(){var i=this;return(0,g.A)(function*(){try{yield i.nakama.servers[i.isOfficial][i.target].client.rpc(i.nakama.servers[i.isOfficial][i.target].session,"set_arcade_url_fn",{data:i.ArcadeListURL}),i.p5toast.show({text:i.lang.text.AdminTools.SuccSetArcadeURL})}catch(t){i.p5toast.show({text:`${i.lang.text.AdminTools.FailedSetArcadeURL}: ${(t.statusText?`${t.statusText}(${t.status})`:t.status)||t}`})}i.ArcadeListURL&&i.global.open_link(i.ArcadeListURL)})()}send_noti_to_server(){this.notification.msg||this.notification.uri?(this.is_sending=!0,this.notification.msg=encodeURIComponent(this.notification.msg),this.notification.uri=encodeURIComponent(this.notification.uri),this.nakama.servers[this.isOfficial][this.target].client.rpc(this.nakama.servers[this.isOfficial][this.target].session,"send_noti_all_fn",this.notification).then(i=>{this.notification.msg="",this.notification.uri="",this.is_sending=!1}).catch(i=>{console.log("send_noti_to_server: ",i),this.p5toast.show({text:`${this.lang.text.AdminTools.SendFailed}: ${(i.statusText?`${i.statusText}(${i.status})`:i.status)||i}`}),this.is_sending=!1})):this.p5toast.show({text:this.lang.text.AdminTools.NoNotiMsg})}refresh_all_user(){this.CurrentOnlineUser=0,this.AllUserCount=0,this.all_users.length=0,this.current_user_size.length=0,this.nakama.servers[this.isOfficial][this.target].client.rpc(this.nakama.servers[this.isOfficial][this.target].session,"query_all_users",{}).then(i=>{this.all_users=i.payload;for(let t=0,s=this.all_users.length;t<s;t++){this.nakama.save_other_user(this.all_users[t],this.isOfficial,this.target);let o=this.all_users[t].id||this.all_users[t].user_id;this.nakama.load_other_user(o,this.isOfficial,this.target,a=>{this.all_users[t]={...this.all_users[t],...a};let l=new Date(this.all_users[t].create_time).getTime()-60*(new Date).getTimezoneOffset()*1e3;this.all_users[t].display_created=new Date(l).toISOString().split(".")[0],this.all_users[t].is_me=o==this.nakama.servers[this.isOfficial][this.target].session.user_id},!0),this.all_users[t].online&&this.CurrentOnlineUser++}this.AllUserCount=this.all_users.length,this.all_user_page=Math.ceil(this.all_users.length/this.LIST_PAGE_SIZE),this.current_user_page=0,this.change_user_list_page(1)}).catch(i=>{console.error("\uc0ac\uc6a9\uc790 \ub9ac\uc2a4\ud2b8 \ub3cc\ub824\ubc1b\uae30 \uc624\ub958: ",i)})}refresh_all_groups(){this.AllGroupCount=0,this.all_groups.length=0,this.current_group_size.length=0,this.nakama.servers[this.isOfficial][this.target].client.rpc(this.nakama.servers[this.isOfficial][this.target].session,"query_all_groups",{}).then(i=>{this.all_groups=i.payload;for(let t=0,s=this.all_groups.length;t<s;t++){for(let o=0,a=this.all_groups[t].users.length;o<a;o++)this.all_groups[t].users[o].user.user_id==this.nakama.servers[this.isOfficial][this.target].session.user_id?(this.all_groups[t].users[o].is_me=!0,this.all_groups[t].users[o].user=this.nakama.users.self):this.all_groups[t].users[o].user=this.nakama.load_other_user(this.all_groups[t].users[o].user.user_id,this.isOfficial,this.target);this.indexed.loadTextFromUserPath(`servers/${this.isOfficial}/${this.target}/groups/${this.all_groups[t].id}.img`,(o,a)=>{o&&a&&(this.all_groups[t].img=a)})}this.AllGroupCount=this.all_groups.length||0,this.all_group_page=Math.ceil(this.all_groups.length/this.LIST_PAGE_SIZE)||0,this.current_group_page=0,this.change_group_list_page(1)}).catch(i=>{console.error("\uadf8\ub8f9 \ub9ac\uc2a4\ud2b8 \ub3cc\ub824\ubc1b\uae30 \uc624\ub958: ",i)})}find_current_user_id(i){for(let t=0,s=this.all_users.length;t<s;t++)if(this.all_users[t].id==i){this.current_user_page=Math.floor(t/5),this.change_user_list_page(1);break}this.UserSel.value=i}force_breakup_group(i){this.alertCtrl.create({header:i.name,message:this.lang.text.AdminTools.ForceBreakUp,buttons:[{text:this.lang.text.GroupDetail.BreakupGroup,cssClass:"redfont",handler:()=>{this.ForceBreakupGroupAct(i)}}]}).then(t=>t.present())}ForceBreakupGroupAct(i){var t=this;return(0,g.A)(function*(){const s=`remove_channel_files_${i.name}`;yield t.p5loading.update({id:s,message:`${t.lang.text.GroupDetail.ForceBreaked}: ${i.name}`,forceEnd:null});try{yield t.nakama.servers[t.isOfficial][t.target].client.rpc(t.nakama.servers[t.isOfficial][t.target].session,"force_remove_group",{group_id:i.id}),t.p5toast.show({text:`${t.lang.text.AdminTools.ForceBreaked}: ${i.name}`}),t.refresh_all_user(),t.refresh_all_groups()}catch(l){console.log("force_breakup_group: ",l),t.p5toast.show({text:`${t.lang.text.AdminTools.ForceBreakedFailed}: ${l.statusText}`,lateable:!0})}try{yield t.nakama.remove_channel_files(t.isOfficial,t.target,t.nakama.groups[t.isOfficial][t.target][i.id].channel_id,void 0,s)}catch(l){console.log("\ucc44\ub110 \ud30c\uc77c \uc0ad\uc81c \uc624\ub958: ",l),t.p5toast.show({text:`${t.lang.text.AdminTools.FailedClear}: ${(l.statusText?`${l.statusText}(${l.status})`:l.status)||l}`,lateable:!0})}let o=t.nakama.servers[t.isOfficial][t.target].info;try{var a;let l=localStorage.getItem("fallback_fs");if(!l)throw"\uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc11c\ubc84 \uc5c6\uc74c";let d=l.split("://"),p=d.pop().split(":"),h=d.pop();h?h+=":":h=t.global.checkProtocolFromAddress(p[0])?"https:":"http:";const m=null===(a=p[1])||void 0===a?void 0:a.split(",");let k=`${h}//${p[0]}:${(null==m?void 0:m[1])||9002}/`;yield t.p5loading.update({id:s,message:`${t.lang.text.AdminTools.ClearFFSKey}: ${i.name}`,forceEnd:null}),yield t.global.remove_files_from_storage_with_key(k,i.id,{})}catch(l){console.log("ffs \ud30c\uc77c \uc0ad\uc81c \uc2e4\ud328: ",l),t.p5toast.show({text:`${t.lang.text.AdminTools.FailedFFSClear}: ${(l.statusText?`${l.statusText}(${l.status})`:l.status)||l}`,lateable:!0})}try{let l=`${o.useSSL?"https":"http"}://${o.address}`;yield t.p5loading.update({id:s,message:`${t.lang.text.AdminTools.ClearCDN}: ${i.name}`,forceEnd:null}),yield t.global.remove_files_from_storage_with_key(l,i.id,{cdn_port:o.cdn_port,apache_port:o.apache_port,user_id:t.nakama.servers[t.isOfficial][t.target].session.user_id})}catch(l){console.log("\ud30c\uc77c \uc77c\uad04 \uc0ad\uc81c \uc694\uccad \uc2e4\ud328: ",l),t.p5toast.show({text:`${t.lang.text.AdminTools.FailedClear}: ${(l.statusText?`${l.statusText}(${l.status})`:l.status)||l}`,lateable:!0})}yield t.p5loading.update({id:s,message:`${t.lang.text.GroupDetail.BreakupGroup}: ${i.name}`,progress:1,forceEnd:1e3})})()}change_user_list_page(i){switch(i){case 1:if(this.current_user_page<this.all_user_page){this.current_user_page+=1,this.current_user_size=Array(this.current_user_page==this.all_user_page?this.all_users.length%this.LIST_PAGE_SIZE==0?this.LIST_PAGE_SIZE:this.all_users.length%this.LIST_PAGE_SIZE:this.LIST_PAGE_SIZE);for(let t=0,s=this.current_user_size.length;t<s;t++)this.current_user_size[t]=(this.current_user_page-1)*this.LIST_PAGE_SIZE+t}break;case-1:if(this.current_user_page-1>0){this.current_user_page-=1,this.current_user_size=Array(this.LIST_PAGE_SIZE);for(let t=0,s=this.current_user_size.length;t<s;t++)this.current_user_size[t]=(this.current_user_page-1)*this.LIST_PAGE_SIZE+t}}this.UserSel.value=void 0}change_group_list_page(i){switch(i){case 1:if(this.current_group_page<this.all_group_page){this.current_group_page+=1,this.current_group_size=Array(this.current_group_page==this.all_group_page?this.all_groups.length%this.LIST_PAGE_SIZE==0?this.LIST_PAGE_SIZE:this.all_groups.length%this.LIST_PAGE_SIZE:this.LIST_PAGE_SIZE);for(let t=0,s=this.current_group_size.length;t<s;t++)this.current_group_size[t]=(this.current_group_page-1)*this.LIST_PAGE_SIZE+t}break;case-1:if(this.current_group_page-1>0){this.current_group_page-=1,this.current_group_size=Array(this.LIST_PAGE_SIZE);for(let t=0,s=this.current_group_size.length;t<s;t++)this.current_group_size[t]=(this.current_group_page-1)*this.LIST_PAGE_SIZE+t}}this.GroupSel.value=void 0}start_private_chat(i){var t=this;return(0,g.A)(function*(){let s=yield t.nakama.join_chat_with_modulation(i.user_id||i.id,2,t.isOfficial,t.target,!0);t.nakama.go_to_chatroom(s)})()}copy_id(i){this.global.WriteValueToClipboard("text/plain",i)}remove_user(i){var t=this;let s=i.display_name||this.lang.text.Profile.noname_user;try{this.nakama.usernameOverride[this.isOfficial][this.target][i.id]&&(s+=` (${this.nakama.usernameOverride[this.isOfficial][this.target][i.id]})`)}catch{}this.alertCtrl.create({header:s,message:this.lang.text.AdminTools.ForceLeave,buttons:[{text:this.lang.text.AdminTools.ApplyLeave,cssClass:"redfont",handler:()=>{!function(){var a=(0,g.A)(function*(){const l=`admin_remove_user_${Date.now()}`;t.p5loading.update({id:l,message:`${t.lang.text.Nakama.RemovingAccount}: ${s}`}),yield t.RemoveUser(i),t.p5loading.remove(l)});return function(){return a.apply(this,arguments)}}()()}}]}).then(o=>o.present())}RemoveUser(i){var t=this;return(0,g.A)(function*(){try{let o=t.nakama.servers[t.isOfficial][t.target].info,a=`${o.useSSL?"https":"http"}://${o.address}`;yield t.nakama.servers[t.isOfficial][t.target].client.rpc(t.nakama.servers[t.isOfficial][t.target].session,"remove_account_fn",{user_id:i.user_id||i.id});try{var s;let l=localStorage.getItem("fallback_fs");if(!l)throw"\uc0ac\uc6a9\uc790 \uc9c0\uc815 \uc11c\ubc84 \uc5c6\uc74c";let d=l.split("://"),p=d.pop().split(":"),h=d.pop();h?h+=":":h=t.global.checkProtocolFromAddress(p[0])?"https:":"http:";const m=null===(s=p[1])||void 0===s?void 0:s.split(",");let k=`${h}//${p[0]}:${(null==m?void 0:m[1])||9002}/`;yield t.global.remove_files_from_storage_with_key(k,i.user_id,{})}catch{}try{yield t.global.remove_files_from_storage_with_key(a,i.user_id,{cdn_port:o.cdn_port,apache_port:o.apache_port,user_id:t.nakama.servers[t.isOfficial][t.target].session.user_id})}catch(l){console.log("\ud30c\uc77c \uc77c\uad04 \uc0ad\uc81c \uc694\uccad \uc2e4\ud328: ",l)}t.p5toast.show({text:`${t.lang.text.AdminTools.UserLeaved}: ${i.display_name||t.lang.text.Profile.noname_user}`}),t.refresh_all_user(),t.refresh_all_groups()}catch(o){console.log("remove_user: ",o),t.p5toast.show({text:`${t.lang.text.AdminTools.UserLeavedFailed}: ${o.statusText}`})}})()}}return(r=_).\u0275fac=function(i){return new(i||r)(e.rXU(T.y),e.rXU(j.X),e.rXU($.G),e.rXU(c.hG),e.rXU(b.j),e.rXU(x.n),e.rXU(F.z3),e.rXU(G.f))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-admin-tools"]],viewQuery:function(i,t){if(1&i&&(e.GBs(y,5),e.GBs(E,5)),2&i){let s;e.mGM(s=e.lsd())&&(t.UserSel=s.first),e.mGM(s=e.lsd())&&(t.GroupSel=s.first)}},decls:78,vars:36,consts:[["UserSel",""],["GroupSel",""],["accordionGroup",""],["GroupUserSel",""],[1,"ion-no-border"],["slot","start"],["defaultHref","portal/settings"],["value","colors","expand","inset",3,"value","click",4,"ngIf"],["button",""],["placeholder","0","type","number","min","0",1,"ion-text-end",3,"ngModelChange","label","ngModel"],[3,"ngModelChange","ngModel"],["button","",1,"ion-text-center",3,"click","disabled"],[4,"ngIf"],[1,"ion-text-end",3,"ngModelChange","label","placeholder","ngModel"],["slot","end","name","open-outline",3,"click"],[1,"ion-text-end",3,"ngModelChange","label","ngModel","placeholder"],[1,"infobox","content_size",3,"ngModelChange","ngModel","placeholder"],["button","",3,"disabled"],[1,"ion-text-center",3,"click"],["color","primary","name","refresh-circle-outline",1,"refresh_icon",3,"click"],["slot","end",2,"margin-right","8px"],[3,"click"],["slot","start","name","arrow-back-circle-outline",1,"icon_style"],["slot","start","name","arrow-forward-circle-outline",1,"icon_style"],["style","height: 245px;",4,"ngIf"],[4,"ngFor","ngForOf"],["value","colors","expand","inset",3,"click","value"],["value","colors"],["slot","header"],[2,"display","contents"],[1,"ion-text-right"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],["color","danger",2,"margin-left","4px",3,"click"],[2,"height","245px"],[1,"disconnect_info",2,"position","relative"],["color","medium","name","person-circle-outline",2,"width","60px","height","60px"],["color","medium"],[3,"value"],["button","","slot","header"],[1,"additional_form","bg_img_form"],["class","profile_img","loading","lazy",3,"src",4,"ngIf"],[1,"additional_form","status_bar_single"],[1,"form_margin"],["class","server_target",4,"ngIf"],[2,"cursor","copy",3,"click"],["color","medium","text-wrap","",1,"ion-text-center"],["disabled",""],[1,"ion-text-end"],["color","danger",1,"ion-text-center"],["loading","lazy",1,"profile_img",3,"src"],[1,"server_target"],["color","medium","name","people-circle-outline",2,"width","60px","height","60px"],["color","medium",2,"display","contents"],["color","medium",1,"ion-text-end"],["disabled","",1,"infobox",3,"ngModelChange","ngModel"],["button","",2,"cursor","copy",3,"click"],["class","profile_img",3,"src",4,"ngIf"],[1,"profile_img",3,"src"]],template:function(i,t){if(1&i){const s=e.RV6();e.j41(0,"ion-header",4)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",5),e.nrm(5,"ion-back-button",6),e.k0s()()(),e.j41(6,"ion-content"),e.DNE(7,P,11,4,"ion-accordion-group",7),e.j41(8,"ion-item-divider")(9,"ion-label"),e.EFF(10),e.k0s()(),e.j41(11,"ion-item",8)(12,"ion-input",9),e.mxI("ngModelChange",function(a){return e.eBV(s),e.DH7(t.RegCountLimit,a)||(t.RegCountLimit=a),e.Njj(a)}),e.k0s()(),e.j41(13,"ion-item")(14,"ion-checkbox",10),e.mxI("ngModelChange",function(a){return e.eBV(s),e.DH7(t.RegWithApproval,a)||(t.RegWithApproval=a),e.Njj(a)}),e.EFF(15),e.k0s()(),e.j41(16,"ion-item",11),e.bIt("click",function(){return e.eBV(s),e.Njj(t.ApplyRegLimit())}),e.j41(17,"ion-label"),e.EFF(18),e.k0s()(),e.DNE(19,L,5,2,"div",12),e.j41(20,"ion-item-divider")(21,"ion-label"),e.EFF(22),e.k0s()(),e.j41(23,"ion-item",8)(24,"ion-input",13),e.mxI("ngModelChange",function(a){return e.eBV(s),e.DH7(t.ArcadeListURL,a)||(t.ArcadeListURL=a),e.Njj(a)}),e.k0s(),e.j41(25,"ion-icon",14),e.bIt("click",function(){return e.eBV(s),e.Njj(t.SetArcadeURL())}),e.k0s()(),e.j41(26,"ion-item-divider")(27,"ion-label"),e.EFF(28),e.k0s()(),e.j41(29,"ion-item")(30,"ion-input",15),e.mxI("ngModelChange",function(a){return e.eBV(s),e.DH7(t.notification.uri,a)||(t.notification.uri=a),e.Njj(a)}),e.k0s()(),e.j41(31,"ion-item")(32,"ion-checkbox",10),e.mxI("ngModelChange",function(a){return e.eBV(s),e.DH7(t.notification.persistent,a)||(t.notification.persistent=a),e.Njj(a)}),e.EFF(33),e.k0s()(),e.j41(34,"textarea",16),e.mxI("ngModelChange",function(a){return e.eBV(s),e.DH7(t.notification.msg,a)||(t.notification.msg=a),e.Njj(a)}),e.k0s(),e.j41(35,"ion-item",17)(36,"ion-label",18),e.bIt("click",function(){return e.eBV(s),e.Njj(t.send_noti_to_server())}),e.EFF(37),e.k0s()(),e.j41(38,"ion-item-divider")(39,"ion-label"),e.EFF(40),e.k0s(),e.j41(41,"ion-icon",19),e.bIt("click",function(){return e.eBV(s),e.Njj(t.refresh_all_user())}),e.k0s(),e.j41(42,"table",20)(43,"tr")(44,"td",21),e.bIt("click",function(){return e.eBV(s),e.Njj(t.change_user_list_page(-1))}),e.nrm(45,"ion-icon",22),e.k0s(),e.j41(46,"td"),e.EFF(47),e.k0s(),e.j41(48,"td"),e.EFF(49,"/"),e.k0s(),e.j41(50,"td"),e.EFF(51),e.k0s(),e.j41(52,"td",21),e.bIt("click",function(){return e.eBV(s),e.Njj(t.change_user_list_page(1))}),e.nrm(53,"ion-icon",23),e.k0s()()()(),e.DNE(54,O,6,1,"div",24),e.j41(55,"ion-accordion-group",null,0),e.DNE(57,U,30,13,"div",25),e.k0s(),e.j41(58,"ion-item-divider")(59,"ion-label"),e.EFF(60),e.k0s(),e.j41(61,"ion-icon",19),e.bIt("click",function(){return e.eBV(s),e.Njj(t.refresh_all_groups())}),e.k0s(),e.j41(62,"table",20)(63,"tr")(64,"td",21),e.bIt("click",function(){return e.eBV(s),e.Njj(t.change_group_list_page(-1))}),e.nrm(65,"ion-icon",22),e.k0s(),e.j41(66,"td"),e.EFF(67),e.k0s(),e.j41(68,"td"),e.EFF(69,"/"),e.k0s(),e.j41(70,"td"),e.EFF(71),e.k0s(),e.j41(72,"td",21),e.bIt("click",function(){return e.eBV(s),e.Njj(t.change_group_list_page(1))}),e.nrm(73,"ion-icon",23),e.k0s()()()(),e.DNE(74,M,6,1,"div",24),e.j41(75,"ion-accordion-group",null,1),e.DNE(77,V,40,17,"div",25),e.k0s()()}2&i&&(e.R7$(3),e.JRh(t.lang.text.Settings.ServerAdmin),e.R7$(4),e.Y8G("ngIf",t.servers.length),e.R7$(3),e.JRh(t.lang.text.AdminTools.RegLimit),e.R7$(),e.Aen(0==t.RegCountLimit?"--background: var(--toast-background-color)":""),e.R7$(),e.Y8G("label",t.lang.text.AdminTools.CountLimit),e.R50("ngModel",t.RegCountLimit),e.R7$(2),e.R50("ngModel",t.RegWithApproval),e.R7$(),e.JRh(t.lang.text.AdminTools.useApproval),e.R7$(),e.Y8G("disabled",t.RegLimitApplying),e.R7$(2),e.JRh(t.lang.text.voidDraw.apply),e.R7$(),e.Y8G("ngIf",t.WaitingApproval.length),e.R7$(3),e.JRh(t.lang.text.AdminTools.ArcadeSet),e.R7$(2),e.Y8G("label",t.lang.text.AdminTools.ArcadeListURL)("placeholder",t.lang.text.AdminTools.ArcadeURLPlaceholder),e.R50("ngModel",t.ArcadeListURL),e.R7$(4),e.JRh(t.lang.text.AdminTools.GlobalNoti),e.R7$(2),e.Y8G("label",t.lang.text.AdminTools.ImageURL),e.R50("ngModel",t.notification.uri),e.Y8G("placeholder",t.lang.text.AdminTools.EnterURI),e.R7$(2),e.R50("ngModel",t.notification.persistent),e.R7$(),e.JRh(t.lang.text.AdminTools.isPersistent),e.R7$(),e.R50("ngModel",t.notification.msg),e.Y8G("placeholder",t.lang.text.AdminTools.NoNotiMsg),e.R7$(),e.Y8G("disabled",t.is_sending||!t.notification.msg&&!t.notification.uri),e.R7$(2),e.JRh(t.lang.text.AdminTools.Send),e.R7$(3),e.JRh(t.lang.text.AdminTools.UserList+" ("+t.CurrentOnlineUser+"/"+t.AllUserCount+")"),e.R7$(7),e.JRh(t.current_user_page),e.R7$(4),e.JRh(t.all_user_page),e.R7$(3),e.Y8G("ngIf",0==t.CurrentOnlineUser),e.R7$(3),e.Y8G("ngForOf",t.current_user_size),e.R7$(3),e.JRh(t.lang.text.AdminTools.GroupList+" ("+t.AllGroupCount+")"),e.R7$(7),e.JRh(t.current_group_page),e.R7$(4),e.JRh(t.all_group_page),e.R7$(3),e.Y8G("ngIf",0==t.AllGroupCount),e.R7$(3),e.Y8G("ngForOf",t.current_group_size))},dependencies:[v.Sq,v.bT,f.me,f.BC,f.vS,c.xk,c.YH,c.Jm,c.QW,c.eY,c.W9,c.eU,c.iq,c.$w,c.uz,c.Dg,c.he,c.BC,c.ai,c.hB,c.su,c.Gw,c.el,c.T6],styles:[".icon_style[_ngcontent-%COMP%]{width:22px;height:22px;transform:translateY(2px);margin-left:4px;margin-right:4px}.refresh_icon[_ngcontent-%COMP%]{margin-left:8px}ion-input[_ngcontent-%COMP%]{--highlight-color-valid: var(--ion-color-primary)}"]}),_})()}];let D=(()=>{var r;class _{}return(r=_).\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[R.iI.forChild(X),R.iI]}),_})(),Y=(()=>{var r;class _{}return(r=_).\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[v.MD,f.YN,c.bv,D]}),_})()}}]);