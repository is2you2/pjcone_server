"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7601],{7601:(B,m,u)=>{u.r(m),u.d(m,{AddGroupPageModule:()=>D});var _=u(177),h=u(4341),l=u(5374),f=u(9858),c=u(467),I=u(8326),v=u(92),e=u(3953),G=u(9900),x=u(4237),k=u(8065),A=u(4234),C=u(482),b=u(755),R=u(3656);const j=["AddGroupPublic"];function F(r,d){if(1&r){const i=e.RV6();e.j41(0,"ion-item",24),e.bIt("click",function(){const n=e.eBV(i).index,a=e.XpG(2);return e.Njj(a.select_server(n))}),e.j41(1,"ion-label"),e.EFF(2),e.k0s()()}if(2&r){const i=d.$implicit;e.R7$(2),e.JRh(i.name)}}function y(r,d){if(1&r){const i=e.RV6();e.j41(0,"ion-accordion-group",16,0),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.isExpanded=!0)}),e.j41(2,"ion-accordion",17)(3,"ion-item",18)(4,"ion-label",19),e.EFF(5),e.k0s(),e.j41(6,"ion-label",20),e.EFF(7),e.k0s(),e.nrm(8,"ion-icon",21),e.k0s(),e.j41(9,"div",22),e.DNE(10,F,3,1,"ion-item",23),e.k0s()()()}if(2&r){const i=e.XpG();e.Y8G("disabled",i.isSaveClicked)("value",i.isExpanded),e.R7$(5),e.JRh(i.lang.text.AddGroup.SelectServer),e.R7$(2),e.JRh(i.servers[i.index].name),e.R7$(3),e.Y8G("ngForOf",i.servers)}}function P(r,d){if(1&r){const i=e.RV6();e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-item",24),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.CheckIfCopiedChannelID())}),e.j41(5,"ion-input",25),e.mxI("ngModelChange",function(n){e.eBV(i);const a=e.XpG();return e.DH7(a.userInput.id,n)||(a.userInput.id=n),e.Njj(n)}),e.k0s()()()}if(2&r){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.AddGroup.JoinGroupWithId),e.R7$(2),e.Y8G("label",i.lang.text.AddGroup.InputGroupId),e.R50("ngModel",i.userInput.id)}}function T(r,d){1&r&&(e.j41(0,"div",27),e.EFF(1,"Enter"),e.k0s())}function M(r,d){if(1&r){const i=e.RV6();e.j41(0,"div"),e.DNE(1,T,2,0,"div",13),e.j41(2,"ion-item",14),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.FocusOnChannelTitle())}),e.j41(3,"ion-checkbox",26),e.mxI("ngModelChange",function(n){e.eBV(i);const a=e.XpG();return e.DH7(a.userInput.volatile,n)||(a.userInput.volatile=n),e.Njj(n)}),e.EFF(4),e.k0s()()()}if(2&r){const i=e.XpG();e.R7$(),e.Y8G("ngIf",i.global.ShowHint),e.R7$(),e.Y8G("disabled",i.isSaveClicked),e.R7$(),e.R50("ngModel",i.userInput.volatile),e.R7$(),e.JRh(i.lang.text.AddGroup.Volatile)}}function S(r,d){1&r&&(e.j41(0,"div",27),e.EFF(1,"Enter"),e.k0s())}function E(r,d){if(1&r){const i=e.RV6();e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"div",28),e.DNE(5,S,2,0,"div",13),e.j41(6,"textarea",29),e.mxI("ngModelChange",function(n){e.eBV(i);const a=e.XpG();return e.DH7(a.userInput.description,n)||(a.userInput.description=n),e.Njj(n)}),e.k0s()(),e.j41(7,"ion-item",30)(8,"ion-input",31),e.mxI("ngModelChange",function(n){e.eBV(i);const a=e.XpG();return e.DH7(a.userInput.max_count,n)||(a.userInput.max_count=n),e.Njj(n)}),e.k0s()(),e.j41(9,"ion-item",7,1)(11,"ion-toggle",32),e.mxI("ngModelChange",function(n){e.eBV(i);const a=e.XpG();return e.DH7(a.userInput.open,n)||(a.userInput.open=n),e.Njj(n)}),e.bIt("ionChange",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.isPublicToggle())}),e.EFF(12),e.k0s()()()}if(2&r){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.AddGroup.GroupDetail),e.R7$(2),e.Y8G("ngIf",i.global.ShowHint&&i.CheckIfTitleFocus),e.R7$(),e.Y8G("disabled",i.isSaveClicked||""!=i.userInput.id),e.R50("ngModel",i.userInput.description),e.Y8G("placeholder",i.lang.text.AddGroup.GroupDetail_placeholder),e.R7$(),e.Y8G("disabled",i.isSaveClicked||""!=i.userInput.id),e.R7$(),e.Y8G("label",i.lang.text.AddGroup.MemberMaxLimit),e.R50("ngModel",i.userInput.max_count),e.R7$(),e.Y8G("disabled",i.isSaveClicked||""!=i.userInput.id),e.R7$(2),e.R50("ngModel",i.userInput.open),e.R7$(),e.SpI(" ",i.lang.text.AddGroup.IsOpen,"")}}function N(r,d){1&r&&(e.j41(0,"div",27),e.EFF(1,"Ctrl + Enter"),e.k0s())}const $=[{path:"",component:(()=>{var r;class d{constructor(t,n,a,s,o,p,g){this.p5toast=t,this.nakama=n,this.statusBar=a,this.lang=s,this.global=o,this.indexed=p,this.navCtrl=g,this.IsFocusOnThisPage=!0,this.CheckIfTitleFocus=!1,this.userInput={server:void 0,id:"",volatile:!1,name:void 0,description:void 0,max_count:void 0,lang_tag:void 0,open:!0,creator_id:void 0,img:void 0},this.servers=[],this.index=0,this.isExpanded=!0,this.isSaveClicked=!1,this.file_sel_id=""}ngOnInit(){let t=JSON.parse(localStorage.getItem("add-group"));t&&(this.userInput=t),this.LoadListServer(),this.servers.length>1&&(this.index=1),this.userInput.server=this.servers[this.index],this.file_sel_id=`add_group_${(new Date).getTime()}`,this.nakama.StatusBarChangedCallback=()=>{this.LoadListServer(),this.index=0}}CheckIfCopiedChannelID(){var t=this;return(0,c.A)(function*(){let n;try{let o=yield t.global.GetValueFromClipboard();"text/plain"===o.type&&(n=o.value)}catch{return}/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(n)?(t.userInput.id=n,t.JoinWithSpecificId()):t.p5toast.show({text:`${t.lang.text.AddGroup.DiffFormat}: ${n}`})})()}LoadListServer(){this.servers=this.nakama.get_all_server_info(!0,!0),this.servers.unshift({name:this.lang.text.AddGroup.UseLocalStorage,isOfficial:"local",target:"target",local:!0})}ionViewWillEnter(){this.IsFocusOnThisPage=!0,this.ChangeContentWithKeyInput(),this.global.p5KeyShortCut.Escape=()=>{this.navCtrl.pop()}}ChangeContentWithKeyInput(){var t=this;let n=document.getElementById("group_name");this.GroupNameInput=n.childNodes[1].childNodes[1].childNodes[1],this.GroupNameInput.onfocus||(this.GroupNameInput.onfocus=()=>{this.CheckIfTitleFocus=!0}),this.GroupNameInput.onblur||(this.GroupNameInput.onblur=()=>{this.CheckIfTitleFocus=!1}),setTimeout(()=>{"DesktopPWA"==v.aH&&this.GroupNameInput.focus()},200),this.p5canvas=new I(a=>{a.keyPressed=function(){var s=(0,c.A)(function*(o){t.IsFocusOnThisPage&&"Enter"===o.key&&(document.activeElement==t.GroupNameInput&&setTimeout(()=>{try{document.getElementById("group_desc").focus()}catch{}},0),!o.ctrlKey&&t.servers[t.index].local&&(t.userInput.volatile=!t.userInput.volatile),o.ctrlKey&&t.save())});return function(o){return s.apply(this,arguments)}}()})}select_server(t){this.index=t,this.userInput.server=this.servers[t],this.servers[t].local&&(this.userInput.id=""),this.isExpanded=!1,this.FocusOnChannelTitle()}FocusOnChannelTitle(){"DesktopPWA"==v.aH&&this.GroupNameInput&&(this.GroupNameInput.value||this.GroupNameInput.focus())}check_if_clipboard_available(t){var n=this;return(0,c.A)(function*(){try{if(0!=t.indexOf("http"))throw"URL \uc8fc\uc18c\uac00 \uc544\ub2d8";yield new Promise((a,s)=>{let o=document.createElement("img");o.src=t,o.onload=()=>{n.userInput.img=t,o.onload=null,o.onerror=null,a(void 0)},o.onerror=()=>{o.onload=null,o.onerror=null,o.remove(),s()}})}catch{try{if(0!=t.indexOf("data:image"))throw"DataURL \uc8fc\uc18c\uac00 \uc544\ub2d8";n.nakama.limit_image_size(t,s=>n.userInput.img=s.canvas.toDataURL())}catch{throw"\uc0ac\uc6a9\ubd88\uac00 \uc774\ubbf8\uc9c0"}}})()}isPublicToggle(){this.userInput.open=this.GroupIsPublic.checked}save(){var t=this;return(0,c.A)(function*(){if(t.isSaveClicked)return;if(t.isSaveClicked=!0,t.servers[t.index].local)return void t.SaveLocalAct();if(t.userInput.id)return void(yield t.JoinWithSpecificId());if("online"!=t.statusBar.groupServer[t.servers[t.index].isOfficial][t.servers[t.index].target])return void t.p5toast.show({text:t.lang.text.AddGroup.cannot_use_selected_server});let n=t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].client,a=t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].session;t.userInput.owner=a.user_id,t.userInput.status="online",t.userInput.lang_tag=t.userInput.lang_tag||navigator.language.split("-")[0]||t.lang.lang,t.userInput.max_count=t.userInput.max_count||1;try{let s=yield n.createGroup(a,{name:t.userInput.name,lang_tag:t.userInput.lang_tag,description:t.userInput.description,max_count:t.userInput.max_count,open:t.userInput.open});t.userInput.id=s.id,t.userInput.creator_id=t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].session.user_id,t.nakama.save_group_info(t.userInput,t.servers[t.index].isOfficial,t.servers[t.index].target);try{yield t.nakama.join_chat_with_modulation(s.id,3,t.servers[t.index].isOfficial,t.servers[t.index].target),t.nakama.rearrange_channels(),t.p5toast.show({text:t.lang.text.AddGroup.group_created})}catch(g){console.error(g)}let o=yield t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].client.getAccount(t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].session),p=JSON.parse(o.user.metadata);p.is_manager?p.is_manager.push(s.id):p.is_manager=[s.id];try{yield t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].client.rpc(t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].session,"update_user_metadata_fn",{user_id:t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target].session.user_id,metadata:p})}catch(g){console.log("\uadf8\ub8f9 \uc0dd\uc131\uc790\ub97c \ub9e4\ub2c8\uc800\ub85c \uc2b9\uaca9 \uc624\ub958: ",g)}setTimeout(()=>{t.navCtrl.pop()},500)}catch(s){switch(console.error("\uadf8\ub8f9 \uc0dd\uc131 \uc2e4\ud328: ",s),s.status){case 400:setTimeout(()=>{t.p5toast.show({text:t.lang.text.AddGroup.NeedSetGroupName}),t.isSaveClicked=!1},500);break;case 409:setTimeout(()=>{t.p5toast.show({text:t.lang.text.AddGroup.AlreadyExist}),t.isSaveClicked=!1},500);break;default:setTimeout(()=>{t.p5toast.show({text:`${t.lang.text.AddGroup.UnexpectedErr}: ${s}`}),t.isSaveClicked=!1},500)}}})()}SaveLocalAct(){this.nakama.channels_orig.local||(this.nakama.channels_orig.local={}),this.nakama.channels_orig.local.target||(this.nakama.channels_orig.local.target={});let t=this.CreateRandomLocalId();this.nakama.channels_orig.local.target[t]={id:t,local:!0,title:this.userInput.name,redirect:{type:0},volatile:this.userInput.volatile,status:"certified",info:{...this.userInput,status:"certified"}},this.userInput.img&&this.indexed.saveTextFileToUserPath(this.userInput.img,`servers/local/target/groups/${t}.img`),this.nakama.rearrange_channels(),setTimeout(()=>{this.navCtrl.pop()},500)}CreateRandomLocalId(){let t="";for(let a=0,s=16;a<s;a++){let o=Math.floor(62*Math.random());t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(o)}return this.userInput.volatile&&(t="tmp_files_"+t),this.nakama.channels_orig.local.target[t]?this.CreateRandomLocalId():t}JoinWithSpecificId(){var t=this;return(0,c.A)(function*(){let n=!1,a=t.nakama.servers[t.servers[t.index].isOfficial][t.servers[t.index].target];try{yield a.client.joinGroup(a.session,t.userInput.id),t.nakama.get_group_list_from_server(t.servers[t.index].isOfficial,t.servers[t.index].target,t.userInput.id),n=!0}catch{try{yield t.nakama.join_chat_with_modulation(t.userInput.id,2,t.servers[t.index].isOfficial,t.servers[t.index].target),t.nakama.rearrange_channels(),n=!0}catch{t.p5toast.show({text:t.lang.text.AddGroup.check_group_id}),t.isSaveClicked=!1,setTimeout(()=>{t.userInput.id=""},1e3)}}n&&(t.p5toast.show({text:t.lang.text.AddGroup.join_group_succ}),setTimeout(()=>{t.nakama.rearrange_channels(),t.navCtrl.pop()},500))})()}ionViewWillLeave(){this.IsFocusOnThisPage=!1,this.GroupNameInput.onfocus=null,this.GroupNameInput.onblur=null,delete this.global.p5KeyShortCut.Escape}ngOnDestroy(){this.p5canvas&&this.p5canvas.remove(),delete this.nakama.StatusBarChangedCallback}buttonClickLinkInputFile(){var t=this;return(0,c.A)(function*(){t.userInput.img?t.userInput.img=void 0:document.getElementById(t.file_sel_id).click()})()}AddChannelImageContextMenu(){var t=this;return function(){var a=(0,c.A)(function*(){let s=yield t.global.GetValueFromClipboard();switch(s.type){case"text/plain":yield t.check_if_clipboard_available(s.value);break;case"image/png":return void t.inputImageSelected({target:{files:[s.value]}})}});return function(){return a.apply(this,arguments)}}()(),!1}inputImageSelected(t){var n=this;return(0,c.A)(function*(){let a=yield n.global.GetBase64ThroughFileReader(t.target.files[0]);n.nakama.limit_image_size(a,o=>n.userInput.img=o.canvas.toDataURL()),document.getElementById(n.file_sel_id).value=""})()}}return(r=d).\u0275fac=function(t){return new(t||r)(e.rXU(G.G),e.rXU(x.X),e.rXU(k.j),e.rXU(A.y),e.rXU(C.z3),e.rXU(b.n),e.rXU(R.q9))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-add-group"]],viewQuery:function(t,n){if(1&t&&e.GBs(j,5),2&t){let a;e.mGM(a=e.lsd())&&(n.GroupIsPublic=a.first)}},decls:30,vars:18,consts:[["accordionGroup",""],["AddGroupPublic",""],[1,"ion-no-border"],["slot","start"],["defaultHref","portal/subscribes"],["value","colors","expand","inset",3,"disabled","value","click",4,"ngIf"],[4,"ngIf"],["button","",3,"disabled"],["id","group_name",1,"ion-text-right",3,"ngModelChange","label","ngModel","placeholder"],["button","",3,"click","contextmenu","disabled"],[1,"additional_form","bg_img_form"],[1,"profile_img",2,"filter","grayscale(0) contrast(1)",3,"src"],["hidden","","type","file","accept","image/*",3,"change","id"],["class","shortcut_hint",4,"ngIf"],["button","",3,"click","disabled"],[1,"ion-text-center"],["value","colors","expand","inset",3,"click","disabled","value"],["value","colors"],["slot","header"],[2,"display","contents"],[1,"ion-text-right"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],["disabled","","placeholder","00000000-0000-0000-0000-000000000000",1,"ion-text-right",2,"pointer-events","none",3,"ngModelChange","label","ngModel"],[3,"ngModelChange","ngModel"],[1,"shortcut_hint"],[2,"position","relative"],["id","group_desc",1,"infobox",3,"ngModelChange","disabled","ngModel","placeholder"],[3,"disabled"],["type","number","min","1","placeholder","1",1,"ion-text-right",3,"ngModelChange","label","ngModel"],[2,"pointer-events","none",3,"ngModelChange","ionChange","ngModel"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",3),e.nrm(5,"ion-back-button",4),e.k0s()()(),e.j41(6,"ion-content"),e.DNE(7,y,11,5,"ion-accordion-group",5)(8,P,6,3,"div",6),e.j41(9,"ion-item-divider")(10,"ion-label"),e.EFF(11),e.k0s()(),e.j41(12,"ion-item",7)(13,"ion-input",8),e.mxI("ngModelChange",function(s){return e.DH7(n.userInput.name,s)||(n.userInput.name=s),s}),e.k0s()(),e.j41(14,"ion-item",9),e.bIt("click",function(){return n.buttonClickLinkInputFile()})("contextmenu",function(){return n.AddChannelImageContextMenu()}),e.j41(15,"div",10),e.nrm(16,"img",11),e.k0s(),e.j41(17,"ion-label")(18,"p"),e.EFF(19),e.k0s(),e.j41(20,"h2"),e.EFF(21),e.k0s()()(),e.j41(22,"input",12),e.bIt("change",function(s){return n.inputImageSelected(s)}),e.k0s(),e.DNE(23,M,5,4,"div",6)(24,E,13,11,"div",6),e.j41(25,"div"),e.DNE(26,N,2,0,"div",13),e.j41(27,"ion-item",14),e.bIt("click",function(){return n.save()}),e.j41(28,"ion-label",15),e.EFF(29),e.k0s()()()()),2&t&&(e.R7$(3),e.JRh(n.lang.text.AddGroup.Title),e.R7$(4),e.Y8G("ngIf",n.servers.length),e.R7$(),e.Y8G("ngIf",!n.userInput.server.local),e.R7$(3),e.JRh(n.lang.text.AddGroup.GroupInfo),e.R7$(),e.Y8G("disabled",n.isSaveClicked||""!=n.userInput.id),e.R7$(),e.Y8G("label",n.lang.text.AddGroup.DisplayName),e.R50("ngModel",n.userInput.name),e.Y8G("placeholder",n.lang.text.AddGroup.DisplayName_placeholder),e.R7$(),e.Y8G("disabled",n.isSaveClicked||""!=n.userInput.id),e.R7$(2),e.Y8G("src",n.userInput.img,e.B4B),e.R7$(3),e.SpI("",(n.userInput.name||n.lang.text.AddGroup.DisplayName_placeholder)+" ("+(n.userInput.server.name||n.userInput.server.target)+")"," "),e.R7$(2),e.JRh(n.lang.text.AddGroup.ClicktoChangeGroupImg),e.R7$(),e.Y8G("id",n.file_sel_id),e.R7$(),e.Y8G("ngIf",n.userInput.server.local),e.R7$(),e.Y8G("ngIf",!n.userInput.server.local),e.R7$(2),e.Y8G("ngIf",n.global.ShowHint),e.R7$(),e.Y8G("disabled",n.isSaveClicked),e.R7$(2),e.JRh(n.lang.text.AddGroup.submit))},dependencies:[_.Sq,_.bT,h.me,h.BC,h.vS,l.xk,l.YH,l.QW,l.eY,l.W9,l.eU,l.iq,l.$w,l.uz,l.Dg,l.he,l.BC,l.BY,l.ai,l.hB,l.su,l.Gw,l.el,l.T6]}),d})()}];let O=(()=>{var r;class d{}return(r=d).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[f.iI.forChild($),f.iI]}),d})(),D=(()=>{var r;class d{}return(r=d).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[_.MD,h.YN,l.bv,O]}),d})()}}]);