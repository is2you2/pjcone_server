"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2635],{2635:(Y,v,a)=>{a.r(v),a.d(v,{NotiAlertPageModule:()=>J});var u=a(177),_=a(4341),g=a(5374),b=a(9858),m=a(467),t=a(3953),P=a(5547),k=a(4234),R=a(7100),j=a(755),A=a(9900),F=a(4237);function T(n,l){1&n&&(t.j41(0,"div",14),t.EFF(1,"1"),t.k0s())}function M(n,l){1&n&&(t.j41(0,"div",14),t.EFF(1,"2"),t.k0s())}function C(n,l){1&n&&(t.j41(0,"div",14),t.EFF(1,"3"),t.k0s())}function S(n,l){1&n&&(t.j41(0,"div",14),t.EFF(1,"4"),t.k0s())}function $(n,l){1&n&&(t.j41(0,"div",14),t.EFF(1,"5"),t.k0s())}function w(n,l){1&n&&(t.j41(0,"div",14),t.EFF(1,"6"),t.k0s())}function E(n,l){1&n&&(t.j41(0,"div",14),t.EFF(1,"7"),t.k0s())}function I(n,l){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.k0s()),2&n){const r=t.XpG().$implicit;t.R7$(),t.JRh(r.index)}}function D(n,l){if(1&n){const r=t.RV6();t.j41(0,"div"),t.DNE(1,I,2,1,"div",3),t.j41(2,"ion-item",16),t.bIt("ionChange",function(){const e=t.eBV(r).$implicit,i=t.XpG(2);return t.Njj(i.GetPushPubKey(e.isOfficial,e.target))}),t.j41(3,"ion-toggle",17),t.mxI("ngModelChange",function(e){const i=t.eBV(r).$implicit,o=t.XpG(2);return t.DH7(o.nakama.servers[i.isOfficial][i.target].info.webpush_tog,e)||(o.nakama.servers[i.isOfficial][i.target].info.webpush_tog=e),t.Njj(e)}),t.EFF(4),t.k0s()()()}if(2&n){const r=l.$implicit,s=t.XpG(2);t.R7$(),t.Y8G("ngIf",s.global.ShowHint&&r.index),t.R7$(2),t.R50("ngModel",s.nakama.servers[r.isOfficial][r.target].info.webpush_tog),t.R7$(),t.JRh(r.name)}}function G(n,l){if(1&n&&(t.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),t.EFF(3),t.k0s()(),t.DNE(4,D,5,3,"div",15),t.k0s()),2&n){const r=t.XpG();t.R7$(3),t.JRh(r.lang.text.NotificationSettings.set_webpush),t.R7$(),t.Y8G("ngForOf",r.servers)}}const H=[{path:"",component:(()=>{var n;class l{constructor(s,e,i,o,d,h,N){this.noti=s,this.lang=e,this.global=i,this.indexed=o,this.loadingCtrl=d,this.p5toast=h,this.nakama=N,this.servers=[]}ngOnInit(){}ionViewWillEnter(){this.servers=this.nakama.get_all_server_info(!0,!0)}ionViewDidEnter(){const s=["icon_mono","diychat","todo","simplechat","voidDraw","arcade"];this.global.p5KeyShortCut.Digit=e=>{s.length>e?this.toggle_silent_set(s[e]):6===e&&this.toggle_simplify()}}toggle_silent_set(s){this.noti.change_silent_settings(s)}toggle_simplify(){this.noti.settings.simplify=!this.noti.settings.simplify,this.indexed.saveTextFileToUserPath(JSON.stringify(this.noti.settings),"notification_settings.json")}ionViewWillLeave(){delete this.global.p5KeyShortCut.Digit}GetPushPubKey(s,e){var i=this;return(0,m.A)(function*(){let o=yield i.loadingCtrl.create({message:`${i.lang.text.GroupServer.WebpushPubkey}: ${i.nakama.servers[s][e].info.name}`});o.present();const p=`${i.nakama.servers[s][e].info.useSSL?"https":"http"}://${i.nakama.servers[s][e].info.address}:${i.nakama.servers[s][e].info.webpush_port||5e3}`;try{if(i.nakama.servers[s][e].info.webpush_tog){const c=yield fetch(`${p}/get_webpush_key`,{method:"POST"});let y;if(!c.ok)throw`${c.statusText} (${c.status})`;y=(yield c.json()).pubkey;const X=yield i.subscribeToPush(y),U={uuid:i.nakama.servers[i.nakama.servers[s][e].info.isOfficial][i.nakama.servers[s][e].info.target].session.user_id,subscription:X},f=yield fetch(`${p}/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)});if(!f.ok)throw`${f.statusText} (${f.status})`}else yield i.unsubscribeFromPush(p)}catch(c){console.log("error_GetPushPubKey: ",c),i.p5toast.show({text:`${i.lang.text.GroupServer.WebpushPubkey}: ${c}`}),i.nakama.servers[s][e].info.webpush_tog=!i.nakama.servers[s][e].info.webpush_tog}yield i.nakama.modify_group_server(i.nakama.servers[s][e].info),o.dismiss()})()}subscribeToPush(s){var e=this;return(0,m.A)(function*(){return yield(yield navigator.serviceWorker.register(`${window.sub_path}assets/sw.js`)).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e.urlBase64ToUint8Array(s)})})()}unsubscribeFromPush(s){return(0,m.A)(function*(){const e=yield navigator.serviceWorker.getRegistration(`${window.sub_path}assets/sw.js`);if(!e)return;const i=yield e.pushManager.getSubscription();i?(yield i.unsubscribe())?yield fetch(`${s}/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:i.endpoint})}):console.warn("\uad6c\ub3c5 \ucde8\uc18c \uc2e4\ud328"):console.log("\ud604\uc7ac \ud478\uc2dc \uad6c\ub3c5 \uc5c6\uc74c")})()}urlBase64ToUint8Array(s){const i=(s+"=".repeat((4-s.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),o=atob(i);return new Uint8Array([...o].map(d=>d.charCodeAt(0)))}}return(n=l).\u0275fac=function(s){return new(s||n)(t.rXU(P.r),t.rXU(k.y),t.rXU(R.z3),t.rXU(j.n),t.rXU(g.Xi),t.rXU(A.G),t.rXU(F.X))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-noti-alert"]],decls:56,vars:25,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/settings"],["class","shortcut_hint",4,"ngIf"],["button","",3,"click"],["src","assets/icon/favicon.png","alt","",1,"img_icon_size"],[1,"ignore_toggles",3,"ngModelChange","ngModel"],["src","assets/icon/diychat.png","alt","",1,"img_icon_size"],["src","assets/icon/todo.png","alt","",1,"img_icon_size"],["src","assets/icon/simplechat.png","alt","",1,"img_icon_size"],["src","assets/icon/voidDraw.png","alt","",1,"img_icon_size"],["name","game-controller-outline",1,"icon_margin"],["name","notifications-circle-outline",1,"icon_margin"],[4,"ngIf"],[1,"shortcut_hint"],[4,"ngFor","ngForOf"],["button","",3,"ionChange"],[1,"ignore_toggles",2,"pointer-events","none",3,"ngModelChange","ngModel"]],template:function(s,e){1&s&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",1),t.nrm(5,"ion-back-button",2),t.k0s()()(),t.j41(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),t.EFF(9),t.k0s()(),t.j41(10,"div"),t.DNE(11,T,2,0,"div",3),t.j41(12,"ion-item",4),t.bIt("click",function(){return e.toggle_silent_set("icon_mono")}),t.nrm(13,"img",5),t.j41(14,"ion-toggle",6),t.mxI("ngModelChange",function(o){return t.DH7(e.noti.settings.silent.icon_mono,o)||(e.noti.settings.silent.icon_mono=o),o}),t.EFF(15),t.k0s()()(),t.j41(16,"div"),t.DNE(17,M,2,0,"div",3),t.j41(18,"ion-item",4),t.bIt("click",function(){return e.toggle_silent_set("diychat")}),t.nrm(19,"img",7),t.j41(20,"ion-toggle",6),t.mxI("ngModelChange",function(o){return t.DH7(e.noti.settings.silent.diychat,o)||(e.noti.settings.silent.diychat=o),o}),t.EFF(21),t.k0s()()(),t.j41(22,"div"),t.DNE(23,C,2,0,"div",3),t.j41(24,"ion-item",4),t.bIt("click",function(){return e.toggle_silent_set("todo")}),t.nrm(25,"img",8),t.j41(26,"ion-toggle",6),t.mxI("ngModelChange",function(o){return t.DH7(e.noti.settings.silent.todo,o)||(e.noti.settings.silent.todo=o),o}),t.EFF(27),t.k0s()()(),t.j41(28,"div"),t.DNE(29,S,2,0,"div",3),t.j41(30,"ion-item",4),t.bIt("click",function(){return e.toggle_silent_set("simplechat")}),t.nrm(31,"img",9),t.j41(32,"ion-toggle",6),t.mxI("ngModelChange",function(o){return t.DH7(e.noti.settings.silent.simplechat,o)||(e.noti.settings.silent.simplechat=o),o}),t.EFF(33),t.k0s()()(),t.j41(34,"div"),t.DNE(35,$,2,0,"div",3),t.j41(36,"ion-item",4),t.bIt("click",function(){return e.toggle_simplify()}),t.nrm(37,"img",10),t.j41(38,"ion-toggle",6),t.mxI("ngModelChange",function(o){return t.DH7(e.noti.settings.silent.voidDraw,o)||(e.noti.settings.silent.voidDraw=o),o}),t.EFF(39),t.k0s()()(),t.j41(40,"div"),t.DNE(41,w,2,0,"div",3),t.j41(42,"ion-item",4),t.bIt("click",function(){return e.toggle_simplify()}),t.nrm(43,"ion-icon",11),t.j41(44,"ion-toggle",6),t.mxI("ngModelChange",function(o){return t.DH7(e.noti.settings.silent.arcade,o)||(e.noti.settings.silent.arcade=o),o}),t.EFF(45),t.k0s()()(),t.j41(46,"ion-item-divider")(47,"ion-label"),t.EFF(48),t.k0s()(),t.j41(49,"div"),t.DNE(50,E,2,0,"div",3),t.j41(51,"ion-item",4),t.bIt("click",function(){return e.toggle_simplify()}),t.nrm(52,"ion-icon",12),t.j41(53,"ion-toggle",6),t.mxI("ngModelChange",function(o){return t.DH7(e.noti.settings.simplify,o)||(e.noti.settings.simplify=o),o}),t.EFF(54),t.k0s()()(),t.DNE(55,G,5,2,"div",13),t.k0s()),2&s&&(t.R7$(3),t.JRh(e.lang.text.Settings.NotificationSetting),t.R7$(6),t.JRh(e.lang.text.NotificationSettings.set_alert),t.R7$(2),t.Y8G("ngIf",e.global.ShowHint),t.R7$(3),t.R50("ngModel",e.noti.settings.silent.icon_mono),t.R7$(),t.SpI(" ",e.lang.text.NotificationSettings.icon_mono," "),t.R7$(2),t.Y8G("ngIf",e.global.ShowHint),t.R7$(3),t.R50("ngModel",e.noti.settings.silent.diychat),t.R7$(),t.JRh(e.lang.text.NotificationSettings.diychat),t.R7$(2),t.Y8G("ngIf",e.global.ShowHint),t.R7$(3),t.R50("ngModel",e.noti.settings.silent.todo),t.R7$(),t.JRh(e.lang.text.Main.Title),t.R7$(2),t.Y8G("ngIf",e.global.ShowHint),t.R7$(3),t.R50("ngModel",e.noti.settings.silent.simplechat),t.R7$(),t.JRh(e.lang.text.NotificationSettings.simplechat),t.R7$(2),t.Y8G("ngIf",e.global.ShowHint),t.R7$(3),t.R50("ngModel",e.noti.settings.silent.voidDraw),t.R7$(),t.JRh(e.lang.text.ChatRoom.voidDraw),t.R7$(2),t.Y8G("ngIf",e.global.ShowHint),t.R7$(3),t.R50("ngModel",e.noti.settings.silent.arcade),t.R7$(),t.JRh(e.lang.text.Arcade.Title),t.R7$(3),t.JRh(e.lang.text.NotificationSettings.set_alert_simple),t.R7$(2),t.Y8G("ngIf",e.global.ShowHint),t.R7$(3),t.R50("ngModel",e.noti.settings.simplify),t.R7$(),t.JRh(e.lang.text.NotificationSettings.set_alert_self),t.R7$(),t.Y8G("ngIf",e.servers.length))},dependencies:[u.Sq,u.bT,_.BC,_.vS,g.QW,g.W9,g.eU,g.iq,g.uz,g.Dg,g.he,g.BC,g.BY,g.ai,g.hB,g.el],styles:[".img_icon_size[_ngcontent-%COMP%]{width:21px;height:21px;margin-right:16px}.ignore_toggles[_ngcontent-%COMP%]{pointer-events:none}"]}),l})()}];let O=(()=>{var n;class l{}return(n=l).\u0275fac=function(s){return new(s||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[b.iI.forChild(H),b.iI]}),l})(),J=(()=>{var n;class l{}return(n=l).\u0275fac=function(s){return new(s||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[u.MD,_.YN,g.bv,O]}),l})()}}]);