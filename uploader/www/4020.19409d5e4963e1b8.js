"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4020],{4020:(Z,J,g)=>{g.d(J,{j:()=>z});var p=g(467),x=g(8326),j=g(5402),D=g(482),G=g(92),O=g(3953),V=g(9900),K=g(755),Q=g(4234),F=g(4237);!function Y(){("http:"!=window.location.protocol||0==window.location.host.indexOf("localhost"))&&g.e(925).then(g.t.bind(g,925,23))}();let z=(()=>{var w;class L{constructor(e,i,t,n,s){this.p5toast=e,this.indexed=i,this.lang=t,this.nakama=n,this.global=s,this.FocusedRemoteId=0,this.PeerGroups={},this.Peers={},this.OnUse=!1,this.StatusText="",this.initQueued=[],this.isInitQueued=!1,this.nakama.WebRTCService=this,this.global.WebRTCService=this}initialize(e,i,t){var n=this;return(0,p.A)(function*(){if(n.OnUse&&"data"!=e)throw n.p5toast.show({text:n.lang.text.WebRTCDevManager.AlreadyCalling}),n.lang.text.WebRTCDevManager.AlreadyCalling;if(n.initQueued.push({type:e,actId:i,groupId:t}),n.isInitQueued)for(;n.isInitQueued;)yield new Promise(s=>setTimeout(s,0));else{for(n.isInitQueued=!0;n.initQueued.length;){const s=n.initQueued.shift();yield n.initialize_queue(s.type,s.actId,s.groupId)}n.isInitQueued=!1}})()}initialize_queue(e,i,t){var n=this;return(0,p.A)(function*(){if("data"!=e&&("http:"==window.location.protocol&&0!=window.location.host.indexOf("localhost")||!(yield j.R.requestAudioRecordingPermission()).value))throw n.lang.text.WebRTCDevManager.SecurityError;if(n.Peers[i]||(n.Peers[i]={}),n.Peers[i].TypeIn=e,n.Peers[i].IceCandidates=[],n.Peers[i].ReceivedOfferPart="",n.Peers[i].ReceivedAnswerPart="",t&&(n.Peers[i].groupId=t,n.PeerGroups[t]||(n.PeerGroups[t]=[]),n.PeerGroups[t].push(i),n.FocusedRemoteId=n.PeerGroups[t].length-1),"data"!=e){n.createP5_panel(i,t);try{n.localMedia||(n.localMedia=document.createElement(e),n.localMedia.id="webrtc_video",n.localMedia.style.width="0px",n.localMedia.style.height="0px",n.localMedia.autoplay=!0,"video"==e&&(n.localMedia.playsInline=!0),n.localMedia.muted=!0,document.body.appendChild(n.localMedia)),n.Peers[i].remoteMedia=document.createElement(e),n.Peers[i].remoteMedia.id=i,n.Peers[i].remoteMedia.style.width="0px",n.Peers[i].remoteMedia.style.height="0px",n.Peers[i].remoteMedia.autoplay=!0,"video"==e&&(n.Peers[i].remoteMedia.playsInline=!0),document.body.appendChild(n.Peers[i].remoteMedia);const s=yield n.getMediaConst(e);if(!n.localStream){try{n.localStream=yield navigator.mediaDevices.getUserMedia(s)}catch{"DesktopPWA"==G.aH&&(n.localStream=yield navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}))}n.localMedia.srcObject=n.localStream}}catch(s){console.log("navigator.getUserMedia error: ",s),yield n.close_webrtc(i),n.p5toast.show({text:`${n.lang.text.WebRTCDevManager.InitErr}: ${s}`})}}yield n.createCall(i)})()}getMediaConst(e){var i=this;return(0,p.A)(function*(){var t,n;let o,r,s=yield i.getDeviceList(),u=Number(null!==(t=localStorage.getItem("VideoInputDev"))&&void 0!==t?t:NaN),P=Number(null!==(n=localStorage.getItem("AudioInputDev"))&&void 0!==n?n:NaN);for(let h=0,f=s.length,_=0,E=0;h<f&&(!o||!r);h++)!o&&"audioinput"==s[h].kind&&(Number.isNaN(P)?(o=s[h].deviceId,localStorage.setItem("AudioInputDev",`${E}`)):E==P&&(o=s[h].deviceId),E++),!r&&"videoinput"==s[h].kind&&(Number.isNaN(u)?(r=s[h].deviceId,localStorage.setItem("AudioInputDev",`${_}`)):_==u&&(r=s[h].deviceId),_++);let d={};return"video"==e?(d.video=!0,r&&(d.video={deviceId:r})):d.video=!1,d.audio=!0,o&&(d.audio={deviceId:o}),d})()}WEBRTC_INIT_REQ_SIGNAL(e,i,t,n,s=!1){var o=this;return(0,p.A)(function*(){try{o.Peers[i]||(yield o.initialize(t,i,n)),o.Peers[i].LocalOffer||(yield o.CreateOffer(i));const r=JSON.stringify(o.Peers[i].LocalOffer);o.Peers[i].LocalOfferPartArray=r.match(/(.{1,64})/g),s||o.WEBRTC_REPLY_INIT_SIGNAL_PART(e,i,t,n)}catch(r){console.warn("\ucd5c\ucd08 \uc5f0\uacb0\uc30d \uc9c1\ud6c4 \uad6c\uc131 \uc2e4\ud328: ",r)}})()}WEBRTC_REPLY_INIT_SIGNAL_PART(e,i,t,n){var s=this;return(0,p.A)(function*(){if(s.Peers[i].LocalOfferPartArray||(yield s.WEBRTC_INIT_REQ_SIGNAL(e,i,t,n,!0)),e.client&&e.client.readyState==e.client.OPEN){const o=s.Peers[i].LocalOfferPartArray.shift();e.client.send(o?JSON.stringify({type:"socket_react",channel:e.channel,act:"WEBRTC_REPLY_INIT_SIGNAL",data_str:o,send_to:i}):JSON.stringify({type:"socket_react",channel:e.channel,act:"WEBRTC_REPLY_INIT_SIGNAL",data_str:"EOL",send_to:i}))}})()}WEBRTC_RECEIVE_ANSWER_PART(e,i){if(e.client&&e.client.readyState==e.client.OPEN){const t=this.Peers[i].LocalAnswerPartArray.shift();t?e.client.send(JSON.stringify({type:"socket_react",channel:e.channel,act:"WEBRTC_RECEIVE_ANSWER",data_str:t,send_to:i})):(e.client.send(JSON.stringify({type:"socket_react",channel:e.channel,act:"WEBRTC_RECEIVE_ANSWER",data_str:"EOL",send_to:i})),this.Peers[i].JoinInited=!0)}}WEBRTC_REPLY_INIT_SIGNAL(e,i,t){"EOL"==e?(this.createRemoteOfferFromAnswer(JSON.parse(this.Peers[t].ReceivedOfferPart),t),delete this.Peers[t].ReceivedOfferPart,this.Peers[t].JoinInited=!0):(this.Peers[t].ReceivedOfferPart=(this.Peers[t].ReceivedOfferPart||"")+e,i.client&&i.client.readyState==i.client.OPEN&&i.client.send(JSON.stringify({type:"socket_react",channel:i.channel,act:"WEBRTC_REPLY_INIT_SIGNAL_PART",send_to:t})))}WEBRTC_RECEIVE_ANSWER(e,i,t){"EOL"==e?(this.ReceiveRemoteAnswer(JSON.parse(this.Peers[t].ReceivedAnswerPart),i,t),delete this.Peers[t].ReceivedAnswerPart):(this.Peers[t].ReceivedAnswerPart=(this.Peers[t].ReceivedAnswerPart||"")+e,i.client&&i.client.readyState==i.client.OPEN&&i.client.send(JSON.stringify({type:"socket_react",channel:i.channel,act:"WEBRTC_RECEIVE_ANSWER_PART",send_to:t})))}WEBRTC_ICE_CANDIDATES(e,i,t){this.ReceiveIceCandidate(JSON.parse(e),i,t)}createP5_panel(e,i){var t=this;this.OnUse||(this.OnUse=!0,this.p5canvas&&(clearTimeout(this.p5waitingAct),this.p5waitingAct=null,this.p5hangup=null,this.p5canvas.remove()),this.p5canvas=new x(n=>{let s,o,r,u,P,d,h,f,C,m,_=!0,E=!0,A=1;n.setup=()=>{if("http:"!=window.location.protocol||0==window.location.host.indexOf("localhost")){let l,c=()=>{this.Peers[e].JoinInited?(l.stop(.1),clearTimeout(this.p5waitingAct)):(l&&l.stop(.1),l=new x.Oscillator(380,"sine"),l.start(),l.amp(1,.15),l.amp(0,.75),this.p5waitingAct=setTimeout(()=>{c()},1200))};this.p5waitingAct=setTimeout(()=>{c()},0),this.p5hangup=()=>{l.stop(.1),clearTimeout(this.p5waitingAct),l=new x.Oscillator(380,"sine"),l.start(),l.freq(250,.35),l.amp(1,.15),l.amp(0,.25),l.amp(1,.35),l.amp(0,.45)}}n.noCanvas(),s=n.createDiv(),s.id("outterDiv"),s.style("position: absolute; left: 50%; top: 0px; z-index: 1"),s.style("transform: translateX(-50%)"),s.style("width: fit-content; height: fit-content"),s.style("padding: 8px 16px;"),s.style("display: flex; justify-content: center;"),r=n.createDiv(),r.parent(s),r.style("display: flex; justify-content: center;"),r.style("width: fit-content; height: fit-content"),r.style("border-radius: 24px"),r.style("background: var(--toast-background-color)"),r.style("padding: 6px 8px"),o=n.createDiv(),o.parent(r),o.id("webrtc_content"),o.style("display: flex; justify-content: center;"),o.style("flex-direction","column"),o.style("width: fit-content; height: fit-content"),o.style("word-break: break-all"),o.style("background: var(--toast-background-color)"),o.style("border-radius: 24px"),o.style("padding: 6px 8px"),o.style("color: "+(D.ud?"white":"black")),W(),u=n.createDiv(),u.parent(o),u.id("webrtc_content"),u.style("display: flex; justify-content: center;"),u.style("align-self","center"),u.style("width: fit-content; height: fit-content"),h=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="mic-outline"></ion-icon>'),h.parent(u),h.style("padding","0px"),h.style("margin","4px"),h.style("border-radius","16px"),h.style("width","40px"),h.style("height","40px"),h.mouseClicked(()=>{const l=this.localStream.getAudioTracks();for(let c=0,y=l.length;c<y;c++)l[c].enabled=!1;f.show(),h.hide(),_=!1}),f=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="mic-off-outline"></ion-icon>'),f.parent(u),f.style("background-color","grey"),f.style("padding","0px"),f.style("margin","4px"),f.style("border-radius","16px"),f.style("width","40px"),f.style("height","40px"),f.mouseClicked(()=>{const l=this.localStream.getAudioTracks();for(let c=0,y=l.length;c<y;c++)l[c].enabled=!0;h.show(),f.hide(),_=!0}),f.hide(),"video"==this.Peers[e].TypeIn&&(P=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="videocam-outline"></ion-icon>'),P.parent(u),P.style("padding","0px"),P.style("margin","4px"),P.style("border-radius","16px"),P.style("width","40px"),P.style("height","40px"),P.mouseClicked(()=>{const l=this.localStream.getVideoTracks();for(let c=0,y=l.length;c<y;c++)l[c].enabled=!1;d.show(),P.hide(),E=!1}),d=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="videocam-off-outline"></ion-icon>'),d.parent(u),d.style("background-color","grey"),d.style("padding","0px"),d.style("margin","4px"),d.style("border-radius","16px"),d.style("width","40px"),d.style("height","40px"),d.mouseClicked(()=>{const l=this.localStream.getVideoTracks();for(let c=0,y=l.length;c<y;c++)l[c].enabled=!0;P.show(),d.hide(),E=!0}),d.hide()),C=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="settings-outline"></ion-icon>'),C.parent(u),C.style("padding","0px"),C.style("margin","4px"),C.style("border-radius","16px"),C.style("width","40px"),C.style("height","40px"),C.mouseClicked((0,p.A)(function*(){C.elt.disabled=!0;let l=yield t.getDeviceList();t.global.PageDismissAct["webrtc-manage"]=function(){var c=(0,p.A)(function*(y){C.elt.disabled=!1;try{var N;if(!Object.keys(y).length)throw"\uc7a5\uce58 \ubcc0\uacbd \uc815\ubcf4\uac00 \ube44\uc5b4\uc788\uc74c";let b={};"video"==t.Peers[e].TypeIn&&y.data.videoinput&&(b.video={deviceId:{exact:y.data.videoinput.deviceId}}),y.data.audioinput&&(b.audio={deviceId:{exact:y.data.audioinput.deviceId}}),t.localStream.getTracks().forEach(v=>v.stop()),t.localStream="video"==t.Peers[e].TypeIn&&null!==(N=y.data.videoinput)&&void 0!==N&&N.useScr?yield navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}):yield navigator.mediaDevices.getUserMedia(b);const B=t.localStream.getAudioTracks();for(let v=0,S=B.length;v<S;v++)B[v].enabled=_;const U=t.localStream.getVideoTracks();for(let v=0,S=U.length;v<S;v++)U[v].enabled=E;t.localMedia.srcObject=t.localStream;const X=t.Peers[e].PeerConnection.getSenders();for(let v of X){var M,k;if("video"==(null===(M=v.track)||void 0===M?void 0:M.kind)){const S=t.localStream.getVideoTracks()[0];v?yield v.replaceTrack(S):t.Peers[e].PeerConnection.addTrack(S,t.localStream)}if("audio"==(null===(k=v.track)||void 0===k?void 0:k.kind)){const S=t.localStream.getAudioTracks()[0];v?yield v.replaceTrack(S):t.Peers[e].PeerConnection.addTrack(S,t.localStream)}}t.CreateOffer(e)}catch(b){console.log("\ubbf8\ub514\uc5b4 \uc2a4\ud2b8\ub9bc \ubcc0\uacbd \uc624\ub958: ",b)}t.global.RestoreShortCutAct("webrtc-manage"),delete t.global.PageDismissAct["webrtc-manage"]});return function(y){return c.apply(this,arguments)}}(),t.global.StoreShortCutAct("webrtc-manage"),t.global.ActLikeModal("webrtc-manage-io-dev",{list:JSON.parse(JSON.stringify(l)),typein:t.Peers[e].TypeIn,dismiss:"webrtc-manage"})})),m=n.createButton('<ion-icon style="width: 32px; height: 32px;" name="close-circle-outline"></ion-icon>'),m.parent(u),m.style("background-color","red"),m.style("padding","0px"),m.style("margin","4px"),m.style("border-radius","16px"),m.style("width","40px"),m.style("height","40px"),m.mouseClicked((0,p.A)(function*(){var l,c;yield null===(l=t.Peers[e])||void 0===l||null===(c=l.HangUpCallBack)||void 0===c?void 0:c.call(l)}))};let T=!1;n.draw=()=>{A>0?A-=.03:A<=0&&(A=0),W(),this.OnUse||this.p5hangup&&!T&&(this.p5hangup(),s.hide(),setTimeout(()=>{this.OnUse||(clearTimeout(this.p5waitingAct),this.p5waitingAct=null,this.p5hangup=null,this.p5canvas.remove())},1e3),T=!0)};let W=()=>{let R=n.lerpColor(n.color("#"+(D.ud?"30564e88":"b9543788")),n.color("#ffd94ebb"),A).levels,l=4*A;r.style(`padding: ${l}px ${l}px`),o.style(`padding: ${n.lerp(6,2,A)}px ${n.lerp(8,3,A)}px`),r.style(`background: rgba(${R[0]}, ${R[1]}, ${R[2]}, ${R[3]/255})`)}}))}getDeviceList(){return(0,p.A)(function*(){return yield navigator.mediaDevices.enumerateDevices()})()}createCall(e){var i=this;return(0,p.A)(function*(){if(!i.Peers[e])return void i.close_webrtc(e);let t;i.Peers[e].isConnected=!0;try{let n=yield i.indexed.loadTextFromUserPath("servers/webrtc_server.json");t={},t.iceServers=JSON.parse(n)}catch{}(!t||!t.iceServers||!t.iceServers.length)&&(i.p5toast.show({text:i.lang.text.WebRTCDevManager.NoRegServer}),t=null),i.Peers[e].PeerConnection=new RTCPeerConnection(t),i.Peers[e].PeerConnection.onicecandidate=n=>i.handleConnection(n,e),i.Peers[e].PeerConnection.oniceconnectionstatechange=n=>{console.log("ICE Connection state: ",i.Peers[e].PeerConnection.iceConnectionState)},i.Peers[e].PeerConnection.onconnectionstatechange=function(){var n=(0,p.A)(function*(s){switch(s.target.connectionState){case"failed":case"disconnected":yield i.close_webrtc(e);break;case"connected":i.p5waitingAct&&clearTimeout(i.p5waitingAct);break;default:console.log("\uc5f0\uacb0 \uc0c1\ud0dc \ubcc0\uacbd\ub428: ",s.target.connectionState)}});return function(s){return n.apply(this,arguments)}}(),"data"!=i.Peers[e].TypeIn?(i.localStream.getTracks().forEach(n=>i.Peers[e].PeerConnection.addTrack(n,i.localStream)),i.Peers[e].PeerConnection.ontrack=n=>{i.Peers[e].remoteMedia.srcObject=n.streams[0]}):i.createDataChannel(void 0,e),i.Peers[e].PeerConnection.ondatachannel=n=>{i.Peers[e].dataChannel=n.channel},i.Peers[e].PeerConnection.onnegotiationneeded=function(){var n=(0,p.A)(function*(s){if(i.Peers[e].JoinInited){yield i.Peers[e].PeerConnection.createOffer({offerToReceiveVideo:!0}).then(r=>i.createdOffer(r,e)).catch(r=>i.setSessionDescriptionError(r));const o=JSON.stringify(i.Peers[e].LocalOffer);i.Peers[e].LocalOfferPartArray=o.match(/(.{1,64})/g),i.WEBRTC_REPLY_INIT_SIGNAL_PART({client:i.Peers[e].signalingChannel,channel:i.Peers[e].signalChannelId},e,i.Peers[e].TypeIn,i.Peers[e].groupId)}});return function(s){return n.apply(this,arguments)}}()})()}createDataChannel(e,i){this.Peers[i].dataChannel=this.Peers[i].PeerConnection.createDataChannel(e),this.createDataChannelListener(i)}createDataChannelListener(e){this.Peers[e].dataChannel.onopen=i=>{this.Peers[e].dataChannelOpenAct&&this.Peers[e].dataChannelOpenAct()},this.Peers[e].dataChannel.onclose=i=>{var t,n;this.Peers[e]&&(null===(t=(n=this.Peers[e]).dataChannelOnCloseAct)||void 0===t||t.call(n),this.Peers[e].dataChannelOpenAct=null,this.Peers[e].dataChannelOnMsgAct=null,this.Peers[e].dataChannelOnCloseAct=null)},this.Peers[e].dataChannel.onmessage=i=>{this.Peers[e].dataChannelOnMsgAct&&this.Peers[e].dataChannelOnMsgAct(i.data)}}CreateOffer(e){var i=this;return(0,p.A)(function*(){try{const t=yield i.Peers[e].PeerConnection.createOffer({offerToReceiveVideo:!0});i.createdOffer(t,e)}catch(t){i.setSessionDescriptionError(t)}})()}handleConnection(e,i){let t=e.candidate;t&&this.Peers[i].IceCandidates.push(new RTCIceCandidate(t))}ReceiveIceCandidate(e,i,t){var n=this;this.ReplyIceCandidate&&clearTimeout(this.ReplyIceCandidate),this.ReplyIceCandidate=setTimeout((0,p.A)(function*(){for(;null!==(s=n.Peers[t])&&void 0!==s&&null!==(s=s.IceCandidates)&&void 0!==s&&s.length;){var s;const o=n.Peers[t].IceCandidates.shift();i.client&&i.client.readyState==i.client.OPEN&&i.client.send(JSON.stringify({type:"socket_react",act:"WEBRTC_ICE_CANDIDATES",channel:i.channel,data_str:JSON.stringify(o),send_to:t})),yield new Promise(r=>setTimeout(r,n.global.WebsocketRetryTerm))}}),800),this.Peers[t].PeerConnection.addIceCandidate(e).then(()=>{console.log("Success to add new ice candidate")}).catch(s=>{console.error("failed to add ice candidate: ",s)})}createdOffer(e,i){this.Peers[i].LocalOffer=e,this.Peers[i].PeerConnection.setLocalDescription(e).then(()=>{this.setLocalDescriptionSuccess(this.Peers[i].PeerConnection)}).catch(t=>this.setSessionDescriptionError(t))}createRemoteOfferFromAnswer(e,i){this.Peers[i].PeerConnection.setRemoteDescription(e).then(()=>{this.setRemoteDescriptionSuccess(this.Peers[i].PeerConnection)}).catch(t=>this.setSessionDescriptionError(t))}CreateAnswer(e,i){this.Peers[i].PeerConnection.createAnswer().then(t=>this.createdAnswer(t,e,i)).catch(t=>this.setSessionDescriptionError(t))}setLocalDescriptionSuccess(e){this.setDescriptionSuccess(e,"setLocalDescription")}setRemoteDescriptionSuccess(e){this.setDescriptionSuccess(e,"setRemoteDescription")}createdAnswer(e,i,t){var n=this;return(0,p.A)(function*(){n.Peers[t].LocalAnswer=e,n.Peers[t].PeerConnection.setLocalDescription(e).then(()=>{n.setLocalDescriptionSuccess(n.Peers[t].PeerConnection)}).catch(o=>n.setSessionDescriptionError(o));const s=JSON.stringify(e);n.Peers[t].LocalAnswerPartArray=s.match(/(.{1,64})/g),n.WEBRTC_RECEIVE_ANSWER_PART(i,t)})()}ReceiveRemoteAnswer(e,i,t){var n=this;return(0,p.A)(function*(){for(n.Peers[t].PeerConnection.setRemoteDescription(e).then(()=>{n.setRemoteDescriptionSuccess(n.Peers[t].PeerConnection)}).catch(o=>n.setSessionDescriptionError(o));null!==(s=n.Peers[t])&&void 0!==s&&null!==(s=s.IceCandidates)&&void 0!==s&&s.length;){var s;const o=n.Peers[t].IceCandidates.shift();i.client&&i.client.readyState==i.client.OPEN&&(i.client.send(JSON.stringify({type:"socket_react",channel:i.channel,act:"WEBRTC_ICE_CANDIDATES",data_str:JSON.stringify(o),send_to:t})),yield new Promise(r=>setTimeout(r,n.global.WebsocketRetryTerm)))}})()}setSessionDescriptionError(e){console.error(`Failed to create session description: ${e}.`)}setDescriptionSuccess(e,i){console.log(`Local ${i} complete.`)}HangUpCall(e){this.Peers[e]&&(this.Peers[e].isConnected=!1,this.Peers[e].PeerConnection&&(this.Peers[e].PeerConnection.close(),this.Peers[e].PeerConnection.onicecandidate=null,this.Peers[e].PeerConnection.oniceconnectionstatechange=null,this.Peers[e].PeerConnection.onconnectionstatechange=null,this.Peers[e].PeerConnection.ontrack=null,this.Peers[e].PeerConnection.ondatachannel=null,this.Peers[e].PeerConnection.onnegotiationneeded=null),this.Peers[e].PeerConnection=null)}close_webrtc(e,i){var t=this;return(0,p.A)(function*(){var n,s;const o=i&&t.PeerGroups[i]||[e],r=i||(null===(n=t.Peers[e])||void 0===n?void 0:n.groupId),u=()=>{t.localMedia&&t.localMedia.remove(),t.localStream&&(t.localStream.getVideoTracks().forEach(a=>a.stop()),t.localStream.getAudioTracks().forEach(a=>a.stop())),t.localMedia=null,t.localStream=null};for(;o.length;){var P,d,h,f;const a=o.shift();if(t.HangUpCall(a),null!==(P=t.Peers[a])&&void 0!==P&&P.remoteMedia&&(null===(d=t.Peers[a].remoteMedia)||void 0===d||d.remove()),t.Peers[a]&&(t.Peers[a].remoteMedia=null),null!==(h=t.Peers[a])&&void 0!==h&&h.dataChannel&&(t.Peers[a].dataChannel.onopen=null,t.Peers[a].dataChannel.onclose=null,t.Peers[a].dataChannel.onmessage=null),delete t.Peers[a],r){var _,C;for(let T=(null===(E=t.PeerGroups[r])||void 0===E?void 0:E.length)-1;T>=0;T--){var E;if(t.PeerGroups[r][T]==a){t.PeerGroups[r].splice(T,1);break}}null!==(_=t.PeerGroups[r])&&void 0!==_&&_.length||(delete t.PeerGroups[r],u(),null===(C=t.p5hangup)||void 0===C||C.call(t))}else if("data"!=(null===(f=t.Peers[a])||void 0===f?void 0:f.TypeIn)){var m;u(),null===(m=t.p5hangup)||void 0===m||m.call(t)}}const A=null===(s=t.PeerGroups[r])||void 0===s?void 0:s.length;t.FocusedRemoteId=A-1,t.OnUse=!!r&&!!A})()}}return(w=L).\u0275fac=function(e){return new(e||w)(O.KVO(V.G),O.KVO(K.n),O.KVO(Q.y),O.KVO(F.X),O.KVO(D.z3))},w.\u0275prov=O.jDH({token:w,factory:w.\u0275fac,providedIn:"root"}),L})()}}]);