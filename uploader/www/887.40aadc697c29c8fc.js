"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[887],{887:(Be,ie,_)=>{_.r(ie),_.d(ie,{MainPageModule:()=>De});var Z=_(177),pe=_(4341),E=_(5374),oe=_(9858),D=_(467),O=_(482),be=_(92),le=_(8326),ye=_(617),t=_(3953),_e=_(4234),ve=_(4237),Ce=_(8065),Te=_(755);function xe(r,v){1&r&&t.nrm(0,"ion-icon",12)}function Se(r,v){1&r&&t.nrm(0,"ion-icon",13)}function Pe(r,v){1&r&&(t.j41(0,"div",14),t.EFF(1,"A"),t.k0s())}function je(r,v){if(1&r){const u=t.RV6();t.j41(0,"div")(1,"div",15),t.bIt("click",function(){t.eBV(u);const g=t.XpG();return t.Njj(g.nakama.open_add_todo_page())}),t.nrm(2,"ion-icon",16),t.j41(3,"div")(4,"ion-label",17),t.EFF(5),t.k0s()()()()}if(2&r){const u=t.XpG();t.R7$(5),t.JRh(u.lang.text.Main.NoTodo)}}function ke(r,v){1&r&&(t.j41(0,"div",22),t.EFF(1,"`"),t.k0s())}function Ie(r,v){if(1&r&&(t.j41(0,"div",22),t.EFF(1),t.k0s()),2&r){const u=t.XpG(2).index;t.R7$(),t.SpI("",u+1," ")}}function Fe(r,v){if(1&r){const u=t.RV6();t.j41(0,"span")(1,"button",23),t.bIt("click",function(){t.eBV(u);const g=t.XpG().$implicit,e=t.XpG(2);return t.Njj(e.ChangeFilterValue(g.value))}),t.DNE(2,Ie,2,1,"div",20),t.EFF(3),t.k0s()()}if(2&r){const u=t.XpG(),c=u.$implicit,g=u.index,e=t.XpG(2);t.R7$(),t.Aen("background-color: "+(c.color||"#8888")+"; "+(e.CurrentFilterValue==c.value?"border: 4px solid var(--ion-color-secondary); margin: -4px 4px 4px -4px;":"")),t.Y8G("id","filterSel_"+g),t.R7$(),t.Y8G("ngIf",e.global.ShowHint),t.R7$(),t.SpI(" ",e.lang.text.TodoDetail[c.name]," ")}}function we(r,v){if(1&r){const u=t.RV6();t.j41(0,"span")(1,"input",24),t.bIt("input",function(g){t.eBV(u);const e=t.XpG().$implicit,M=t.XpG(2);return t.Njj(M.GetFilterInput(g,e.name))})("blur",function(){t.eBV(u);const g=t.XpG(3);return t.Njj(g.EnableShortcut())})("focus",function(){t.eBV(u);const g=t.XpG(3);return t.Njj(g.DisableShortcut())}),t.k0s()()}if(2&r){const u=t.XpG().$implicit,c=t.XpG(2);t.R7$(),t.Y8G("placeholder",c.lang.text.TodoDetail[u.name])}}function Ee(r,v){if(1&r&&(t.j41(0,"span"),t.DNE(1,Fe,4,5,"span",9)(2,we,2,1,"span",9),t.k0s()),2&r){const u=v.$implicit;t.R7$(),t.Y8G("ngIf",!u.type),t.R7$(),t.Y8G("ngIf","input"==u.type)}}function Ae(r,v){if(1&r){const u=t.RV6();t.j41(0,"div",18)(1,"button",19),t.bIt("click",function(){t.eBV(u);const g=t.XpG();return t.Njj(g.SwitchTargetFilter())}),t.DNE(2,ke,2,0,"div",20),t.EFF(3),t.k0s(),t.DNE(4,Ee,3,2,"span",21),t.k0s()}if(2&r){const u=t.XpG();t.R7$(2),t.Y8G("ngIf",u.global.ShowHint&&u.global.portalHint),t.R7$(),t.SpI(" ",u.lang.text.TodoDetail[u.TargetFilterDisplayName]," "),t.R7$(),t.Y8G("ngForOf",u.AllCategories[u.TargetFilterName])}}var f=function(r){return r[r.None=0]="None",r[r.Deadline=1]="Deadline",r[r.Importance=2]="Importance",r[r.Color=3]="Color",r[r.Creator=4]="Creator",r[r.InputText=5]="InputText",r}(f||{});const Re=[{path:"",component:(()=>{var r;class v{constructor(c,g,e,M,s,l){this.global=c,this.lang=g,this.nakama=e,this.statusBar=M,this.indexed=s,this.alertCtrl=l,this.isPlayingCanvas={loop:!0},this.TargetFilterDisplayName="FilterCat_0",this.TargetFilterName=0,this.AllCategories={},this.CurrentFilterValue=null,this.isEmptyTodo=!1}ngOnInit(){this.global.PortalBottonTabAct.Todo=()=>{this.ViewInitFunc&&this.ViewInitFunc()}}toggle_session(){this.nakama.toggle_all_session(),this.global.p5todo.redraw()}toggleCanvasPlaying(){this.isPlayingCanvas.loop=!this.isPlayingCanvas.loop,this.isPlayingCanvas.loop?this.global.p5todo.loop():this.global.p5todo.noLoop()}SwitchTargetFilter(c){switch(this.TargetFilterName=null!=c?c:(this.TargetFilterName+1)%6,this.TargetFilterName){case f.None:this.TargetFilterDisplayName="FilterCat_0";break;case f.Importance:this.TargetFilterDisplayName="Importance";break;case f.Color:this.TargetFilterDisplayName="CustomColor";break;case f.Deadline:this.TargetFilterDisplayName="Deadline";break;case f.Creator:this.TargetFilterDisplayName="FilterByCreator";break;case f.InputText:this.TargetFilterDisplayName="AsString"}this.CurrentFilterValue=null,this.global.p5FilteringTodos&&this.global.p5FilteringTodos(f.None,this.TargetFilterDisplayName)}ChangeFilterValue(c){this.CurrentFilterValue=this.CurrentFilterValue==c?null:c,this.global.p5FilteringTodos()}EnableShortcut(){this.global.BlockMainShortcut=!1,this.global.portalHint=!0}DisableShortcut(){this.global.BlockMainShortcut=!0,this.global.portalHint=!1}CreateTodoManager(){var c=this;setTimeout(()=>{"DesktopPWA"!=be.aH&&this.toggleCanvasPlaying()},8e3);let g=document.getElementById("todo");this.global.p5todo&&this.global.p5todo.remove(),this.global.p5todo=new le(e=>{let C,Q,W,ne,M=this.statusBar,s={},l=[],B=[],H=[],A=e.createVector(0,0),q=e.createVector(0,0),p=e.createVector(0,0),b=1,P=e.createVector(0,0),Y=this.nakama,ae=this.indexed,I=[],x=!1,U=this.isPlayingCanvas;this.GetFilterInput=(n,o)=>{if("InputPlaceHolder"===o){const i=n.target.value;for(let d=0,h=l.length;d<h;d++){var a;let m=!1;const k=s[l[d]].json;if(k.title){if(k.title.indexOf(i)>=0&&(m=!0),m){s[l[d]].isHidden=!m;continue}(null===(a=k.description)||void 0===a?void 0:a.indexOf(i))>=0&&(m=!0),s[l[d]].isHidden=!m}}}this.isPlayingCanvas.loop||e.redraw()},e.setup=(0,D.A)(function*(){let n=e.createCanvas(g.clientWidth,g.clientHeight);n.parent(g),n.id("p5todo"),n.elt.oncontextmenu=function(){var a=(0,D.A)(function*(i){for(let d=l.length-1;d>=0;d--){const h=s[l[d]];if("AddButton"!=h.json.id&&h.position.dist(w(i.offsetX,i.offsetY))<h.EllipseSize/2){let k="";try{let S;try{S=`todo/${h.json.id}_${h.json.remote.isOfficial}_${h.json.remote.target}/thumbnail.png`}catch{S=`todo/${h.json.id}/thumbnail.png`}let X=yield ae.loadBlobFromUserPath(S,"image/png");const V=URL.createObjectURL(X);k=`<div style="text-align: center"><img src="${V}" alt="todo_image" style="border-radius: 2px"></div>`,setTimeout(()=>{URL.revokeObjectURL(V)},100)}catch{}c.alertCtrl.create({header:h.json.title,message:new ye.Vk(k+`<div>${h.json.description||""}</div>`),buttons:[{text:c.lang.text.TodoDetail.TodoComplete,handler:()=>{!function(){var X=(0,D.A)(function*(){try{yield Y.doneTodo(h.json)}catch(V){console.log("\ud560 \uc77c \uc644\ub8cc \uc624\ub958: ",V)}});return function(){return X.apply(this,arguments)}}()()}},{text:c.lang.text.TodoDetail.remove,cssClass:"redfont",handler:()=>{!function(){var X=(0,D.A)(function*(){try{yield Y.deleteTodoFromStorage(!0,h.json)}catch(V){console.log("\ud560 \uc77c \uc0ad\uc81c \uc624\ub958: ",V)}});return function(){return X.apply(this,arguments)}}()()}}]}).then(S=>{me(),S.onDidDismiss().then(()=>{x=!1}),x=!0,S.present()});break}}});return function(i){return a.apply(this,arguments)}}(),e.smooth(),e.noStroke(),e.pixelDensity(1),e.ellipseMode(e.CENTER),e.rectMode(e.CENTER),e.textAlign(e.CENTER,e.CENTER),e.textSize(20),e.textLeading(28),e.textWrap(e.CHAR),e.imageMode(e.CENTER);let o=Number(localStorage.getItem("p5todoScale")||1);Me(),c.ViewInitFunc=ee,b=o,localStorage.setItem("p5todoScale",`${b}`),c.global.p5todoStopCanvas=()=>{x=!0,e.noLoop()},c.global.p5todoPlayCanvas=()=>{x=!1,e.windowResized(),c.isPlayingCanvas.loop&&e.loop()},c.global.p5todoAddtodo=a=>{let i=JSON.parse(a),d=i.id;if(i.remote&&(d+=`_${i.remote.isOfficial}_${i.remote.target}`),!i.removed){if(i.done){for(let h=l.length-1;h>=0;h--)if(l[h]==d)return void s[l[h]].makeDone()}else s[d]?(s[d].json=i,s[d].initialize()):s[d]=new de(i);c.isPlayingCanvas.loop||(Q=s[d],e.loop()),W()}},W=()=>{l=Object.keys(s),c.isEmptyTodo=!l.length,c.isEmptyTodo||(s.AddButton?1==l.length&&s.AddButton.makeDone():(s.AddButton=new de("",!0),l=Object.keys(s)))},c.global.p5removeTodo=a=>{let i=JSON.parse(a),d=i.id;i.remote&&(d+=`_${i.remote.isOfficial}_${i.remote.target}`);for(let h=l.length-1;h>=0;h--)if(l[h]==d){s[l[h]].RemoveTodo();break}c.isEmptyTodo=!Object.keys(l).length,W(),e.redraw()},ne=function(){var a=(0,D.A)(function*(){s={},l.length=0;let i=yield c.indexed.GetFileListFromDB("todo/");for(let d=0,h=i.length;d<h;d++)if(i[d].indexOf("/info.todo")>=0){let m=yield c.indexed.loadTextFromUserPath(i[d]);c.global.p5todoAddtodo(m)}c.isEmptyTodo=!Object.keys(l).length});return function(){return a.apply(this,arguments)}}(),ne(),c.SwitchTargetFilter(c.TargetFilterName),c.AllCategories[f.None]=[],c.AllCategories[f.Importance]=[{name:"Importance_0",color:"#58a19288",value:"0"},{name:"Importance_1",color:"#ddbb4188",value:"1"},{name:"Importance_2",color:"#b9543788",value:"2"}],c.AllCategories[f.Color]=[{name:"ColorFilterRed",color:"#ff000088",value:[-30,30]},{name:"ColorFilterYellow",color:"#ffff0088",value:[30,90]},{name:"ColorFilterGreen",color:"#00ff0088",value:[90,150]},{name:"ColorFilterCyan",color:"#00ffff88",value:[150,210]},{name:"ColorFilterBlue",color:"#0000ff88",value:[210,270]},{name:"ColorFilterMagenta",color:"#ff00ff88",value:[270,330]}],c.AllCategories[f.Deadline]=[{name:"TimeBefore",color:"#bbbbbb88",value:"before"},{name:"TimeIn",color:"#00ff0088",value:"ontime"},{name:"TimeOut",color:"#b9543788",value:"after"},{name:"Yesterday",color:"#45678988",value:"yesterday"},{name:"Today",color:"#789abc88",value:"today"},{name:"Tomorrow",color:"#abcdef88",value:"tomorrow"}],c.AllCategories[f.Creator]=[{name:"CreatorLocal",color:"#bbbbbb88",value:"local"},{name:"CreatorMe",color:"#00ff0088",value:"server"},{name:"Requested",color:"#6789ab88",value:"worker"},{name:"CreatorOther",color:"#ba987688",value:"other"}],c.AllCategories[f.InputText]=[{name:"InputPlaceHolder",color:"#bbbbbb88",type:"input",value:"text"}],c.global.p5FilteringTodos=K});let re,K=(n,o)=>{switch(o&&(re=o),null!=n?n:this.TargetFilterName){case f.None:for(let i=0,d=l.length;i<d;i++)s[l[i]].isHidden=!1;break;case f.Importance:if(this.CurrentFilterValue)for(let i=0,d=l.length;i<d;i++)s[l[i]].isHidden="AddButton"!=s[l[i]].json.id&&s[l[i]].json.importance!=this.CurrentFilterValue;else K(f.None);break;case f.Color:for(let i=0,d=l.length;i<d;i++){let h;e.push(),e.colorMode(e.HSB);try{h=e.color(s[l[i]].json.custom_color)}catch{}if(!h)switch(s[l[i]].json.importance){case"0":h=e.color("#58a192");break;case"1":h=e.color("#ddbb41");break;case"2":h=e.color("#b95437")}if(e.pop(),this.CurrentFilterValue){if(h){let m=(360+this.CurrentFilterValue[0])%360,k=(360+this.CurrentFilterValue[1])%360,R=e.hue(h);s[l[i]].isHidden=m<k?!(m<R&&R<k):k<R&&R<m}}else s[l[i]].isHidden=!1}break;case f.Deadline:if(this.CurrentFilterValue)for(let i=0,d=l.length;i<d;i++)if("AddButton"==s[l[i]].json.id)s[l[i]].isHidden=!1;else switch(this.CurrentFilterValue){case"before":s[l[i]].isHidden=!(s[l[i]].json.startFrom&&s[l[i]].json.startFrom>Date.now());break;case"ontime":s[l[i]].isHidden=!((s[l[i]].json.startFrom||0)<Date.now()&&(s[l[i]].json.limit||s[l[i]].json.written)>Date.now());break;case"after":s[l[i]].isHidden=!(s[l[i]].json.limit<=Date.now());break;case"yesterday":{const h=new Date;h.setDate(h.getDate()-1),h.setHours(0,0,0,0);const m=new Date;m.setDate(m.getDate()-1),m.setHours(23,59,59,999),s[l[i]].isHidden=!(s[l[i]].json.limit>h&&s[l[i]].json.limit<=m)}break;case"today":{const h=new Date;h.setHours(0,0,0,0);const m=new Date;m.setHours(23,59,59,999),s[l[i]].isHidden=!(s[l[i]].json.limit>h&&s[l[i]].json.limit<=m)}break;case"tomorrow":{const h=new Date;h.setDate(h.getDate()+1),h.setHours(0,0,0,0);const m=new Date;m.setDate(m.getDate()+1),m.setHours(23,59,59,999),s[l[i]].isHidden=!(s[l[i]].json.limit>h&&s[l[i]].json.limit<=m)}}else K(f.None);break;case f.Creator:if(this.CurrentFilterValue)for(let i=0,d=l.length;i<d;i++)if("AddButton"==s[l[i]].json.id)s[l[i]].isHidden=!1;else switch(this.CurrentFilterValue){case"local":s[l[i]].isHidden=s[l[i]].json.storeAt!=this.CurrentFilterValue;break;case"server":s[l[i]].isHidden=void 0===s[l[i]].json.remote;break;case"worker":s[l[i]].isHidden=!(void 0!==s[l[i]].json.workers&&s[l[i]].json.is_me);break;case"other":s[l[i]].isHidden=s[l[i]].json.is_me||"local"==s[l[i]].json.storeAt}else K(f.None)}e.redraw()},Me=()=>{P.x=e.width/2,P.y=e.height/2,p.x=0,p.y=0,b=1,localStorage.setItem("p5todoScale",`${b}`),this.isPlayingCanvas.loop||e.redraw()},y={Act:!1,lerp:0,Scale:e.createVector(),CamPos:e.createVector(),CamScale:0},ee=()=>{y.Act=!0,y.Scale.x=P.x,y.Scale.y=P.y,y.CamPos.x=p.x,y.CamPos.y=p.y,y.CamScale=b,this.isPlayingCanvas.loop||e.loop()};e.draw=()=>{e.clear(255,255,255,255),e.push(),e.translate(P),e.scale(b),e.translate(p);for(let n=0,o=l.length;n<o;n++)s[l[n]].display();for(let n=H.length-1;n>=0;n--)H[n].display(),H[n].lifeTime<0&&H.splice(n,1);for(let n=B.length-1;n>=0;n--)B[n].DoneAnim();e.pop(),this.isPlayingCanvas.loop&&(q.x=80*-e.accelerationX,q.y=80*e.accelerationY),y.Act&&(y.lerp+=.07,P.x=e.lerp(y.Scale.x,e.width/2,z(y.lerp)),P.y=e.lerp(y.Scale.y,e.height/2,z(y.lerp)),p.x=e.lerp(y.CamPos.x,0,z(y.lerp)),p.y=e.lerp(y.CamPos.y,0,z(y.lerp)),b=e.lerp(y.CamScale,1,z(y.lerp)),localStorage.setItem("p5todoScale",`${b}`),y.lerp>=1&&(y.Act=!1,y.lerp=0,P.x=e.width/2,P.y=e.height/2,p.x=0,p.y=0,b=1,localStorage.setItem("p5todoScale",`${b}`),this.isPlayingCanvas.loop||e.noLoop()))};let z=n=>e.sin(n*e.PI/2);e.windowResized=()=>{x||setTimeout(()=>{let n=p.x/e.width,o=p.y/e.height;e.resizeCanvas(g.clientWidth,g.clientHeight),P.x=e.width/2,P.y=e.height/2,p.x=n*e.width,p.y=o*e.height},50)};let N=!0;class de{constructor(o,a=!1){this.isAddButton=!1,this.EllipseSize=96,this.Velocity=e.createVector(0,0),this.Accel=e.createVector(0,0),this.isGrabbed=!1,this.TextColor=e.color(O.ud?255:0),this.ProgressWeight=8,this.LerpProgress=0,this.isHidden=!1,this.LifeTime=1,this.json=o;let i=e.max(e.width,e.height)||1,d=e.createVector(i/e.min(1,b),0).setHeading(e.random(-e.PI,e.PI));if(a)return this.isAddButton=a,this.position=A.copy(),this.defaultColor=e.color(O.ud?"#bbb":"#888"),void(this.json={id:"AddButton",written:0,limit:1,longSide:53,shortSide:11});this.position=d,this.initialize()}initialize(){if(!this.json.custom_color)switch(this.json.importance){case"0":this.defaultColor=e.color("#58a192");break;case"1":this.defaultColor=e.color("#ddbb41");break;case"2":this.defaultColor=e.color("#b95437")}let a,o=Number(this.json.importance);switch(o){case 0:this.EllipseSize=96;break;case 1:this.EllipseSize=104;break;case 2:this.EllipseSize=112}if(!I[o]){I[o]=e.createImage(this.EllipseSize,this.EllipseSize),I[o].loadPixels();let i=e.createVector(I[o].width/2,I[o].height/2);for(let d=0,h=I[o].height;d<h;d++)for(let m=0,k=I[o].width;m<k;m++){let R=e.createVector(m,d);i.dist(R)<this.EllipseSize/2-1&&I[o].set(m,d,e.color(255,80))}I[o].updatePixels()}try{a=`todo/${this.json.id}_${this.json.remote.isOfficial}_${this.json.remote.target}/thumbnail.png`}catch{a=`todo/${this.json.id}/thumbnail.png`}ae.loadBlobFromUserPath(a,"").then(i=>{const d=URL.createObjectURL(i);e.loadImage(d,h=>{this.ThumbnailImage=h,this.ThumbnailImage.mask(I[o]),URL.revokeObjectURL(d)})}).catch(i=>{this.ThumbnailImage=null})}display(){if(e.push(),this.isGrabbed||(this.CalcPosition(),this.OnCollider(),this.position=this.position.add(this.Velocity)),e.translate(this.position),this.LerpProgress=e.map(Date.now(),this.json.startFrom||this.json.written,this.json.limit,0,1,!0),(this.isAddButton||this.json.written>this.json.limit)&&(this.LerpProgress=1),this.isHidden?e.fill(128,40):e.fill("FilterByCreator"==re&&this.json.remote?M.colors[M.groupServer[this.json.remote.isOfficial][this.json.remote.target]||"offline"]+e.hex(e.floor(e.lerp(34,96,this.LerpProgress)),2):(this.json.custom_color||this.defaultColor.toString("#rrggbb"))+e.hex(e.floor(e.lerp(34,96,this.LerpProgress)),2)),e.ellipse(0,0,this.EllipseSize,this.EllipseSize),!this.isHidden&&this.ThumbnailImage&&e.image(this.ThumbnailImage,0,0,this.EllipseSize,this.EllipseSize),e.push(),!this.isHidden){e.noFill(),this.isAddButton?(e.push(),e.noStroke(),e.fill(255),e.rect(0,0,this.json.shortSide,this.json.longSide),e.rect(0,0,this.json.longSide,this.json.shortSide),e.pop()):(e.stroke(this.json.custom_color||this.defaultColor),e.strokeWeight(this.ProgressWeight)),e.rotate(-e.PI/2);let o=this.EllipseSize-this.ProgressWeight;this.LerpProgress<1?e.arc(0,0,o,o,0,this.LerpProgress*e.TWO_PI):e.circle(0,0,o)}if(e.pop(),!this.isHidden){let o=.9*this.EllipseSize;this.TextColor=e.color(O.ud?255:0,0==this.LerpProgress?128:255),e.fill(this.TextColor),e.text(this.json.title,0,0,o,o)}e.pop()}CalcPosition(){let o=this.position.dist(A),a=e.map(o,0,this.EllipseSize/8,0,1,!0),i=e.map(a,this.EllipseSize/4,0,1,.95,!0);this.Accel.x=a,this.Accel.y=0;let d=this.position.copy().sub(q).heading()-e.PI;this.Accel=this.Accel.setHeading(d),this.Velocity.add(this.Accel).mult(i)}OnCollider(){for(let o=0,a=l.length;o<a;o++)if(s[l[o]]!=this){let i=s[l[o]],d=this.position.dist(i.position),h=this.EllipseSize/2+i.EllipseSize/2;d<h&&(U.loop||Q==this&&(Q=null,e.noLoop()),this.ReflectBounce(i,d/h),i.ReflectBounce(this,d/h))}}ReflectBounce(o,a){let i=le.Vector.sub(this.position,o.position);this.Velocity.add(i.mult(1-a)).mult(.85)}makeDone(){var o=this;return(0,D.A)(function*(){o.LifeTime=1,yield new Promise(a=>setTimeout(a,500)),o.Velocity=A.copy(),o.Accel=A.copy(),o.OriginalEllipseSize=o.EllipseSize,o.OriginalProgWeight=o.ProgressWeight,o.json.done=!0,B.push(o),U.loop||e.loop()})()}DoneAnim(){var o=this;return(0,D.A)(function*(){if(U.loop||e.loop(),o.LifeTime-=.04,o.EllipseSize=o.OriginalEllipseSize*o.LifeTime,o.ProgressWeight=o.OriginalProgWeight*o.LifeTime,o.LifeTime<.5&&H.push(new he(o.position,o.json.custom_color||o.defaultColor)),o.TextColor=e.color(O.ud?255:0,(0==o.LerpProgress?128:255)*o.LifeTime),o.isAddButton&&(o.json.longSide*=o.LifeTime,o.json.shortSide*=o.LifeTime),o.LifeTime<0){U.loop||setTimeout(()=>e.noLoop(),1e3),o.RemoveTodo(),W();for(let a=0;a<20;a++)H.push(new he(o.position,o.json.custom_color||o.defaultColor))}})()}Clicked(){N&&!x&&!this.json.done&&(this.isAddButton?Y.open_add_todo_page():Y.open_add_todo_page(JSON.stringify(this.json)))}RemoveTodo(){let o=this.json.id;this.json.remote&&(o+=`_${this.json.remote.isOfficial}_${this.json.remote.target}`);for(let a=l.length-1;a>=0;a--)if(l[a]==o){l.splice(a,1);break}for(let a=B.length-1;a>=0;a--)if(B[a]=this){B.splice(a,1);break}delete s[o]}}class he{constructor(o,a){this.RectSize=4,this.rotate=0,this.pos=o.copy(),e.randomSeed(e.random(-255,255)),this.lifeTime=e.random(180,255),this.vel=e.createVector(e.random(-75,75),e.random(-40,-80)),this.acc=e.createVector(0,e.random(-1,-3)),e.push(),e.colorMode(e.HSB);let i=e.hue(a),d=e.saturation(a),h=e.brightness(a);this.color=e.color(e.random(i-20,i+20),e.random(d-20,d+20),e.random(h-20,h+20),this.lifeTime/255),e.pop(),this.RectSize=e.random(3,4),this.rotate=e.random(-e.PI,e.PI)}display(){this.color.setAlpha(this.lifeTime/255),e.fill(this.color),this.CalcPhysics(),e.push(),e.translate(this.pos),e.rotate(this.rotate),e.rect(0,0,this.RectSize,this.RectSize),e.pop(),this.lifeTime--}CalcPhysics(){this.acc.y+=.07,this.vel.add(this.acc),this.pos.add(this.vel.copy().div(100))}}let J,j,ue,F,te=0;e.mousePressed=n=>{let o=n.target==document.getElementById("p5todo");if(!x&&o)switch(N=!0,n.which){case 1:j=e.createVector(e.mouseX,e.mouseY),F=p.copy(),J=e.createVector(e.mouseX,e.mouseY);for(let a=l.length-1;a>=0;a--)if(s[l[a]].position.dist(w())<s[l[a]].EllipseSize/2){s[l[a]].isGrabbed=!0,C=s[l[a]],j=w();break}break;case 2:ee()}},e.mouseDragged=n=>{let o=n.target==document.getElementById("p5todo");if(!x&&o&&1===(this.isPlayingCanvas.loop||e.redraw(),n.which))try{J=e.createVector(e.mouseX,e.mouseY);let a=0;C?(C.position=w(),a=j.dist(w())):(p=F.copy().add(J.sub(j).div(b)),a=F.dist(p)),a>15&&(N=!1)}catch{}},e.mouseReleased=n=>{let o=n.target==document.getElementById("p5todo");!x&&o&&1===n.which&&(J=null,fe())};let w=(n,o)=>{let a=e.createVector(n||e.mouseX,o||e.mouseY);return a.sub(P),a.div(b),a.sub(p),a};e.mouseWheel=n=>{let o=n.target==document.getElementById("p5todo");!x&&o&&(this.isPlayingCanvas.loop||e.redraw(),b*=n.deltaY<0?1.1:.9,localStorage.setItem("p5todoScale",`${b}`))};let T=[],G=!1;const $=56;e.touchStarted=n=>{let o=n.target==document.getElementById("p5todo");if(!x&&o)switch(N=!0,T=n.touches,G=!0,T.length){case 1:ge();break;case 2:let a=e.createVector(T[0].clientX,T[0].clientY-$),i=e.createVector(T[1].clientX,T[1].clientY-$);N=!1,te=a.dist(i),j=a.copy().add(i).div(2),F=p.copy(),ue=b,C&&(C.isGrabbed=!1,C.Velocity=A.copy(),C.Accel=A.copy(),C=null);break;default:G=!1,ee()}},e.touchMoved=n=>{let o=n.target==document.getElementById("p5todo");if(!x&&o){switch(this.isPlayingCanvas.loop||e.redraw(),T=n.touches,T.length){case 1:{if(!G)return;let a=n.changedTouches[0],i=e.createVector(a.clientX,a.clientY-$),d=0;C?(C.position=w(),d=j.dist(w(i.x,i.y))):(p=F.copy().add(i.sub(j).div(b)),d=F.dist(p)),d>15&&(N=!1)}break;case 2:{if(!G)return;let a=e.createVector(T[0].clientX,T[0].clientY-$),i=e.createVector(T[1].clientX,T[1].clientY-$),d=a.copy().add(i).div(2);b=a.dist(i)/te*ue,localStorage.setItem("p5todoScale",`${b}`),p=F.copy().add(d.sub(j).div(b))}}return!1}},e.touchEnded=n=>{let o=n.target==document.getElementById("p5todo");if(!x&&o)switch(T=n.touches,T.length){case 0:fe(),G=!1;break;case 1:if(!G)return;ge(),te=0}};let ge=()=>{j=e.createVector(T[0].clientX,T[0].clientY-$),F=p.copy();for(let n=l.length-1;n>=0;n--)if(s[l[n]].position.dist(w(j.x,j.y))<s[l[n]].EllipseSize/2){s[l[n]].isGrabbed=!0,C=s[l[n]];break}},me=()=>{C&&(C.isGrabbed=!1,C.Velocity=A.copy(),C.Accel=A.copy(),C=null)},fe=()=>{me(),j=null;try{if(F.dist(p)<15)for(let o=l.length-1;o>=0;o--)if(s[l[o]].position.dist(w())<s[l[o]].EllipseSize/2){s[l[o]].Clicked();break}}catch{}}})}ionViewDidEnter(){document.getElementById("p5todo")||this.global.p5todo?this.global.p5todoPlayCanvas():this.CreateTodoManager(),this.try_add_shortcut()}try_add_shortcut(){this.global.p5KeyShortCut?(this.global.p5KeyShortCut.AddAct=()=>{this.nakama.open_add_todo_page()},this.global.p5KeyShortCut.Backquote=()=>{this.SwitchTargetFilter()},this.global.p5KeyShortCut.Digit=c=>{this.AllCategories[this.TargetFilterName].length>c&&this.ChangeFilterValue(this.AllCategories[this.TargetFilterName][c].value)}):setTimeout(()=>{this.try_add_shortcut()},100)}ionViewWillLeave(){this.global.p5todoStopCanvas&&this.global.p5todoStopCanvas(),this.global.p5KeyShortCut&&(delete this.global.p5KeyShortCut.AddAct,delete this.global.p5KeyShortCut.Backquote,delete this.global.p5KeyShortCut.Digit)}}return(r=v).\u0275fac=function(c){return new(c||r)(t.rXU(O.z3),t.rXU(_e.y),t.rXU(ve.X),t.rXU(Ce.j),t.rXU(Te.n),t.rXU(E.hG))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-main"]],decls:15,vars:8,consts:[[1,"ion-no-border"],[1,"play_button",3,"click"],["button","","style","width: 24px; height: 24px;","name","play-circle",4,"ngIf"],["button","","style","width: 24px; height: 24px;","name","pause-circle",4,"ngIf"],[1,"add_button",3,"click"],["class","shortcut_hint shortcut_top_add",4,"ngIf"],["button","","name","add-circle-outline",2,"width","24px","height","24px"],[1,"header_online_circle",3,"click"],["oncontextmenu","return false;"],[4,"ngIf"],["id","todo",1,"full_screen",2,"overflow","hidden"],["style","position: absolute; top: 16px; left: 16px;",4,"ngIf"],["button","","name","play-circle",2,"width","24px","height","24px"],["button","","name","pause-circle",2,"width","24px","height","24px"],[1,"shortcut_hint","shortcut_top_add"],[1,"disconnect_info",3,"click"],["color","medium","name","create-outline",2,"width","60px","height","60px"],["color","medium"],[2,"position","absolute","top","16px","left","16px"],[1,"FilterSwitchButton",3,"click"],["class","shortcut_hint shortcut_todo_categories",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"shortcut_hint","shortcut_todo_categories"],[1,"FilterSwitchButton",3,"click","id"],["type","text",3,"input","blur","focus","placeholder"]],template:function(c,g){1&c&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"div",1),t.bIt("click",function(){return g.toggleCanvasPlaying()}),t.DNE(5,xe,1,0,"ion-icon",2)(6,Se,1,0,"ion-icon",3),t.k0s(),t.j41(7,"div",4),t.bIt("click",function(){return g.nakama.open_add_todo_page()}),t.DNE(8,Pe,2,0,"div",5),t.nrm(9,"ion-icon",6),t.k0s(),t.j41(10,"div",7),t.bIt("click",function(){return g.toggle_session()}),t.k0s()()(),t.j41(11,"ion-content",8),t.DNE(12,je,6,1,"div",9),t.j41(13,"div",10),t.DNE(14,Ae,5,3,"div",11),t.k0s()()),2&c&&(t.R7$(3),t.JRh(g.lang.text.Main.Title),t.R7$(2),t.Y8G("ngIf",!g.isPlayingCanvas.loop),t.R7$(),t.Y8G("ngIf",g.isPlayingCanvas.loop),t.R7$(2),t.Y8G("ngIf",g.global.ShowHint),t.R7$(2),t.Aen("background-color: "+g.statusBar.colors[g.statusBar.settings.groupServer]+"; cursor: pointer;"),t.R7$(2),t.Y8G("ngIf",g.isEmptyTodo),t.R7$(2),t.Y8G("ngIf",!g.isEmptyTodo))},dependencies:[Z.Sq,Z.bT,E.W9,E.eU,E.iq,E.he,E.BC,E.ai],styles:[".play_button[_ngcontent-%COMP%]{position:absolute;right:116px;top:16px;cursor:pointer}.add_button[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.FilterSwitchButton[_ngcontent-%COMP%]{padding:8px;border-radius:8px;font-size:16px;background-color:#8888;margin-right:8px;margin-bottom:8px;color:var(--default-text-color-direction)}"]}),v})()},{path:"add-todo-menu",loadChildren:()=>Promise.all([_.e(2076),_.e(8163)]).then(_.bind(_,8163)).then(r=>r.AddTodoMenuPageModule)}];let Ve=(()=>{var r;class v{}return(r=v).\u0275fac=function(c){return new(c||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[oe.iI.forChild(Re),oe.iI]}),v})(),De=(()=>{var r;class v{}return(r=v).\u0275fac=function(c){return new(c||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[Z.MD,pe.YN,E.bv,Ve]}),v})()}}]);