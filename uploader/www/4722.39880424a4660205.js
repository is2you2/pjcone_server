"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4722],{4722:(J,G,h)=>{h.r(G),h.d(G,{OthersProfilePageModule:()=>W});var D=h(177),R=h(4341),m=h(5374),O=h(9858),$=h(467),V=h(8326),e=h(3953),j=h(4237),U=h(8065),X=h(9900),N=h(4234),F=h(482),T=h(3656);function M(a,f){if(1&a){const i=e.RV6();e.j41(0,"td")(1,"ion-button",9),e.bIt("click",function(){e.eBV(i);const s=e.XpG(2);return e.Njj(s.DemoteUser())}),e.EFF(2),e.k0s()()}if(2&a){const i=e.XpG(2);e.R7$(2),e.SpI(" ",i.lang.text.OtherProfile.DemoteMember," ")}}function B(a,f){if(1&a){const i=e.RV6();e.j41(0,"td")(1,"ion-button",10),e.bIt("click",function(){e.eBV(i);const s=e.XpG(2);return e.Njj(s.PromoteUser())}),e.EFF(2),e.k0s()()}if(2&a){const i=e.XpG(2);e.R7$(2),e.SpI(" ",i.lang.text.OtherProfile.PromoteMember," ")}}function L(a,f){if(1&a){const i=e.RV6();e.j41(0,"td")(1,"ion-button",11),e.bIt("click",function(){e.eBV(i);const s=e.XpG(2);return e.Njj(s.notification_react(-5))}),e.EFF(2),e.k0s()()}if(2&a){const i=e.XpG(2);e.R7$(2),e.SpI(" ",i.lang.text.OtherProfile.add_to_group," ")}}function Z(a,f){if(1&a){const i=e.RV6();e.j41(0,"td")(1,"ion-button",12),e.bIt("click",function(){e.eBV(i);const s=e.XpG(2);return e.Njj(s.kick_user_from_group())}),e.EFF(2),e.k0s()()}if(2&a){const i=e.XpG(2);e.R7$(2),e.SpI(" ",i.lang.text.OtherProfile.kick_from_group," ")}}function A(a,f){if(1&a){const i=e.RV6();e.j41(0,"div",5)(1,"table",6)(2,"tr")(3,"td")(4,"ion-button",7),e.bIt("click",function(){e.eBV(i);const s=e.XpG();return e.Njj(s.create_chat())}),e.EFF(5),e.k0s()(),e.DNE(6,M,3,1,"td",8)(7,B,3,1,"td",8)(8,L,3,1,"td",8)(9,Z,3,1,"td",8),e.k0s()()()}if(2&a){const i=e.XpG();e.R7$(4),e.Y8G("disabled",i.lock_create_chat),e.R7$(),e.SpI(" ",i.lang.text.OtherProfile.privacy_chat," "),e.R7$(),e.Y8G("ngIf",(i.has_admin||i.nakama.PromotedGroup[i.isOfficial][i.target][i.group_info.id])&&1==i.info.state),e.R7$(),e.Y8G("ngIf",(i.has_admin||i.nakama.PromotedGroup[i.isOfficial][i.target][i.group_info.id])&&2==i.info.state),e.R7$(),e.Y8G("ngIf",(i.has_admin||i.nakama.PromotedGroup[i.isOfficial][i.target][i.group_info.id])&&3==i.info.state),e.R7$(),e.Y8G("ngIf",(i.has_admin||i.nakama.PromotedGroup[i.isOfficial][i.target][i.group_info.id])&&0!=i.info.state)}}const Y=[{path:"",component:(()=>{var a;class f{constructor(t,s,o,r,l,c,v,p){this.nakama=t,this.statusBar=s,this.p5toast=o,this.lang=r,this.global=l,this.route=c,this.router=v,this.navCtrl=p,this.info={},this.group_info={},this.additional_buttons={},this.has_admin=!1,this.isClickDisplayNameEdit=!1,this.lock_create_chat=!1}ngOnInit(){this.route.queryParams.subscribe(t=>{try{const s=this.router.getCurrentNavigation().extras.state;if(!s)return;this.info=s.info,this.has_admin=s.has_admin,this.group_info=s.group,this.isOfficial=this.group_info.server.isOfficial,this.target=this.group_info.server.target,this.nakama.load_other_user(this.info.user.id,this.isOfficial,this.target),this.nakama.socket_reactive["others-profile"]=o=>{this.p5ChangeImageSmooth(o)},this.nakama.socket_reactive["others-online"]=()=>{this.p5canvas.loop()},this.catch_user_noties()}catch(s){console.log("\ub2e4\ub978 \uc0ac\ub78c\uc758 \ud504\ub85c\ud544 \uc5f4\uae30 \uc2e4\ud328: ",s)}})}ionViewWillEnter(){this.p5canvas||(this.OtherCanvasDiv=document.getElementById("OtherUserCanvasDiv"),this.p5canvas=new V(t=>{let o,r,l,c,p,n,v=1,b="0, 0, 0",x=0,I=!1,d=t.createDiv();t.setup=()=>{let P=t.color(`#${(this.info.user.id.replace(/[^5-79a-b]/g,"")+"abcdef").substring(0,6)}`);b=`${t.red(P)}, ${t.green(P)}, ${t.blue(P)}`,p=t.createDiv(),p.style("width","100%"),p.style("height","100%"),p.style("position","fixed"),p.style("background-image",`linear-gradient(to top, rgba(${b}, 0), rgba(${b}, 0))`),p.parent(this.OtherCanvasDiv),t.noCanvas(),t.pixelDensity(1),n=t.createDiv(),n.style("width","156px"),n.style("height","156px"),n.style("position","absolute"),n.style("top","120px"),n.style("left","50%"),n.style("transform","translateX(-50%)"),n.style("border-radius","156px"),n.style("background-image","url(assets/data/avatar.svg)"),n.style("background-position","center"),n.style("background-repeat","no-repeat"),n.style("background-size","cover"),n.parent(this.OtherCanvasDiv);const E="36px";d.style("background-color",this.info.user.online?this.statusBar.colors.online:this.statusBar.colors.offline),d.style("width",E),d.style("height",E),d.style("position","absolute"),d.style("top","8px"),d.style("left","118px"),d.style("border-radius",E),d.style("z-index","1"),d.parent(n),l=t.createImg(this.info.user.img,"profile_img"),l.style("width","156px"),l.style("height","156px"),l.style("border-radius","156px"),l.style("position","absolute"),l.style("object-fit","cover"),this.info.user.img||l.hide(),l.parent(n),c=t.createImg(void 0,"before_img"),c.style("width","156px"),c.style("height","156px"),c.style("border-radius","156px"),c.style("position","absolute"),c.style("object-fit","cover"),c.hide(),c.parent(n),this.p5ChangeImageSmooth=k=>{n.style("background-image","url(assets/data/avatar.svg)"),k?(c.elt.src=void 0,c.hide()):(c.elt.src=l.elt.src,c.show()),l.elt.src=k,v=1,t.loop(),this.info.user.img=k,k?l.show():l.hide()};const S="36px";let g=t.createDiv();g.style("width","100%"),g.style("position","absolute"),g.style("top","330px"),g.style("display","flex"),g.style("flex-direction","column"),g.parent(this.OtherCanvasDiv);let C=this.nakama.GetOverrideName(this.info.user.id,this.isOfficial,this.target);o=t.createDiv(),o.style("font-size",S),o.style("font-weight","bold"),o.style("align-self","center"),o.style("width","80%"),o.style("text-align","center");let w=t.createSpan(C||this.info.user.display_name||this.lang.text.Profile.noname_user);w.parent(o),t.createSpan('<ion-icon name="pencil-outline" style="width: 24px; height: 24px; margin-left: 8px"></ion-icon>').parent(o),o.elt.onclick=()=>{I=!0,r.value(w.html()),r.attribute("placeholder",this.info.user.display_name||this.lang.text.Profile.noname_user),r.show(),o.hide(),r.elt.focus(),this.isClickDisplayNameEdit=!0},o.parent(g),r=t.createInput(),r.style("font-size",S),r.style("font-weight","bold"),r.style("align-self","center"),r.style("width","80%"),r.style("text-align","center"),r.attribute("placeholder",this.lang.text.Profile.name_placeholder),o.style("text-align","center"),r.parent(g),r.hide(),r.elt.addEventListener("focusout",()=>{I=!1;let k=`${r.value()}`;this.nakama.SaveOverrideName(this.info.user.id,k,this.isOfficial,this.target),k?_.removeAttribute("hidden"):_.attribute("hidden","true"),w.html(`${k||this.info.user.display_name||this.lang.text.Profile.noname_user}`),r.hide(),o.show()});let _=t.createDiv(this.info.user.display_name||this.lang.text.Profile.noname_user);_.style("color","var(--ion-color-medium)"),_.style("align-self","center"),_.style("margin-top","36px"),_.style("width","80%"),_.style("text-align","center"),C||_.attribute("hidden","true"),_.parent(g);let y=t.createDiv(this.info.user.id);y.style("color","var(--ion-color-medium)"),y.style("align-self","center"),y.style("margin-top","36px"),y.style("width","80%"),y.style("text-align","center"),y.style("cursor","copy"),y.parent(g),y.elt.onclick=()=>{this.copy_id()}},t.draw=()=>{v>0&&(v-=.025,c.style("opacity",`${v}`),l.style("opacity",""+(1-v))),this.info.user.online?this.lerpVal<1?this.lerpVal+=.025:this.lerpVal=1:this.lerpVal>0?this.lerpVal-=.025:this.lerpVal=0,x<1&&(x+=.025),l.style("filter",`grayscale(${t.lerp(.9,0,this.lerpVal)}) contrast(${t.lerp(1.4,1,this.lerpVal)})`),c.style("filter",`grayscale(${t.lerp(.9,0,this.lerpVal)}) contrast(${t.lerp(1.4,1,this.lerpVal)})`),p.style("background-image",`linear-gradient(to top, rgba(${b}, ${t.min(1,x)/2}), rgba(${b}, 0))`),v<=0&&(this.lerpVal>=1||this.lerpVal<=0)&&x>=1&&(this.info.user.img&&n.style("background-image",""),d.style("background-color",this.info.user.online?this.statusBar.colors.online:this.statusBar.colors.offline),t.noLoop())},t.keyPressed=P=>{"Enter"==P.code&&I&&r.elt.blur()}}))}ionViewDidEnter(){this.global.p5KeyShortCut.Escape=()=>{this.navCtrl.pop()}}catch_user_noties(){this.nakama.noti_origin[this.isOfficial]&&this.nakama.noti_origin[this.isOfficial][this.target]&&Object.keys(this.nakama.noti_origin[this.isOfficial][this.target]).forEach(o=>{this.nakama.noti_origin[this.isOfficial][this.target][o].sender_id==this.info.user.id&&(this.additional_buttons[this.nakama.noti_origin[this.isOfficial][this.target][o].code.toString()]=o)})}notification_react(t){switch(t){case 0:case-1:case-2:break;case-5:this.nakama.servers[this.isOfficial][this.target].client.addGroupUsers(this.nakama.servers[this.isOfficial][this.target].session,this.group_info.group_id||this.group_info.id,[this.info.user.id]).then(s=>{s||console.warn("\ubc34 \uc720\uc800\uc5d0 \ub300\ud55c\uac83 \uac19\uc74c, \ud655\uc778 \ud544\uc694"),this.p5toast.show({text:`${this.lang.text.OtherProfile.added_to_group}: ${this.info.user.display_name||this.lang.text.Profile.noname_user}`}),this.nakama.servers[this.isOfficial][this.target].client.deleteNotifications(this.nakama.servers[this.isOfficial][this.target].session,[this.additional_buttons[t.toString()]]).then(o=>{o||console.warn("\uc54c\ub9bc \ubd80\uc815 \uac80\ud1a0 \ud544\uc694"),delete this.additional_buttons[t.toString()],this.nakama.update_notifications(this.isOfficial,this.target),this.info.status="online",this.p5canvas.loop()})});break;default:console.warn("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \uc54c\ub9bc \ubc18\uc751: ",t)}}create_chat(){var t=this;return(0,$.A)(function*(){if(!t.lock_create_chat){t.lock_create_chat=!0;try{let s=yield t.nakama.join_chat_with_modulation(t.info.user.id,2,t.isOfficial,t.target,!0);t.nakama.go_to_chatroom_without_admob_act(s),t.lock_create_chat=!1,t.navCtrl.pop()}catch(s){t.lock_create_chat=!1,console.error(s)}}})()}PromoteUser(){var t=this;return(0,$.A)(function*(){try{yield t.nakama.servers[t.isOfficial][t.target].client.promoteGroupUsers(t.nakama.servers[t.isOfficial][t.target].session,t.group_info.id,[t.info.user.id]),t.p5toast.show({text:`${t.lang.text.OtherProfile.PromoteSucc}: ${t.info.user.display_name}`}),t.info.state=1}catch(s){t.p5toast.show({text:`${t.lang.text.OtherProfile.PromoteFailed}: ${s.statusText||s} (${s.status})`})}})()}DemoteUser(){var t=this;return(0,$.A)(function*(){try{yield t.nakama.servers[t.isOfficial][t.target].client.demoteGroupUsers(t.nakama.servers[t.isOfficial][t.target].session,t.group_info.id,[t.info.user.id]),t.p5toast.show({text:`${t.lang.text.OtherProfile.DemoteSucc}: ${t.info.user.display_name}`}),t.info.state=2}catch(s){t.p5toast.show({text:`${t.lang.text.OtherProfile.DemoteFailed}: ${s.statusText||s} (${s.status})`})}})()}kick_user_from_group(){switch(this.info.state){case 0:case 1:case 2:this.after_announce_kick();break;case 3:this.nakama.servers[this.isOfficial][this.target].client.deleteNotifications(this.nakama.servers[this.isOfficial][this.target].session,[this.additional_buttons[-5]]).then(t=>{t||console.warn("\uc54c\ub9bc \ubd80\uc815 \uac80\ud1a0 \ud544\uc694"),this.after_announce_kick(),delete this.additional_buttons[-5],this.nakama.update_notifications(this.isOfficial,this.target),this.info.status="missing",this.p5canvas.loop()});break;default:console.warn("\uc608\uc0c1\ud558\uc9c0 \ubabb\ud55c \uadf8\ub8f9 \uc0ac\uc6a9\uc790 \uc0c1\ud0dc: ",this.info)}}after_announce_kick(){this.nakama.servers[this.isOfficial][this.target].client.kickGroupUsers(this.nakama.servers[this.isOfficial][this.target].session,this.group_info.group_id||this.group_info.id,[this.info.user.id]).then(t=>{this.p5toast.show({text:`${this.lang.text.OtherProfile.kicked_from_group}: ${this.info.user.display_name||this.lang.text.Profile.noname_user}`}),this.navCtrl.pop()})}copy_id(){this.global.WriteValueToClipboard("text/plain",this.info.user.id)}ionViewWillLeave(){delete this.global.p5KeyShortCut.Escape}ngOnDestroy(){this.route.queryParams.unsubscribe(),delete this.nakama.socket_reactive["others-profile"],delete this.nakama.socket_reactive["others-online"],this.p5canvas.remove(),this.p5ChangeImageSmooth=null}}return(a=f).\u0275fac=function(t){return new(t||a)(e.rXU(j.X),e.rXU(U.j),e.rXU(X.G),e.rXU(N.y),e.rXU(F.z3),e.rXU(O.nX),e.rXU(O.Ix),e.rXU(T.q9))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-others-profile"]],decls:9,vars:2,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref",""],["id","OtherUserCanvasDiv",2,"position","absolute","width","100%","height","100%","display","flex"],["style","width: 100%; position: absolute; bottom: 0;",4,"ngIf"],[2,"width","100%","position","absolute","bottom","0"],["id","input_table",2,"width","100%","background-color","black"],["expand","block",3,"click","disabled"],[4,"ngIf"],["color","warning","expand","block",3,"click"],["color","tertiary","expand","block",3,"click"],["expand","block",3,"click"],["color","danger","expand","block",3,"click"]],template:function(t,s){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",1),e.nrm(5,"ion-back-button",2),e.k0s()()(),e.j41(6,"ion-content"),e.nrm(7,"div",3),e.DNE(8,A,10,6,"div",4),e.k0s()),2&t&&(e.R7$(3),e.JRh(s.lang.text.OtherProfile.Title),e.R7$(5),e.Y8G("ngIf","online"==s.statusBar.groupServer[s.isOfficial][s.target]))},dependencies:[D.bT,m.Jm,m.QW,m.W9,m.eU,m.BC,m.ai,m.el],styles:[".content_size[_ngcontent-%COMP%]{height:360px}"]}),f})()}];let z=(()=>{var a;class f{}return(a=f).\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[O.iI.forChild(Y),O.iI]}),f})(),W=(()=>{var a;class f{}return(a=f).\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[D.MD,R.YN,m.bv,z]}),f})()}}]);