"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[887],{887:(Ve,te,C)=>{C.r(te),C.d(te,{MainPageModule:()=>Ae});var J=C(177),fe=C(4341),E=C(5374),ie=C(9858),V=C(467),z=C(482),be=C(92),oe=C(8326),pe=C(617),i=C(3953),ye=C(4234),Ce=C(4237),ve=C(8065),Te=C(755);function je(c,v){1&c&&i.nrm(0,"ion-icon",12)}function Se(c,v){1&c&&i.nrm(0,"ion-icon",13)}function _e(c,v){1&c&&(i.j41(0,"div",14),i.EFF(1,"A"),i.k0s())}function Pe(c,v){if(1&c){const g=i.RV6();i.j41(0,"div")(1,"div",15),i.bIt("click",function(){i.eBV(g);const m=i.XpG();return i.Njj(m.nakama.open_add_todo_page())}),i.nrm(2,"ion-icon",16),i.j41(3,"div")(4,"ion-label",17),i.EFF(5),i.k0s()()()()}if(2&c){const g=i.XpG();i.R7$(5),i.JRh(g.lang.text.Main.NoTodo)}}function ke(c,v){1&c&&(i.j41(0,"div",22),i.EFF(1,"`"),i.k0s())}function xe(c,v){if(1&c&&(i.j41(0,"div",22),i.EFF(1),i.k0s()),2&c){const g=i.XpG().index;i.R7$(),i.JRh(g+1)}}function Fe(c,v){if(1&c){const g=i.RV6();i.j41(0,"button",19),i.bIt("click",function(){const m=i.eBV(g).$implicit,e=i.XpG(2);return i.Njj(e.ChangeFilterValue(m.value))}),i.DNE(1,xe,2,1,"div",20),i.EFF(2),i.k0s()}if(2&c){const g=v.$implicit,d=i.XpG(2);i.Aen("background-color: "+(g.color||"#8888")),i.R7$(),i.Y8G("ngIf",d.global.ShowHint),i.R7$(),i.SpI(" ",d.lang.text.TodoDetail[g.name]," ")}}function we(c,v){if(1&c){const g=i.RV6();i.j41(0,"div",18)(1,"button",19),i.bIt("click",function(){i.eBV(g);const m=i.XpG();return i.Njj(m.SwitchTargetFilter())}),i.DNE(2,ke,2,0,"div",20),i.EFF(3),i.k0s(),i.DNE(4,Fe,3,4,"button",21),i.k0s()}if(2&c){const g=i.XpG();i.R7$(2),i.Y8G("ngIf",g.global.ShowHint),i.R7$(),i.SpI(" ",g.lang.text.TodoDetail[g.TargetFilterDisplayName]," "),i.R7$(),i.Y8G("ngForOf",g.AllCategories[g.TargetFilterName])}}var y=function(c){return c[c.None=0]="None",c[c.Deadline=1]="Deadline",c[c.Importance=2]="Importance",c[c.Color=3]="Color",c[c.Creator=4]="Creator",c}(y||{});const Ee=[{path:"",component:(()=>{var c;class v{constructor(d,m,e,G,s,l){this.global=d,this.lang=m,this.nakama=e,this.statusBar=G,this.indexed=s,this.alertCtrl=l,this.isPlayingCanvas={loop:!0},this.TargetFilterDisplayName="FilterCat_0",this.TargetFilterName=0,this.AllCategories={},this.CurrentFilterValue=null,this.isEmptyTodo=!1}ngOnInit(){this.global.PortalBottonTabAct.Todo=()=>{this.ViewInitFunc&&this.ViewInitFunc()}}toggle_session(){this.nakama.toggle_all_session(),this.global.p5todo.redraw()}toggleCanvasPlaying(){this.isPlayingCanvas.loop=!this.isPlayingCanvas.loop,this.isPlayingCanvas.loop?this.global.p5todo.loop():this.global.p5todo.noLoop()}SwitchTargetFilter(d){switch(this.TargetFilterName=null!=d?d:(this.TargetFilterName+1)%5,this.TargetFilterName){case y.None:this.TargetFilterDisplayName="FilterCat_0";break;case y.Importance:this.TargetFilterDisplayName="Importance";break;case y.Color:this.TargetFilterDisplayName="CustomColor";break;case y.Deadline:this.TargetFilterDisplayName="Deadline";break;case y.Creator:this.TargetFilterDisplayName="FilterByCreator"}this.CurrentFilterValue=null,this.global.p5FilteringTodos&&this.global.p5FilteringTodos(y.None,this.TargetFilterDisplayName)}ChangeFilterValue(d){this.CurrentFilterValue=this.CurrentFilterValue==d?null:d,this.global.p5FilteringTodos()}CreateTodoManager(){var d=this;setTimeout(()=>{"DesktopPWA"!=be.aH&&this.toggleCanvasPlaying()},8e3);let m=document.getElementById("todo");this.global.p5todo&&this.global.p5todo.remove(),this.global.p5todo=new oe(e=>{let T,Z,U,ae,G=this.statusBar,s={},l=[],D=[],M=[],I=e.createVector(0,0),Q=e.createVector(0,0),f=e.createVector(0,0),b=1,P=e.createVector(0,0),X=this.nakama,se=this.indexed,x=[],_=!1,Y=this.isPlayingCanvas;e.setup=(0,V.A)(function*(){let r=e.createCanvas(m.clientWidth,m.clientHeight);r.parent(m),r.id("p5todo"),r.elt.oncontextmenu=function(){var a=(0,V.A)(function*(t){for(let n=0,h=l.length;n<h;n++)if("AddButton"!=s[l[n]].json.id&&s[l[n]].position.dist(w(t.offsetX,t.offsetY))<s[l[n]].EllipseSize/2){let A="";try{let S;try{S=`todo/${s[l[n]].json.id}_${s[l[n]].json.remote.isOfficial}_${s[l[n]].json.remote.target}/thumbnail.png`}catch{S=`todo/${s[l[n]].json.id}/thumbnail.png`}let O=yield se.loadBlobFromUserPath(S,"image/png"),me=URL.createObjectURL(O);A=`<div style="text-align: center"><img src="${me}" alt="todo_image" style="border-radius: 2px"></div>`,setTimeout(()=>{URL.revokeObjectURL(me)},100)}catch{}d.alertCtrl.create({header:s[l[n]].json.title,message:new pe.Vk(A+`<div>${s[l[n]].json.description||""}</div>`),buttons:[{text:d.lang.text.TodoDetail.TodoComplete,handler:function(){var S=(0,V.A)(function*(){try{yield X.doneTodo(s[l[n]].json)}catch{}});return function(){return S.apply(this,arguments)}}()},{text:d.lang.text.TodoDetail.remove,cssClass:"redfont",handler:function(){var S=(0,V.A)(function*(){try{yield X.deleteTodoFromStorage(!0,s[l[n]].json)}catch{}});return function(){return S.apply(this,arguments)}}()}]}).then(S=>{ue(),S.onDidDismiss().then(()=>{_=!1}),_=!0,S.present()});break}});return function(t){return a.apply(this,arguments)}}(),e.smooth(),e.noStroke(),e.pixelDensity(1),e.ellipseMode(e.CENTER),e.rectMode(e.CENTER),e.textAlign(e.CENTER,e.CENTER),e.textSize(20),e.textLeading(28),e.textWrap(e.CHAR),e.imageMode(e.CENTER);let o=Number(localStorage.getItem("p5todoScale")||1);Re(),d.ViewInitFunc=q,b=o,localStorage.setItem("p5todoScale",`${b}`),d.global.p5todoStopCanvas=()=>{_=!0,e.noLoop()},d.global.p5todoPlayCanvas=()=>{_=!1,e.windowResized(),d.isPlayingCanvas.loop&&e.loop()},d.global.p5todoAddtodo=a=>{let t=JSON.parse(a),n=t.id;if(t.remote&&(n+=`_${t.remote.isOfficial}_${t.remote.target}`),!t.removed){if(t.done){for(let h=0,u=l.length;h<u;h++)if(l[h]==n)return void s[l[h]].makeDone()}else s[n]?(s[n].json=t,s[n].initialize()):s[n]=new re(t);d.isPlayingCanvas.loop||(Z=s[n],e.loop()),U()}},U=()=>{l=Object.keys(s),d.isEmptyTodo=!l.length,d.isEmptyTodo||(s.AddButton?1==l.length&&s.AddButton.makeDone():(s.AddButton=new re("",!0),l=Object.keys(s)))},d.global.p5removeTodo=a=>{let t=JSON.parse(a),n=t.id;t.remote&&(n+=`_${t.remote.isOfficial}_${t.remote.target}`);for(let h=0,u=l.length;h<u;h++)if(l[h]==n){s[l[h]].RemoveTodo();break}d.isEmptyTodo=!Object.keys(l).length,U(),e.redraw()},ae=function(){var a=(0,V.A)(function*(){s={},l.length=0;let t=yield d.indexed.GetFileListFromDB("todo/");for(let n=0,h=t.length;n<h;n++)if(t[n].indexOf("/info.todo")>=0){let u=yield d.indexed.loadTextFromUserPath(t[n]);d.global.p5todoAddtodo(u)}d.isEmptyTodo=!Object.keys(l).length});return function(){return a.apply(this,arguments)}}(),ae(),d.SwitchTargetFilter(d.TargetFilterName),d.AllCategories[y.None]=[],d.AllCategories[y.Importance]=[{name:"Importance_0",color:"#58a19288",value:"0"},{name:"Importance_1",color:"#ddbb4188",value:"1"},{name:"Importance_2",color:"#b9543788",value:"2"}],d.AllCategories[y.Color]=[{name:"ColorFilterRed",color:"#ff000088",value:[-30,30]},{name:"ColorFilterYellow",color:"#ffff0088",value:[30,90]},{name:"ColorFilterGreen",color:"#00ff0088",value:[90,150]},{name:"ColorFilterCyan",color:"#00ffff88",value:[150,210]},{name:"ColorFilterBlue",color:"#0000ff88",value:[210,270]},{name:"ColorFilterMagenta",color:"#ff00ff88",value:[270,330]}],d.AllCategories[y.Deadline]=[{name:"TimeBefore",color:"#bbbbbb88",value:"before"},{name:"TimeIn",color:"#00ff0088",value:"ontime"},{name:"TimeOut",color:"#b9543788",value:"after"},{name:"Yesterday",color:"#45678988",value:"yesterday"},{name:"Today",color:"#789abc88",value:"today"},{name:"Tomorrow",color:"#abcdef88",value:"tomorrow"}],d.AllCategories[y.Creator]=[{name:"CreatorLocal",color:"#bbbbbb88",value:"local"},{name:"CreatorMe",color:"#00ff0088",value:"server"},{name:"Requested",color:"#6789ab88",value:"worker"},{name:"CreatorOther",color:"#ba987688",value:"other"}],d.global.p5FilteringTodos=W});let ne,W=(r,o)=>{switch(o&&(ne=o),null!=r?r:this.TargetFilterName){case y.None:for(let t=0,n=l.length;t<n;t++)s[l[t]].isHidden=!1;break;case y.Importance:if(this.CurrentFilterValue)for(let t=0,n=l.length;t<n;t++)s[l[t]].isHidden="AddButton"!=s[l[t]].json.id&&s[l[t]].json.importance!=this.CurrentFilterValue;else W(y.None);break;case y.Color:for(let t=0,n=l.length;t<n;t++){let h;e.push(),e.colorMode(e.HSB);try{h=e.color(s[l[t]].json.custom_color)}catch{}if(!h)switch(s[l[t]].json.importance){case"0":h=e.color("#58a192");break;case"1":h=e.color("#ddbb41");break;case"2":h=e.color("#b95437")}if(e.pop(),this.CurrentFilterValue){if(h){let u=(360+this.CurrentFilterValue[0])%360,A=(360+this.CurrentFilterValue[1])%360,R=e.hue(h);s[l[t]].isHidden=u<A?!(u<R&&R<A):A<R&&R<u}}else s[l[t]].isHidden=!1}break;case y.Deadline:if(this.CurrentFilterValue)for(let t=0,n=l.length;t<n;t++)if("AddButton"==s[l[t]].json.id)s[l[t]].isHidden=!1;else switch(this.CurrentFilterValue){case"before":s[l[t]].isHidden=!(s[l[t]].json.startFrom&&s[l[t]].json.startFrom>Date.now());break;case"ontime":s[l[t]].isHidden=!((s[l[t]].json.startFrom||0)<Date.now()&&(s[l[t]].json.limit||s[l[t]].json.written)>Date.now());break;case"after":s[l[t]].isHidden=!(s[l[t]].json.limit<=Date.now());break;case"yesterday":{const h=new Date;h.setDate(h.getDate()-1),h.setHours(0,0,0,0);const u=new Date;u.setDate(u.getDate()-1),u.setHours(23,59,59,999),s[l[t]].isHidden=!(s[l[t]].json.limit>h&&s[l[t]].json.limit<=u)}break;case"today":{const h=new Date;h.setHours(0,0,0,0);const u=new Date;u.setHours(23,59,59,999),s[l[t]].isHidden=!(s[l[t]].json.limit>h&&s[l[t]].json.limit<=u)}break;case"tomorrow":{const h=new Date;h.setDate(h.getDate()+1),h.setHours(0,0,0,0);const u=new Date;u.setDate(u.getDate()+1),u.setHours(23,59,59,999),s[l[t]].isHidden=!(s[l[t]].json.limit>h&&s[l[t]].json.limit<=u)}}else W(y.None);break;case y.Creator:if(this.CurrentFilterValue)for(let t=0,n=l.length;t<n;t++)if("AddButton"==s[l[t]].json.id)s[l[t]].isHidden=!1;else switch(this.CurrentFilterValue){case"local":s[l[t]].isHidden=s[l[t]].json.storeAt!=this.CurrentFilterValue;break;case"server":s[l[t]].isHidden=void 0===s[l[t]].json.remote;break;case"worker":s[l[t]].isHidden=!(void 0!==s[l[t]].json.workers&&s[l[t]].json.is_me);break;case"other":s[l[t]].isHidden=s[l[t]].json.is_me||"local"==s[l[t]].json.storeAt}else W(y.None)}e.redraw()},Re=()=>{P.x=e.width/2,P.y=e.height/2,f.x=0,f.y=0,b=1,localStorage.setItem("p5todoScale",`${b}`),this.isPlayingCanvas.loop||e.redraw()},p={Act:!1,lerp:0,Scale:e.createVector(),CamPos:e.createVector(),CamScale:0},q=()=>{p.Act=!0,p.Scale.x=P.x,p.Scale.y=P.y,p.CamPos.x=f.x,p.CamPos.y=f.y,p.CamScale=b,this.isPlayingCanvas.loop||e.loop()};e.draw=()=>{e.clear(255,255,255,255),e.push(),e.translate(P),e.scale(b),e.translate(f);for(let r=0,o=l.length;r<o;r++)s[l[r]].display();for(let r=M.length-1;r>=0;r--)M[r].display(),M[r].lifeTime<0&&M.splice(r,1);for(let r=D.length-1;r>=0;r--)D[r].DoneAnim();e.pop(),this.isPlayingCanvas.loop&&(Q.x=40*-e.accelerationX,Q.y=40*e.accelerationY),p.Act&&(p.lerp+=.07,P.x=e.lerp(p.Scale.x,e.width/2,$(p.lerp)),P.y=e.lerp(p.Scale.y,e.height/2,$(p.lerp)),f.x=e.lerp(p.CamPos.x,0,$(p.lerp)),f.y=e.lerp(p.CamPos.y,0,$(p.lerp)),b=e.lerp(p.CamScale,1,$(p.lerp)),localStorage.setItem("p5todoScale",`${b}`),p.lerp>=1&&(p.Act=!1,p.lerp=0,P.x=e.width/2,P.y=e.height/2,f.x=0,f.y=0,b=1,localStorage.setItem("p5todoScale",`${b}`),this.isPlayingCanvas.loop||e.noLoop()))};let $=r=>e.sin(r*e.PI/2);e.windowResized=()=>{_||setTimeout(()=>{let r=f.x/e.width,o=f.y/e.height;e.resizeCanvas(m.clientWidth,m.clientHeight),P.x=e.width/2,P.y=e.height/2,f.x=r*e.width,f.y=o*e.height},50)};let B=!0;class re{constructor(o,a=!1){this.isAddButton=!1,this.EllipseSize=96,this.Velocity=e.createVector(0,0),this.Accel=e.createVector(0,0),this.isGrabbed=!1,this.TextColor=e.color(z.ud?255:0),this.ProgressWeight=8,this.LerpProgress=0,this.isHidden=!1,this.LifeTime=1,this.json=o;let t=e.max(e.width,e.height)||1,n=e.createVector(t/e.min(1,b),0).setHeading(e.random(-e.PI,e.PI));if(a)return this.isAddButton=a,this.position=I.copy(),this.defaultColor=e.color(z.ud?"#bbb":"#888"),void(this.json={id:"AddButton",written:0,limit:1,longSide:53,shortSide:11});this.position=n,this.initialize()}initialize(){if(!this.json.custom_color)switch(this.json.importance){case"0":this.defaultColor=e.color("#58a192");break;case"1":this.defaultColor=e.color("#ddbb41");break;case"2":this.defaultColor=e.color("#b95437")}let a,o=Number(this.json.importance);switch(o){case 0:this.EllipseSize=96;break;case 1:this.EllipseSize=104;break;case 2:this.EllipseSize=112}if(!x[o]){x[o]=e.createImage(this.EllipseSize,this.EllipseSize),x[o].loadPixels();let t=e.createVector(x[o].width/2,x[o].height/2);for(let n=0,h=x[o].height;n<h;n++)for(let u=0,A=x[o].width;u<A;u++){let R=e.createVector(u,n);t.dist(R)<this.EllipseSize/2-1&&x[o].set(u,n,e.color(255,80))}x[o].updatePixels()}try{a=`todo/${this.json.id}_${this.json.remote.isOfficial}_${this.json.remote.target}/thumbnail.png`}catch{a=`todo/${this.json.id}/thumbnail.png`}se.loadBlobFromUserPath(a,"").then(t=>{let n=URL.createObjectURL(t);e.loadImage(n,h=>{this.ThumbnailImage=h,this.ThumbnailImage.mask(x[o]),URL.revokeObjectURL(n)})}).catch(t=>{this.ThumbnailImage=null})}display(){if(e.push(),this.isGrabbed||(this.CalcPosition(),this.OnCollider(),this.position=this.position.add(this.Velocity)),e.translate(this.position),this.LerpProgress=e.map(Date.now(),this.json.startFrom||this.json.written,this.json.limit,0,1,!0),(this.isAddButton||this.json.written>this.json.limit)&&(this.LerpProgress=1),this.isHidden?e.fill(128,40):e.fill("FilterByCreator"==ne&&this.json.remote?G.colors[G.groupServer[this.json.remote.isOfficial][this.json.remote.target]||"offline"]+e.hex(e.floor(e.lerp(34,96,this.LerpProgress)),2):(this.json.custom_color||this.defaultColor.toString("#rrggbb"))+e.hex(e.floor(e.lerp(34,96,this.LerpProgress)),2)),e.ellipse(0,0,this.EllipseSize,this.EllipseSize),!this.isHidden&&this.ThumbnailImage&&e.image(this.ThumbnailImage,0,0,this.EllipseSize,this.EllipseSize),e.push(),!this.isHidden){e.noFill(),this.isAddButton?(e.push(),e.noStroke(),e.fill(255),e.rect(0,0,this.json.shortSide,this.json.longSide),e.rect(0,0,this.json.longSide,this.json.shortSide),e.pop()):(e.stroke(this.json.custom_color||this.defaultColor),e.strokeWeight(this.ProgressWeight)),e.rotate(-e.PI/2);let o=this.EllipseSize-this.ProgressWeight;this.LerpProgress<1?e.arc(0,0,o,o,0,this.LerpProgress*e.TWO_PI):e.circle(0,0,o)}if(e.pop(),!this.isHidden){let o=.9*this.EllipseSize;this.TextColor=e.color(z.ud?255:0,0==this.LerpProgress?128:255),e.fill(this.TextColor),e.text(this.json.title,0,0,o,o)}e.pop()}CalcPosition(){let o=this.position.dist(I),a=e.map(o,0,this.EllipseSize/8,0,1,!0),t=e.map(a,this.EllipseSize/4,0,1,.95,!0);this.Accel.x=a,this.Accel.y=0;let n=this.position.copy().sub(Q).heading()-e.PI;this.Accel=this.Accel.setHeading(n),this.Velocity.add(this.Accel).mult(t)}OnCollider(){for(let o=0,a=l.length;o<a;o++)if(s[l[o]]!=this){let t=s[l[o]],n=this.position.dist(t.position),h=this.EllipseSize/2+t.EllipseSize/2;n<h&&(Y.loop||Z==this&&(Z=null,e.noLoop()),this.ReflectBounce(t,n/h),t.ReflectBounce(this,n/h))}}ReflectBounce(o,a){let t=oe.Vector.sub(this.position,o.position);this.Velocity.add(t.mult(1-a)).mult(.85)}makeDone(){var o=this;return(0,V.A)(function*(){o.LifeTime=1,yield new Promise(a=>setTimeout(a,500)),o.Velocity=I.copy(),o.Accel=I.copy(),o.OriginalEllipseSize=o.EllipseSize,o.OriginalProgWeight=o.ProgressWeight,o.json.done=!0,D.push(o),Y.loop||e.loop()})()}DoneAnim(){var o=this;return(0,V.A)(function*(){if(Y.loop||e.loop(),o.LifeTime-=.04,o.EllipseSize=o.OriginalEllipseSize*o.LifeTime,o.ProgressWeight=o.OriginalProgWeight*o.LifeTime,o.LifeTime<.5&&M.push(new ce(o.position,o.json.custom_color||o.defaultColor)),o.TextColor=e.color(z.ud?255:0,(0==o.LerpProgress?128:255)*o.LifeTime),o.isAddButton&&(o.json.longSide*=o.LifeTime,o.json.shortSide*=o.LifeTime),o.LifeTime<0){Y.loop||setTimeout(()=>e.noLoop(),1e3),o.RemoveTodo(),U();for(let a=0;a<20;a++)M.push(new ce(o.position,o.json.custom_color||o.defaultColor))}})()}Clicked(){B&&!_&&!this.json.done&&(this.isAddButton?X.open_add_todo_page():X.open_add_todo_page(JSON.stringify(this.json)))}RemoveTodo(){let o=this.json.id;this.json.remote&&(o+=`_${this.json.remote.isOfficial}_${this.json.remote.target}`);for(let a=0,t=l.length;a<t;a++)if(l[a]==o){l.splice(a,1);break}for(let a=0,t=D.length;a<t;a++)if(D[a]=this){D.splice(a,1);break}delete s[o]}}class ce{constructor(o,a){this.RectSize=4,this.rotate=0,this.pos=o.copy(),e.randomSeed(e.random(-255,255)),this.lifeTime=e.random(180,255),this.vel=e.createVector(e.random(-75,75),e.random(-40,-80)),this.acc=e.createVector(0,e.random(-1,-3)),e.push(),e.colorMode(e.HSB);let t=e.hue(a),n=e.saturation(a),h=e.brightness(a);this.color=e.color(e.random(t-20,t+20),e.random(n-20,n+20),e.random(h-20,h+20),this.lifeTime/255),e.pop(),this.RectSize=e.random(3,4),this.rotate=e.random(-e.PI,e.PI)}display(){this.color.setAlpha(this.lifeTime/255),e.fill(this.color),this.CalcPhysics(),e.push(),e.translate(this.pos),e.rotate(this.rotate),e.rect(0,0,this.RectSize,this.RectSize),e.pop(),this.lifeTime--}CalcPhysics(){this.acc.y+=.07,this.vel.add(this.acc),this.pos.add(this.vel.copy().div(100))}}let K,k,de,F,ee=0;e.mousePressed=r=>{let o=r.target==document.getElementById("p5todo");if(!_&&o)switch(B=!0,r.which){case 1:k=e.createVector(e.mouseX,e.mouseY),F=f.copy(),K=e.createVector(e.mouseX,e.mouseY);for(let a=0,t=l.length;a<t;a++)if(s[l[a]].position.dist(w())<s[l[a]].EllipseSize/2){s[l[a]].isGrabbed=!0,T=s[l[a]],k=w();break}break;case 2:q()}},e.mouseDragged=r=>{let o=r.target==document.getElementById("p5todo");if(!_&&o&&1===(this.isPlayingCanvas.loop||e.redraw(),r.which))try{K=e.createVector(e.mouseX,e.mouseY);let a=0;T?(T.position=w(),a=k.dist(w())):(f=F.copy().add(K.sub(k).div(b)),a=F.dist(f)),a>15&&(B=!1)}catch{}},e.mouseReleased=r=>{let o=r.target==document.getElementById("p5todo");!_&&o&&1===r.which&&(K=null,ge())};let w=(r,o)=>{let a=e.createVector(r||e.mouseX,o||e.mouseY);return a.sub(P),a.div(b),a.sub(f),a};e.mouseWheel=r=>{let o=r.target==document.getElementById("p5todo");!_&&o&&(this.isPlayingCanvas.loop||e.redraw(),b*=r.deltaY<0?1.1:.9,localStorage.setItem("p5todoScale",`${b}`))};let j=[],N=!1;const H=56;e.touchStarted=r=>{let o=r.target==document.getElementById("p5todo");if(!_&&o)switch(B=!0,j=r.touches,N=!0,j.length){case 1:he();break;case 2:let a=e.createVector(j[0].clientX,j[0].clientY-H),t=e.createVector(j[1].clientX,j[1].clientY-H);B=!1,ee=a.dist(t),k=a.copy().add(t).div(2),F=f.copy(),de=b,T&&(T.isGrabbed=!1,T.Velocity=I.copy(),T.Accel=I.copy(),T=null);break;default:N=!1,q()}},e.touchMoved=r=>{let o=r.target==document.getElementById("p5todo");if(!_&&o){switch(this.isPlayingCanvas.loop||e.redraw(),j=r.touches,j.length){case 1:{if(!N)return;let a=r.changedTouches[0],t=e.createVector(a.clientX,a.clientY-H),n=0;T?(T.position=w(),n=k.dist(w(t.x,t.y))):(f=F.copy().add(t.sub(k).div(b)),n=F.dist(f)),n>15&&(B=!1)}break;case 2:{if(!N)return;let a=e.createVector(j[0].clientX,j[0].clientY-H),t=e.createVector(j[1].clientX,j[1].clientY-H),n=a.copy().add(t).div(2);b=a.dist(t)/ee*de,localStorage.setItem("p5todoScale",`${b}`),f=F.copy().add(n.sub(k).div(b))}}return!1}},e.touchEnded=r=>{let o=r.target==document.getElementById("p5todo");if(!_&&o)switch(j=r.touches,j.length){case 0:ge(),N=!1;break;case 1:if(!N)return;he(),ee=0}};let he=()=>{k=e.createVector(j[0].clientX,j[0].clientY-H),F=f.copy();for(let r=0,o=l.length;r<o;r++)if(s[l[r]].position.dist(w(k.x,k.y))<s[l[r]].EllipseSize/2){s[l[r]].isGrabbed=!0,T=s[l[r]];break}},ue=()=>{T&&(T.isGrabbed=!1,T.Velocity=I.copy(),T.Accel=I.copy(),T=null)},ge=()=>{ue(),k=null;try{if(F.dist(f)<15)for(let o=0,a=l.length;o<a;o++)if(s[l[o]].position.dist(w())<s[l[o]].EllipseSize/2){s[l[o]].Clicked();break}}catch{}}})}ionViewDidEnter(){document.getElementById("p5todo")?this.global.p5todoPlayCanvas():this.CreateTodoManager(),this.try_add_shortcut()}try_add_shortcut(){this.global.p5KeyShortCut?(this.global.p5KeyShortCut.AddAct=()=>{this.nakama.open_add_todo_page()},this.global.p5KeyShortCut.Backquote=()=>{this.SwitchTargetFilter()},this.global.p5KeyShortCut.Digit=d=>{this.AllCategories[this.TargetFilterName].length>d&&this.ChangeFilterValue(this.AllCategories[this.TargetFilterName][d].value)}):setTimeout(()=>{this.try_add_shortcut()},100)}ionViewWillLeave(){this.global.p5todoStopCanvas&&this.global.p5todoStopCanvas(),this.global.p5KeyShortCut&&(delete this.global.p5KeyShortCut.AddAct,delete this.global.p5KeyShortCut.Backquote,delete this.global.p5KeyShortCut.Digit)}}return(c=v).\u0275fac=function(d){return new(d||c)(i.rXU(z.z3),i.rXU(ye.y),i.rXU(Ce.X),i.rXU(ve.j),i.rXU(Te.n),i.rXU(E.hG))},c.\u0275cmp=i.VBU({type:c,selectors:[["app-main"]],decls:15,vars:8,consts:[[1,"ion-no-border"],[1,"play_button",3,"click"],["button","","style","width: 24px; height: 24px;","name","play-circle",4,"ngIf"],["button","","style","width: 24px; height: 24px;","name","pause-circle",4,"ngIf"],[1,"add_button",3,"click"],["class","shortcut_hint shortcut_top_add",4,"ngIf"],["button","","name","add-circle-outline",2,"width","24px","height","24px"],[1,"header_online_circle",3,"click"],["oncontextmenu","return false;"],[4,"ngIf"],["id","todo",1,"full_screen",2,"overflow","hidden"],["style","position: absolute; top: 16px; left: 16px;",4,"ngIf"],["button","","name","play-circle",2,"width","24px","height","24px"],["button","","name","pause-circle",2,"width","24px","height","24px"],[1,"shortcut_hint","shortcut_top_add"],[1,"disconnect_info",3,"click"],["color","medium","name","create-outline",2,"width","60px","height","60px"],["color","medium"],[2,"position","absolute","top","16px","left","16px"],[1,"FilterSwitchButton",3,"click"],["class","shortcut_hint shortcut_todo_categories",4,"ngIf"],["class","FilterSwitchButton",3,"style","click",4,"ngFor","ngForOf"],[1,"shortcut_hint","shortcut_todo_categories"]],template:function(d,m){1&d&&(i.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),i.EFF(3),i.k0s(),i.j41(4,"div",1),i.bIt("click",function(){return m.toggleCanvasPlaying()}),i.DNE(5,je,1,0,"ion-icon",2)(6,Se,1,0,"ion-icon",3),i.k0s(),i.j41(7,"div",4),i.bIt("click",function(){return m.nakama.open_add_todo_page()}),i.DNE(8,_e,2,0,"div",5),i.nrm(9,"ion-icon",6),i.k0s(),i.j41(10,"div",7),i.bIt("click",function(){return m.toggle_session()}),i.k0s()()(),i.j41(11,"ion-content",8),i.DNE(12,Pe,6,1,"div",9),i.j41(13,"div",10),i.DNE(14,we,5,3,"div",11),i.k0s()()),2&d&&(i.R7$(3),i.JRh(m.lang.text.Main.Title),i.R7$(2),i.Y8G("ngIf",!m.isPlayingCanvas.loop),i.R7$(),i.Y8G("ngIf",m.isPlayingCanvas.loop),i.R7$(2),i.Y8G("ngIf",m.global.ShowHint),i.R7$(2),i.Aen("background-color: "+m.statusBar.colors[m.statusBar.settings.groupServer]+"; cursor: pointer;"),i.R7$(2),i.Y8G("ngIf",m.isEmptyTodo),i.R7$(2),i.Y8G("ngIf",!m.isEmptyTodo))},dependencies:[J.Sq,J.bT,E.W9,E.eU,E.iq,E.he,E.BC,E.ai],styles:[".play_button[_ngcontent-%COMP%]{position:absolute;right:116px;top:16px;cursor:pointer}.add_button[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.FilterSwitchButton[_ngcontent-%COMP%]{padding:8px;border-radius:8px;font-size:16px;background-color:#8888;margin-right:8px;margin-bottom:8px;color:var(--default-text-color-direction)}"]}),v})()},{path:"add-todo-menu",loadChildren:()=>C.e(8163).then(C.bind(C,8163)).then(c=>c.AddTodoMenuPageModule)}];let Ie=(()=>{var c;class v{}return(c=v).\u0275fac=function(d){return new(d||c)},c.\u0275mod=i.$C({type:c}),c.\u0275inj=i.G2t({imports:[ie.iI.forChild(Ee),ie.iI]}),v})(),Ae=(()=>{var c;class v{}return(c=v).\u0275fac=function(d){return new(d||c)},c.\u0275mod=i.$C({type:c}),c.\u0275inj=i.G2t({imports:[J.MD,fe.YN,E.bv,Ie]}),v})()}}]);