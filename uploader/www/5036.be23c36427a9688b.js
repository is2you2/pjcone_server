"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5036],{5036:(N,C,l)=>{l.r(C),l.d(C,{CommunityPageModule:()=>A});var g=l(177),k=l(4341),d=l(5374),v=l(9858),p=l(467),t=l(3953),P=l(8065),x=l(4237),S=l(4234),b=l(482),M=l(3656);function O(o,r){1&o&&(t.j41(0,"div",9),t.EFF(1,"A"),t.k0s())}function I(o,r){if(1&o&&(t.j41(0,"div",21),t.EFF(1),t.k0s()),2&o){const e=t.XpG().index;t.R7$(),t.JRh((e+1)%10)}}function R(o,r){if(1&o&&t.nrm(0,"img",22),2&o){const e=t.XpG().$implicit;t.Aen(e.isNSFW?"filter: blur(16px);":""),t.Y8G("src",e.mainImage.thumbnail,t.B4B)}}function T(o,r){if(1&o&&(t.j41(0,"span",23),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit,n=t.XpG(2);t.R7$(),t.SpI(" ","("+(e.server?e.server.name||e.server.target:n.lang.text.AddGroup.UseLocalStorage)+")"," ")}}function j(o,r){1&o&&t.nrm(0,"ion-icon",24)}function D(o,r){if(1&o){const e=t.RV6();t.j41(0,"ion-card",12),t.bIt("click",function(){const i=t.eBV(e),a=i.$implicit,s=i.index,_=t.XpG(2);return t.Njj(_.nakama.open_post(a,s))})("contextmenu",function(){const i=t.eBV(e).index,a=t.XpG(2);return t.Njj(a.PostContextMenu(i))}),t.DNE(1,I,2,1,"div",13),t.j41(2,"div",14),t.DNE(3,R,1,3,"img",15),t.k0s(),t.j41(4,"ion-card-header")(5,"ion-card-subtitle",16)(6,"span"),t.EFF(7),t.k0s(),t.DNE(8,T,2,1,"span",17),t.k0s(),t.j41(9,"ion-card-title",18),t.DNE(10,j,1,0,"ion-icon",19),t.EFF(11),t.k0s()(),t.j41(12,"ion-card-content",20),t.EFF(13),t.k0s()()}if(2&o){const e=r.$implicit,n=r.index,i=t.XpG(2);t.R7$(),t.Y8G("ngIf",i.global.ShowHint&&n<10),t.R7$(2),t.Y8G("ngIf",e.mainImage),t.R7$(3),t.Aen("color: #"+e.UserColor),t.R7$(),t.SpI(" ",i.nakama.usernameOverride[e.server.isOfficial]&&i.nakama.usernameOverride[e.server.isOfficial][e.server.target]&&i.nakama.usernameOverride[e.server.isOfficial][e.server.target][e.creator_id]||e.creator_name," "),t.R7$(),t.Y8G("ngIf",i.nakama.showServer),t.R7$(2),t.Y8G("ngIf",e.OutSource),t.R7$(),t.SpI(" ",e.title,""),t.R7$(2),t.SpI(" ",e.content," ")}}function G(o,r){if(1&o&&(t.j41(0,"div",10),t.DNE(1,D,14,9,"ion-card",11),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.nakama.posts)}}function $(o,r){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"div",25),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.add_post())}),t.nrm(2,"ion-icon",26),t.j41(3,"div")(4,"ion-label",27),t.EFF(5),t.k0s()()()()}if(2&o){const e=t.XpG();t.R7$(5),t.JRh(e.lang.text.Community.NoPosts)}}const F=[{path:"",component:(()=>{var o;class r{constructor(n,i,a,s,_,c){this.statusBar=n,this.nakama=i,this.lang=a,this.global=s,this.navCtrl=_,this.alertCtrl=c,this.is_loadable=!0,this.is_auto_load_end=!1}ngOnInit(){this.nakama.CommunityGoToEditPost=this.add_post,this.global.PortalBottonTabAct.Community=()=>{this.ContentScroll&&(this.ContentScroll.scrollTop=0)}}add_post(n){this.global.RemoveAllModals(()=>{this.navCtrl.navigateForward("portal/community/add-post",{state:{data:n,act:!0}})})}ionViewDidEnter(){var n=this;return(0,p.A)(function*(){n.try_add_shortcut(),n.is_loadable=!0,yield n.nakama.load_posts_counter(),n.nakama.has_new_post=!1,yield n.load_post_cycles(),n.is_auto_load_end=!0,n.ContentDiv&&n.ContentScroll&&n.ContentDiv.clientHeight-(n.ContentScroll.scrollTop+n.ContentScroll.clientHeight)<450&&n.load_post_cycles(),n.nakama.socket_reactive.try_load_post=()=>{setTimeout(()=>{n.ContentDiv&&n.ContentScroll&&n.ContentDiv.clientHeight-(n.ContentScroll.scrollTop+n.ContentScroll.clientHeight)<450&&n.load_post_cycles()},0)}})()}load_post_cycles(){var n=this;return(0,p.A)(function*(){n.is_loadable&&(yield n.load_posts()),setTimeout(()=>{try{n.ContentDiv||(n.ContentDiv=document.getElementById("CommunityMainContent")),n.ContentScroll||(n.ContentScroll=document.getElementById("CommunityScrollDiv")),n.ContentScroll.onscroll||(n.ContentScroll.onscroll=i=>{n.ContentDiv.clientHeight-(n.ContentScroll.scrollTop+n.ContentScroll.clientHeight)<450&&n.load_post_cycles()}),n.is_loadable&&n.ContentDiv.clientHeight-(n.ContentScroll.scrollTop+n.ContentScroll.clientHeight)<450&&n.load_post_cycles()}catch(i){console.log("\uac8c\uc2dc\ubb3c \uc2a4\ud06c\ub864 \ud589\ub3d9 \uc0dd\uc131 \uc624\ub958: ",i)}},100)})()}PostContextMenu(n){try{(this.nakama.posts[n].server.local||this.nakama.posts[n].creator_id==this.nakama.servers[this.nakama.posts[n].server.isOfficial][this.nakama.posts[n].server.target].session.user_id)&&this.alertCtrl.create({header:this.nakama.posts[n].title,message:this.nakama.posts[n].content,buttons:[{text:this.lang.text.ChatRoom.EditChat,handler:()=>{this.nakama.EditPost(this.nakama.posts[n])}},{text:this.lang.text.ChatRoom.Delete,handler:()=>{this.nakama.RemovePost(this.nakama.posts[n])},cssClass:"redfont"}]}).then(i=>i.present())}catch{}return!1}try_add_shortcut(){this.global.p5KeyShortCut?this.AddShortcut():setTimeout(()=>{this.try_add_shortcut()},100)}load_posts(){var n=this;return(0,p.A)(function*(){let i=!1,a=Object.keys(n.nakama.post_counter);for(let s=0,_=a.length;s<_;s++){let c=Object.keys(n.nakama.post_counter[a[s]]);for(let m=0,f=c.length;m<f;m++){let u=Object.keys(n.nakama.post_counter[a[s]][c[m]]);for(let h=0,w=u.length;h<w;h++){let y="me"==u[h];try{"me"!=u[h]&&(y=u[h]==n.nakama.servers[a[s]][c[m]].session.user_id)}catch{}let X=n.nakama.post_counter[a[s]][c[m]][u[h]];yield n.load_post_step_by_step(X,a[s],c[m],u[h],y),!i&&n.nakama.post_counter[a[s]][c[m]][u[h]]>=0&&(i=!0)}}}n.is_loadable=i,n.nakama.rearrange_posts()})()}load_post_step_by_step(n,i,a,s,_){var c=this;return(0,p.A)(function*(){if(n<0)return;let m=yield c.nakama.load_local_post_with_id(`LocalPost_${n}`,i,a,s);if(!m&&"me"!=s)try{m=yield c.nakama.load_server_post_with_id(`ServerPost_${n}`,i,a,s,_)}catch{}c.nakama.post_counter[i][a][s]--,m||(yield c.load_post_step_by_step(c.nakama.post_counter[i][a][s],i,a,s,_))})()}AddShortcut(){this.global.p5KeyShortCut&&(this.global.p5KeyShortCut.Digit=n=>{this.nakama.posts.length>n?this.nakama.open_post(this.nakama.posts[n],n):this.add_post()}),this.global.p5KeyShortCut&&!this.global.p5KeyShortCut.AddAct&&(this.global.p5KeyShortCut.AddAct=()=>{this.add_post()})}ionViewWillLeave(){delete this.global.p5KeyShortCut.Digit,delete this.global.p5KeyShortCut.AddAct,delete this.nakama.socket_reactive.try_load_post,this.ContentScroll&&(this.ContentScroll.onscroll=null)}}return(o=r).\u0275fac=function(n){return new(n||o)(t.rXU(P.j),t.rXU(x.X),t.rXU(S.y),t.rXU(b.z3),t.rXU(M.q9),t.rXU(d.hG))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-community"]],decls:13,vars:6,consts:[[1,"ion-no-border"],[1,"add_post",3,"click"],["class","shortcut_hint shortcut_top_add",4,"ngIf"],["button","","name","add-circle-outline",2,"width","24px","height","24px"],[1,"header_online_circle",3,"click"],["id","CommunityScrollDiv",2,"height","100%","overflow-y","auto"],["id","CommunityMainContent"],["class","CardContainerDiv CardContainerDivShared",4,"ngIf"],[4,"ngIf"],[1,"shortcut_hint","shortcut_top_add"],[1,"CardContainerDiv","CardContainerDivShared"],["button","","class","card_style",3,"click","contextmenu",4,"ngFor","ngForOf"],["button","",1,"card_style",3,"click","contextmenu"],["class","shortcut_hint",4,"ngIf"],[1,"thumbnail_image"],["alt","",3,"src","style",4,"ngIf"],[1,"cardCreator"],["style","color: #888; font-weight: normal;",4,"ngIf"],[1,"cardTitle"],["name","link-outline",4,"ngIf"],[1,"cardContent"],[1,"shortcut_hint"],["alt","",3,"src"],[2,"color","#888","font-weight","normal"],["name","link-outline"],[1,"disconnect_info",3,"click"],["color","medium","name","document-text-outline",2,"width","60px","height","60px"],["color","medium"]],template:function(n,i){1&n&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"div",1),t.bIt("click",function(){return i.add_post()}),t.DNE(5,O,2,0,"div",2),t.nrm(6,"ion-icon",3),t.k0s(),t.j41(7,"div",4),t.bIt("click",function(){return i.nakama.toggle_all_session()}),t.k0s()()(),t.j41(8,"ion-content")(9,"div",5)(10,"div",6),t.DNE(11,G,2,1,"div",7)(12,$,6,1,"div",8),t.k0s()()()),2&n&&(t.R7$(3),t.JRh(i.lang.text.Community.Title),t.R7$(2),t.Y8G("ngIf",i.global.ShowHint),t.R7$(2),t.Aen("background-color: "+i.statusBar.colors[i.statusBar.settings.groupServer]+"; cursor: pointer;"),t.R7$(4),t.Y8G("ngIf",i.nakama.posts.length),t.R7$(),t.Y8G("ngIf",!i.nakama.posts.length))},dependencies:[g.Sq,g.bT,d.b_,d.I9,d.ME,d.HW,d.tN,d.W9,d.eU,d.iq,d.he,d.BC,d.ai],styles:[".md[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:68px;top:16px;cursor:pointer}.ios[_ngcontent-%COMP%]   .add_post[_ngcontent-%COMP%]{position:absolute;right:58px;top:10px;cursor:pointer}.md[_ngcontent-%COMP%]   .CardContainerDiv[_ngcontent-%COMP%]{padding-top:14px}.ios[_ngcontent-%COMP%]   .CardContainerDiv[_ngcontent-%COMP%]{padding-top:20px}.CardContainerDivShared[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:16px;padding:16px 0 16px 16px}.card_style[_ngcontent-%COMP%]{width:90%;margin-top:0}.md[_ngcontent-%COMP%]   .cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.md[_ngcontent-%COMP%]   .cardTitle[_ngcontent-%COMP%]{max-height:24px;overflow-y:hidden}.md[_ngcontent-%COMP%]   .cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.ios[_ngcontent-%COMP%]   .cardCreator[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;font-weight:700;max-height:20px;overflow-y:hidden}.ios[_ngcontent-%COMP%]   .cardTitle[_ngcontent-%COMP%]{max-height:34px;overflow-y:hidden}.ios[_ngcontent-%COMP%]   .cardContent[_ngcontent-%COMP%]{max-height:40px;overflow-y:hidden;padding-bottom:0;margin-bottom:13px}.thumbnail_image[_ngcontent-%COMP%]{width:100%;max-height:240px;object-fit:cover;overflow:hidden}"]}),r})()},{path:"add-post",loadChildren:()=>l.e(7759).then(l.bind(l,7759)).then(o=>o.AddPostPageModule)}];let E=(()=>{var o;class r{}return(o=r).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[v.iI.forChild(F),v.iI]}),r})(),A=(()=>{var o;class r{}return(o=r).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[g.MD,k.YN,d.bv,E]}),r})()}}]);