"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4168],{4168:(j,v,i)=>{i.r(v),i.d(v,{RegisterCharacterPageModule:()=>U});var b=i(177),u=i(4341),s=i(5374),d=i(9858),R=i(467),e=i(3953),C=i(4237),y=i(482),P=i(3307),_=i(755),I=i(4234),M=i(3656);const k=[{path:"",component:(()=>{var n;class l{constructor(a,t,g,o,p,h,f,r){this.nakama=a,this.global=t,this.p5loading=g,this.indexed=o,this.lang=p,this.navCtrl=h,this.router=f,this.route=r,this.RegInfo={file:void 0,creator_name:"",character_name:""}}ngOnDestroy(){var a,t;this.route.queryParams.unsubscribe(),null===(a=(t=this.global.PageDismissAct)["arcade-character-set"])||void 0===a||a.call(t)}ngOnInit(){var a=this;this.route.queryParams.subscribe(function(){var t=(0,R.A)(function*(g){try{const o=a.router.getCurrentNavigation().extras.state;if(!o)throw"\ud398\uc774\uc9c0 \ubcf5\uadc0";a.RegInfo=o.info}catch(o){console.log("\uce90\ub9ad\ud130 \uc815\ubcf4 \ubd88\ub7ec\uc624\uae30 \uc2e4\ud328: ",o),a.navCtrl.pop()}});return function(g){return t.apply(this,arguments)}}())}ApplyRegister(){var a=this;return(0,R.A)(function*(){a.navCtrl.pop();const t="apply_avatar";yield a.p5loading.update({id:t,message:a.lang.text.RegAvatar.Registering});const g=a.RegInfo.file;yield a.indexed.saveBlobToUserPath(g,"servers/self/avatar.pck"),a.global.godot_window.filename=`${a.RegInfo.creator_name}/${a.RegInfo.character_name}`,a.global.godot_window.path="servers/self/avatar.pck",a.global.godot_window.create_thumbnail({});const o=a.nakama.get_all_server_info(!0,!0),p={filename:"avatar.pck",file_ext:"pck",size:a.RegInfo.file.size,blob:a.RegInfo.file};yield new Promise(r=>setTimeout(r,500));const h=yield a.indexed.loadBlobFromUserPath("servers/self/avatar.pck_thumbnail.png","image/png"),f={filename:"avatar.pck_thumbnail.png",file_ext:"png",size:h.size,blob:h};for(let r of o)try{const m=yield a.global.upload_file_to_storage(p,{user_id:a.nakama.servers[r.isOfficial][r.target].session.user_id,apache_port:r.apache_port,cdn_port:r.cdn_port},r.useSSL?"https:":"http:",r.address,!1,t),$=yield a.global.upload_file_to_storage(f,{user_id:a.nakama.servers[r.isOfficial][r.target].session.user_id,apache_port:r.apache_port,cdn_port:r.cdn_port},r.useSSL?"https:":"http:",r.address,!1,t);yield a.nakama.servers[r.isOfficial][r.target].client.writeStorageObjects(a.nakama.servers[r.isOfficial][r.target].session,[{collection:"user_public",key:"avatar",permission_read:2,permission_write:1,value:{data:{url:m,thumbnail:$}}}])}catch(m){console.log("\uc5c5\ub85c\ub4dc \uc2e4\ud328: ",m)}a.p5loading.update({id:t,message:a.lang.text.RegAvatar.Registering,forceEnd:350,progress:1})})()}}return(n=l).\u0275fac=function(a){return new(a||n)(e.rXU(C.X),e.rXU(y.z3),e.rXU(P.f),e.rXU(_.n),e.rXU(I.y),e.rXU(M.q9),e.rXU(d.Ix),e.rXU(d.nX))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-register-character"]],decls:18,vars:10,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","portal/arcade"],["type","text","disabled","",1,"ion-text-end",3,"ngModelChange","label","placeholder","ngModel"],["id","avatar_sample",2,"width","100%","height","67vw"],["button","",3,"click","disabled"],[1,"ion-text-center"]],template:function(a,t){1&a&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",1),e.nrm(5,"ion-back-button",2),e.k0s()()(),e.j41(6,"ion-content")(7,"ion-item-divider")(8,"ion-label"),e.EFF(9),e.k0s()(),e.j41(10,"ion-item")(11,"ion-input",3),e.mxI("ngModelChange",function(o){return e.DH7(t.RegInfo.creator_name,o)||(t.RegInfo.creator_name=o),o}),e.k0s()(),e.j41(12,"ion-item")(13,"ion-input",3),e.mxI("ngModelChange",function(o){return e.DH7(t.RegInfo.character_name,o)||(t.RegInfo.character_name=o),o}),e.k0s()(),e.nrm(14,"div",4),e.j41(15,"ion-item",5),e.bIt("click",function(){return t.ApplyRegister()}),e.j41(16,"ion-label",6),e.EFF(17),e.k0s()()()),2&a&&(e.R7$(3),e.JRh(t.lang.text.RegAvatar.Title),e.R7$(6),e.JRh(t.lang.text.RegAvatar.infotitle),e.R7$(2),e.Y8G("label",t.lang.text.RegAvatar.creator)("placeholder",t.lang.text.RegAvatar.creator_placeholder),e.R50("ngModel",t.RegInfo.creator_name),e.R7$(2),e.Y8G("label",t.lang.text.RegAvatar.model)("placeholder",t.lang.text.RegAvatar.model_placeholder),e.R50("ngModel",t.RegInfo.character_name),e.R7$(2),e.Y8G("disabled",!t.RegInfo.creator_name),e.R7$(2),e.JRh(t.lang.text.RegAvatar.ApplyReg))},dependencies:[u.BC,u.vS,s.QW,s.W9,s.eU,s.$w,s.uz,s.Dg,s.he,s.BC,s.ai,s.Gw,s.el],styles:["ion-input[_ngcontent-%COMP%]{--highlight-color-valid: var(--ion-color-primary)}"]}),l})()}];let A=(()=>{var n;class l{}return(n=l).\u0275fac=function(a){return new(a||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.iI.forChild(k),d.iI]}),l})(),U=(()=>{var n;class l{}return(n=l).\u0275fac=function(a){return new(a||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[b.MD,u.YN,s.bv,A]}),l})()}}]);