"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5436],{5436:(L,I,l)=>{l.r(I),l.d(I,{WebrtcManageIoDevPageModule:()=>w});var p=l(177),v=l(4341),s=l(5374),g=l(9858),_=l(467),m=l(92),e=l(3953),f=l(4234),b=l(755),R=l(482),M=l(9900),D=l(4237),S=l(3656);const W=["VideoIn"],C=["AudioIn"],x=["AudioOut"],G=["RegisterNewWebRTCServer"],j=()=>[0,.5,.6,.7,.8,.9,1];function $(o,a){if(1&o&&(e.j41(0,"ion-item")(1,"ion-radio",12),e.EFF(2),e.k0s()()),2&o){const i=a.$implicit,t=a.index;e.R7$(),e.Y8G("value",t),e.R7$(),e.JRh(i.label||i.deviceId)}}function T(o,a){if(1&o&&(e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-radio-group",10,0),e.DNE(6,$,3,2,"ion-item",11),e.k0s()()),2&o){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.VideoIn),e.R7$(3),e.Y8G("ngForOf",i.VideoInputs)}}function k(o,a){if(1&o&&(e.j41(0,"ion-item")(1,"ion-radio",12),e.EFF(2),e.k0s()()),2&o){const i=a.$implicit,t=a.index;e.R7$(),e.Y8G("value",t),e.R7$(),e.JRh(i.label||i.deviceId)}}function P(o,a){if(1&o&&(e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-radio-group",13,1),e.DNE(6,k,3,2,"ion-item",11),e.k0s()()),2&o){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.AudioIn),e.R7$(3),e.Y8G("ngForOf",i.AudioInputs)}}function A(o,a){if(1&o&&(e.j41(0,"ion-item")(1,"ion-radio",12),e.EFF(2),e.k0s()()),2&o){const i=a.$implicit,t=a.index;e.R7$(),e.Y8G("value",t),e.R7$(),e.JRh(i.label||i.deviceId)}}function F(o,a){if(1&o&&(e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-radio-group",14,2),e.DNE(6,A,3,2,"ion-item",11),e.k0s()()),2&o){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.AudioOut),e.R7$(3),e.Y8G("ngForOf",i.AudioOutputs)}}function O(o,a){if(1&o){const i=e.RV6();e.j41(0,"ion-item",15),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.saveSetup())}),e.j41(1,"ion-label",16),e.EFF(2),e.k0s()()}if(2&o){const i=e.XpG();e.R7$(2),e.JRh(i.lang.text.WebRTCDevManager.saveSetup)}}function V(o,a){if(1&o){const i=e.RV6();e.j41(0,"img",23),e.bIt("click",function(){e.eBV(i);const n=e.XpG().index,r=e.XpG(2);return e.Njj(r.copy_info(n))}),e.k0s()}if(2&o){const i=e.XpG().index,t=e.XpG(2);e.Y8G("src",t.QRCodes[i],e.B4B)}}function U(o,a){if(1&o){const i=e.RV6();e.j41(0,"ion-accordion",12)(1,"ion-item",19)(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"div",20),e.DNE(5,V,1,1,"img",21),e.j41(6,"ion-item",15),e.bIt("click",function(){const n=e.eBV(i).index,r=e.XpG(2);return e.Njj(r.ModifyServer(n))}),e.j41(7,"ion-label",16),e.EFF(8),e.k0s()(),e.j41(9,"ion-item",15),e.bIt("click",function(){const n=e.eBV(i).index,r=e.XpG(2);return e.Njj(r.RemoveServer(n))}),e.j41(10,"ion-label",22),e.EFF(11),e.k0s()()()()}if(2&o){const i=a.$implicit,t=a.index,n=e.XpG(2);e.Y8G("value",t),e.R7$(3),e.JRh(i.urls[0]),e.R7$(2),e.Y8G("ngIf",n.QRCodes[t]),e.R7$(3),e.JRh(n.lang.text.WebRTCDevManager.Modify),e.R7$(3),e.JRh(n.lang.text.WebRTCDevManager.Remove)}}function y(o,a){if(1&o){const i=e.RV6();e.j41(0,"ion-icon",29),e.bIt("click",function(){e.eBV(i);const n=e.XpG(4);return e.Njj(n.AddServerUrl())}),e.k0s()}}function N(o,a){if(1&o){const i=e.RV6();e.j41(0,"ion-icon",30),e.bIt("click",function(){e.eBV(i);const n=e.XpG().$implicit,r=e.XpG(3);return e.Njj(r.SubtractServerUrl(n))}),e.k0s()}}function X(o,a){if(1&o){const i=e.RV6();e.j41(0,"ion-item")(1,"ion-input",26),e.mxI("ngModelChange",function(n){const r=e.eBV(i).$implicit,u=e.XpG(3);return e.DH7(u.userInput.urls[r],n)||(u.userInput.urls[r]=n),e.Njj(n)}),e.k0s(),e.DNE(2,y,1,0,"ion-icon",27)(3,N,1,0,"ion-icon",28),e.k0s()}if(2&o){const i=a.$implicit,t=e.XpG(3);e.R7$(),e.Y8G("label",0==i?t.lang.text.WebRTCDevManager.Urls:""),e.R50("ngModel",t.userInput.urls[i]),e.R7$(),e.Y8G("ngIf",0==i),e.R7$(),e.Y8G("ngIf",0!=i)}}function E(o,a){if(1&o){const i=e.RV6();e.j41(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.DNE(4,X,4,4,"ion-item",11),e.j41(5,"ion-item")(6,"ion-input",24),e.mxI("ngModelChange",function(n){e.eBV(i);const r=e.XpG(2);return e.DH7(r.userInput.username,n)||(r.userInput.username=n),e.Njj(n)}),e.k0s()(),e.j41(7,"ion-item")(8,"ion-input",25),e.mxI("ngModelChange",function(n){e.eBV(i);const r=e.XpG(2);return e.DH7(r.userInput.credential,n)||(r.userInput.credential=n),e.Njj(n)}),e.k0s()()()}if(2&o){const i=e.XpG(2);e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.ServerInfo),e.R7$(),e.Y8G("ngForOf",i.UserInputUrlsLength),e.R7$(2),e.Y8G("label",i.lang.text.WebRTCDevManager.Username),e.R50("ngModel",i.userInput.username),e.R7$(2),e.Y8G("label",i.lang.text.WebRTCDevManager.Credential),e.R50("ngModel",i.userInput.credential)}}function Y(o,a){if(1&o){const i=e.RV6();e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-accordion-group",null,3),e.DNE(6,U,12,5,"ion-accordion",17),e.k0s(),e.j41(7,"ion-item",15),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.CreateNewServerInfo())}),e.j41(8,"ion-label",16),e.EFF(9),e.k0s()(),e.j41(10,"ion-modal",18,4),e.DNE(12,E,9,6,"ng-template"),e.k0s()()}if(2&o){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.ManageServer),e.R7$(3),e.Y8G("ngForOf",i.ServerInfos),e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.AddServer),e.R7$(),e.Y8G("initialBreakpoint",.5)("breakpoints",e.lJ4(5,j))}}const B=[{path:"",component:(()=>{var o;class a{constructor(t,n,r,u,d,c,h,Q){this.lang=t,this.indexed=n,this.global=r,this.p5toast=u,this.nakama=d,this.router=c,this.route=h,this.navCtrl=Q,this.InOut=[],this.VideoInputs=[],this.AudioInputs=[],this.AudioOutputs=[],this.ServerInfos=[],this.QRCodes=[],this.userInput={urls:[""],username:"",credential:""},this.UserInputUrlsLength=[0]}ngOnDestroy(){var t,n;this.route.queryParams.unsubscribe(),null===(t=(n=this.global.PageDismissAct)["webrtc-manage"])||void 0===t||t.call(n,{}),this.indexed.saveTextFileToUserPath(JSON.stringify(this.ServerInfos),"servers/webrtc_server.json")}ngOnInit(){this.route.queryParams.subscribe(t=>{const n=this.router.getCurrentNavigation().extras.state;this.InOut=n.list||[];for(let r=0,u=this.InOut.length;r<u;r++)"video"==n.typein&&this.InOut[r].kind.indexOf("videoinput")>=0&&this.VideoInputs.push(this.InOut[r]),this.InOut[r].kind.indexOf("audioinput")>=0&&this.AudioInputs.push(this.InOut[r]),this.InOut[r].kind.indexOf("audiooutput")>=0&&this.AudioOutputs.push(this.InOut[r]);"video"==n.typein&&"DesktopPWA"==m.aH&&this.VideoInputs.push({label:this.lang.text.WebRTCDevManager.ScreenIn,useScr:!0})})}ionViewWillEnter(){var t=this;return(0,_.A)(function*(){try{let n=yield t.indexed.loadTextFromUserPath("servers/webrtc_server.json");t.ServerInfos=JSON.parse(n);for(let r=0,u=t.ServerInfos.length;r<u;r++){let c=`${yield t.global.GetHeaderAddress()}?rtcserver=[${t.ServerInfos[r].urls}],${t.ServerInfos[r].username},${t.ServerInfos[r].credential}`,h=t.global.readasQRCodeFromString(c);t.QRCodes[r]=h}}catch{}try{let n=localStorage.getItem("VideoInputDev");t.VideoInput.value=Number(n)||0}catch{}try{let n=localStorage.getItem("AudioInputDev");t.AudioInput.value=Number(n)||0}catch{}try{let n=localStorage.getItem("AudioOutputDev");t.AudioOutput.value=Number(n)||0}catch{}})()}ionViewDidEnter(){this.global.p5KeyShortCut.AddAct=()=>{this.OpenNewWebRTCServerForm()},this.global.p5KeyShortCut.Escape=()=>{this.navCtrl.pop()}}saveSetup(){var t,n;let r={};this.VideoInput&&void 0!==this.VideoInput.value&&(r.videoinput=this.VideoInputs[this.VideoInput.value],localStorage.setItem("VideoInputDev",this.VideoInput.value)),this.AudioInput&&void 0!==this.AudioInput.value&&(r.audioinput=this.AudioInputs[this.AudioInput.value],localStorage.setItem("AudioInputDev",this.AudioInput.value)),this.AudioOutput&&void 0!==this.AudioOutput.value&&(r.audiooutput=this.AudioOutputs[this.AudioOutput.value],localStorage.setItem("AudioOutputDev",this.AudioOutput.value)),null===(t=(n=this.global.PageDismissAct)["webrtc-manage"])||void 0===t||t.call(n,{data:r}),this.navCtrl.pop()}AddServerUrl(){this.userInput.urls.push(""),this.UserInputUrlsLength.push(this.UserInputUrlsLength.length)}SubtractServerUrl(t){this.userInput.urls.splice(t,1),this.UserInputUrlsLength.pop()}CreateNewServerInfo(){this.userInput={urls:[""],username:"",credential:""},this.UserInputUrlsLength.length=1,this.OpenNewWebRTCServerForm()}OpenNewWebRTCServerForm(){this.global.StoreShortCutAct("webrtc-manage-io"),this.RegisterServer.onDidDismiss().then(()=>{this.SaveServer(),this.global.RestoreShortCutAct("webrtc-manage-io")}),this.RegisterServer.present()}SaveServer(){var t=this;return(0,_.A)(function*(){t.userInput.urls.filter(c=>c);for(let c=t.userInput.urls.length-1;c>=0;c--)t.userInput.urls[c].trim()||t.userInput.urls.splice(c,1);if(!t.userInput.urls.length)return void t.p5toast.show({text:t.lang.text.WebRTCDevManager.IgnoreSave});let n=yield t.nakama.SaveWebRTCServer(t.userInput),u=`${yield t.global.GetHeaderAddress()}?rtcserver=[${t.userInput.urls}],${t.userInput.username},${t.userInput.credential}`,d=t.global.readasQRCodeFromString(u);void 0!==t.index?t.QRCodes[t.index]=d:t.QRCodes.push(d),n||t.ServerInfos.push(t.userInput),t.userInput={urls:[""],username:"",credential:""},t.UserInputUrlsLength.length=0,t.UserInputUrlsLength.push(0),t.index=void 0})()}copy_info(t){var n=this;return(0,_.A)(function*(){let u=`${yield n.global.GetHeaderAddress()}?rtcserver=[${n.ServerInfos[t].urls}],${n.ServerInfos[t].username},${n.ServerInfos[t].credential}`;n.global.WriteValueToClipboard("text/plain",u)})()}ModifyServer(t){this.index=t,this.userInput=this.ServerInfos[t],this.UserInputUrlsLength.length=0;for(let n=0,r=this.userInput.urls.length;n<r;n++)this.UserInputUrlsLength.push(n);this.OpenNewWebRTCServerForm()}RemoveServer(t){var n=this;return(0,_.A)(function*(){n.QRCodes.splice(t,1),n.ServerInfos.splice(t,1)})()}ionViewWillLeave(){delete this.global.p5KeyShortCut.AddAct,delete this.global.p5KeyShortCut.Escape}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(f.y),e.rXU(b.n),e.rXU(R.z3),e.rXU(M.G),e.rXU(D.X),e.rXU(g.Ix),e.rXU(g.nX),e.rXU(S.q9))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-webrtc-manage-io-dev"]],viewQuery:function(t,n){if(1&t&&(e.GBs(W,5),e.GBs(C,5),e.GBs(x,5),e.GBs(G,5)),2&t){let r;e.mGM(r=e.lsd())&&(n.VideoInput=r.first),e.mGM(r=e.lsd())&&(n.AudioInput=r.first),e.mGM(r=e.lsd())&&(n.AudioOutput=r.first),e.mGM(r=e.lsd())&&(n.RegisterServer=r.first)}},decls:12,vars:6,consts:[["VideoIn",""],["AudioIn",""],["AudioOut",""],["WebRTCServers",""],["RegisterNewWebRTCServer",""],[1,"ion-no-border"],["slot","start"],["defaultHref",""],[4,"ngIf"],["button","",3,"click",4,"ngIf"],["name","videoinput"],[4,"ngFor","ngForOf"],[3,"value"],["name","audioinput"],["name","audiooutput"],["button","",3,"click"],[1,"ion-text-center"],[3,"value",4,"ngFor","ngForOf"],[3,"initialBreakpoint","breakpoints"],["button","","slot","header"],["slot","content"],["style","width: 100%; height: auto;","alt","Loading",3,"src","click",4,"ngIf"],["color","danger",1,"ion-text-center"],["alt","Loading",2,"width","100%","height","auto",3,"click","src"],["placeholder","username",1,"ion-text-end",3,"ngModelChange","label","ngModel"],["placeholder","credential",1,"ion-text-end",3,"ngModelChange","label","ngModel"],["placeholder","stun:stun.l.google.com:19302",1,"ion-text-end",3,"ngModelChange","label","ngModel"],["slot","end","color","success","name","add-circle-outline",3,"click",4,"ngIf"],["slot","end","color","danger","name","remove-circle-outline",3,"click",4,"ngIf"],["slot","end","color","success","name","add-circle-outline",3,"click"],["slot","end","color","danger","name","remove-circle-outline",3,"click"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",5)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",6),e.nrm(5,"ion-back-button",7),e.k0s()()(),e.j41(6,"ion-content"),e.DNE(7,T,7,2,"div",8)(8,P,7,2,"div",8)(9,F,7,2,"div",8)(10,O,3,1,"ion-item",9)(11,Y,13,6,"div",8),e.k0s()),2&t&&(e.R7$(3),e.JRh(n.lang.text.WebRTCDevManager.Title),e.R7$(4),e.Y8G("ngIf",n.VideoInputs.length),e.R7$(),e.Y8G("ngIf",n.AudioInputs.length),e.R7$(),e.Y8G("ngIf",n.AudioOutputs.length),e.R7$(),e.Y8G("ngIf",n.InOut.length),e.R7$(),e.Y8G("ngIf",!n.InOut.length))},dependencies:[p.Sq,p.bT,v.BC,v.vS,s.xk,s.YH,s.QW,s.W9,s.eU,s.iq,s.$w,s.uz,s.Dg,s.he,s.KO,s.f0,s.BC,s.ai,s.Sb,s.Je,s.Gw,s.el],styles:["ion-input[_ngcontent-%COMP%]{--highlight-color-valid: var(--ion-color-primary)}"]}),a})()}];let J=(()=>{var o;class a{}return(o=a).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[g.iI.forChild(B),g.iI]}),a})(),w=(()=>{var o;class a{}return(o=a).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[p.MD,v.YN,s.bv,J]}),a})()}}]);