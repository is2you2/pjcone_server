"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5436],{5436:(w,I,l)=>{l.r(I),l.d(I,{WebrtcManageIoDevPageModule:()=>B});var v=l(177),_=l(4341),s=l(5374),d=l(9858),p=l(467),m=l(92),g=l(9969),e=l(3953),f=l(4234),b=l(755),R=l(7100),M=l(9900),D=l(4237),S=l(3656);const W=["VideoIn"],x=["AudioIn"],C=["AudioOut"],j=["RegisterNewWebRTCServer"],G=()=>[0,.5,.6,.7,.8,.9,1];function T(r,a){if(1&r&&(e.j41(0,"ion-item")(1,"ion-radio",11),e.EFF(2),e.k0s()()),2&r){const i=a.$implicit,t=a.index;e.R7$(),e.Y8G("value",t),e.R7$(),e.JRh(i.label||i.deviceId)}}function $(r,a){if(1&r&&(e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-radio-group",9,0),e.DNE(6,T,3,2,"ion-item",10),e.k0s()()),2&r){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.VideoIn),e.R7$(3),e.Y8G("ngForOf",i.VideoInputs)}}function k(r,a){if(1&r&&(e.j41(0,"ion-item")(1,"ion-radio",11),e.EFF(2),e.k0s()()),2&r){const i=a.$implicit,t=a.index;e.R7$(),e.Y8G("value",t),e.R7$(),e.JRh(i.label||i.deviceId)}}function P(r,a){if(1&r&&(e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-radio-group",12,1),e.DNE(6,k,3,2,"ion-item",10),e.k0s()()),2&r){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.AudioIn),e.R7$(3),e.Y8G("ngForOf",i.AudioInputs)}}function A(r,a){if(1&r){const i=e.RV6();e.j41(0,"ion-item",13),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.saveSetup())}),e.j41(1,"ion-label",14),e.EFF(2),e.k0s()()}if(2&r){const i=e.XpG();e.R7$(2),e.JRh(i.lang.text.WebRTCDevManager.saveSetup)}}function F(r,a){if(1&r){const i=e.RV6();e.j41(0,"img",21),e.bIt("click",function(){e.eBV(i);const n=e.XpG().index,o=e.XpG(2);return e.Njj(o.copy_info(n))}),e.k0s()}if(2&r){const i=e.XpG().index,t=e.XpG(2);e.Y8G("src",t.QRCodes[i],e.B4B)}}function O(r,a){if(1&r){const i=e.RV6();e.j41(0,"ion-accordion",11)(1,"ion-item",17)(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"div",18),e.DNE(5,F,1,1,"img",19),e.j41(6,"ion-item",13),e.bIt("click",function(){const n=e.eBV(i).index,o=e.XpG(2);return e.Njj(o.ModifyServer(n))}),e.j41(7,"ion-label",14),e.EFF(8),e.k0s()(),e.j41(9,"ion-item",13),e.bIt("click",function(){const n=e.eBV(i).index,o=e.XpG(2);return e.Njj(o.RemoveServer(n))}),e.j41(10,"ion-label",20),e.EFF(11),e.k0s()()()()}if(2&r){const i=a.$implicit,t=a.index,n=e.XpG(2);e.Y8G("@toggle_item",void 0)("value",t),e.R7$(3),e.JRh(i.urls[0]),e.R7$(2),e.Y8G("ngIf",n.QRCodes[t]),e.R7$(3),e.JRh(n.lang.text.WebRTCDevManager.Modify),e.R7$(3),e.JRh(n.lang.text.WebRTCDevManager.Remove)}}function V(r,a){if(1&r){const i=e.RV6();e.j41(0,"ion-icon",27),e.bIt("click",function(){e.eBV(i);const n=e.XpG(4);return e.Njj(n.AddServerUrl())}),e.k0s()}}function U(r,a){if(1&r){const i=e.RV6();e.j41(0,"ion-icon",28),e.bIt("click",function(){e.eBV(i);const n=e.XpG().$implicit,o=e.XpG(3);return e.Njj(o.SubtractServerUrl(n))}),e.k0s()}}function y(r,a){if(1&r){const i=e.RV6();e.j41(0,"ion-item")(1,"ion-input",24),e.mxI("ngModelChange",function(n){const o=e.eBV(i).$implicit,u=e.XpG(3);return e.DH7(u.userInput.urls[o],n)||(u.userInput.urls[o]=n),e.Njj(n)}),e.k0s(),e.DNE(2,V,1,0,"ion-icon",25)(3,U,1,0,"ion-icon",26),e.k0s()}if(2&r){const i=a.$implicit,t=e.XpG(3);e.R7$(),e.Y8G("label",0==i?t.lang.text.WebRTCDevManager.Urls:""),e.R50("ngModel",t.userInput.urls[i]),e.R7$(),e.Y8G("ngIf",0==i),e.R7$(),e.Y8G("ngIf",0!=i)}}function N(r,a){if(1&r){const i=e.RV6();e.j41(0,"ion-content")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.DNE(4,y,4,4,"ion-item",10),e.j41(5,"ion-item")(6,"ion-input",22),e.mxI("ngModelChange",function(n){e.eBV(i);const o=e.XpG(2);return e.DH7(o.userInput.username,n)||(o.userInput.username=n),e.Njj(n)}),e.k0s()(),e.j41(7,"ion-item")(8,"ion-input",23),e.mxI("ngModelChange",function(n){e.eBV(i);const o=e.XpG(2);return e.DH7(o.userInput.credential,n)||(o.userInput.credential=n),e.Njj(n)}),e.k0s()()()}if(2&r){const i=e.XpG(2);e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.ServerInfo),e.R7$(),e.Y8G("ngForOf",i.UserInputUrlsLength),e.R7$(2),e.Y8G("label",i.lang.text.WebRTCDevManager.Username),e.R50("ngModel",i.userInput.username),e.R7$(2),e.Y8G("label",i.lang.text.WebRTCDevManager.Credential),e.R50("ngModel",i.userInput.credential)}}function X(r,a){if(1&r){const i=e.RV6();e.j41(0,"div")(1,"ion-item-divider")(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-accordion-group",null,2),e.DNE(6,O,12,6,"ion-accordion",15),e.k0s(),e.j41(7,"ion-item",13),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.CreateNewServerInfo())}),e.j41(8,"ion-label",14),e.EFF(9),e.k0s()(),e.j41(10,"ion-modal",16,3),e.DNE(12,N,9,6,"ng-template"),e.k0s()()}if(2&r){const i=e.XpG();e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.ManageServer),e.R7$(3),e.Y8G("ngForOf",i.ServerInfos),e.R7$(3),e.JRh(i.lang.text.WebRTCDevManager.AddServer),e.R7$(),e.Y8G("initialBreakpoint",.5)("breakpoints",e.lJ4(5,G))}}const E=[{path:"",component:(()=>{var r;class a{constructor(t,n,o,u,c,h,J,L){this.lang=t,this.indexed=n,this.global=o,this.p5toast=u,this.nakama=c,this.router=h,this.route=J,this.navCtrl=L,this.InOut=[],this.VideoInputs=[],this.AudioInputs=[],this.AudioOutputs=[],this.ServerInfos=[],this.QRCodes=[],this.userInput={urls:[""],username:"",credential:""},this.UserInputUrlsLength=[0],this.exitWithSave=!1}ngOnDestroy(){var t,n;this.route.queryParams.unsubscribe(),this.exitWithSave||null===(t=(n=this.global.PageDismissAct)["webrtc-manage"])||void 0===t||t.call(n,{}),this.indexed.saveTextFileToUserPath(JSON.stringify(this.ServerInfos),"servers/webrtc_server.json")}ngOnInit(){this.route.queryParams.subscribe(t=>{const n=this.router.getCurrentNavigation().extras.state;this.InOut=n.list||[];for(let o=0,u=this.InOut.length;o<u;o++)"video"==n.typein&&this.InOut[o].kind.indexOf("videoinput")>=0&&this.VideoInputs.push(this.InOut[o]),this.InOut[o].kind.indexOf("audioinput")>=0&&this.AudioInputs.push(this.InOut[o]),this.InOut[o].kind.indexOf("audiooutput")>=0&&this.AudioOutputs.push(this.InOut[o]);"video"==n.typein&&"DesktopPWA"==m.aH&&this.VideoInputs.push({label:this.lang.text.WebRTCDevManager.ScreenIn,useScr:!0})})}ionViewWillEnter(){var t=this;return(0,p.A)(function*(){try{let n=yield t.indexed.loadTextFromUserPath("servers/webrtc_server.json");t.ServerInfos=JSON.parse(n);for(let o=0,u=t.ServerInfos.length;o<u;o++){let h=t.global.readasQRCodeFromString(`${t.global.CustomLocalAddress}?rtcserver=[${t.ServerInfos[o].urls}],${t.ServerInfos[o].username},${t.ServerInfos[o].credential}`);t.QRCodes[o]=h}}catch{}try{let n=localStorage.getItem("VideoInputDev");t.VideoInput.value=Number(n)||0}catch{}try{let n=localStorage.getItem("AudioInputDev");t.AudioInput.value=Number(n)||0}catch{}try{let n=localStorage.getItem("AudioOutputDev");t.AudioOutput.value=Number(n)||0}catch{}})()}ionViewDidEnter(){this.global.p5KeyShortCut.AddAct=()=>{this.OpenNewWebRTCServerForm()}}saveSetup(){var t,n;let o={};this.VideoInput&&void 0!==this.VideoInput.value&&(o.videoinput=this.VideoInputs[this.VideoInput.value],localStorage.setItem("VideoInputDev",this.VideoInput.value)),this.AudioInput&&void 0!==this.AudioInput.value&&(o.audioinput=this.AudioInputs[this.AudioInput.value],localStorage.setItem("AudioInputDev",this.AudioInput.value)),this.AudioOutput&&void 0!==this.AudioOutput.value&&(o.audiooutput=this.AudioOutputs[this.AudioOutput.value],localStorage.setItem("AudioOutputDev",this.AudioOutput.value)),this.exitWithSave=!0,null===(t=(n=this.global.PageDismissAct)["webrtc-manage"])||void 0===t||t.call(n,{data:o}),this.navCtrl.pop()}AddServerUrl(){this.userInput.urls.push(""),this.UserInputUrlsLength.push(this.UserInputUrlsLength.length)}SubtractServerUrl(t){this.userInput.urls.splice(t,1),this.UserInputUrlsLength.pop()}CreateNewServerInfo(){this.userInput={urls:[""],username:"",credential:""},this.UserInputUrlsLength.length=1,this.OpenNewWebRTCServerForm()}OpenNewWebRTCServerForm(){this.global.StoreShortCutAct("webrtc-manage-io"),this.RegisterServer.onDidDismiss().then(()=>{this.SaveServer(),this.global.RestoreShortCutAct("webrtc-manage-io")}),this.RegisterServer.present()}SaveServer(){var t=this;return(0,p.A)(function*(){t.userInput.urls.filter(c=>c);for(let c=t.userInput.urls.length-1;c>=0;c--)t.userInput.urls[c].trim()||t.userInput.urls.splice(c,1);if(!t.userInput.urls.length)return void t.p5toast.show({text:t.lang.text.WebRTCDevManager.IgnoreSave});let n=yield t.nakama.SaveWebRTCServer(t.userInput),u=t.global.readasQRCodeFromString(`${t.global.CustomLocalAddress}?rtcserver=[${t.userInput.urls}],${t.userInput.username},${t.userInput.credential}`);void 0!==t.index?t.QRCodes[t.index]=u:t.QRCodes.push(u),n||t.ServerInfos.push(t.userInput),t.userInput={urls:[""],username:"",credential:""},t.UserInputUrlsLength.length=0,t.UserInputUrlsLength.push(0),t.index=void 0})()}copy_info(t){var n=this;return(0,p.A)(function*(){n.global.WriteValueToClipboard("text/plain",`${n.global.CustomLocalAddress}?rtcserver=[${n.ServerInfos[t].urls}],${n.ServerInfos[t].username},${n.ServerInfos[t].credential}`)})()}ModifyServer(t){this.index=t,this.userInput=this.ServerInfos[t],this.UserInputUrlsLength.length=0;for(let n=0,o=this.userInput.urls.length;n<o;n++)this.UserInputUrlsLength.push(n);this.OpenNewWebRTCServerForm()}RemoveServer(t){var n=this;return(0,p.A)(function*(){n.QRCodes.splice(t,1),n.ServerInfos.splice(t,1)})()}ionViewWillLeave(){delete this.global.p5KeyShortCut.AddAct}}return(r=a).\u0275fac=function(t){return new(t||r)(e.rXU(f.y),e.rXU(b.n),e.rXU(R.z3),e.rXU(M.G),e.rXU(D.X),e.rXU(d.Ix),e.rXU(d.nX),e.rXU(S.q9))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-webrtc-manage-io-dev"]],viewQuery:function(t,n){if(1&t&&(e.GBs(W,5),e.GBs(x,5),e.GBs(C,5),e.GBs(j,5)),2&t){let o;e.mGM(o=e.lsd())&&(n.VideoInput=o.first),e.mGM(o=e.lsd())&&(n.AudioInput=o.first),e.mGM(o=e.lsd())&&(n.AudioOutput=o.first),e.mGM(o=e.lsd())&&(n.RegisterServer=o.first)}},decls:11,vars:5,consts:[["VideoIn",""],["AudioIn",""],["WebRTCServers",""],["RegisterNewWebRTCServer",""],[1,"ion-no-border"],["slot","start"],["defaultHref",""],[4,"ngIf"],["button","",3,"click",4,"ngIf"],["name","videoinput"],[4,"ngFor","ngForOf"],[3,"value"],["name","audioinput"],["button","",3,"click"],[1,"ion-text-center"],[3,"value",4,"ngFor","ngForOf"],[3,"initialBreakpoint","breakpoints"],["button","","slot","header"],["slot","content"],["style","width: 100%; height: auto;","alt","Loading",3,"src","click",4,"ngIf"],["color","danger",1,"ion-text-center"],["alt","Loading",2,"width","100%","height","auto",3,"click","src"],["placeholder","username",1,"ion-text-end",3,"ngModelChange","label","ngModel"],["placeholder","credential",1,"ion-text-end",3,"ngModelChange","label","ngModel"],["placeholder","stun:stun.l.google.com:19302",1,"ion-text-end",3,"ngModelChange","label","ngModel"],["slot","end","color","success","name","add-circle-outline",3,"click",4,"ngIf"],["slot","end","color","danger","name","remove-circle-outline",3,"click",4,"ngIf"],["slot","end","color","success","name","add-circle-outline",3,"click"],["slot","end","color","danger","name","remove-circle-outline",3,"click"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",4)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",5),e.nrm(5,"ion-back-button",6),e.k0s()()(),e.j41(6,"ion-content"),e.DNE(7,$,7,2,"div",7)(8,P,7,2,"div",7)(9,A,3,1,"ion-item",8)(10,X,13,6,"div",7),e.k0s()),2&t&&(e.R7$(3),e.JRh(n.lang.text.WebRTCDevManager.Title),e.R7$(4),e.Y8G("ngIf",n.VideoInputs.length),e.R7$(),e.Y8G("ngIf",n.AudioInputs.length),e.R7$(),e.Y8G("ngIf",n.InOut.length),e.R7$(),e.Y8G("ngIf",!n.InOut.length))},dependencies:[v.Sq,v.bT,_.BC,_.vS,s.xk,s.YH,s.QW,s.W9,s.eU,s.iq,s.$w,s.uz,s.Dg,s.he,s.KO,s.f0,s.BC,s.ai,s.Sb,s.Je,s.Gw,s.el],styles:["ion-input[_ngcontent-%COMP%]{--highlight-color-valid: var(--ion-color-primary)}"],data:{animation:[(0,g.hZ)("toggle_item",[(0,g.kY)(":enter",[(0,g.iF)({height:"0px",opacity:0}),(0,g.i0)(".5s ease-out",(0,g.iF)({height:"48px",opacity:1}))]),(0,g.kY)(":leave",[(0,g.i0)(".5s ease-in",(0,g.iF)({height:"0px",opacity:0}))])])]}}),a})()}];let Y=(()=>{var r;class a{}return(r=a).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[d.iI.forChild(E),d.iI]}),a})(),B=(()=>{var r;class a{}return(r=a).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[v.MD,_.YN,s.bv,Y]}),a})()}}]);