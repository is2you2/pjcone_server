"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7759,7476],{7476:(G,M,m)=>{m.d(M,{u:()=>O});var S=m(8326),A=m(3953);let O=(()=>{var g;class B{constructor(){this.Buttons={},this.ArrayKeys=[],this.RemoveLock=!1}CreateFloatButton(){this.p5canvas=new S(I=>{let k,P=[],e=$=>{P.push($),R=0,I.loop()},F=$=>{k=$,$.style("transform-origin","50% 50%"),$.style("opacity","0"),$.style("transform","scale(0)"),R=0,I.loop()},U=()=>{this.LastRemoveQueue.style("transform-origin","50% 50%"),this.LastRemoveQueue.style("opacity","1"),this.LastRemoveQueue.style("transform","scale(1)"),R=0,I.loop()};I.setup=()=>{I.noCanvas(),this.AddAnimateActFunc=e,this.AddButtonQueue=F,this.RemoveButtonQueue=U,I.noLoop()};let R=0,j=$=>I.sin($*I.PI/2);I.draw=()=>{R+=.07;let $=R>=1;$&&(R=1,k&&(k=null),this.LastRemoveQueue&&(this.LastRemoveQueue.remove(),this.LastRemoveQueue=null,this.LastRemoveKey=null,this.RemoveLock=!1,!this.ArrayKeys.length&&this.p5canvas&&this.p5canvas.remove()),I.noLoop()),k&&(k.style("opacity",`${R}`),k.style("transform",`scale(${j(R)})`)),this.LastRemoveQueue&&(this.LastRemoveQueue.style("opacity",""+(1-R)),this.LastRemoveQueue.style("transform",`scale(${j(1-R)})`));for(let w=P.length-1;w>=0;w--){let E=I.lerp(P[w].start,P[w].end,j(R));P[w].button.style(`right: ${E}px`)}$&&(P.length=0)}})}AddFloatButton(I,P){if(this.LastRemoveKey==I)return;this.p5canvas||this.CreateFloatButton();for(let k of this.ArrayKeys){let F=Number(this.Buttons[k].style("right").split("px").shift());this.AddAnimateActFunc({type:"add",button:this.Buttons[k],start:F,end:F+80})}let e=this.p5canvas.createDiv(`<ion-icon style="width: 36px; height: 36px" name="${P}"></ion-icon>`);return e.style("position: absolute; right: 0; bottom: 56px; z-index: 1"),e.style("width: 64px; height: 64px"),e.style("text-align: center; align-content: center"),e.style("cursor: pointer"),e.style("margin: 16px"),e.style("padding-top: 6px"),e.style("background-color: #8888"),e.style("border-radius: 24px"),this.AddButtonQueue(e),this.Buttons[I]=e,this.ArrayKeys.push(I),e}RemoveFloatButton(I){if(!this.Buttons[I]||this.RemoveLock)return;this.RemoveLock=!0,this.LastRemoveKey=I,this.LastRemoveQueue=this.Buttons[I],delete this.Buttons[I];let P=-1;for(let e=this.ArrayKeys.length-1;e>=0;e--){if(P>=0){let k=Number(this.Buttons[this.ArrayKeys[e]].style("right").split("px").shift());this.AddAnimateActFunc({type:"remove",button:this.Buttons[this.ArrayKeys[e]],start:k,end:k-80})}this.ArrayKeys[e]==I&&(this.RemoveButtonQueue(),this.ArrayKeys.splice(e,1),P=e)}}}return(g=B).\u0275fac=function(I){return new(I||g)},g.\u0275prov=A.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),B})()},7759:(G,M,m)=>{m.r(M),m.d(M,{AddPostPageModule:()=>nt});var S=m(177),L=m(4341),A=m(5374),O=m(9858),g=m(467),B=m(4237),D=m(5402),I=m(8326),P=m(92),e=m(3953),k=m(482),F=m(4234),U=m(3656),R=m(9900),j=m(755),$=m(345),w=m(7476),E=m(3307);function W(d,b){if(1&d&&(e.j41(0,"ion-title"),e.EFF(1),e.k0s()),2&d){const p=e.XpG();e.R7$(),e.JRh(p.lang.text.AddPost.EditTitle)}}function X(d,b){if(1&d&&(e.j41(0,"ion-title"),e.EFF(1),e.k0s()),2&d){const p=e.XpG();e.R7$(),e.JRh(p.lang.text.AddPost.Title)}}function Y(d,b){if(1&d){const p=e.RV6();e.j41(0,"ion-item",8),e.bIt("click",function(){const i=e.eBV(p).index,n=e.XpG(2);return e.Njj(n.select_server(i,!0))}),e.j41(1,"ion-label"),e.EFF(2),e.k0s()()}if(2&d){const p=b.$implicit;e.R7$(2),e.JRh(p.name)}}function H(d,b){if(1&d){const p=e.RV6();e.j41(0,"ion-accordion-group",27,0),e.bIt("click",function(){e.eBV(p);const i=e.XpG();return e.Njj(i.isExpanded=!0)}),e.j41(2,"ion-accordion",28)(3,"ion-item",29)(4,"ion-label",10),e.EFF(5),e.k0s(),e.j41(6,"ion-label",30),e.EFF(7),e.k0s(),e.nrm(8,"ion-icon",31),e.k0s(),e.j41(9,"div",32),e.DNE(10,Y,3,1,"ion-item",33),e.k0s()()()}if(2&d){const p=e.XpG();e.Y8G("disabled",p.isSaveClicked)("value",p.isExpanded),e.R7$(5),e.JRh(p.lang.text.AddGroup.SelectServer),e.R7$(2),e.JRh(p.servers[p.index].name),e.R7$(3),e.Y8G("ngForOf",p.servers)}}function Q(d,b){if(1&d){const p=e.RV6();e.j41(0,"div",34)(1,"ion-item",13)(2,"ion-toggle",35),e.mxI("ngModelChange",function(i){e.eBV(p);const n=e.XpG();return e.DH7(n.userInput.isNSFW,i)||(n.userInput.isNSFW=i),e.Njj(i)}),e.EFF(3),e.k0s()(),e.j41(4,"div",36),e.nrm(5,"img",37),e.k0s()()}if(2&d){const p=e.XpG();e.R7$(2),e.R50("ngModel",p.userInput.isNSFW),e.R7$(),e.JRh(p.lang.text.AddPost.NSFW),e.R7$(2),e.Aen(p.userInput.isNSFW?"filter: blur(16px);":""),e.Y8G("src",p.MainPostImage,e.B4B)}}function J(d,b){1&d&&(e.j41(0,"div",38),e.EFF(1,"Enter"),e.k0s())}function z(d,b){if(1&d&&e.nrm(0,"ion-icon",43),2&d){const p=e.XpG().$implicit;e.Y8G("name",p.icon||"close-circle")}}function K(d,b){if(1&d&&e.nrm(0,"img",44),2&d){const p=e.XpG().$implicit;e.Y8G("src","assets/icon/"+p.icon_img,e.B4B)("alt",p.title)}}function Z(d,b){if(1&d){const p=e.RV6();e.j41(0,"div",39)(1,"div",40),e.bIt("click",function(){const i=e.eBV(p).$implicit;return e.Njj(i.act())})("contextmenu",function(){const i=e.eBV(p).$implicit;return e.Njj(i.context?i.context():null)}),e.DNE(2,z,1,1,"ion-icon",41)(3,K,1,2,"img",42),e.j41(4,"div"),e.EFF(5),e.k0s()()()}if(2&d){const p=b.$implicit;e.R7$(),e.Aen("cursor: "+(p.cursor||"pointer")+";"),e.Y8G("hidden",p.isHide),e.R7$(),e.Y8G("ngIf",p.icon),e.R7$(),e.Y8G("ngIf",p.icon_img),e.R7$(2),e.JRh(p.name)}}function q(d,b){if(1&d){const p=e.RV6();e.j41(0,"ion-item",45),e.bIt("click",function(){const i=e.eBV(p),n=i.$implicit,s=i.index,r=e.XpG();return e.Njj(r.open_viewer(n,s))})("contextmenu",function(){const i=e.eBV(p).index,n=e.XpG();return e.Njj(n.PostAttachContextMenu(i))}),e.j41(1,"ion-label"),e.EFF(2),e.k0s(),e.j41(3,"div",46),e.nrm(4,"img",47),e.k0s()()}if(2&d){const p=b.$implicit,t=b.index,i=e.XpG();e.Y8G("disabled",i.isSaveClicked),e.R7$(2),e.JRh("{"+t+"} "+p.filename),e.R7$(2),e.Y8G("src",p.thumbnail,e.B4B)}}function tt(d,b){1&d&&(e.j41(0,"div",48),e.EFF(1,"Ctrl + Enter"),e.k0s())}const et=[{path:"",component:(()=>{var d;class b{constructor(t,i,n,s,r,o,h,c,u,y,C,l){var x,a=this;this.global=t,this.lang=i,this.navCtrl=n,this.nakama=s,this.p5toast=r,this.indexed=o,this.sanitizer=h,this.route=c,this.router=u,this.floatButton=y,this.alertCtrl=C,this.p5loading=l,this.servers=[],this.userInput={id:void 0,title:void 0,content:void 0,creator_id:void 0,creator_name:void 0,UserColor:void 0,create_time:void 0,modify_time:void 0,server:void 0,mainImage:void 0,attachments:[],OutSource:void 0,isNSFW:!1,CDN:void 0},this.index=0,this.CheckIfTitleInputFocus=!1,this.isModify=!1,this.voidDrawContextId="add_post_voiddraw",this.isExpanded=!1,this.isSaveClicked=!1,this.isServerChanged=!1,this.useVoiceRecording=!1,this.MainPostImage=null,this.extended_buttons=[{icon:"image-outline",name:this.lang.text.AddPost.MainPostImage,act:()=>{this.isSaveClicked||(this.MainPostImage?(URL.revokeObjectURL(this.MainPostImage),this.MainPostImage=null,this.userInput.mainImage=void 0,document.getElementById("PostMainImage_sel").value=""):document.getElementById("PostMainImage_sel").click())},context:()=>(function(){var f=(0,g.A)(function*(){let v;try{try{let T=yield a.global.GetValueFromClipboard("add_post");switch(T.type){case"text/plain":v=T.value;break;case"image/png":return void a.ChangeMainPostImage({target:{files:[T.value]}});case"error":throw T.value}}catch(T){throw T}try{let T=a.global.Base64ToBlob(v),V=v.split(";")[0].split(":")[1],at=new File([T],`${a.lang.text.ChatRoom.FileLink}.${V.split("/").pop()}`,{type:V});throw a.ChangeMainPostImage({target:{files:[at]}}),"done"}catch(T){if("done"===T)throw T}try{if(0!=v.indexOf("http:")&&0!=v.indexOf("https:"))throw"\uc62c\ubc14\ub978 \uc6f9 \uc8fc\uc18c\uac00 \uc544\ub2d8"}catch(T){throw T}let _={};_.url=v,_.content_related_creator=[],_.content_related_creator.push({user_id:"local"==a.isOfficial?"local":a.nakama.servers[a.isOfficial][a.target].session.user_id,timestamp:(new Date).getTime(),display_name:a.nakama.users.self.display_name,various:"link"}),_.content_creator={user_id:"local"==a.isOfficial?"local":a.nakama.servers[a.isOfficial][a.target].session.user_id,timestamp:(new Date).getTime(),display_name:a.nakama.users.self.display_name,various:"link"};let N=_.url.split(".");_.file_ext=N.pop().split("?").shift(),_.filename=decodeURIComponent(`${N.pop().split("/").pop()||a.lang.text.ChatRoom.ExternalLinkFile}.${_.file_ext}`).split("_").pop(),a.global.set_viewer_category_from_ext(_),_.type="",_.typeheader=_.viewer,a.global.modulate_thumbnail(_,_.url,a.cont),a.userInput.mainImage=_,a.MainPostImage=_.url}catch(_){throw"done"==_?_:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${_}`}});return function(){return f.apply(this,arguments)}}()(),!1)},{icon:"document-attach-outline",name:this.lang.text.ChatRoom.attachments,act:()=>{this.isSaveClicked||this.new_attach({detail:{value:"load"}})},context:()=>{if(!this.isSaveClicked)return this.new_attach({detail:{value:"link"}}),!1}},{icon_img:"voidDraw.png",name:this.lang.text.ChatRoom.voidDraw,act:(x=(0,g.A)(function*(){a.isSaveClicked||(a.WillLeavePageInside=!0,a.global.PageDismissAct["add-post-new-image"]=function(){var f=(0,g.A)(function*(v){v.data&&(a.AddAttachTextForm(),yield a.voidDraw_fileAct_callback(v)),delete a.global.PageDismissAct["add-post-new-image"]});return function(v){return f.apply(this,arguments)}}(),a.global.ActLikeModal("portal/community/add-post/void-draw",{dismiss:"add-post-new-image"}))}),function(){return x.apply(this,arguments)}),context:()=>(function(){var f=(0,g.A)(function*(){let v=yield a.global.GetValueFromClipboard("voiddraw");"image/png"===v.type?a.SelectVoidDrawBackgroundImage({target:{files:[v.value]}}):document.getElementById(a.voidDrawContextId).click()});return function(){return f.apply(this,arguments)}}()(),!1)},{icon:"reader-outline",name:this.lang.text.ChatRoom.newText,act:function(){var x=(0,g.A)(function*(){let f={info:{content:{is_new:void 0,type:"text/plain",viewer:"text",filename:void 0,path:void 0}},no_edit:void 0,dismiss:"add-post-viewer"};f.info.content.is_new="text",f.info.content.filename=a.global.TextEditorNewFileName(),f.no_edit=!0,a.WillLeavePageInside=!0,a.global.PageDismissAct["add-post-viewer"]=v=>{if(v.data){let _=a.global.TextEditorAfterAct(v.data,{display_name:a.nakama.users.self.display_name});a.AddAttachTextForm(),a.userInput.attachments.push(_)}delete a.global.PageDismissAct["add-post-viewer"]},a.global.ActLikeModal("portal/community/add-post/ionic-viewer",f)});return function(){return x.apply(this,arguments)}}()},{icon:"camera-outline",name:this.lang.text.ChatRoom.Camera,act:function(){var x=(0,g.A)(function*(){if(!a.isSaveClicked)try{let f=yield a.global.from_camera("tmp_files/post/",{user_id:"local"==a.isOfficial?void 0:a.nakama.servers[a.isOfficial][a.target].session.user_id,display_name:a.nakama.users.self.display_name},"add_post");a.AddAttachTextForm(),a.userInput.attachments.push(f)}catch{}});return function(){return x.apply(this,arguments)}}()},{icon:"mic-circle-outline",name:this.lang.text.ChatRoom.Voice,act:function(){var x=(0,g.A)(function*(){if(!a.isSaveClicked){if(a.global.useVoiceRecording&&"PostRecording"!=a.global.useVoiceRecording)return void a.p5toast.show({text:a.lang.text.GlobalAct[a.global.useVoiceRecording]});a.useVoiceRecording=!a.useVoiceRecording,a.useVoiceRecording?(yield D.R.hasAudioRecordingPermission()).value?(a.global.useVoiceRecording="PostRecording",a.extended_buttons[5].icon="stop-circle-outline",a.p5loading.toast(a.lang.text.ChatRoom.StartVRecord,"add_post"),a.p5StartVoiceTimer(),yield D.R.startRecording(),a.CreateFloatingVoiceTimeHistoryAddButton()):(a.useVoiceRecording=!1,a.extended_buttons[5].icon="mic-circle-outline",yield D.R.requestAudioRecordingPermission()):yield a.StopAndSaveVoiceRecording()}});return function(){return x.apply(this,arguments)}}()},{icon:"cloud-done-outline",name:this.lang.text.ChatRoom.Detour,act:()=>{this.toggle_custom_attach()}},{icon:"globe-outline",name:this.lang.text.AddPost.NoOutLink,act:()=>{this.toggle_open_link()}}],this.lock_modal_open=!1,this.UseOutLink=!1,this.isApplyPostData=!1,this.WillLeavePage=!1,this.WillLeavePageInside=!1}ngOnDestroy(){this.route.queryParams.unsubscribe(),this.TitleInput.onpaste=null,this.TitleInput.onfocus=null,this.TitleInput.onblur=null,this.ContentTextArea.onpaste=null,this.p5StartVoiceTimer=null,this.p5StopVoiceTimer=null,this.cont.abort("\uac8c\uc2dc\ubb3c \ud3b8\uc9d1 \ud398\uc774\uc9c0 \ubc97\uc5b4\ub0a8"),this.cont=null,this.p5canvas&&this.p5canvas.remove(),delete this.nakama.StatusBarChangedCallback,this.useVoiceRecording&&this.StopAndSaveVoiceRecording();try{this.MainPostImage&&setTimeout(()=>{URL.revokeObjectURL(this.MainPostImage)},1e3)}catch{}this.indexed.GetFileListFromDB("tmp_files/post").then(t=>t.forEach(i=>this.indexed.removeFileFromUserPath(i))),this.global.portalHint=!0}ngOnInit(){var t=this;this.voidDrawContextId=`add_post_voiddraw_${Date.now()}`,this.cont=new AbortController,this.UseOutLink=!0,this.toggle_open_link(this.UseOutLink),this.route.queryParams.subscribe(function(){var i=(0,g.A)(function*(n){const s=t.router.getCurrentNavigation().extras.state;let r=!1;var o;if(s&&(r=!!s.act,s.data&&(t.userInput=s.data),t.toggle_custom_attach((null===(o=t.userInput)||void 0===o?void 0:o.CDN)||0)),t.lock_modal_open=!1,r){if(t.LoadListServer(),t.servers.length>1&&(t.index=1),s&&s.data){let h=`${t.userInput.server.isOfficial}/${t.userInput.server.target}`;for(let c=0,u=t.servers.length;c<u;c++)if(`${t.servers[c].isOfficial}/${t.servers[c].target}`==h){t.index=c;break}if(t.userInput.mainImage){let c=t.userInput.mainImage.url;c||(c=URL.createObjectURL(t.userInput.mainImage.blob)),t.MainPostImage=c}for(let c=0,u=t.userInput.attachments.length;c<u;c++)if("image"==t.userInput.attachments[c].viewer)if(t.userInput.attachments[c].url)t.userInput.attachments[c].thumbnail=t.userInput.attachments[c].url;else{let y=yield t.indexed.loadBlobFromUserPath(t.userInput.attachments[c].path,t.userInput.attachments[c].type);const C=URL.createObjectURL(y);t.userInput.attachments[c].thumbnail=C,setTimeout(()=>{URL.revokeObjectURL(C)},1e3)}t.UseOutLink=!!t.userInput.OutSource,t.toggle_open_link(t.UseOutLink),t.OriginalInfo=JSON.parse(JSON.stringify(t.userInput))}t.select_server(t.index)}});return function(n){return i.apply(this,arguments)}}()),setTimeout(()=>{this.WillLeavePage||this.CreateDrop()},100),this.nakama.StatusBarChangedCallback=()=>{this.LoadListServer(),this.index=0}}LoadListServer(){this.servers=this.nakama.get_all_server_info(!0,!0),this.servers.unshift({name:this.lang.text.AddGroup.UseLocalStorage,isOfficial:"local",target:"target",local:!0})}WaitingCurrent(){var t=this;return(0,g.A)(function*(){for(;t.WillLeavePage;)yield new Promise(i=>setTimeout(i,0))})()}CreateDrop(){var t=this;let i=document.getElementById("p5Drop_addPost");this.p5canvas||(this.p5canvas=new I(n=>{let s=0;n.setup=()=>{let o=n.createCanvas(i.clientWidth,i.clientHeight);o.parent(i),n.pixelDensity(.1),o.drop(function(){var h=(0,g.A)(function*(c){yield t.selected_blobFile_callback_act(c.file)});return function(c){return h.apply(this,arguments)}}()),n.noLoop(),this.p5StartVoiceTimer=()=>{n.loop(),s=n.millis()},this.p5StopVoiceTimer=()=>{n.noLoop()}},n.draw=()=>{this.useVoiceRecording&&(this.extended_buttons[5].name=r(n.millis()-s))};let r=o=>{let h=o/1e3,c=n.floor(h)%60,u=h/60,y=n.floor(u)%60,C=n.floor(u/60);return C?`${C}:${n.nf(y,2)}:${n.nf(c,2)}`:`${y}:${n.nf(c,2)}`};n.mouseMoved=o=>{o.dataTransfer?(i.style.pointerEvents="all",i.style.backgroundColor="#0008"):(i.style.pointerEvents="none",i.style.backgroundColor="transparent")},n.keyPressed=function(){var o=(0,g.A)(function*(h){t.WillLeavePage||"Enter"!==h.key||(document.activeElement==t.TitleInput&&setTimeout(()=>{t.ContentTextArea.focus()},0),h.ctrlKey&&t.postData())});return function(h){return o.apply(this,arguments)}}()}))}ionViewWillEnter(){this.global.portalHint=!1,this.WillLeavePage=!1,this.TitleInput=document.getElementById("add_post_title").childNodes[1].childNodes[1].childNodes[1],this.TitleInput.onblur||(this.TitleInput.onblur=()=>{this.CheckIfTitleInputFocus=!1}),this.TitleInput.onfocus||(this.TitleInput.onfocus=()=>{this.CheckIfTitleInputFocus=!0}),this.TitleInput.onpaste||(this.TitleInput.onpaste=t=>{let i=[];for(const n of t.clipboardData.files)i.push({file:n});if(i.length)return 1==i.length&&this.ChangeMainPostImage({target:{files:[i[0].file]}}),!1}),this.ContentTextArea=document.getElementById("add_post_content"),setTimeout(()=>{"DesktopPWA"==P.aH&&(this.userInput.title?this.ContentTextArea.focus():this.TitleInput.focus())},200),this.ContentTextArea.onpaste||(this.ContentTextArea.onpaste=t=>{let i=[];for(const n of t.clipboardData.files)i.push({file:n});if(i.length){for(let n=0,s=i.length;n<s;n++)this.selected_blobFile_callback_act(i[n].file);return!1}}),this.isModify=!!this.userInput.id}SelectVoidDrawBackgroundImage(t){var i=this;return(0,g.A)(function*(){const n=t.target.files[0],s=`tmp_files/add_post/${n.name}`;yield i.indexed.saveBlobToUserPath(n,s);let r=yield i.indexed.loadBlobFromUserPath(s,n.type);const o=URL.createObjectURL(r);new I(h=>{h.setup=()=>{document.getElementById(i.voidDrawContextId).value="",h.noCanvas(),h.loadImage(o,c=>{i.global.PageDismissAct["add-post-new-image-quick"]=function(){var u=(0,g.A)(function*(y){y.data&&(i.AddAttachTextForm(),yield i.voidDraw_fileAct_callback(y)),delete i.global.PageDismissAct["add-post-new-image-quick"]});return function(y){return u.apply(this,arguments)}}(),i.global.ActLikeModal("portal/community/add-post/void-draw",{path:s,width:c.width,height:c.height,type:n.type,dismiss:"add-post-new-image-quick"}),URL.revokeObjectURL(o),h.remove()},c=>{console.log("\ube60\ub978 \ud3b8\uc9d1\uae30 \uc774\ub3d9 \uc2e4\ud328: ",c),URL.revokeObjectURL(o),h.remove()})}})})()}ionViewDidEnter(){this.WillLeavePageInside||this.global.StoreShortCutAct("AddPostPage"),this.WillLeavePageInside=!1,this.AddShortcut()}go_to_profile(){this.nakama.open_profile_page({isOfficial:this.isOfficial,target:this.target})}select_server(t,i=!1){this.index=t,this.userInput.server=this.servers[t],this.isExpanded=!1,this.isOfficial=this.servers[t].isOfficial,this.target=this.servers[t].target,i?this.isServerChanged=this.OriginalServerInfo!=`${this.isOfficial}/${this.target}`:this.OriginalServerInfo=`${this.isOfficial}/${this.target}`,this.userInput.creator_name=this.nakama.users.self.display_name;try{this.userInput.creator_id=this.nakama.servers[this.isOfficial][this.target].session.user_id,this.userInput.UserColor=(this.userInput.creator_id.replace(/[^5-79a-b]/g,"")+"abcdef").substring(0,6),this.extended_buttons[7].isHide=2==this.userInput.CDN}catch{this.userInput.creator_id="me",this.userInput.UserColor="888888",this.extended_buttons[7].isHide=!0,this.toggle_open_link(!0)}"DesktopPWA"==P.aH&&this.TitleInput&&this.TitleInput.focus()}AddShortcut(){this.global.p5key&&this.global.p5KeyShortCut&&(this.global.p5KeyShortCut.Escape=()=>{this.navCtrl.navigateBack("portal/community")})}AddVoiceTimeHistory(){const t=this.ContentTextArea.value,i=this.ContentTextArea.selectionStart,s=t.substring(i).indexOf("\n\n");if(s<0){let r=`{"i":"n","t":"${this.extended_buttons[5].name}"}\n\n`;t&&("\n"!=t.charAt(t.length-1)&&(r="\n"+r),"\n"!=t.charAt(t.length-2)&&(r="\n"+r)),this.userInput.content=`${t||""}${r}`}else{const o=t.substring(0,i).length+s+1,h=t.substring(0,o);let c=t.substring(o),u=`\n{"i":"n","t":"${this.extended_buttons[5].name}"}`;0!=c.indexOf("\n\n")&&(u+="\n"),0==c.indexOf("\n\n\n")&&(c=c.substring(1)),this.userInput.content=`${h}${u}${c}`}this.ContentTextArea.focus()}CreateFloatingVoiceTimeHistoryAddButton(){this.floatButton.RemoveFloatButton("addpost-timer"),this.floatButton.AddFloatButton("addpost-timer","timer-outline").mouseClicked(()=>{this.AddVoiceTimeHistory(),this.p5toast.show({text:`${this.lang.text.AddPost.RecordVoiceTime}: ${this.extended_buttons[5].name}`})})}StopAndSaveVoiceRecording(){var t=this;return(0,g.A)(function*(){t.floatButton.RemoveFloatButton("addpost-timer");const i="add_post";t.p5loading.update({id:i,message:t.lang.text.AddPost.SavingRecord});try{let n=yield t.global.StopAndSaveVoiceRecording();yield t.selected_blobFile_callback_act(n)}catch{}t.p5loading.remove(i),t.extended_buttons[5].icon="mic-circle-outline",t.extended_buttons[5].name=t.lang.text.ChatRoom.Voice,t.checkVoiceLinker()})()}checkVoiceLinker(){this.p5StopVoiceTimer&&this.p5StopVoiceTimer();let t=this.userInput.content.split("\n");for(let i=0,n=t.length;i<n;i++)try{let s=JSON.parse(t[i]);"n"==s.i&&(s.i=this.userInput.attachments.length-1),t[i]=JSON.stringify(s)}catch{}this.userInput.content=t.join("\n")}ChangeMainPostImage(t){let i=t.target.files[0],n={};n.filename=i.name,n.file_ext=i.name.split(".").pop()||i.type||this.lang.text.ChatRoom.unknown_ext,n.size=i.size,n.type=i.type||i.type_override,n.blob=i,n.path=`tmp_files/post/MainImage.${n.file_ext}`,this.userInput.mainImage=n;const s=URL.createObjectURL(i);this.indexed.saveBlobToUserPath(i,n.path),this.MainPostImage=s,this.p5loading.update({id:"add_post",message:this.lang.text.AddPost.SyncMainImage,image:this.MainPostImage,forceEnd:1e3})}selected_blobFile_callback_act(t,i=[],n="loaded",s){var r=this;return(0,g.A)(function*(){let o=r.global.selected_blobFile_callback_act(t,"tmp_files/post/",{user_id:"local"==r.isOfficial?"local":r.nakama.servers[r.isOfficial][r.target].session.user_id,display_name:r.nakama.users.self.display_name},n,i);yield r.create_selected_thumbnail(o),void 0===s?(r.AddAttachTextForm(),r.userInput.attachments.push(o)):r.userInput.attachments[s]=o,r.indexed.saveBlobToUserPath(o.blob,o.path)})()}AddAttachTextForm(){const t=this.ContentTextArea.value,i=this.ContentTextArea.selectionStart,s=t.substring(i).indexOf("\n\n");if(s<0){let r=`{${this.userInput.attachments.length}}\n\n`;t&&("\n"!=t.charAt(t.length-1)&&(r="\n"+r),"\n"!=t.charAt(t.length-2)&&(r="\n"+r)),this.userInput.content=`${t||""}${r}`}else{const o=t.substring(0,i).length+s+1,h=t.substring(0,o);let c=t.substring(o),u=`\n{${this.userInput.attachments.length}}`;0!=c.indexOf("\n\n")&&(u+="\n"),0==c.indexOf("\n\n\n")&&(c=c.substring(1)),this.userInput.content=`${h}${u}${c}`}this.ContentTextArea.focus()}create_selected_thumbnail(t){var i=this;return(0,g.A)(function*(){if(i.global.set_viewer_category_from_ext(t),t.url){try{(yield fetch(t.url,{signal:i.cont.signal})).ok&&(t.thumbnail=t.url)}catch{}return void(t.typeheader=t.viewer)}try{t.thumbnail=yield i.indexed.loadBlobFromUserPath(t.path,t.type)}catch{}const n=URL.createObjectURL(t.blob);"image"===(i.p5loading.update({id:"add_post",image:"image"==t.viewer?n:null},!0),t.typeheader=t.blob.type.split("/")[0]||t.viewer,setTimeout(()=>{URL.revokeObjectURL(n)},0),t.thumbnail=void 0,t.typeheader)&&(t.thumbnail=i.sanitizer.bypassSecurityTrustUrl(n))})()}voidDraw_fileAct_callback(t,i,n){var s=this;return(0,g.A)(function*(){let r=yield s.global.voidDraw_fileAct_callback(t,"tmp_files/post/",{user_id:"local"==s.isOfficial?"local":s.nakama.servers[s.isOfficial][s.target].session.user_id,display_name:s.nakama.users.self.display_name},i);r.thumbnail=s.sanitizer.bypassSecurityTrustUrl(t.data.img),void 0!==n?s.userInput.attachments[n]=r:s.userInput.attachments.push(r),s.p5loading.remove(t.data.loadingCtrl)})()}new_attach(t){var i=this;return(0,g.A)(function*(){switch(t.detail.value){case"load":document.getElementById("add_post_input").click();break;case"link":let n;try{try{let o=yield i.global.GetValueFromClipboard("add_post");switch(o.type){case"text/plain":n=o.value;break;case"image/png":return void i.inputFileSelected({target:{files:[o.value]}});case"error":throw o.value}}catch(o){throw o}try{let o=i.global.Base64ToBlob(n),h=n.split(";")[0].split(":")[1],c=new File([o],`${i.lang.text.ChatRoom.FileLink}.${h.split("/").pop()}`,{type:h});throw yield i.selected_blobFile_callback_act(c),"done"}catch(o){if("done"===o)throw o}try{if(0!=n.indexOf("http:")&&0!=n.indexOf("https:"))throw"\uc62c\ubc14\ub978 \uc6f9 \uc8fc\uc18c\uac00 \uc544\ub2d8"}catch(o){throw o}let s={};s.url=n,s.content_related_creator=[],s.content_related_creator.push({user_id:"local"==i.isOfficial?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"}),s.content_creator={user_id:"local"==i.isOfficial?"local":i.nakama.servers[i.isOfficial][i.target].session.user_id,timestamp:(new Date).getTime(),display_name:i.nakama.users.self.display_name,various:"link"};let r=s.url.split(".");s.file_ext=r.pop().split("?").shift(),s.filename=decodeURIComponent(`${r.pop().split("/").pop()||i.lang.text.ChatRoom.ExternalLinkFile}.${s.file_ext}`).split("_").pop(),i.global.set_viewer_category_from_ext(s),s.type="",s.typeheader=s.viewer,i.global.modulate_thumbnail(s,s.url,i.cont),i.AddAttachTextForm(),i.userInput.attachments.push(s)}catch(s){throw"done"==s?s:`\uc778\uc2dd \ubd88\uac00\ub2a5\ud55c URL \uc815\ubcf4: ${s}`}}})()}RemoveCurrentAttach(t){this.p5loading.toast(`${this.lang.text.AddPost.RemoveAttach}: ${this.userInput.attachments[t].filename}`,"add_post"),this.userInput.attachments.splice(t,1);let i=this.userInput.content.split("\n");for(let n=i.length-1;n>=0;n--){let s=!1,r=i[n].length-1,o=0;try{o=Number(i[n].substring(1,r)),s="{"==i[n].charAt(0)&&"}"==i[n].charAt(r)&&!isNaN(o)}catch{}if(s)if(t==o){if(""==i[n+1])try{i.splice(n+1,1)}catch{}i.splice(n,1)}else t<o&&(i[n]=`{${o-1}}`)}this.userInput.content=i.join("\n")}PostAttachContextMenu(t){return this.alertCtrl.create({header:this.lang.text.AddPost.RemoveAttach,message:`{${t}} ${this.userInput.attachments[t].filename}`,buttons:[{text:this.lang.text.UserFsDir.RemoveApply,handler:()=>{this.RemoveCurrentAttach(t)},cssClass:"redfont"}]}).then(i=>i.present()),!1}inputFileSelected(t){var i=this;return(0,g.A)(function*(){var n;if(null!==(n=t.target)&&void 0!==n&&null!==(n=n.files)&&void 0!==n&&n.length){const s="add_post";if(1!=t.target.files.length){i.p5loading.update({id:s,message:i.lang.text.ContentViewer.OnLoadContent,progress:0});for(let o=0,h=t.target.files.length;o<h;o++)i.p5loading.update({id:s,message:`${i.lang.text.ContentViewer.OnLoadContent}: ${t.target.files[o].name}`,progress:o/h}),yield i.selected_blobFile_callback_act(t.target.files[o]);i.p5loading.remove(s),setTimeout(()=>{document.getElementById("add_post_input").value=""},300)}else i.p5loading.update({id:s}),yield i.selected_blobFile_callback_act(t.target.files[0]),i.p5loading.remove(s),document.getElementById("add_post_input").value=""}})()}open_viewer(t,i){var n=this;let s=[];for(let r=0,o=this.userInput.attachments.length;r<o;r++)s.push({content:this.userInput.attachments[r]});this.lock_modal_open||(this.lock_modal_open=!0,this.global.PageDismissAct["add-post-open-viewer"]=function(){var r=(0,g.A)(function*(o){if(o.data)switch(o.data.type){case"image":let h=[];if(o.data.msg.content.content_related_creator&&(h=[...o.data.msg.content.content_related_creator]),o.data.msg.content.content_creator){let c=!1;for(let u=0,y=h.length;u<y;u++)if(h[u].user_id==o.data.msg.content.content_creator.user_id){c=!0;break}c||h.push(o.data.msg.content.content_creator)}return n.global.PageDismissAct["add-post-modify-image"]=function(){var c=(0,g.A)(function*(u){u.data&&(yield n.voidDraw_fileAct_callback(u,h,i)),delete n.global.PageDismissAct["add-post-modify-image"]});return function(u){return c.apply(this,arguments)}}(),yield n.WaitingCurrent(),n.WillLeavePageInside=!0,void n.global.ActLikeModal("portal/community/add-post/void-draw",{path:o.data.path||t.path,width:o.data.width,height:o.data.height,type:o.data.filetype,isDarkMode:o.data.isDarkMode,scrollHeight:o.data.scrollHeight,dismiss:"add-post-modify-image"});case"text":yield n.selected_blobFile_callback_act(o.data.blob,o.data.contentRelated,"textedit",i)}delete n.global.PageDismissAct["add-post-open-viewer"]});return function(o){return r.apply(this,arguments)}}(),this.WillLeavePageInside=!0,this.global.ActLikeModal("portal/community/add-post/ionic-viewer",{info:{content:t},path:t.path,alt_path:t.path,isOfficial:this.isOfficial,target:this.target,relevance:s,dismiss:"add-post-open-viewer"}))}toggle_custom_attach(t){var i=this;return(0,g.A)(function*(){switch(i.userInput.CDN=(null!=t?t:i.userInput.CDN+1)%3,i.userInput.CDN){case 0:i.extended_buttons[6].icon="cloud-offline-outline",i.extended_buttons[6].name=i.lang.text.ChatRoom.Detour;break;case 1:i.extended_buttons[6].icon="cloud-done-outline",i.extended_buttons[6].name=i.lang.text.ChatRoom.useFSS;break;case 2:i.extended_buttons[6].icon="server-outline",i.extended_buttons[6].name=i.lang.text.ChatRoom.forceSQL}})()}toggle_open_link(t){var i=this;return(0,g.A)(function*(){i.UseOutLink=null!=t?t:!i.UseOutLink,i.UseOutLink?(i.extended_buttons[7].icon="link-outline",i.extended_buttons[7].name=i.lang.text.AddPost.UseOutLink):(i.extended_buttons[7].icon="globe-outline",i.extended_buttons[7].name=i.lang.text.AddPost.NoOutLink)})()}showPreview(){this.global.RemoveAllModals(()=>{this.navCtrl.navigateForward("portal/community/add-post/post-viewer",{state:{data:this.userInput,index:-1}})})}postData(){var t=this;return(0,g.A)(function*(){var i;if(!t.userInput.title)return t.p5toast.show({text:t.lang.text.AddPost.NeedPostTitle}),void t.TitleInput.focus();t.isApplyPostData=!0,t.navCtrl.navigateBack("portal/community");const n=`postData_${Date.now()}`;yield t.p5loading.update({id:n,message:`${t.lang.text.AddPost.WIP}: ${t.userInput.title}`,forceEnd:null}),t.useVoiceRecording&&(yield t.StopAndSaveVoiceRecording());let s=!!t.userInput.server.local;t.isSaveClicked=!0;let r=t.userInput.server.isOfficial,o=t.userInput.server.target,h={};try{let u=t.nakama.servers[r][o].info;h.cdn_port=u.cdn_port,h.apache_port=u.apache_port}catch{h={}}let c=(null===(i=t.OriginalInfo)||void 0===i?void 0:i.CDN)!=t.userInput.CDN;if(t.isModify||c||t.isServerChanged){if(t.userInput.mainImage&&t.userInput.mainImage.url){try{let u=yield fetch(t.userInput.mainImage.url,{signal:t.cont.signal});u.ok&&(t.userInput.mainImage.blob=yield u.blob())}catch{}delete t.userInput.mainImage.thumbnail,delete t.userInput.mainImage.alt_path,t.userInput.mainImage.override_name=t.userInput.mainImage.url.split("/").pop(),delete t.userInput.mainImage.url}for(let u=0,y=t.userInput.attachments.length;u<y;u++)if(!t.userInput.attachments[u].blob)if(t.userInput.attachments[u].url)try{let l=yield(yield fetch(t.userInput.attachments[u].url)).blob();t.userInput.attachments[u].blob=l,delete t.userInput.attachments[u].thumbnail,delete t.userInput.attachments[u].alt_path,t.userInput.attachments[u].override_name=t.userInput.attachments[u].url.split("/").pop(),delete t.userInput.attachments[u].url}catch{continue}else{let C=yield t.indexed.loadBlobFromUserPath(t.userInput.attachments[u].path,t.userInput.attachments[u].type);t.userInput.attachments[u].blob=C}yield t.nakama.RemovePost(t.userInput,void 0,n),t.OriginalInfo&&(yield t.nakama.RemovePost(t.OriginalInfo,void 0,n))}t.p5loading.update({id:n,message:`${t.lang.text.AddPost.WIP}: ${t.userInput.title}`});try{if(!t.isModify||t.isServerChanged)if(s){let l=Number(yield t.indexed.loadTextFromUserPath("servers/local/target/posts/me/counter.txt"))||0;t.userInput.id=`LocalPost_${l}`;try{yield t.indexed.saveTextFileToUserPath(`${l+1}`,"servers/local/target/posts/me/counter.txt")}catch(a){t.p5toast.show({text:`${t.lang.text.AddPost.SyncErr}: ${a}`}),console.log(a)}}else try{let l=yield t.nakama.servers[r][o].client.readStorageObjects(t.nakama.servers[r][o].session,{object_ids:[{collection:"server_post",key:"Counter",user_id:t.nakama.servers[r][o].session.user_id}]}),a=0;l.objects.length&&(a=l.objects[0].value.counter),t.userInput.id=`ServerPost_${a}`,yield t.nakama.servers[r][o].client.writeStorageObjects(t.nakama.servers[r][o].session,[{collection:"server_post",key:"Counter",permission_write:1,permission_read:2,value:{counter:a+1}}])}catch(l){t.p5toast.show({text:`${t.lang.text.AddPost.SyncErr}: ${l}`}),console.log(l)}t.isModify?t.userInput.modify_time=(new Date).getTime():(t.userInput.create_time=(new Date).getTime(),t.userInput.modify_time=t.userInput.create_time);for(let l=0,a=t.userInput.attachments.length;l<a;l++)delete t.userInput.attachments[l].thumbnail;if(t.userInput.mainImage){if(t.p5loading.update({id:n,message:t.lang.text.AddPost.SyncMainImage}),t.userInput.mainImage.path=`servers/${r}/${o}/posts/${t.userInput.creator_id}/${t.userInput.id}/MainImage.${t.userInput.mainImage.file_ext}`,t.userInput.mainImage.thumbnail=t.MainPostImage,!t.userInput.mainImage.blob)try{let a=yield(yield fetch(t.MainPostImage)).blob();t.userInput.mainImage.blob=a}catch{}if(t.p5loading.update({id:n,image:t.MainPostImage}),s)try{if(1!=t.userInput.CDN)throw"FFS \uc0ac\uc6a9 \uc21c\uc704\uc5d0 \uc5c6\uc74c";let l;if(t.p5loading.update({id:n,message:`${t.lang.text.AddPost.SyncMainImage}: ${t.userInput.mainImage.filename}`}),l=yield t.global.try_upload_to_user_custom_fs(t.userInput.mainImage,t.nakama.users.self.display_name,n,t.userInput.title),!l)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete t.userInput.mainImage.path,delete t.userInput.mainImage.partsize,t.userInput.mainImage.url=l}catch{yield t.indexed.saveBlobToUserPath(t.userInput.mainImage.blob,t.userInput.mainImage.path)}else try{if(2==t.userInput.CDN)throw"SQL \uac15\uc81c";let l=t.nakama.servers[t.isOfficial][t.target].info.address,a=t.nakama.servers[t.isOfficial][t.target].info.useSSL?"https:":"http:",x=yield t.global.upload_file_to_storage(t.userInput.mainImage,{user_id:t.nakama.servers[t.isOfficial][t.target].session.user_id,cdn_port:h.cdn_port,apache_port:h.apache_port},a,l,1==t.userInput.CDN,n,t.userInput.title);if(!x)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete t.userInput.mainImage.partsize,t.userInput.mainImage.url=x}catch{yield t.nakama.sync_save_file(t.userInput.mainImage,r,o,"server_post",`${t.userInput.id}_mainImage`)}}let u=t.userInput.attachments.length;if(u){t.p5loading.update({id:n,message:t.lang.text.AddPost.SyncAttaches});for(let l=u-1;l>=0;l--)if(s)try{if(1!=t.userInput.CDN)throw"FFS \uc0ac\uc6a9 \uc21c\uc704\uc5d0 \uc5c6\uc74c";let a;if(t.p5loading.update({id:n,message:`${t.lang.text.AddPost.SyncAttaches}: [${l}]${t.userInput.attachments[l].filename}`}),a=yield t.global.try_upload_to_user_custom_fs(t.userInput.attachments[l],t.nakama.users.self.display_name,n,t.userInput.title),!a)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";delete t.userInput.attachments[l].path,delete t.userInput.attachments[l].partsize,t.userInput.attachments[l].url=a}catch{try{t.userInput.attachments[l].path=`servers/${r}/${o}/posts/${t.userInput.creator_id}/${t.userInput.id}/[${l}]${t.userInput.attachments[l].filename}`,yield t.indexed.saveBlobToUserPath(t.userInput.attachments[l].blob,t.userInput.attachments[l].path)}catch(x){t.p5toast.show({text:`{${l}} ${t.lang.text.AddPost.AttachError}: ${x}`,lateable:!0}),t.RemoveCurrentAttach(l)}}else try{if(2==t.userInput.CDN)throw"SQL \uac15\uc81c";let a=t.nakama.servers[t.isOfficial][t.target].info.address,x=t.nakama.servers[t.isOfficial][t.target].info.useSSL?"https:":"http:",f=yield t.global.upload_file_to_storage(t.userInput.attachments[l],{user_id:t.nakama.servers[t.isOfficial][t.target].session.user_id,cdn_port:h.cdn_port,apache_port:h.apache_port},x,a,1==t.userInput.CDN,n,t.userInput.title);if(!f)throw"\ub9c1\ud06c \ub9cc\ub4e4\uae30 \uc2e4\ud328";delete t.userInput.attachments[l].path,delete t.userInput.attachments[l].partsize,t.userInput.attachments[l].url=f}catch(a){try{"SQL \uac15\uc81c"==a&&t.userInput.attachments[l].url&&!t.userInput.attachments[l].blob&&(t.userInput.attachments[l].blob=yield(yield fetch(t.userInput.attachments[l].url,{signal:t.cont.signal})).blob()),yield t.nakama.sync_save_file(t.userInput.attachments[l],r,o,"server_post",`${t.userInput.id}_attach_${l}`)}catch(x){t.p5toast.show({text:`{${l}} ${t.lang.text.AddPost.AttachError}: ${x}`,lateable:!0}),t.RemoveCurrentAttach(l)}}}if(t.userInput.OutSource&&(t.global.remove_file_from_storage(t.userInput.OutSource,h),t.userInput.OutSource=void 0),t.UseOutLink=t.UseOutLink&&"me"!=t.userInput.creator_id,t.UseOutLink){let l=new Blob([JSON.stringify(t.userInput)],{type:"text/plain"}),a={blob:l,filename:`${t.userInput.id}.json`,file_ext:"json",size:l.size};try{let x=t.nakama.servers[t.isOfficial][t.target].info.address,f=t.nakama.servers[t.isOfficial][t.target].session.user_id,v=t.nakama.servers[t.isOfficial][t.target].info.useSSL?"https:":"http:",_=yield t.global.upload_file_to_storage(a,{user_id:f,cdn_port:h.cdn_port,apache_port:h.apache_port},v,x,1==t.userInput.CDN,n,t.userInput.title);if(!_)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";t.userInput.OutSource=_}catch{try{let f=t.nakama.users.self.display_name,v=yield t.global.try_upload_to_user_custom_fs(a,f,n,t.userInput.title);if(!v)throw"\uc5c5\ub85c\ub4dc \uc2e4\ud328";t.userInput.OutSource=v}catch(f){t.userInput.OutSource=void 0,t.UseOutLink=!1,t.p5toast.show({text:`${t.lang.text.AddPost.OutLinkFailed}: ${f}`})}}}let y=JSON.parse(JSON.stringify(t.userInput));y.mainImage&&(delete y.mainImage.blob,delete y.mainImage.thumbnail);for(let l=y.attachments.length-1;l>=0;l--)delete y.attachments[l].blob;delete y.server;try{t.nakama.posts_orig[r][o]||(t.nakama.posts_orig[r][o]={}),t.nakama.posts_orig[r][o][t.userInput.creator_id]||(t.nakama.posts_orig[r][o][t.userInput.creator_id]={}),t.nakama.posts_orig[r][o][t.userInput.creator_id][t.userInput.id]=t.userInput}catch(l){t.p5toast.show({text:`${t.lang.text.AddPost.SyncErr}: ${l}`}),console.log(l)}let C=JSON.stringify(y);if(yield t.indexed.saveTextFileToUserPath(C,`servers/${r}/${o}/posts/${t.userInput.creator_id}/${t.userInput.id}/info.json`),!s){let l=new Blob([C],{type:"application/json"}),a={filename:"info.json"};a.blob=l,a.size=l.size,a.type="application/json",a.file_ext="json",a.typeheader="text",a.path=`servers/${r}/${o}/posts/${t.userInput.creator_id}/${t.userInput.id}/info.json`,yield t.nakama.sync_save_file(a,r,o,"server_post",t.userInput.id)}t.nakama.rearrange_posts()}catch(u){t.p5toast.show({text:`${t.lang.text.AddPost.SyncErr}: ${u}`}),console.warn("\uac8c\uc2dc\ubb3c \uc800\uc7a5 \ucc98\ub9ac \uc624\ub958: ",u)}try{yield t.nakama.servers[t.isOfficial][t.target].client.rpc(t.nakama.servers[t.isOfficial][t.target].session,"send_noti_all_fn",{noti_id:B.I.MANAGE_POST,type:"add",user_id:t.userInput.creator_id,post_id:t.userInput.id,persistent:!1})}catch{}yield t.p5loading.update({id:n,message:`${t.lang.text.AddPost.WIP}: ${t.userInput.title}`,progress:1,forceEnd:1e3})})()}ionViewWillLeave(){if(this.p5loading.update({id:"add_post",forceEnd:0},!0),this.WillLeavePage=!0,this.WillLeavePageInside||this.global.RestoreShortCutAct("AddPostPage"),delete this.global.p5KeyShortCut.Escape,!this.isApplyPostData)try{this.nakama.posts_orig[this.isOfficial][this.target][this.userInput.creator_id][this.userInput.id]&&delete this.nakama.posts_orig[this.isOfficial][this.target][this.userInput.creator_id][this.userInput.id],this.nakama.load_local_post_with_id(this.userInput.id,this.userInput.server.isOfficial,this.userInput.server.target,this.userInput.creator_id),this.nakama.rearrange_posts()}catch{}}}return(d=b).\u0275fac=function(t){return new(t||d)(e.rXU(k.z3),e.rXU(F.y),e.rXU(U.q9),e.rXU(B.X),e.rXU(R.G),e.rXU(j.n),e.rXU($.up),e.rXU(O.nX),e.rXU(O.Ix),e.rXU(w.u),e.rXU(A.hG),e.rXU(E.f))},d.\u0275cmp=e.VBU({type:d,selectors:[["app-add-post"]],decls:36,vars:22,consts:[["accordionGroup",""],[1,"ion-no-border"],[4,"ngIf"],["slot","start"],["defaultHref","portal/community"],["slot","end","name","play-circle-outline",1,"top_icon",3,"click"],["id","p5Drop_addPost",2,"position","absolute","width","100%","height","100%","display","flex","z-index","500","pointer-events","none"],["value","colors","expand","inset",3,"disabled","value","click",4,"ngIf"],["button","",3,"click"],[1,"additional_form","new_bg_form"],[2,"display","contents"],[1,"ion-text-end"],["style","width: 100%; text-align: center; text-align: -webkit-center; padding: 8px;",4,"ngIf"],["button",""],["id","add_post_title",3,"ngModelChange","disabled","placeholder","ngModel"],[2,"position","relative"],["class","shortcut_hint","style","z-index: 32;",4,"ngIf"],["id","add_post_content",1,"infobox",2,"height","360px",3,"ngModelChange","disabled","placeholder","ngModel"],["hidden","","type","file","id","add_post_input","accept","*","multiple","",3,"change"],["hidden","","type","file","id","PostMainImage_sel","accept","image/*",3,"change"],["hidden","","type","file","accept","image/*",3,"change","id"],[2,"width","100%","text-align","center","padding-bottom","16px"],["style","display: inline-block;",4,"ngFor","ngForOf"],["button","",3,"disabled","click","contextmenu",4,"ngFor","ngForOf"],["class","shortcut_hint",4,"ngIf"],["button","",3,"click","disabled"],[1,"ion-text-center"],["value","colors","expand","inset",3,"click","disabled","value"],["value","colors"],["slot","header"],[1,"ion-text-right"],[1,"ion-accordion-toggle-icon","hide_accordion_icon"],["slot","content"],["button","",3,"click",4,"ngFor","ngForOf"],[2,"width","100%","text-align","center","text-align","-webkit-center","padding","8px"],[2,"pointer-events","none",3,"ngModelChange","ngModel"],[1,"thumbnail_image",2,"width","400px","padding-top","8px"],["alt","MainPostImage",3,"src"],[1,"shortcut_hint",2,"z-index","32"],[2,"display","inline-block"],[1,"ext_button","ext_button_override",3,"click","contextmenu","hidden"],["slot","icon-only","style","width: 36px; height: 36px;",3,"name",4,"ngIf"],["class","ext_icon_img",3,"src","alt",4,"ngIf"],["slot","icon-only",2,"width","36px","height","36px",3,"name"],[1,"ext_icon_img",3,"src","alt"],["button","",3,"click","contextmenu","disabled"],[1,"additional_form","bg_img_form"],[1,"profile_img",3,"src"],[1,"shortcut_hint"]],template:function(t,i){1&t&&(e.j41(0,"ion-header",1)(1,"ion-toolbar"),e.DNE(2,W,2,1,"ion-title",2)(3,X,2,1,"ion-title",2),e.j41(4,"ion-buttons",3),e.nrm(5,"ion-back-button",4),e.k0s(),e.j41(6,"ion-icon",5),e.bIt("click",function(){return i.showPreview()}),e.k0s()()(),e.j41(7,"ion-content"),e.nrm(8,"div",6),e.DNE(9,H,11,5,"ion-accordion-group",7),e.j41(10,"ion-item",8),e.bIt("click",function(){return i.go_to_profile()}),e.nrm(11,"div",9),e.j41(12,"ion-label",10),e.EFF(13),e.k0s(),e.j41(14,"ion-label",11),e.EFF(15),e.k0s()(),e.j41(16,"ion-item-divider")(17,"ion-label"),e.EFF(18),e.k0s()(),e.DNE(19,Q,6,5,"div",12),e.j41(20,"ion-item",13)(21,"ion-input",14),e.mxI("ngModelChange",function(s){return e.DH7(i.userInput.title,s)||(i.userInput.title=s),s}),e.k0s()(),e.j41(22,"div",15),e.DNE(23,J,2,0,"div",16),e.j41(24,"textarea",17),e.mxI("ngModelChange",function(s){return e.DH7(i.userInput.content,s)||(i.userInput.content=s),s}),e.k0s()(),e.j41(25,"input",18),e.bIt("change",function(s){return i.inputFileSelected(s)}),e.k0s(),e.j41(26,"input",19),e.bIt("change",function(s){return i.ChangeMainPostImage(s)}),e.k0s(),e.j41(27,"input",20),e.bIt("change",function(s){return i.SelectVoidDrawBackgroundImage(s)}),e.k0s(),e.j41(28,"div",21),e.DNE(29,Z,6,6,"div",22),e.k0s(),e.DNE(30,q,5,3,"ion-item",23),e.j41(31,"div"),e.DNE(32,tt,2,0,"div",24),e.j41(33,"ion-item",25),e.bIt("click",function(){return i.postData()}),e.j41(34,"ion-label",26),e.EFF(35),e.k0s()()()()),2&t&&(e.R7$(2),e.Y8G("ngIf",i.isModify),e.R7$(),e.Y8G("ngIf",!i.isModify),e.R7$(6),e.Y8G("ngIf",i.servers.length),e.R7$(2),e.Aen("background-image: linear-gradient(to right, #0000, #"+i.userInput.UserColor+"44)"),e.R7$(2),e.JRh(i.lang.text.AddPost.Creator),e.R7$(2),e.JRh(i.userInput.creator_name||i.lang.text.Profile.noname_user),e.R7$(3),e.JRh(i.lang.text.AddPost.AddNewPost),e.R7$(),e.Y8G("ngIf",i.MainPostImage),e.R7$(2),e.Y8G("disabled",i.isSaveClicked)("placeholder",i.lang.text.AddPost.TitlePlaceholder),e.R50("ngModel",i.userInput.title),e.R7$(2),e.Y8G("ngIf",i.global.ShowHint&&i.CheckIfTitleInputFocus),e.R7$(),e.Y8G("disabled",i.isSaveClicked)("placeholder",i.lang.text.AddPost.ContentPlaceHolder),e.R50("ngModel",i.userInput.content),e.R7$(3),e.Y8G("id",i.voidDrawContextId),e.R7$(2),e.Y8G("ngForOf",i.extended_buttons),e.R7$(),e.Y8G("ngForOf",i.userInput.attachments),e.R7$(2),e.Y8G("ngIf",i.global.ShowHint),e.R7$(),e.Y8G("disabled",i.isSaveClicked),e.R7$(2),e.JRh(i.lang.text.AddPost.Post))},dependencies:[S.Sq,S.bT,L.me,L.BC,L.vS,A.xk,A.YH,A.QW,A.W9,A.eU,A.iq,A.$w,A.uz,A.Dg,A.he,A.BC,A.BY,A.ai,A.hB,A.Gw,A.el],styles:[".ext_button_override[_ngcontent-%COMP%]{margin:12px;cursor:pointer}.thumbnail_image[_ngcontent-%COMP%]{width:100%;max-height:240px;object-fit:cover;border-radius:16px;overflow:hidden}"]}),b})()},{path:"void-draw",loadChildren:()=>m.e(2655).then(m.bind(m,2655)).then(d=>d.VoidDrawPageModule)},{path:"ionic-viewer",loadChildren:()=>Promise.all([m.e(4803),m.e(222)]).then(m.bind(m,4803)).then(d=>d.IonicViewerPageModule)},{path:"post-viewer",loadChildren:()=>Promise.all([m.e(222),m.e(526)]).then(m.bind(m,526)).then(d=>d.PostViewerPageModule)}];let it=(()=>{var d;class b{}return(d=b).\u0275fac=function(t){return new(t||d)},d.\u0275mod=e.$C({type:d}),d.\u0275inj=e.G2t({imports:[O.iI.forChild(et),O.iI]}),b})(),nt=(()=>{var d;class b{}return(d=b).\u0275fac=function(t){return new(t||d)},d.\u0275mod=e.$C({type:d}),d.\u0275inj=e.G2t({imports:[S.MD,L.YN,A.bv,it]}),b})()}}]);