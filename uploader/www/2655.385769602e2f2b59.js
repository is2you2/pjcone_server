"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2655],{2655:(ut,De,v)=>{v.r(De),v.d(De,{VoidDrawPageModule:()=>et});var ce=v(177),oe=v(4341),R=v(5374),ae=v(9858),N=v(467),Se=v(8326),Ve=v(92),e=v(3953),We=v(4234),je=v(3656),Me=v(482),Le=v(755),Ne=v(4237),Be=v(9900),Ee=v(4020);const Ge=["ChangeLineWeight"],He=["RemoteDraw"],Xe=["ChangeTransparent"],Oe=["ChangeResolution"],$e=["AddrQRShare"];function Fe(d,S){1&d&&(e.j41(0,"div",18),e.EFF(1,"Shift + S"),e.k0s())}function Ue(d,S){if(1&d&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&d){const r=S.$implicit;e.Y8G("value",r),e.R7$(),e.JRh(r.info.name)}}function Ye(d,S){if(1&d){const r=e.RV6();e.j41(0,"img",25),e.bIt("click",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.copy_address(i.SelectedAddress))}),e.k0s()}if(2&d){const r=e.XpG(2);e.Y8G("src",r.QRCodeSRC,e.B4B)}}function Je(d,S){if(1&d){const r=e.RV6();e.j41(0,"div",20)(1,"div",21),e.DNE(2,Ye,1,1,"img",22),e.j41(3,"ion-item",23),e.bIt("click",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.copy_address(i.SelectedAddress))}),e.j41(4,"ion-label",24),e.EFF(5),e.k0s()()()()}if(2&d){const r=e.XpG();e.R7$(2),e.Y8G("ngIf",r.QRCodeSRC),e.R7$(3),e.JRh(r.SelectedAddress)}}function Qe(d,S){if(1&d){const r=e.RV6();e.j41(0,"div",26),e.bIt("click",function(i){e.eBV(r);const a=e.XpG();return e.Njj(a.CheckIfDismissAct(i))}),e.j41(1,"div",27)(2,"h4"),e.EFF(3),e.k0s(),e.j41(4,"ion-range",28),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.colorPickRed,i)||(a.colorPickRed=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.j41(5,"div",29),e.EFF(6),e.k0s(),e.j41(7,"div",30)(8,"input",31),e.bIt("input",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.colorPickRed,i)||(a.colorPickRed=i),e.Njj(i)}),e.k0s()()(),e.j41(9,"ion-range",28),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.colorPickGreen,i)||(a.colorPickGreen=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.j41(10,"div",29),e.EFF(11),e.k0s(),e.j41(12,"div",30)(13,"input",31),e.bIt("input",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.colorPickGreen,i)||(a.colorPickGreen=i),e.Njj(i)}),e.k0s()()(),e.j41(14,"ion-range",28),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.colorPickBlue,i)||(a.colorPickBlue=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.j41(15,"div",29),e.EFF(16),e.k0s(),e.j41(17,"div",30)(18,"input",31),e.bIt("input",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.colorPickBlue,i)||(a.colorPickBlue=i),e.Njj(i)}),e.k0s()()(),e.j41(19,"ion-range",28),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.colorPickAlpha,i)||(a.colorPickAlpha=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.j41(20,"div",29),e.EFF(21),e.k0s(),e.j41(22,"div",30)(23,"input",31),e.bIt("input",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ColorSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.colorPickAlpha,i)||(a.colorPickAlpha=i),e.Njj(i)}),e.k0s()()()()()}if(2&d){const r=e.XpG();e.R7$(3),e.JRh(r.lang.text.voidDraw.ColorpickDetail),e.R7$(),e.R50("ngModel",r.colorPickRed),e.R7$(2),e.JRh(r.lang.text.voidDraw.ColorpickRed),e.R7$(2),e.R50("ngModel",r.colorPickRed),e.R7$(),e.R50("ngModel",r.colorPickGreen),e.R7$(2),e.JRh(r.lang.text.voidDraw.ColorpickGreen),e.R7$(2),e.R50("ngModel",r.colorPickGreen),e.R7$(),e.R50("ngModel",r.colorPickBlue),e.R7$(2),e.JRh(r.lang.text.voidDraw.ColorpickBlue),e.R7$(2),e.R50("ngModel",r.colorPickBlue),e.R7$(),e.R50("ngModel",r.colorPickAlpha),e.R7$(2),e.JRh(r.lang.text.voidDraw.ColorpickAlpha),e.R7$(2),e.R50("ngModel",r.colorPickAlpha)}}function ze(d,S){if(1&d){const r=e.RV6();e.j41(0,"div",32),e.bIt("click",function(i){e.eBV(r);const a=e.XpG();return e.Njj(a.CheckIfDismissAct(i))}),e.j41(1,"div",33)(2,"h4"),e.EFF(3),e.k0s(),e.j41(4,"ion-range",34),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.resolutionRatio,i)||(a.resolutionRatio=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ResolutionSliderUpdate())}),e.j41(5,"div",29),e.EFF(6),e.k0s(),e.j41(7,"div",30)(8,"input",31),e.bIt("input",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ResolutionSliderUpdate())}),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.resolutionRatio,i)||(a.resolutionRatio=i),e.Njj(i)}),e.k0s()()(),e.j41(9,"ion-toggle",35),e.bIt("ionChange",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.UserToggleAutoResolution())}),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.ToggleAutoResolution,i)||(a.ToggleAutoResolution=i),e.Njj(i)}),e.EFF(10),e.k0s(),e.j41(11,"div"),e.EFF(12),e.k0s()()()}if(2&d){const r=e.XpG();e.R7$(3),e.JRh(r.lang.text.voidDraw.ResolutionDetail),e.R7$(),e.R50("ngModel",r.resolutionRatio),e.Y8G("disabled",r.ToggleAutoResolution),e.R7$(2),e.JRh(r.lang.text.voidDraw.ResolutionRatio),e.R7$(2),e.R50("ngModel",r.resolutionRatio),e.R7$(),e.R50("ngModel",r.ToggleAutoResolution),e.R7$(),e.JRh(r.lang.text.voidDraw.AutoResolution),e.R7$(2),e.Lme("",r.resolutionEffectedWidth," x ",r.resolutionEffectedHeight,"")}}function Ke(d,S){if(1&d){const r=e.RV6();e.j41(0,"div",36),e.bIt("click",function(i){e.eBV(r);const a=e.XpG();return e.Njj(a.CheckIfDismissAct(i))}),e.j41(1,"div",37)(2,"h4"),e.EFF(3),e.k0s(),e.j41(4,"ion-range",38),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.LineCurrentWeight,i)||(a.LineCurrentWeight=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ChangeCurrentLineWeight())}),e.j41(5,"div",29),e.EFF(6),e.k0s(),e.j41(7,"div",30)(8,"input",39),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.LineCurrentWeight,i)||(a.LineCurrentWeight=i),e.Njj(i)}),e.bIt("input",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ChangeCurrentLineWeight())}),e.k0s()()(),e.j41(9,"ion-range",38),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.LineDefaultWeight,i)||(a.LineDefaultWeight=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ChangeDefaultLineWeight())}),e.j41(10,"div",29),e.EFF(11),e.k0s(),e.j41(12,"div",30)(13,"input",39),e.mxI("ngModelChange",function(i){e.eBV(r);const a=e.XpG();return e.DH7(a.LineDefaultWeight,i)||(a.LineDefaultWeight=i),e.Njj(i)}),e.bIt("input",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.ChangeDefaultLineWeight())}),e.k0s()()()()()}if(2&d){const r=e.XpG();e.R7$(3),e.JRh(r.lang.text.voidDraw.changeWeight),e.R7$(),e.R50("ngModel",r.LineCurrentWeight),e.R7$(2),e.JRh(r.lang.text.voidDraw.weight),e.R7$(2),e.R50("ngModel",r.LineCurrentWeight),e.R7$(),e.R50("ngModel",r.LineDefaultWeight),e.R7$(2),e.JRh(r.lang.text.voidDraw.changeDefaultWeight),e.R7$(2),e.R50("ngModel",r.LineDefaultWeight)}}const Ze=[{path:"",component:(()=>{var d;class S{constructor(o,i,a,t,s,C,h,m,x,B,D){this.lang=o,this.alertCtrl=i,this.loadingCtrl=a,this.global=t,this.indexed=s,this.nakama=C,this.p5toast=h,this.webrtc=m,this.router=x,this.route=B,this.navCtrl=D,this.voidDrawId="voidDraw",this.isMobile=!1,this.p5DrawingStack=[],this.colorPickRed=0,this.colorPickGreen=0,this.colorPickBlue=0,this.colorPickAlpha=255,this.isCropMode=!1,this.HasConnectedPeer=!1,this.ServerList=[],this.isDrawServerCreated=!1,this.ReadyToShareAct=!1,this.AlreadyExistServer=!1,this.resolutionRatio=100,this.resolutionEffectedWidth=0,this.resolutionEffectedHeight=0,this.ToggleAutoResolution=!1,this.WillLeaveHere=!1,this.WithoutSave=!0,this.QRNavParams={}}ngOnDestroy(){this.route.queryParams.unsubscribe(),this.global.PageDismissAct[this.navParams.dismiss]&&this.global.PageDismissAct[this.navParams.dismiss]({}),this.p5ActualCanvas&&(this.p5ActualCanvas.remove(),this.p5ActualCanvas=null),!this.AlreadyExistServer&&this.TargetRemoteAddress&&this.nakama.RemoveWebRTCServer(this.TargetRemoteAddress.split("://").pop()),this.p5ImageCanvas&&(this.p5ImageCanvas.remove(),this.p5ImageCanvas=null),this.p5voidDraw&&this.p5voidDraw.remove(),this.IceWebRTCWsClient&&this.IceWebRTCWsClient.close(1e3),this.CancelRemoteAct()}ngOnInit(){var o=this;this.route.queryParams.subscribe(function(){var i=(0,N.A)(function*(a){try{const t=o.router.getCurrentNavigation().extras.state;if(!t)throw"\ud398\uc774\uc9c0 \ubcf5\uadc0";o.navParams=t||{},o.voidDrawId=`voidDraw_${Date.now()}`,o.QueueAfterLoad=()=>{o.create_new_canvas({width:t.width,height:t.height,path:t.path,type:t.type}),t.remote&&setTimeout(()=>{o.Port=t.remote.port,o.username=t.remote.username,o.password=t.remote.password,o.CreateRemoteLocalClient(t.remote.address,t.remote.channel)},1e3)}}catch(t){console.log("\uadf8\ub9bc\ud310 \uc815\ubcf4 \ubc1b\uc9c0 \ubabb\ud568: ",t),o.p5SetDrawable(!0)}});return function(a){return i.apply(this,arguments)}}())}ionViewWillEnter(){this.QueueAfterLoad&&this.QueueAfterLoad(),this.QueueAfterLoad=null,this.p5SetDrawable&&this.p5SetDrawable(!0)}ionViewDidEnter(){var o=this;return(0,N.A)(function*(){o.global.StoreShortCutAct("void-draw"),o.AddShortCut(),o.mainLoading=yield o.loadingCtrl.create({message:o.lang.text.voidDraw.UseThisImage}),o.isMobile="DesktopPWA"!=Ve.aH})()}AddShortCut(){delete this.global.p5KeyShortCut.Digit,this.global.p5KeyShortCut.HistoryAct=o=>{switch(o.code.slice(-1)){case"Z":this.p5history_act(-1);break;case"X":this.p5history_act(1);break;case"C":this.isCropMode?this.p5apply_crop():o.shiftKey?this.p5change_color_contextmenu():this.p5change_color();break;case"V":this.p5set_line_weight()}},this.global.p5KeyShortCut.AddAct=()=>{this.ClickRemoteAddButton()},this.global.p5KeyShortCut.SKeyAct=o=>{o.shiftKey?this.open_crop_tool_contextmenu():this.open_crop_tool()},this.global.p5KeyShortCut.DeleteAct=()=>{this.isCropMode?this.p5apply_crop():this.dismiss_draw()},this.global.p5KeyShortCut.FKeyAct=()=>{},this.global.p5KeyShortCut.Escape=()=>{this.isDrawServerCreated?this.CancelRemoteAct():this.navCtrl.pop()}}CancelRemoteAct(){this.ReadyToShareAct=!1,this.RemoteLoadingCtrl&&this.RemoteLoadingCtrl.dismiss(),this.isDrawServerCreated=!1,this.p5SetDrawable(!0),this.webrtc.close_webrtc(!1)}create_new_canvas(o){o.width=o.width||432,o.height=o.height||432,this.p5ActualCanvas&&(this.p5ActualCanvas.remove(),this.p5ActualCanvas=null),this.p5ImageCanvas&&(this.p5ImageCanvas.remove(),this.p5ImageCanvas=null),this.p5voidDraw&&this.p5voidDraw.remove(),this.create_p5voidDraw(o)}CheckIfDismissAct(o){"colordetailOuter"==o.target.id&&this.ChangeTransparent.dismiss(),"resolutiondetailOuter"==o.target.id&&this.ChangeResolution.dismiss(),"strokeweightOuter"==o.target.id&&this.ChangeLineWeight.dismiss()}create_p5voidDraw(o){var i=this;let a=document.getElementById(this.voidDrawId);this.isCropMode=!1,this.p5voidDraw=new Se(t=>{let s,C,h,m,x,B,D,w,O,V=t.createColorPicker("#000"),de=Math.min(o.width,o.height)/100;const ye=localStorage.getItem("voiddraw-lineweight")||1;let ge,he=Number(ye);t.setup=(0,N.A)(function*(){V.style("position","absolute"),t.pixelDensity(1),t.noLoop(),t.noFill(),t.imageMode(t.CENTER),t.createCanvas(a.clientWidth,a.clientHeight).parent(a),W.x=t.width/2,W.y=t.height/2,i.ChangeCurrentLineWeight=()=>{he=Number(i.LineCurrentWeight)||1},i.ChangeDefaultLineWeight=()=>{localStorage.setItem("voiddraw-lineweight",`${i.LineDefaultWeight||1}`)},i.p5set_line_weight=()=>{i.LineDefaultWeight=Number(ye),i.LineCurrentWeight=he,i.ChangeLineWeight.onDidDismiss().then(()=>{I=!0,A=!1,i.global.RestoreShortCutAct("draw-stroke-weight-change")}),I=!1,i.global.StoreShortCutAct("draw-stroke-weight-change"),i.ChangeLineWeight.present()},i.p5change_color=()=>{V.elt.click()},i.p5change_color_contextmenu=()=>{i.ChangeTransparent.onDidDismiss().then(()=>{I=!0,A=!1,i.global.RestoreShortCutAct("draw-transparent")}),I=!1,i.global.StoreShortCutAct("draw-transparent"),i.ChangeTransparent.present()},i.p5save_image=(f=!1,M=!1)=>{new Se(p=>{p.setup=()=>{let se=p.createCanvas(i.resolutionEffectedWidth,i.resolutionEffectedHeight);p.pixelDensity(1),h&&p.image(h,0,0,i.resolutionEffectedWidth,i.resolutionEffectedHeight),m&&p.image(m,0,0,i.resolutionEffectedWidth,i.resolutionEffectedHeight),s&&p.image(s,0,0,i.resolutionEffectedWidth,i.resolutionEffectedHeight);let ve=se.elt.toDataURL("image/png").replace("image/png","image/octet-stream"),xe=`voidDraw_${p.year()}-${p.nf(p.month(),2)}-${p.nf(p.day(),2)}_${p.nf(p.hour(),2)}-${p.nf(p.minute(),2)}-${p.nf(p.second(),2)}.png`;if(M){let z=i.global.Base64ToBlob(ve,"image/png");i.global.WriteValueToClipboard("image/png",z,"image.png")}else{if(f){i.p5toast.show({text:`${i.lang.text.ContentViewer.DownloadThisFile}: ${xe}`});let z=p.createA(ve,null);z.elt.download=xe,z.hide(),z.parent(a),z.elt.click()}else i.navParams.dismiss&&i.global.PageDismissAct[i.navParams.dismiss]({data:{name:xe,img:ve,loadingCtrl:i.mainLoading}}),i.navCtrl.pop();p.remove()}}})},i.p5history_act=(f,M=!1)=>{let p=L+f;if(!(p>i.p5DrawingStack.length)){switch(L=t.min(t.max(0,p),i.p5DrawingStack.length),f){case 1:i.p5DrawingStack.length&&(w.style.fill="var(--ion-color-dark)"),L==i.p5DrawingStack.length&&(O.style.fill="var(--ion-color-medium)"),J(s,i.p5DrawingStack[L-1]);break;case-1:i.p5DrawingStack.length&&(O.style.fill="var(--ion-color-dark)"),L<1?(w.style.fill="var(--ion-color-medium)",s.clear(255,255,255,255),t.redraw()):ne()}!M&&i.ReadyToShareAct&&i.webrtc.dataChannel.send(JSON.stringify({type:"same",act:"history_act",data:f}))}},i.p5open_crop_tool=()=>{i.isCropMode?(i.isCropMode=!1,t.redraw()):(i.isCropMode=!0,I=!0,g.x=s.width,g.y=s.height,H.x=0,H.y=0,t.redraw()),ge(),A=!1},i.ToggleAutoResolution=!!localStorage.getItem("voidDraw-auto-adjust-res"),i.ToggleAutoResolution&&(i.resolutionRatio=t.min(100,100*_)),i.resolutionEffectedWidth=t.floor(o.width*i.resolutionRatio/100),i.resolutionEffectedHeight=t.floor(o.height*i.resolutionRatio/100),i.open_crop_tool_contextmenu=()=>{i.ChangeResolution.onDidDismiss().then(()=>{I=!0,A=!1,i.global.RestoreShortCutAct("resolution-detail")}),I=!1,i.global.StoreShortCutAct("resolution-detail"),i.ChangeResolution.present()},i.UserToggleAutoResolution=()=>{i.ToggleAutoResolution?(i.resolutionRatio=t.min(100,100*_),i.ResolutionSliderUpdate(),localStorage.setItem("voidDraw-auto-adjust-res","1")):localStorage.removeItem("voidDraw-auto-adjust-res")},i.ResolutionSliderUpdate=()=>{t.pixelDensity(t.min(1,1*(Number(i.resolutionRatio)||1)/100/_)),t.redraw(),i.resolutionEffectedWidth=t.floor(s.width*(Number(i.resolutionRatio)||1)/100),i.resolutionEffectedHeight=t.floor(s.height*(Number(i.resolutionRatio)||1)/100)},i.p5apply_crop=(f=!0)=>{f&&i.isMobile&&H.div(_),s.resizeCanvas(g.x,g.y),C=t.createVector(s.width/2,s.height/2),f&&y.sub(H),ne(),h.resizeCanvas(g.x,g.y),h.push(),h.background(i.navParams.isDarkMode?26:255),h.translate(y),i.p5BaseImage&&h.image(i.p5BaseImage,0,0),h.pop(),h.redraw(),m.resizeCanvas(g.x,g.y),m.push(),x&&(m.translate(y),m.image(x,re.x,re.y)),m.pop(),m.redraw();let M=m.elt.toDataURL("image/png");if(t.loadImage(M,p=>{re.x=-y.x,re.y=-y.y,x=p,m.image(x,0,0),m.redraw()}),i.isCropMode=!1,ge(),i.ToggleAutoResolution&&(i.resolutionRatio=t.min(100,100*_)),i.resolutionEffectedWidth=t.floor(g.x*i.resolutionRatio/100),i.resolutionEffectedHeight=t.floor(g.y*i.resolutionRatio/100),i.p5SetCanvasViewportInit(),f&&i.ReadyToShareAct){let p=i.p5getCropPos(),se=i.p5getCropSize();i.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"crop",cropPX:p.x,cropPY:p.y,cropSX:se.x,cropSY:se.y}))}},i.p5SetDrawable=ht,B=t.createElement("table"),B.style("position: absolute; top: 0px;"),B.style(`width: 100%; height: ${j}px;`),B.style("background-color: var(--voidDraw-menu-background);"),B.parent(a);let l=B.elt.insertRow(0),c=l.insertCell(0);c.innerHTML=i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">A</div><ion-icon style="width: 27px; height: 27px" name="wifi-outline"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="wifi-outline"></ion-icon>',c.style.textAlign="center",c.style.cursor="pointer",c.onclick=()=>{i.ClickRemoteAddButton()};let T=l.insertCell(1);T.innerHTML=i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">S</div><ion-icon style="width: 27px; height: 27px" name="crop"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="crop"></ion-icon>',T.style.textAlign="center",T.style.cursor="pointer",T.onclick=()=>{i.open_crop_tool()},T.oncontextmenu=()=>{i.open_crop_tool_contextmenu()};let P=l.insertCell(2);P.innerHTML=i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>',P.style.textAlign="center",P.style.cursor="pointer",P.onclick=()=>{i.dismiss_draw()},ge=()=>{P.innerHTML=i.isCropMode?i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="cut-sharp"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="cut-sharp"></ion-icon>':i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">D</div><ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="checkmark"></ion-icon>'},D=t.createElement("table"),D.style("position: absolute; bottom: 0px;"),D.style(`width: 100%; height: ${j}px;`),D.style("background-color: var(--voidDraw-menu-background);"),D.parent(a);let $=D.elt.insertRow(0),ee=$.insertCell(0);ee.innerHTML=i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">Z</div><ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon></div>':'<ion-icon id="undoIcon" style="width: 27px; height: 27px" name="arrow-undo"></ion-icon>',w=document.getElementById("undoIcon"),w.style.fill="var(--ion-color-medium)",ee.style.textAlign="center",ee.style.cursor="pointer",ee.onclick=()=>{i.p5history_act(-1)};let te=$.insertCell(1);te.innerHTML=i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">X</div><ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon></div>':'<ion-icon id="redoIcon" style="width: 27px; height: 27px" name="arrow-redo"></ion-icon>',O=document.getElementById("redoIcon"),O.style.fill="var(--ion-color-medium)",te.style.textAlign="center",te.style.cursor="pointer",te.onclick=()=>{i.p5history_act(1)};let X=$.insertCell(2);X.innerHTML=i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">C</div><ion-icon style="width: 27px; height: 27px" name="color-palette"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="color-palette"></ion-icon>',V.style("width: 0px; height: 0px; opacity: 0;"),V.parent(X),V.elt.oninput=()=>{let f=V.color().levels,M=`#${t.hex(f[0],2)}${t.hex(f[1],2)}${t.hex(f[2],2)}`;X.childNodes[0].style.color=M,i.colorPickRed=f[0],i.colorPickGreen=f[1],i.colorPickBlue=f[2],i.colorPickAlpha=f[3]},o.path&&(V.value("#ff0000"),V.elt.oninput()),X.style.textAlign="center",X.style.cursor="pointer",X.onclick=()=>{V.elt.click()},X.oncontextmenu=()=>(i.p5change_color_contextmenu(),!1),i.ColorSliderUpdate=()=>{let f=`#${t.hex(Number(i.colorPickRed)||0,2)}${t.hex(Number(i.colorPickGreen)||0,2)}${t.hex(Number(i.colorPickBlue)||0,2)}`;V.value(f);let M=`#${t.hex(Number(i.colorPickRed)||0,2)}${t.hex(Number(i.colorPickGreen)||0,2)}${t.hex(Number(i.colorPickBlue)||0,2)}${t.hex(Number(i.colorPickAlpha)||0,2)}`;X.childNodes[0].style.color=M};let ie=$.insertCell(3);if(ie.innerHTML=i.global.ShowHint?'<div><div class="shortcut_hint shortcut_voiddraw">V</div><ion-icon style="width: 27px; height: 27px" name="pencil"></ion-icon></div>':'<ion-icon style="width: 27px; height: 27px" name="pencil"></ion-icon>',ie.style.textAlign="center",ie.style.cursor="pointer",ie.onclick=()=>{i.change_line_weight()},i.p5SetCanvasViewportInit=()=>{t.resizeCanvas(a.clientWidth,a.clientHeight),pe=W.copy(),me=_,_e=U.copy(),E=0,ue=!0,t.loop()},s=t.createGraphics(o.width,o.height),C=t.createVector(s.width/2,s.height/2),s.pixelDensity(1),s.noLoop(),s.noFill(),i.p5ActualCanvas=s,h=t.createGraphics(o.width,o.height),h.pixelDensity(1),h.noLoop(),h.noFill(),h.background(i.navParams.isDarkMode?26:255),i.p5ImageCanvas=h,m=t.createGraphics(o.width,o.height),m.pixelDensity(1),m.noLoop(),m.noFill(),m.clear(255,255,255,255),o.path){let f=yield i.indexed.loadBlobFromUserPath(o.path,o.type),M=URL.createObjectURL(f);t.loadImage(M,p=>{i.p5BaseImage=p,h.image(i.p5BaseImage,0,0),h.redraw(),URL.revokeObjectURL(M),setTimeout(()=>{i.p5SetCanvasViewportInit()},100)},p=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",p),h.redraw(),URL.revokeObjectURL(M),setTimeout(()=>{i.p5SetCanvasViewportInit()},100)})}else h.redraw(),setTimeout(()=>{i.p5SetCanvasViewportInit()},100);o.width<o.height&&(de/=_),i.p5getCropPos=it,i.p5setCropPos=ke,i.p5getCropSize=ot,i.p5setCropSize=at,i.p5RemoteDrawStart=lt,i.p5RemoteDrawing=st,i.p5RemoteDrawingEnd=ct,i.p5updateRemoteCurve=nt,i.p5CancelCurrentDraw=()=>{b=null,t.redraw()},i.navParams.scrollHeight&&ke(0,-i.navParams.scrollHeight)});let W=t.createVector(),_=1,U=t.createVector(0,0),y=t.createVector(),re=t.createVector(),H=t.createVector(),g=t.createVector(),ue=!1,E=0,pe=t.createVector(0,0),me=0,_e=t.createVector(0,0),it=()=>y,ot=()=>g,ke=(n,l)=>{y.x=n,y.y=l,h.translate(n,l),m.translate(n,l),t.redraw()},at=(n,l)=>{g.x=n,g.y=l,h.translate(n,l),m.translate(n,l),t.redraw()},Y=n=>t.sin(n*t.PI/2);t.draw=()=>{if(ue){E+=.07,E>=1&&(ue=!1,E=1,t.noLoop()),U.x=t.lerp(_e.x,t.width/2,Y(E)),U.y=t.lerp(_e.y,t.height/2,Y(E)),W.x=t.lerp(pe.x,0,Y(E)),W.y=t.lerp(pe.y,0,Y(E));let n=a.clientHeight-112;_=t.lerp(me,a.clientWidth/n<s.width/s.height?a.clientWidth/s.width:n/s.height,Y(E)),this.ToggleAutoResolution&&(this.resolutionRatio=t.min(100,100*_),this.resolutionEffectedWidth=t.floor(s.width*this.resolutionRatio/100),this.resolutionEffectedHeight=t.floor(s.height*this.resolutionRatio/100)),t.pixelDensity(t.min(1,1*this.resolutionRatio/100/_))}if(t.clear(255,255,255,255),t.push(),t.translate(U),t.scale(_),t.translate(W),t.image(h,0,0),t.image(m,0,0),s&&t.image(s,0,0),this.isCropMode)t.push(),t.translate(-s.width/2,-s.height/2),t.translate(H),t.noStroke(),t.fill(0,100),t.rect(0,0,g.x,g.y),t.stroke(255,0,0),t.strokeWeight(8),t.beginShape(t.LINES),t.vertex(0,0),t.vertex(g.x,0),t.vertex(g.x,0),t.vertex(g.x,.8*g.y),t.vertex(0,0),t.vertex(0,g.y),t.vertex(0,g.y),t.vertex(.8*g.x,g.y),t.stroke(255,255,0),t.vertex(.8*g.x,g.y),t.vertex(g.x,g.y),t.vertex(g.x,.8*g.y),t.vertex(g.x,g.y),t.endShape(),t.pop();else{if(u&&u.pos&&u.pos.length){t.push(),t.translate(y),t.stroke(u.color),t.strokeWeight(u.weight),t.beginShape();for(let n=0,l=u.pos.length;n<l;n++)t.curveVertex(u.pos[n].x-C.x,u.pos[n].y-C.y);t.endShape(),t.pop()}if(this.ReadyToShareAct&&b&&b.pos&&b.pos.length){t.push(),t.translate(y),t.stroke(b.color),t.strokeWeight(b.weight),t.beginShape();for(let n=0,l=b.pos.length;n<l;n++)t.curveVertex(b.pos[n].x-C.x,b.pos[n].y-C.y);t.endShape(),t.pop()}}t.pop()},this.p5DrawingStack=[],this.p5ClearCurrentDraw=()=>{u={},this.p5DrawingStack.length=0,L=0,ne(),t.redraw()};let L=0,ne=()=>{s.clear(255,255,255,255);for(let n=0;n<L;n++)J(s,this.p5DrawingStack[n])},J=(n,l=u)=>{if(l.color){n.push(),n.translate(y),n.stroke(l.color),n.strokeWeight(l.weight),n.beginShape();for(let c=0,T=l.pos.length;c<T;c++)n.curveVertex(l.pos[c].x,l.pos[c].y);n.endShape(),n.pop(),n.redraw(),t.redraw()}},nt=n=>{for(let l=0,c=n.length;l<c;l++)J(s,n[l]);L=this.p5DrawingStack.length};t.windowResized=()=>{setTimeout(()=>{this.p5SetCanvasViewportInit()},0)};let u={},b={},lt=n=>{b=n,t.redraw()},st=n=>{b&&b.pos&&b.pos.push(n),t.redraw()},ct=n=>{b.pos.push(n),b.pos.push(n),this.p5DrawingStack.length=L,b&&(this.p5DrawingStack.push(b),J(s,b)),L=this.p5DrawingStack.length,b=null,t.redraw()};const j=56;let Ce,Q,we,fe,Te,K,be,Re=0,le=!1,A=!1;t.mousePressed=n=>{if(I){if(t.mouseY<j||t.mouseY>t.height-j)return void(A=!0);switch(n.which){case 1:this.isCropMode?Pe():Ie();break;case 3:Q=t.createVector(t.mouseX,t.mouseY),K=W.copy(),Ce=t.createVector(t.mouseX,t.mouseY);break;case 2:this.p5SetCanvasViewportInit()}}};let Pe=(n,l)=>{let c=F(n,l),T=H.copy().add(g).sub(t.createVector(s.width/2,s.height/2)),P=c.dist(T),$=.2*t.max(g.x,g.y);le=P<$,le?(fe=t.createVector(t.mouseX,t.mouseY),be=g.copy()):we=t.createVector(t.mouseX,t.mouseY).sub(H.mult(_))},Ie=(n,l)=>{w.style.fill="var(--ion-color-dark)",O.style.fill="var(--ion-color-medium)";let c=F(n,l);c.sub(y),c.add(C);let T={x:c.x,y:c.y},P=V.color().levels,$=`#${t.hex(P[0],2)}${t.hex(P[1],2)}${t.hex(P[2],2)}${t.hex(this.colorPickAlpha,2)}`;u={pos:[],color:$,weight:de*he},u.pos.push(T),u.pos.push(T),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"start",data:u})),t.redraw()};t.mouseDragged=n=>{if(I&&!A)switch(n.which){case 1:if(this.isCropMode){let l=t.createVector(t.mouseX,t.mouseY);le?g=be.copy().add(fe.copy().sub(l).div(-_)):H=we.copy().sub(l).div(-_),t.redraw()}else{let l=F();l.sub(y),l.add(C);let c={x:l.x,y:l.y};u&&u.pos&&u.pos.push(c),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"moved",data:c})),t.redraw()}break;case 3:Ce=t.createVector(t.mouseX,t.mouseY),W=K.copy().add(Ce.sub(Q).div(_)),t.redraw()}},t.mouseWheel=n=>{I&&(t.mouseY<j||t.mouseY>t.height-j?A=!0:(dt(F()),_*=n.deltaY<0?1.1:.9,this.ToggleAutoResolution&&(this.resolutionRatio=t.min(100,100*_),this.resolutionEffectedWidth=t.floor(s.width*this.resolutionRatio/100),this.resolutionEffectedHeight=t.floor(s.height*this.resolutionRatio/100)),t.pixelDensity(t.min(1,1*this.resolutionRatio/100/_)),t.redraw()))},t.mouseReleased=n=>{if(I){if(1===n.which&&!this.isCropMode&&!A){let l=F();l.sub(y),l.add(C);let c={x:l.x,y:l.y};if(u)try{u.pos.push(c),u.pos.push(c),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"end",data:c}))}catch{}Ae()}A=!1}};let dt=n=>{U=t.createVector(t.mouseX,t.mouseY),W=n.mult(-1)},F=(n,l)=>{let c=t.createVector(n||t.mouseX,l||t.mouseY);return c.sub(U),c.div(_),c.sub(W),c},k=[],Z=!1,I=!0,ht=n=>{I=n};t.touchStarted=n=>{if(I){if(k=n.touches,n.changedTouches[0].clientY<j||n.changedTouches[0].clientY>t.height-j)return void(A=!0);switch(Z=!0,k.length){case 1:this.isCropMode?Pe(n.changedTouches[0].clientX,n.changedTouches[0].clientY-j):Ie(n.changedTouches[0].clientX,n.changedTouches[0].clientY-j);break;case 2:let l=t.createVector(k[0].clientX,k[0].clientY-56),c=t.createVector(k[1].clientX,k[1].clientY-56);Re=l.dist(c),Q=l.copy().add(c).div(2),K=W.copy(),Te=_,u=null,this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"cancel"}));break;default:Z=!1,this.p5SetCanvasViewportInit()}}},t.touchMoved=n=>{if(I&&Z){switch(k=n.touches,k.length){case 1:if(this.isCropMode&&!A){let l=t.createVector(n.changedTouches[0].clientX,n.changedTouches[0].clientY-j);le?g=be.copy().add(fe.copy().sub(l).div(-_)):H=we.copy().sub(l).div(-_),t.redraw()}else{let l=F(n.changedTouches[0].clientX,n.changedTouches[0].clientY-j);l.sub(y),l.add(C);let c={x:l.x,y:l.y};u&&u.pos&&u.pos.push(c),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"moved",data:c})),t.redraw()}break;case 2:{let l=t.createVector(k[0].clientX,k[0].clientY-56),c=t.createVector(k[1].clientX,k[1].clientY-56),T=l.copy().add(c).div(2);_=l.dist(c)/Re*Te,W=K.copy().add(T.sub(Q).div(_)),this.ToggleAutoResolution&&(this.resolutionRatio=t.min(100,100*_),this.resolutionEffectedWidth=t.floor(s.width*this.resolutionRatio/100),this.resolutionEffectedHeight=t.floor(s.height*this.resolutionRatio/100)),t.pixelDensity(t.min(1,1*this.resolutionRatio/100/_)),t.redraw()}}return!1}},t.touchEnded=n=>{if(I&&n.changedTouches){switch(k=n.touches,Z=!1,k.length){case 0:if(!this.isCropMode&&!A&&u){let l=F(n.changedTouches[0].clientX,n.changedTouches[0].clientY-j);l.sub(y),l.add(C);let c={x:l.x,y:l.y};u.pos.push(c),u.pos.push(c),this.ReadyToShareAct&&this.webrtc.dataChannel.send(JSON.stringify({type:"draw",act:"end",data:c})),Ae()}break;case 1:if(!Z)return;gt(),Re=0,u=null}A=!1}};let gt=()=>{Q=t.createVector(k[0].clientX,k[0].clientY-56),K=W.copy()},Ae=()=>{if(this.p5DrawingStack.length=L,u)if(this.p5DrawingStack.push(u),this.p5DrawingStack.length>20){let n=this.p5DrawingStack.shift();J(m,n);let l=m.elt.toDataURL("image/png");t.loadImage(l,c=>{x=c,m.redraw()}),ne()}else J(s,u);L=this.p5DrawingStack.length,Q=null,A=!1,u=null,t.redraw()}})}ClickRemoteAddButton(){if(!this.isDrawServerCreated){if(this.IceWebRTCWsClient)return this.isDrawServerCreated=!0,this.global.StoreShortCutAct("voiddraw-remote"),this.p5SetDrawable(!1),this.AddrQRShare.onDidDismiss().then(()=>{this.p5SetDrawable(!0),this.isDrawServerCreated=!1,this.global.RestoreShortCutAct("voiddraw-remote"),this.HasConnectedPeer||this.p5SetDrawable(!0)}),void this.AddrQRShare.present();this.ServerList=this.nakama.get_all_online_server(),this.ServerList.length?(this.p5SetDrawable(!1),this.RemoteDraw.open()):(this.p5SetDrawable(!1),this.RemoteBridgeServerSelected({detail:{value:"local"}}))}}RemoteBridgeServerSelected(o){var i=this;return(0,N.A)(function*(){if(i.isDrawServerCreated)return;let a=o.detail.value;if("local"===a){let t;i.alertCtrl.create({header:i.lang.text.voidDraw.LocalAddrInput,inputs:[{type:"text",placeholder:"(wss://)0.0.0.0(:0)"},{type:"text",placeholder:"rtcport:username:password"}],buttons:[{text:i.lang.text.voidDraw.Confirm,handler:s=>{let C=s[1].split(":");i.Port=C[0],i.username=C[1],i.password=C[2],s[0]?(i.InputCustomAddress=s[0],i.p5SetDrawable(!1),t=!0,i.CreateOnMessageLink(),i.CreateRemoteLocalClient(s[0],s[1])):i.p5toast.show({text:i.lang.text.voidDraw.InputAddress})}}]}).then(s=>{s.onWillDismiss().then(()=>{i.p5SetDrawable(!0)}),s.onDidDismiss().then(()=>{!t&&!i.WillLeaveHere&&i.global.RestoreShortCutAct("voiddraw-remote-bridge")}),i.global.StoreShortCutAct("voiddraw-remote-bridge"),s.present()})}else i.InputCustomAddress=`${a.info.useSSL?"wss":"ws"}://${a.info.address}`,i.p5SetDrawable(!1),i.CreateOnMessageLink(),i.CreateRemoteLocalClient(i.InputCustomAddress,o[1],a.info)})()}CreateRemoteLocalClient(o,i,a){var t=this;return(0,N.A)(function*(){let s=o.split("://"),C=s.pop().split(":");t.TargetRemoteAddress=C[0];let m,h=s.pop();h?h+=":":h=t.global.checkProtocolFromAddress(C[0])?"wss:":"ws:",a?t.AlreadyExistServer=!0:yield t.nakama.SaveWebRTCServer({urls:[`stun:${C[0]}:${t.Port||("wss:"==h?5349:3478)}`,`turn:${C[0]}:${t.Port||("wss"==h?5349:3478)}`],username:t.username||"username",credential:t.password||"password"}).then(x=>t.AlreadyExistServer=x),t.IceWebRTCWsClient=new WebSocket(`${h}//${C[0]}:${C[1]||12013}/`),t.AddShortCut(),t.isDrawServerCreated=!0,t.IceWebRTCWsClient.onopen=(0,N.A)(function*(){t.p5toast.show({text:`${t.lang.text.voidDraw.Connected}: ${C[0]}`}),i?(t.IceWebRTCWsClient.send(JSON.stringify({type:"join",channel:i})),yield new Promise(x=>setTimeout(x,t.global.WebsocketRetryTerm)),t.IceWebRTCWsClient.send(JSON.stringify({type:"size_req",channel:i})),t.RemoteLoadingCtrl=yield t.loadingCtrl.create({message:t.lang.text.voidDraw.WaitingConnection}),t.RemoteLoadingCtrl.present()):t.IceWebRTCWsClient.send(JSON.stringify({type:"init",max:2}))}),t.IceWebRTCWsClient.onmessage=function(){var x=(0,N.A)(function*(B){let D;try{let w=JSON.parse(B.data);if(void 0===m)m=w.uid;else if(m==w.uid)return;switch(w.type){case"join":t.HasConnectedPeer=!0,t.p5SetDrawable(!1);break;case"block":console.error("\uc774\ubbf8 \uc5f0\uacb0\ub41c \uc0ac\uc6a9\uc790 \uc788\uc74c"),t.IceWebRTCWsClient.close(1e3,"block");break;case"leave":t.HasConnectedPeer=!1,t.p5SetDrawable(!0),t.RemoteLoadingCtrl.dismiss(),t.IceWebRTCWsClient.close(1e3,"leave_pair");break;case"init_id":t.QRNavParams={address:o,channel:w.id,user_id:w.uid},t.init_gen_qrcode(),t.AddrQRShare.onDidDismiss().then(()=>{t.isDrawServerCreated=!1,t.global.RestoreShortCutAct("voiddraw-remote"),t.HasConnectedPeer||t.p5SetDrawable(!0)}),t.global.StoreShortCutAct("voiddraw-remote"),t.p5SetDrawable(!1),t.AddrQRShare.present(),t.IceWebRTCWsClient.send(JSON.stringify({type:"join",channel:w.id})),D=w.id;break;case"init_req":t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_Init,t.webrtc.initialize("data").then((0,N.A)(function*(){t.webrtc.HangUpCallBack=()=>{t.IceWebRTCWsClient.close(1e3,"hangup_webrtc")},t.CreateOnMessageLink(),t.CreateOnOpenAct(),t.webrtc.CreateOffer(),yield new Promise(V=>setTimeout(V,t.global.WebsocketRetryTerm)),t.IceWebRTCWsClient.send(JSON.stringify({type:"socket_react",channel:D,act:"WEBRTC_INIT_REQ_SIGNAL"}))}));break;case"size_req":t.AddrQRShare.dismiss(),t.RemoteLoadingCtrl=yield t.loadingCtrl.create({message:t.lang.text.voidDraw.WaitingConnection}),t.RemoteLoadingCtrl.present();let O=t.p5getCropPos();t.IceWebRTCWsClient.send(JSON.stringify({type:"size",width:t.p5ActualCanvas.width,height:t.p5ActualCanvas.height,cropX:O.x,cropY:O.y,channel:D}));break;case"socket_react":switch(w.act){case"WEBRTC_REPLY_INIT_SIGNAL":t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_Reply,t.nakama.socket_reactive[w.act](w.data_str),"EOL"==w.data_str&&(t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_Offer,t.webrtc.CreateAnswer({client:t.IceWebRTCWsClient,channel:D})),t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_Ice;break;case"WEBRTC_ICE_CANDIDATES":t.nakama.socket_reactive[w.act](w.data_str,{client:t.IceWebRTCWsClient,channel:D}),t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_datachannel,t.IceWebRTCWsClient.send(JSON.stringify({type:"init_end",channel:D}));break;case"WEBRTC_INIT_REQ_SIGNAL":t.nakama.socket_reactive[w.act]({client:t.IceWebRTCWsClient,channel:D});break;case"WEBRTC_RECEIVE_ANSWER":t.nakama.socket_reactive[w.act](w.data_str,{client:t.IceWebRTCWsClient,channel:D})}break;case"size":t.create_new_canvas({width:w.width,height:w.height}),t.p5SetDrawable(!1),t.p5setCropPos(w.cropX,w.cropY),t.p5voidDraw.redraw(),t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_Init,t.webrtc.initialize("data").then(()=>{t.webrtc.HangUpCallBack=()=>{t.IceWebRTCWsClient&&t.IceWebRTCWsClient.close(1e3,"hangup_callback")},t.CreateOnOpenAct(),t.CreateOnMessageLink(),t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_Offer,t.webrtc.CreateOffer(),t.IceWebRTCWsClient.send(JSON.stringify({type:"init_req"}))});break;case"init_end":t.RemoteLoadingCtrl.message=t.lang.text.voidDraw.WebRTC_datachannel}}catch{t.IceWebRTCWsClient.close(1e3)}});return function(B){return x.apply(this,arguments)}}(),t.IceWebRTCWsClient.onerror=x=>{console.log("\uadf8\ub9bc\ud310 \uae30\ub2a5 \uacf5\uc720 \uc5f0\uacb0 \uc624\ub958: ",x),t.IceWebRTCWsClient.close(1e3,"error")},t.IceWebRTCWsClient.onclose=x=>{console.log("\uc5f0\uacb0\uc774 \ub04a\uae30\ub294 \uc774\uc720: ",x),t.p5toast.show({text:t.lang.text.TodoDetail.Disconnected}),t.RemoteLoadingCtrl&&t.RemoteLoadingCtrl.dismiss(),t.AddrQRShare.dismiss(),t.isDrawServerCreated=!1,t.p5SetDrawable(!0),t.webrtc.close_webrtc(!1),t.IceWebRTCWsClient.onopen=null,t.IceWebRTCWsClient.onclose=null,t.IceWebRTCWsClient.onmessage=null,t.IceWebRTCWsClient.onerror=null,t.IceWebRTCWsClient=null}})()}CreateOnOpenAct(o=(0,N.A)(function*(){})){var i=this;this.webrtc.dataChannelOpenAct=(0,N.A)(function*(){if(i.ReadyToShareAct=!0,i.p5ClearCurrentDraw(),o&&(yield o()),i.RemoteLoadingCtrl.message=i.lang.text.voidDraw.WebRTC_ShareBG,i.navParams.path)try{let a=i.navParams.path.split(".").pop(),t=yield i.indexed.loadBlobFromUserPath(i.navParams.path,""),s=i.InputCustomAddress.split("://"),C=s.pop(),h=s.shift();h=h?"wss"==h?"https:":"http:":i.global.checkProtocolFromAddress(i.InputCustomAddress)?"https":"http";let m=yield i.global.upload_file_to_storage({blob:t,size:t.size,file_ext:a,filename:`voidDrawRemoveImage.${a}`},{user_id:`tmp_${i.QRNavParams.channel}_${i.QRNavParams.user_id}`},h,C,!1,i.RemoteLoadingCtrl);i.webrtc.dataChannel.send(JSON.stringify({type:"background",data:m}))}catch(a){i.p5toast.show({text:`${i.lang.text.voidDraw.FailedGetBG}: ${a}`}),console.log("\ubc30\uacbd \uadf8\ub9bc \uacf5\uc720\ud558\uae30 \uc624\ub958: ",a)}i.RemoteLoadingCtrl.dismiss(),i.p5SetDrawable(!0)})}CreateOnMessageLink(){this.webrtc.dataChannelOnMsgAct=o=>{let i=JSON.parse(o);switch(i.type){case"drawline":this.p5DrawingStack=i.data,this.p5updateRemoteCurve(i.data),this.p5voidDraw.redraw();break;case"background":this.p5voidDraw.loadImage(i.data,a=>{this.p5BaseImage=a,this.p5ImageCanvas.image(this.p5BaseImage,0,0),this.p5ImageCanvas.redraw(),this.p5SetCanvasViewportInit()},a=>{console.error("\uadf8\ub9bc\ud310 \ubc30\uacbd \uc774\ubbf8\uc9c0 \ubd88\ub7ec\uc624\uae30 \uc624\ub958: ",a),this.p5ImageCanvas.redraw(),this.p5SetCanvasViewportInit()}),this.RemoteLoadingCtrl.dismiss();break;case"draw":switch(i.act){case"start":this.p5RemoteDrawStart(i.data);break;case"moved":this.p5RemoteDrawing(i.data);break;case"cancel":this.p5CancelCurrentDraw();break;case"crop":this.p5setCropPos(i.cropPX,i.cropPY),this.p5setCropSize(i.cropSX,i.cropSY),this.isCropMode=!0,this.p5apply_crop(!1);break;case"end":this.p5RemoteDrawingEnd(i.data)}break;case"same":"history_act"===i.act&&this.p5history_act(i.data,!0)}},this.webrtc.dataChannelOnCloseAct=()=>{this.CancelRemoteAct()}}change_line_weight(){this.p5set_line_weight()}open_crop_tool(){this.p5open_crop_tool()}dismiss_draw(){if(this.isCropMode)this.p5apply_crop();else{if("voiddraw-remote"==this.navParams.dismiss)return void this.navCtrl.pop();this.mainLoading.present(),this.WithoutSave=!1,this.p5save_image()}}ionSelectCancel(){this.p5voidDraw&&this.p5SetDrawable&&!this.isDrawServerCreated&&this.p5SetDrawable(!0)}RemoveShortCut(){this.p5voidDraw&&this.p5SetDrawable&&this.p5SetDrawable(!1),delete this.global.p5KeyShortCut.HistoryAct,delete this.global.p5KeyShortCut.AddAct,delete this.global.p5KeyShortCut.DeleteAct,delete this.global.p5KeyShortCut.SKeyAct,delete this.global.p5KeyShortCut.FKeyAct,delete this.global.p5KeyShortCut.Escape}ionViewWillLeave(){this.p5SetDrawable&&this.p5SetDrawable(!1),this.WillLeaveHere=!0,this.RemoveShortCut(),this.global.RestoreShortCutAct("void-draw")}ionViewDidLeave(){this.WithoutSave&&this.mainLoading.remove()}init_gen_qrcode(){var o=this;return(0,N.A)(function*(){let i=o.QRNavParams.address;o.SelectedAddress=`${yield o.global.GetHeaderAddress()}?voidDraw=${i},${o.QRNavParams.channel},${o.Port||""},${o.username||""},${o.password||""}`.replace(" ","%20"),o.QRCodeSRC=o.global.readasQRCodeFromString(o.SelectedAddress)})()}copy_address(o){this.global.WriteValueToClipboard("text/plain",o)}}return(d=S).\u0275fac=function(o){return new(o||d)(e.rXU(We.y),e.rXU(R.hG),e.rXU(R.Xi),e.rXU(Me.z3),e.rXU(Le.n),e.rXU(Ne.X),e.rXU(Be.G),e.rXU(Ee.j),e.rXU(ae.Ix),e.rXU(ae.nX),e.rXU(je.q9))},d.\u0275cmp=e.VBU({type:d,selectors:[["app-void-draw"]],viewQuery:function(o,i){if(1&o&&(e.GBs(Ge,5),e.GBs(He,5),e.GBs(Xe,5),e.GBs(Oe,5),e.GBs($e,5)),2&o){let a;e.mGM(a=e.lsd())&&(i.ChangeLineWeight=a.first),e.mGM(a=e.lsd())&&(i.RemoteDraw=a.first),e.mGM(a=e.lsd())&&(i.ChangeTransparent=a.first),e.mGM(a=e.lsd())&&(i.ChangeResolution=a.first),e.mGM(a=e.lsd())&&(i.AddrQRShare=a.first)}},decls:29,vars:6,consts:[["RemoteDraw",""],["AddrQRShare",""],["ChangeTransparent",""],["ChangeResolution",""],["ChangeLineWeight",""],[1,"ion-no-border"],["slot","start"],["defaultHref",""],["slot","end","name","clipboard-outline",1,"top_icon",2,"width","24px","height","24px",3,"click"],["class","shortcut_hint","style","left: auto; right: 4px; top: 0px; padding: 2px 8px; border-radius: 8px;",4,"ngIf"],["slot","end","name","save-outline",1,"top_icon",2,"width","24px","height","24px",3,"click"],["oncontextmenu","return false;"],["hidden",""],["value","local",3,"ionChange","ionCancel","label"],["value","local"],[3,"value",4,"ngFor","ngForOf"],[1,"full_screen",2,"display","flex","overflow","hidden","background-color","black",3,"id"],[1,"transparent-modal"],[1,"shortcut_hint",2,"left","auto","right","4px","top","0px","padding","2px 8px","border-radius","8px"],[3,"value"],[2,"display","flex","justify-content","center","align-items","center","height","100%"],[2,"width","400px","min-height","455px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["style","width: 100%; height: auto; cursor: copy; margin-bottom: 8px;","alt","QuickLink",3,"src","click",4,"ngIf"],["button","",3,"click"],[1,"ion-text-center"],["alt","QuickLink",2,"width","100%","height","auto","cursor","copy","margin-bottom","8px",3,"click","src"],["id","colordetailOuter",2,"display","flex","justify-content","center","align-items","center","height","100%",3,"click"],["id","colordetailInner",2,"width","400px","min-height","240px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["max","255",3,"ngModelChange","ionInput","ngModel"],["slot","label",1,"slider_title"],["slot","end",1,"slider_end"],["type","text",1,"slider_input",3,"input","ngModelChange","ngModel"],["id","resolutiondetailOuter",2,"display","flex","justify-content","center","align-items","center","height","100%",3,"click"],["id","resolutiondetailInner",2,"width","400px","min-height","160px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["min","1",3,"ngModelChange","ionInput","ngModel","disabled"],[3,"ionChange","ngModelChange","ngModel"],["id","strokeweightOuter",2,"display","flex","justify-content","center","align-items","center","height","100%",3,"click"],["id","strokeweightInner",2,"width","400px","min-height","160px","background-color","var(--chatroom-background)","text-align","center","padding","16px"],["min","1","max","30",3,"ngModelChange","ionInput","ngModel"],["type","text",1,"slider_input",3,"ngModelChange","input","ngModel"]],template:function(o,i){if(1&o){const a=e.RV6();e.j41(0,"ion-header",5)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",6),e.nrm(5,"ion-back-button",7),e.k0s(),e.j41(6,"ion-icon",8),e.bIt("click",function(){return e.eBV(a),e.Njj(i.p5save_image(!0,!0))}),e.k0s(),e.DNE(7,Fe,2,0,"div",9),e.j41(8,"ion-icon",10),e.bIt("click",function(){return e.eBV(a),e.Njj(i.p5save_image(!0))}),e.k0s()()(),e.j41(9,"ion-content",11)(10,"div",12)(11,"ion-select",13,0),e.bIt("ionChange",function(s){return e.eBV(a),e.Njj(i.RemoteBridgeServerSelected(s))})("ionCancel",function(){return e.eBV(a),e.Njj(i.ionSelectCancel())}),e.j41(13,"ion-select-option",14),e.EFF(14),e.k0s(),e.DNE(15,Ue,2,2,"ion-select-option",15),e.k0s()(),e.nrm(16,"div",16),e.j41(17,"ion-modal",17,1),e.DNE(19,Je,6,2,"ng-template"),e.k0s(),e.j41(20,"ion-modal",17,2),e.DNE(22,Qe,24,13,"ng-template"),e.k0s(),e.j41(23,"ion-modal",17,3),e.DNE(25,ze,13,9,"ng-template"),e.k0s(),e.j41(26,"ion-modal",17,4),e.DNE(28,Ke,14,7,"ng-template"),e.k0s()()}2&o&&(e.R7$(3),e.JRh(i.lang.text.ChatRoom.voidDraw),e.R7$(4),e.Y8G("ngIf",i.global.ShowHint),e.R7$(4),e.Y8G("label",i.lang.text.voidDraw.ConnectToAddress),e.R7$(3),e.JRh(i.lang.text.voidDraw.InternalConn),e.R7$(),e.Y8G("ngForOf",i.ServerList),e.R7$(),e.Y8G("id",i.voidDrawId))},dependencies:[ce.Sq,ce.bT,oe.me,oe.BC,oe.vS,R.QW,R.W9,R.eU,R.iq,R.uz,R.he,R.Ob,R.Nm,R.Ip,R.BC,R.BY,R.ai,R.Sb,R.hB,R.su,R.Je,R.el],styles:[".slider_title[_ngcontent-%COMP%]{width:72px}.slider_end[_ngcontent-%COMP%]{width:40px;margin-left:24px}.slider_input[_ngcontent-%COMP%]{max-width:32px}"]}),S})()}];let qe=(()=>{var d;class S{}return(d=S).\u0275fac=function(o){return new(o||d)},d.\u0275mod=e.$C({type:d}),d.\u0275inj=e.G2t({imports:[ae.iI.forChild(Ze),ae.iI]}),S})(),et=(()=>{var d;class S{}return(d=S).\u0275fac=function(o){return new(o||d)},d.\u0275mod=e.$C({type:d}),d.\u0275inj=e.G2t({imports:[ce.MD,oe.YN,R.bv,qe]}),S})()}}]);